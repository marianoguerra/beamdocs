<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>OS_Mon Release Notes</h1><p>This document describes the changes made to the OS_Mon application.</p><h2>Os_Mon 2.4.7</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Due to <strong>/proc</strong> restrictions in newer Android
releases enforced by SELinux, cpu_sup is fixed so that it
gets some basic CPU stats using the <strong>sysinfo</strong>
syscall rather than reading <strong>/proc/loadavg</strong>.</p> <p>
Own Id: OTP-15387 Aux Id: PR-1966 </p> </li></ul><h2>Os_Mon 2.4.6</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Improved documentation.</p> <p>
Own Id: OTP-15190</p> </li></ul><h2>Os_Mon 2.4.5</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Fix <strong>disksup</strong> to handle mount paths with spaces in
them.</p> <p>
Own Id: OTP-14513</p> </li></ul><h2>Os_Mon 2.4.4</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p> Removed all old unused files in the documentation.
</p> <p>
Own Id: OTP-14475 Aux Id: ERL-409, PR-1493 </p> </li></ul><h2>Os_Mon 2.4.3</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
On macOS 10.13 (High Sierra), disksup could not grab
information for any disks that used the new APFS file
system. That has been corrected.</p> <p>
Own Id: OTP-14560 Aux Id: ERL-461 </p> </li></ul><h2>Os_Mon 2.4.2</h2><h2>Improvements and New Features</h2><ul><li> <p>
Support s390x in os_mon.</p> <p>
Own Id: OTP-14161 Aux Id: PR-1309 </p> </li></ul><h2>Os_Mon 2.4.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Fix type specification for cpu_sup:util/1</p> <p>
Own Id: OTP-13526 Aux Id: PR-1029 </p> </li><li> <p>
Fix strict compilation on SUN/SPARC</p> <p>
Own Id: OTP-13548 Aux Id: PR-1046 </p> </li><li> <p>
Implement cpu_sup:util/0,1 on Mac OSX</p> <p>
Own Id: OTP-13597 Aux Id: PR-1049 </p> </li><li> <p>
Fix memsup:get_os_wordsize() on 64-bit FreeBSD and 64-bit
Linux PPC</p> <p>
Own Id: OTP-13601 Aux Id: PR-1039 </p> </li></ul><h2>Os_Mon 2.4</h2><h2>Improvements and New Features</h2><ul><li> <p>
cpu_sup should use native sysctl/libkvm calls on BSD</p> <p>
This avoids forking off with os:cmd every time we just
want to collect the load averages. riak does this every
second, which results in a lot of unnecessary load.</p> <p>
Own Id: OTP-12730</p> </li><li> <p>
Implement native cpu_sup:util/0,1 for FreeBSD</p> <p>
Own Id: OTP-12796</p> </li></ul><h2>Os_Mon 2.3.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Do not crash with badmatch when integer part of loadavg
has more than 2 digits.</p> <p>
Own Id: OTP-12581</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>
Fix compilation of memsup on OpenBSD.</p> <p>
Own Id: OTP-12404</p> </li></ul><h2>Os_Mon 2.3</h2><h2>Improvements and New Features</h2><ul><li> <p>
Adds a new application parameter 'disksup_posix_only', to
make diskup use only options defined in the POSIX
standard.</p> <p>
Own Id: OTP-12053</p> </li></ul><h2>Os_Mon 2.2.15</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Application upgrade (appup) files are corrected for the
following applications: </p> <p>
<strong>asn1, common_test, compiler, crypto, debugger, dialyzer, edoc, eldap, erl_docgen, et, eunit, gs, hipe, inets, observer, odbc, os_mon, otp_mibs, parsetools, percept, public_key, reltool, runtime_tools, ssh, syntax_tools, test_server, tools, typer, webtool, wx, xmerl</strong></p> <p>
A new test utility for testing appup files is added to
test_server. This is now used by most applications in
OTP.</p> <p>
(Thanks to Tobias Schlager)</p> <p>
Own Id: OTP-11744</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>
Calls to erlang:open_port/2 with 'spawn' are updated to
handle space in the command path.</p> <p>
Own Id: OTP-10842</p> </li></ul><h2>Os_Mon 2.2.14</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Fix incorrect reporting of memory on OS X via memsup.
Thanks to Christopher Meiklejohn.</p> <p>
Own Id: OTP-11454</p> </li></ul><h2>Os_Mon 2.2.13</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Use 'df -k -l' to query FreeBSD and OpenBSD about
diskspace on local disks. Previously 'df' -k -t ufs' was
used but this will not handle zfs or other disks. Just
use '-l' instead of listing potential filesystems.</p> <p>
Own Id: OTP-11207</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>
Fix compilation on Solaris. Thanks to Maciej Malecki.</p> <p>
Own Id: OTP-11213</p> </li><li> <p>
Fix broken cpu_sup:nprocs and others on Solaris 64-bit.
Thanks to Simon Cornish.</p> <p>
Own Id: OTP-11298</p> </li></ul><h2>Os_Mon 2.2.12</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Compilation fixes for NetBSD. Thanks to YAMAMOTO Takashi.</p> <p>
Own Id: OTP-10941</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>
Fixed disksup:get_disk_data for SUSv3, specifically OS X
ML. Thanks to Sriram Melkote.</p> <p>
Own Id: OTP-10945</p> </li></ul><h2>Os_Mon 2.2.11</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Removed deprecated function calls to snmp</p> <p>
Own Id: OTP-10448</p> </li></ul><h2>Os_Mon 2.2.10</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Infinity timeout added to internal calls in disksup to
allow it to work properly under very heavy load.</p> <p>
Own Id: OTP-10100</p> </li><li> <p>Clarify error messages from os_mon port programs</p> <p>
Own Id: OTP-10161</p> </li></ul><h2>Os_Mon 2.2.9</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Fix segmentation fault in memsup</p> <p>
when /proc/meminfo does not include information about
buffers/cache (for instance inside OpenVZ container)
(Thanks to Anton Vorobev)</p> <p>
Own Id: OTP-9913</p> </li></ul><h2>Os_Mon 2.2.8</h2><h2>Improvements and New Features</h2><ul><li> <p>Erlang/OTP can now be built using parallel make if you
limit the number of jobs, for instance using '<strong>make -j6</strong>' or '<strong>make -j10</strong>'. '<strong>make -j</strong>' does not
work at the moment because of some missing
dependencies.</p> <p>
Own Id: OTP-9451</p> </li><li> <p>
Tuple funs (a two-element tuple with a module name and a
function) are now officially deprecated and will be
removed in R16. Use '<strong>fun M:F/A</strong>' instead. To make
you aware that your system uses tuple funs, the very
first time a tuple fun is applied, a warning will be sent
to the error logger.</p> <p>
Own Id: OTP-9649</p> </li></ul><h2>Os_Mon 2.2.7</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>Remove misc. compiler warnings</p> <p>
Own Id: OTP-9542</p> </li></ul><h2>Os_Mon 2.2.6</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Add NetBSD support to memsup and disksup (Thanks to
Andrew Thompson)</p> <p>
Own Id: OTP-9216</p> </li><li> <p>
Add support for DragonFlyBSD to memsup</p> <p>
DragonFly was partially supported by os_mon already but
when trying to start the os_mon application it'd crash
with an error about an unknown operating system in
memsup. This patch changes memsup to use the FreeBSD
sysctl method to get memory information when on
DragonFly. (Thanks to Andrew Thompson )</p> <p>
Own Id: OTP-9217</p> </li></ul><h2>Os_Mon 2.2.5</h2><h2>Improvements and New Features</h2><ul><li> <p>
Cleanups suggested by tidier and modernization of types
and specs.</p> <p>
Own Id: OTP-8455</p> </li></ul><h2>Os_Mon 2.2.4</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
Memsup did not read memory correctly on MaxOSX
Snowleopard. This has now been corrected. (Thanks to Joel
Reymont)</p> <p>
Own Id: OTP-8211</p> </li><li> <p>
Removed unused code in <strong>cpu_sup.erl</strong>.</p> <p>
Own Id: OTP-8226</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>
The documentation is now built with open source tools
(xsltproc and fop) that exists on most platforms. One
visible change is that the frames are removed.</p> <p>
Own Id: OTP-8201</p> </li></ul><h2>Os_Mon 2.2.3</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
A missing define in <strong>memsup.c</strong> caused a build error
on IRIX machines. This has now been fixed.</p> <p>
Own Id: OTP-8094</p> </li></ul><h2>Os_Mon 2.2.2</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
disksup:get_disk_data/0 returned disk volume in bytes
instead of kbytes as stated in the documentation. The
problem occurred on Windows only and is now corrected.</p> <p>
*** POTENTIAL INCOMPATIBILITY ***</p> <p>
Own Id: OTP-7741</p> </li></ul><h2>Os_Mon 2.2.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>An error in <strong>memsup</strong> could cause <strong>os_mon</strong> to
report erroneous memory values on windows for ranges of
memory between 2GB and 4GB. This have now been fixed.</p> <p>
Own Id: OTP-7944</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>Added support for dragonfly OS.</p> <p>
Own Id: OTP-7938</p> </li></ul><h2>Os_Mon 2.2</h2><h2>Improvements and New Features</h2><ul><li> <p>The copyright notices have been updated.</p> <p>
Own Id: OTP-7851</p> </li></ul><h2>Os_Mon 2.1.8</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>A problem with <strong>OTP-OS-MON-MIB.mib</strong> for 64-bit
environments has now been fixed. The mib has been
extended with 64-bit memory retrieval
counterparts.</p><p>In addition, a new function
<strong>get_os_wordsize/0</strong> has been added in the
<strong>memsup</strong> module</p> <p>
Own Id: OTP-7441</p> </li><li> <p>An error in <strong>memsup.c</strong> caused the compilation to
crash on bsd environments. This has now been fixed.</p> <p>
Own Id: OTP-7558</p> </li></ul><h2>Os_Mon 2.1.7</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>Fixed a build error that occurred on NetBSD (Thanks to
Per Hedeland and Raphael Langerhorst)</p> <p>
Own Id: OTP-7505</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p> Memory information in
<strong>memsup:get_system_memory_data/0</strong> now has additional
entries in its property list for linux.</p> <p>
Own Id: OTP-7409 Aux Id: seq10984 </p> </li></ul><h2>Os_Mon 2.1.6</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>
System information retrieval on darwin platforms with
environments locales not conforming to the C locale
caused an error in <strong>cpu_sup</strong> resulting in process
termination.</p> <p>
Own Id: OTP-7320</p> </li></ul><h2>Os_Mon 2.1.5</h2><h2>Improvements and New Features</h2><ul><li> <p>
CPU utilization, on linux, is now measured via a port
program instead of os:cmd in erlang. This should enhance
performance.</p> <p>
Own Id: OTP-7108 Aux Id: OTP-6935 </p> </li></ul><h2>Os_Mon 2.1.3</h2><h2>Improvements and New Features</h2><ul><li> <p>
Extended memsup memory probing on linux to use a port
program to probe memory usage. This is faster then the
previous implementation.</p> <p>
Own Id: OTP-6860 Aux Id: seq10616 </p> </li></ul><h2>Os_Mon 2.1.2.1</h2><h2>Improvements and New Features</h2><ul><li> <p>Minor Makefile changes.</p> <p>Own Id: OTP-6689</p> </li></ul><h2>OS_Mon 2.1.2</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>When the <strong>memsup_system_only</strong> flag was set to
<strong>true</strong>, a <strong>badmatch</strong> exception occurred in the
function <strong>os_mon_mib:get_load/1</strong>.</p> <p>Own Id: OTP-6351 Aux Id: seq10517</p> </li></ul><h2>OS_Mon 2.1.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>Did not build on Mac OS X.</p> <p>Added support for IRIX. (Thanks to Michel Urvoy and
Daniel Solaz.)</p> <p>Own Id: OTP-6136</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p><strong>disksup</strong>: Now using <strong>round(T*100)</strong> instead of
<strong>trunc(T*100)</strong> when setting the threshold value
given a float <strong>T</strong>.</p> <p>Own Id: OTP-6153</p> </li></ul><h2>Os_Mon 2.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>In 2.0, a call to <strong>alarm_handler:get_alarms/0</strong> was
introduced in <strong>memsup</strong> and <strong>disksup</strong>. This will
lead to problems if the default <strong>alarm_handler</strong>
event handler is not used, however, and the call has now
been removed. (Thanks to Serge Aleynikov for pointing
this out.)</p> <p>Own Id: OTP-6029</p> </li><li> <p>A bug that in rare cases caused <strong>cpu_sup</strong> to crash
has been corrected.</p> <p>Own Id: OTP-6102 Aux Id: seq10312 </p> </li></ul><h2>OS_Mon 2.0</h2><p>A note on backwards compatibility: The behaviour of OS_Mon 2.0 is
backwards compatible under normal operation, but has changed
somewhat in error situations: The services do not terminate
and the API functions do not raise exceptions in all cases where
they did before. Also, in the case where a service does terminate,
the exit reason may be different. See below for details.</p><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>A call to a OS_Mon service (cpu_sup, disksup, ...) when
OS_Mon is not running, or when the service is not
available for the OS, or when the service is not started,
will no longer result in an exception. Instead a warning
is issued via error_logger and a dummy value is returned,
which one is specified in the man pages for the
respective service.</p> <p>The reason is that it should not be necessary for a
service to be started on each and every node of a
distributed Erlang system for the OS-MON-MIB and other
OS_Mon users to work properly.</p> <p>Own Id: OTP-4332 Aux Id: seq7358 </p> </li><li> <p>References to the obsolete EVA application in
OTP-OS-MON-MIB has been removed.</p> <p>Own Id: OTP-5699</p> </li><li> <p>Setting the option <strong>memsup_system_only</strong> to
<strong>true</strong> did not work, but would crash the
<strong>memsup</strong> process.</p> <p>Own Id: OTP-5890 Aux Id: seq10185 </p> </li><li> <p><strong>cpu_sup:nprocs/0</strong> returned 0 on FreeBsd.</p> <p>Own Id: OTP-5901</p> </li><li> <p>If the OS_Mon service <strong>disksup</strong> or <strong>memsup</strong> was
restarted, the same alarm could be set twice. Also, set
alarms were not cleared when the application was stopped.</p> <p>Own Id: OTP-5910</p> </li></ul><h2>Improvements and New Features</h2><ul><li> <p>Thresholds and time intervals in <strong>disksup</strong> and
<strong>memsup</strong> are now configurable in run-time.</p> <p>Own Id: OTP-4246 Aux Id: Seq7230 </p> </li><li> <p><strong>memsup</strong> can now handle systems with more than 4GB
of RAM.</p> <p>Own Id: OTP-5800 Aux Id: seq10130 </p> </li><li> <p>The entire OS_Mon application (code and documentation)
has been reviewed and consequently updated with the goal
to make the application more robust, homogeneous and
easier to configure.</p> <p>The behaviour under normal operation is backwards
compatible. However, recoverable errors now no longer
terminate the affected service (and thus possible the
entire application), instead <strong>error_logger</strong> is used
to warn the user if/when such errors occurs. Also, in the
case of unrecoverable errors, the services have been made
more homogeneous with respect to behavior and exit
reasons. See below for more information and refer to the
man pages for details.</p> <p>Port handling has been unified, meaning that if a port
program sends garbage or unexpectedly dies, this is now
handled the same way by all OS_Mon services, namely
immediate process termination with the exit reason
<strong>{port_error,Garbage}</strong> or <strong>{port_died,Reason}</strong>,
respectively.</p> <p>Application configuration parameter handling has been
unified. Bad parameter values are no longer silently
ignored (<strong>disksup</strong>) or cause application termination
(<strong>memsup</strong>, <strong>os_sup</strong>). Instead a warning is
issued and the default value for the parameter is used.
Also, some cases where a bad parameter value accidentally
could be accepted have been corrected.</p> <p>Message handling has been unified. Unknown
(<strong>gen_server-</strong>) calls cause process termination,
whereas unknown casts and messages are now ignored by all
OS_Mon services.</p> <p>Own Id: OTP-5897</p> </li><li> <p>The following changes have been made to the <strong>os_sup</strong>
service:</p> <p>It is now available on Windows, using <strong>nteventlog</strong>
as backend.</p> <p>On Solaris, enabling the service (that is, installing a
new configuration file for <strong>syslogd</strong> etc.) can now
be done outside the <strong>os_sup</strong> process. The reason for
this is that the Erlang emulator should normally not be
run with <strong>root</strong> privileges, as is otherwise
required. The new application configuration parameter
<strong>os_sup_config</strong> must be set to <strong>false</strong>.</p> <p>Also, <strong>os_sup</strong> can now be configured using a new
configuration parameter <strong>os_sup_mfa</strong> to call an
arbitrary Erlang function when a message is received from
the OS.</p> <p>Own Id: OTP-5925</p> </li><li> <p>The <strong>memsup</strong> service has been rewritten, replacing
the supervised <strong>memsup_helper</strong> with a linked help
process. This gives the <strong>memsup</strong> process more
control and prevents a situation where it gets out of
synch with the received memory data and thus possibly
returns erroneous results.</p> <p>Own Id: OTP-5927</p> </li></ul><h2>OS_Mon 1.8.1</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p><strong>cpu_sup:util/0</strong> failed with error reason
<strong>negative_diff</strong> when called the first time on a
machine (hw) that had been up for a very long time.</p> <p>Own Id: OTP-5869 Aux Id: seq10166</p> </li></ul><h2>OS_Mon 1.8</h2><h2>Improvements and New Features</h2><ul><li> <p>The memsup part of the OS_Mon application has been made
more stable. If there are (possibly temporary) problems
collecting memory data, the interface functions
(<strong>get_memory_data/0</strong>,
<strong>get_system_memory_data/0</strong>) now do not fail, but
return the previously collected value, if any, or a dummy
value otherwise. Also, a warning message is printed.</p> <p>*** POTENTIAL INCOMPATIBILITY ***</p> <p>Own Id: OTP-5798</p> </li></ul><h2>OS_Mon 1.7.4</h2><h2>Fixed Bugs and Malfunctions</h2><ul><li> <p>Corrected several problems in the error handling/error
recovery (especially when OS_Mon is starting up).</p> <p>Own Id: OTP-5559</p> </li></ul><h2>OS_Mon 1.7.3</h2><h2>Improvements and New Features</h2><ul><li> <p><strong>memsup.c</strong> will now compile on OpenBSD. (Thanks to
Geoff White and Jay Nelson.)</p> <p>The <strong>disksup</strong> and <strong>cpu_sup</strong> modules now work on
Mac OS X (tested on Mac OS 10.3.8).</p> <p>The <strong>memsup</strong> module should now work on Linux 2.6.* as
well as on older Linuxes. (<strong>/proc/meminfo</strong> has
slightly different formats in different releases of
Linux.)</p> <p>Own Id: OTP-5421            <br/>
Aux Id: OTP-5194, OTP-5228, OTP-5291 </p> </li></ul><h2>OS_Mon 1.7.2</h2><p>This version is identical with 1.7.</p></body></html>
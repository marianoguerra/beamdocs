<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>Definition of Agent Net if</h1><img src="snmp_agent_netif_1.gif" title="The Purpose of Agent Net if"></img><p>The Network Interface (Net if) process delivers SNMP PDUs to a
master agent, and receives SNMP PDUs from the master agent. The most
common behaviour of a Net if process is that is receives bytes from
a network, decodes them into an SNMP PDU, which it sends to a master
agent. When the master agent has processed the PDU, it sends a
response PDU to the Net if process, which encodes the PDU into bytes
and transmits the bytes onto the network.
</p><p>However, that simple behaviour can be modified in numerous
ways. For example, the Net if process can apply some kind of
encrypting/decrypting scheme on the bytes or
act as a proxy filter, which sends some packets to a proxy agent and
some packets to the master agent.
</p><p>It is also possible to write your own Net if process. The default
Net if process is implemented in the module <strong>snmpa_net_if</strong> and
it uses UDP as the transport protocol i.e the transport domains
<strong>transportDomainUdpIpv4</strong> and/or <strong>transportDomainUdpIpv6</strong>.
</p><p>This section describes how to write a Net if process.
</p><a name="mandatory_functions"></a><h2>Mandatory Functions</h2><p>A Net if process must implement the SNMP agent 
<a href="snmpa_network_interface">network interface behaviour</a>.
</p><a name="messages"></a><h2>Messages</h2><p>The section <em>Messages</em> describes mandatory messages, which
Net if must send and be able to receive.     
</p><p>In this section an <strong>Address</strong> field is a
<strong>{Domain, Addr}</strong> tuple where <strong>Domain</strong> is
<strong>transportDomainUdpIpv4</strong> or <strong>transportDomainUdpIpv4</strong>,
and <strong>Addr</strong> is an
<strong>{</strong><a href="../kernel/inet#type-ip_address">kernel/inet#type-ip_address</a><strong>,IpPort}</strong> tuple.</p><a name="outgoing_messages"></a><h2>Outgoing Messages</h2><p>Net if must send the following message when it receives an
SNMP PDU from the network that is aimed for the MasterAgent:
</p><a name="om_snmp_pdu"></a><pre>
MasterAgent ! {snmp_pdu, Vsn, Pdu, PduMS, ACMData, From, Extra}
      </pre><ul><li><strong>Vsn</strong> is either <strong>'version-1'</strong>, <strong>'version-2'</strong>, or <strong>'version-3'</strong>. </li><li><strong>Pdu</strong> is an SNMP PDU record, as defined in <strong>snmp_types.hrl</strong>, with the SNMP request. </li><li><strong>PduMS</strong> is the Maximum Size of the response Pdu allowed.  Normally this is returned from <strong>snmpa_mpd:process_packet</strong> (see Reference Manual). </li><li><strong>ACMData</strong> is data used by the Access Control Module in use.  Normally this is returned from <strong>snmpa_mpd:process_packet</strong> (see Reference Manual). </li><li><strong>From</strong> is the source <strong>Address</strong>. </li><li><strong>Extra</strong> is any term the Net if process wishes to send to the agent. This term can be retrieved by the instrumentation functions by calling <strong>snmp:current_net_if_data()</strong>. This data is also sent back to the Net if process when the agent generates a response to the request.</li></ul><p>The following message is used to report that a response to a
request has been received.  The only request an agent can send
is an Inform-Request.
</p><a name="om_snmp_response_received"></a><pre>
Pid ! {snmp_response_received, Vsn, Pdu, From}
      </pre><ul><li><strong>Pid</strong> is the Process that waits for the response for the request.  The Pid was specified in the <strong>send_pdu_req</strong> message  <a href="#im_send_pdu_req">(see below)</a>. </li><li><strong>Vsn</strong> is either <strong>'version-1'</strong>, <strong>'version-2'</strong>, or <strong>'version-3'</strong>. </li><li><strong>Pdu</strong> is the SNMP Pdu received </li><li><strong>From</strong> is the source <strong>Address</strong>. </li></ul><a name="incoming_messages"></a><h2>Incoming Messages</h2><p>This section describes the incoming messages which a Net if
process must be able to receive.
</p><ul><li> <a name="im_snmp_response"></a> <p><strong>{snmp_response, Vsn, Pdu, Type, ACMData, To, Extra}</strong></p> <p>This message is sent to the Net if process from a master
agent as a response to a previously received request.
</p> <ul><li> <p><strong>Vsn</strong> is either <strong>'version-1'</strong>,
<strong>'version-2'</strong>, or <strong>'version-3'</strong>. </p> </li><li> <p><strong>Pdu</strong> is an SNMP PDU record (as defined in
snmp_types.hrl) with the SNMP response. </p> </li><li> <p><strong>Type</strong> is the <strong>#pdu.type</strong> 
of the original request. </p> </li><li> <p><strong>ACMData</strong> is data used by the Access Control
Module in use.  Normally this is just sent to
<strong>snmpa_mpd:generate_response_message</strong> 
(see Reference Manual). </p> </li><li> <p><strong>To</strong> is the destination <strong>Address</strong> that comes
from the <strong>From</strong> field in the corresponding <strong>snmp_pdu</strong>
message previously sent to the MasterAgent.</p> </li><li> <p><strong>Extra</strong> is the term that the Net if process
sent to the agent when the request was sent to the agent. </p> </li></ul> </li><li> <a name="im_discarded_pdu"></a> <p><strong>{discarded_pdu, Vsn, ReqId, ACMData, Variable, Extra}</strong></p> <p>This message is sent from a master agent if it for some
reason decided to discard the pdu. </p> <ul><li> <p><strong>Vsn</strong> is either <strong>'version-1'</strong>,
<strong>'version-2'</strong>, or <strong>'version-3'</strong>. </p> </li><li> <p><strong>ReqId</strong> is the request id of the original request. </p> </li><li> <p><strong>ACMData</strong> is data used by the Access Control
Module in use. Normally this is just sent to
<strong>snmpa_mpd:generate_response_message</strong> 
(see Reference Manual). </p> </li><li> <p><strong>Variable</strong> is the name of an snmp counter that
represents the error, e.g. <strong>snmpInBadCommunityUses</strong>. </p> </li><li> <p><strong>Extra</strong> is the term that the Net if process
sent to the agent when the request was sent to the agent. </p> </li></ul> </li><li> <a name="im_send_pdu"></a> <p><strong>{send_pdu, Vsn, Pdu, MsgData, To, Extra}</strong></p> <p>This message is sent from a master agent when a trap is
to be sent. </p> <ul><li> <p><strong>Vsn</strong> is either <strong>'version-1'</strong>,
<strong>'version-2'</strong>, or <strong>'version-3'</strong>.</p> </li><li> <p><strong>Pdu</strong> is an SNMP PDU record (as defined in
snmp_types.hrl) with the SNMP response. </p> </li><li> <p><strong>MsgData</strong> is the message specific data used in
the SNMP message.  This value is normally sent to
<strong>snmpa_mpd:generate_message/4</strong>.  In SNMPv1 and
SNMPv2c, this message data is the community string.  In
SNMPv3, it is the context information. </p> </li><li> <p><strong>To</strong> is a list of <strong>{Address, SecData}</strong>
tuples i.e the destination addresses and
their corresponding security parameters.  This value is
normally sent to <strong>snmpa_mpd:generate_message/4</strong>. </p> </li><li> <p><strong>Extra</strong> is any term that the notification sender
wishes to pass to the Net if process when sending a notification 
(see 
<a href="./snmpa#send_notification2">send notification </a> for more info). </p> </li></ul> </li><li> <a name="im_send_pdu_req"></a> <p><strong>{send_pdu_req, Vsn, Pdu, MsgData, To, Pid, Extra}</strong></p> <p>This message is sent from a master agent when a request is to 
be sent.  The only request an agent can send is Inform-Request.  
The net if process needs to remember the request id and the Pid, 
and when a response is received for the request id, send it to Pid, 
using a <strong>snmp_response_received</strong> message. </p> <ul><li> <p><strong>Vsn</strong> is either <strong>'version-1'</strong>,
<strong>'version-2'</strong>,  or <strong>'version-3'</strong>.</p> </li><li> <p><strong>Pdu</strong> is an SNMP PDU record (as defined in
snmp_types.hrl) with the SNMP response. </p> </li><li> <p><strong>MsgData</strong> is the message specific data used in
the SNMP message.  This value is normally sent to
<strong>snmpa_mpd:generate_message/4</strong>. In SNMPv1 and
SNMPv2c, this message data is the community string. In
SNMPv3, it is the context information. </p> </li><li> <p><strong>To</strong> is a list of <strong>{Address, SecData}</strong>
tuples i.e the destination addresses and
their corresponding security parameters. This value is
normally sent to <strong>snmpa_mpd:generate_message/4</strong>. </p> </li><li> <p><strong>Pid</strong> is a process identifier. </p> </li><li> <p><strong>Extra</strong> is any term that the notification sender
wishes to pass to the Net if process when sending a notification 
(see 
<a href="./snmpa#send_notification2">send notification </a> for more info). </p> </li></ul> </li></ul><h2>Notes</h2><p>Since the Net if process is responsible for encoding and
decoding of SNMP messages, it must also update the relevant
counters in the SNMP group in MIB-II. It can use the functions
in the module <strong>snmpa_mpd</strong> for this purpose (refer to the 
Reference Manual, section <strong>snmp</strong>, 
module <a href="snmp_pdus">snmpa_mpd</a>
for more details.)
</p><p>There are also some useful functions for encoding and
decoding of SNMP messages in the module 
<a href="snmp_pdus">snmp_pdus</a>.
</p></body></html>
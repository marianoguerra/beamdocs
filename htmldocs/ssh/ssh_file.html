<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>ssh_file</h1><h1>ssh_file</h1><p>Default callback module for the client's and server's database operations in the ssh application</p><p>This module is the default callback handler for the client's and the server's user and host "database" operations.
All data, for instance key pairs, are stored in files in the normal file system. This page documents the files, where they
are stored and configuration options for this callback module.
The intention is to be compatible with the
<a href="http://www.openssh.com">OpenSSH</a>
storage in files. Therefore it mimics directories and filenames of
<a href="http://www.openssh.com">OpenSSH</a>.
Ssh_file implements the <a href="./ssh_server_key_api">ssh_server_key_api</a> and
the <a href="./ssh_client_key_api">ssh_client_key_api</a>.
This enables the user to make an own interface using for example a database handler.
Such another callback module could be used by setting the option
<a href="../ssh/ssh#type-key_cb_common_option">ssh/ssh#type-key_cb_common_option</a>
when starting a client or a server (with for example
<a href="../ssh/ssh#connect-3">ssh:connect</a>,
<a href="../ssh/ssh#daemon-2">ssh:daemon</a> of
<a href="../ssh/ssh#shell-1">ssh:shell</a>
).
</p><h2>Files, directories and who uses them</h2><h2>Daemons</h2><p>Daemons uses all files stored in the <a href="#SYSDIR">SYSDIR</a> directory.
</p><p>Optionaly, in case of <strong>publickey</strong> authorization, one or more of the remote user's public keys
in the <a href="#USERDIR">USERDIR</a> directory are used.
See the files 
<a href="#USERDIR-authorized_keys">USERDIR-authorized_keys</a> and
<a href="#USERDIR-authorized_keys2">USERDIR-authorized_keys2</a>.
</p><h2>Clients</h2><p>Clients uses all files stored in the <a href="#USERDIR">USERDIR</a> directory.
</p><h2>Directory contents</h2><dl><dt><a name="LOCALUSER"></a>LOCALUSER</dt><dd><p>The user name of the OS process running the Erlang virtual machine (emulator).</p> </dd><dt><a name="SYSDIR"></a>SYSDIR</dt><dd><p>This is the directory holding the server's files:</p> <ul><li><a name="SYSDIR-ssh_host_dsa_key"></a><strong>ssh_host_dsa_key</strong> - private dss host key (optional)</li><li><a name="SYSDIR-ssh_host_rsa_key"></a><strong>ssh_host_rsa_key</strong> - private rsa host key (optional)</li><li><a name="SYSDIR-ssh_host_ecdsa_key"></a><strong>ssh_host_ecdsa_key</strong> - private ecdsa host key (optional)</li><li><a name="SYSDIR-ssh_host_ed25519_key"></a><strong>ssh_host_ed25519_key</strong> - private eddsa host key for curve 25519 (optional)</li><li><a name="SYSDIR-ssh_host_ed448_key"></a><strong>ssh_host_ed448_key</strong> - private eddsa host key for curve 448 (optional)</li></ul> <p>At least one host key must be defined. The default value of SYSDIR is <a name="#/etc/ssh"></a><strong>/etc/ssh</strong>.
</p> <p>For security reasons, this directory is normally accessible only to the root user.
</p> <p>To change the SYSDIR, see the <a href="#type-system_dir_daemon_option">system_dir</a> option.
</p> </dd><dt><a name="USERDIR"></a>USERDIR</dt><dd><p>This is the directory holding the files:</p> <ul><li><a name="USERDIR-authorized_keys"></a><strong>authorized_keys</strong> and, as second alternative <a name="USERDIR-authorized_keys2"></a><strong>authorized_keys2</strong> -  the user's public keys are stored concatenated in one of those files. </li><li><a name="USERDIR-known_hosts"></a><strong>known_hosts</strong> - host keys from hosts visited concatenated. The file is created and used by the client.</li><li><a name="USERDIR-id_dsa"></a><strong>id_dsa</strong> - private dss user key (optional)</li><li><a name="USERDIR-id_rsa"></a><strong>id_rsa</strong> - private rsa user key (optional)</li><li><a name="USERDIR-id_ecdsa"></a><strong>id_ecdsa</strong> - private ecdsa user key (optional)</li><li><a name="USERDIR-id_ed25519"></a><strong>id_ed25519</strong> - private eddsa user key for curve 25519 (optional)</li><li><a name="USERDIR-id_ed448"></a><strong>id_ed448</strong> - private eddsa user key for curve 448 (optional)</li></ul> <p>The default value of USERDIR is <strong>/home/</strong><a href="#LOCALUSER">LOCALUSER</a><strong>/.ssh</strong>.
</p> <p>To change the USERDIR, see the <a href="#type-user_dir_common_option">user_dir</a> option
</p> </dd></dl><h1>Data Types</h1><h2>Options for the default ssh_file callback module</h2><span class="name">user_dir_common_option</span><p>Sets the <a href="#USERDIR">user directory</a>.</p><span class="name">user_dir_fun_common_option</span><span class="name">user2dir</span><p>Sets the <a href="#USERDIR">user directory</a> dynamically
by evaluating the <strong>user2dir</strong> function.
</p><span class="name">system_dir_daemon_option</span><p>Sets the <a href="#SYSDIR">system directory</a>.</p><span class="name">pubkey_passphrase_client_options</span><p>If the user's DSA, RSA or ECDSA key is protected by a passphrase, it can be
supplied with thoose options.
</p><p>Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.</p><h1>Functions</h1><h2>host_key(Algorithm, DaemonOptions) -&gt; {ok, Key} | {error, Reason}</h2><p><span class="strong">Types and description</span></p><p>See the api description in
<a href="../ssh/ssh_server_key_api#Module:host_key-2">ssh_server_key_api, Module:host_key/2</a>.
</p><p><span class="strong">Options</span></p><ul><li><a href="#type-system_dir_daemon_option">system_dir</a></li></ul><p><span class="strong">Files</span></p><ul><li><a href="#SYSDIR-ssh_host_rsa_key">SYSDIR-ssh_host_rsa_key</a></li><li><a href="#SYSDIR-ssh_host_dsa_key">SYSDIR-ssh_host_dsa_key</a></li><li><a href="#SYSDIR-ssh_host_ecdsa_key">SYSDIR-ssh_host_ecdsa_key</a></li><li><a href="#SYSDIR-ssh_host_ed25519_key">SYSDIR-ssh_host_ed25519_key</a></li><li><a href="#SYSDIR-ssh_host_ed448_key">c&gt;</a></li></ul><h2>is_auth_key(PublicUserKey, User, DaemonOptions) -&gt; Result</h2><p><span class="strong">Types and description</span></p><p>See the api description in
<a href="../ssh/ssh_server_key_api#Module:is_auth_key-3">ssh_server_key_api: Module:is_auth_key/3</a>.
</p><p><span class="strong">Options</span></p><ul><li><a href="#type-user_dir_fun_common_option">user_dir_fun</a></li><li><a href="#type-user_dir_common_option">user_dir</a></li></ul><p><span class="strong">Files</span></p><ul><li><a href="#USERDIR-authorized_keys">USERDIR-authorized_keys</a></li><li><a href="#USERDIR-authorized_keys2">USERDIR-authorized_keys2</a></li></ul><h2>add_host_key(HostNames, PublicHostKey, ConnectOptions) -&gt; ok | {error, Reason}</h2><p><span class="strong">Types and description</span></p><p>See the api description in
<a href="../ssh/ssh_client_key_api#Module:add_host_key-3">ssh_client_key_api, Module:add_host_key/3</a>.
</p><p><span class="strong">Option</span></p><ul><li><a href="#type-user_dir_common_option">user_dir</a></li></ul><p><span class="strong">File</span></p><ul><li><a href="#USERDIR-known_hosts">USERDIR-known_hosts</a></li></ul><h2>is_host_key(Key, Host, Algorithm, ConnectOptions) -&gt; Result</h2><p><span class="strong">Types and description</span></p><p>See the api description in
<a href="../ssh/ssh_client_key_api#Module:is_host_key-4">ssh_client_key_api, Module:is_host_key/4</a>.
</p><p><span class="strong">Option</span></p><ul><li><a href="#type-user_dir_common_option">user_dir</a></li></ul><p><span class="strong">File</span></p><ul><li><a href="#USERDIR-known_hosts">USERDIR-known_hosts</a></li></ul><h2>user_key(Algorithm, ConnectOptions) -&gt; {ok, PrivateKey} | {error, Reason}</h2><p><span class="strong">Types and description</span></p><p>See the api description in
<a href="../ssh/ssh_client_key_api#Module:user_key-2">ssh_client_key_api, Module:user_key/2</a>.
</p><p><span class="strong">Options</span></p><ul><li><a href="#type-user_dir_common_option">user_dir</a></li><li><a href="#type-pubkey_passphrase_client_options">dsa_pass_phrase</a></li><li><a href="#type-pubkey_passphrase_client_options">rsa_pass_phrase</a></li><li><a href="#type-pubkey_passphrase_client_options">ecdsa_pass_phrase</a></li></ul><p>Note that EdDSA passhrases (Curves 25519 and 448) are not implemented.</p><p><span class="strong">Files</span></p><ul><li><a href="#USERDIR-id_dsa">USERDIR-id_dsa</a></li><li><a href="#USERDIR-id_rsa">USERDIR-id_rsa</a></li><li><a href="#USERDIR-id_ecdsa">USERDIR-id_ecdsa</a></li><li><a href="#USERDIR-id_ed25519">USERDIR-id_ed25519</a></li><li><a href="#USERDIR-id_ed448">USERDIR-id_ed448</a></li></ul></body></html>
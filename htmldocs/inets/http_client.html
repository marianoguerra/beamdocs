<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>HTTP Client</h1><h2>Configuration</h2><p>The HTTP client default profile is started when the <strong>Inets</strong>
application is started and is then available to all processes on
that Erlang node. Other profiles can also be started at
application startup, or profiles can be started and stopped
dynamically in runtime. Each client profile spawns a new
process to handle each request, unless a persistent connection 
can be used with or without pipelining.
The client adds a <strong>host</strong> header and an empty
<strong>te</strong> header if there are no such headers present in the request.</p><p>The client supports IPv6 as long as the underlying mechanisms also do
so.</p><p>The following is to be put in the Erlang node application configuration file
to start a profile at application startup:</p><pre>
      [{inets, [{services, [{httpc, PropertyList}]}]}]</pre><p>For valid properties, see 
<a href="httpc">httpc(3)</a>. </p><h2>Getting Started</h2><p>Start <strong>Inets</strong>:</p><pre><code class="erl">
 1 &gt; inets:start().
      ok</code></pre><p>The following calls use the default client profile.
Use the proxy <strong>"www-proxy.mycompany.com:8000"</strong>,
except from requests to localhost. This applies to all the
following requests.</p><p>Example:</p><pre><code class="erl">
      2 &gt; httpc:set_options([{proxy, {{"www-proxy.mycompany.com", 8000},
      ["localhost"]}}]).
      ok</code></pre><p>The following is an ordinary synchronous request:</p><pre><code class="erl">
      3 &gt; {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} =
      httpc:request(get, {"http://www.erlang.org", []}, [], []).</code></pre><p>With all the default values presented, a get request can also be written
as follows:</p><pre><code class="erl">
      4 &gt; {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} =
      httpc:request("http://www.erlang.org").</code></pre><p>The following is an ordinary asynchronous request:</p><pre><code class="erl">
      5 &gt; {ok, RequestId} =
      httpc:request(get, {"http://www.erlang.org", []}, [], [{sync, false}]).</code></pre><p>The result is sent to the calling process as
<strong>{http, {ReqestId, Result}}</strong>.</p><p>In this case, the calling process is the shell, so the following
result is received:</p><pre><code class="erl">
      6 &gt; receive {http, {RequestId, Result}} -&gt; ok after 500 -&gt; error end.
      ok</code></pre><p>This sends a request with a specified connection header:</p><pre><code class="erl">
      7 &gt; {ok, {{NewVersion, 200, NewReasonPhrase}, NewHeaders, NewBody}} =
      httpc:request(get, {"http://www.erlang.org", [{"connection", "close"}]},
      [], []).</code></pre><p>This sends an HTTP request over a unix domain socket (experimental):</p><pre><code class="erl">
      8 &gt; httpc:set_options([{ipfamily, local},
      {unix_socket,"/tmp/unix_socket/consul_http.sock"}]).
      9 &gt; {ok, {{NewVersion, 200, NewReasonPhrase}, NewHeaders, NewBody}} =
      httpc:request(put, {"http:///v1/kv/foo", [], [], "hello"}, [], []).</code></pre><p>Start an HTTP client profile:</p><pre><code class="">
      10 &gt; {ok, Pid} = inets:start(httpc, [{profile, foo}]).
      {ok, &lt;0.45.0&gt;}       
      </code></pre><p>The new profile has no proxy settings, so the connection is refused:</p><pre><code class="erl">
      11 &gt; httpc:request("http://www.erlang.org", foo).
      {error, econnrefused}</code></pre><p>Stop the HTTP client profile:</p><pre><code class="erl">
      12 &gt; inets:stop(httpc, foo).
      ok</code></pre><p>Alternative way to stop the HTTP client profile:</p><pre><code class="erl">
      13 &gt; inets:stop(httpc, Pid).
      ok</code></pre></body></html>
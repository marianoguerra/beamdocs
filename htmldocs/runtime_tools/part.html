<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>Runtime Tools User's Guide</h1><p><em>Runtime Tools</em></p><h3>Introduction</h3><p>The Linux Trace Toolkit: next generation is an open source system software package
for correlated tracing of the Linux kernel, user applications and libraries. </p><p>For more information, please visit <a href="http://lttng.org">http://lttng.org</a></p><h3>Building Erlang/OTP with LTTng support</h3><p>
Configure and build Erlang with LTTng support:
</p><p>For LTTng to work properly with Erlang/OTP you need
the following packages installed:</p><ul><li><p>LTTng-tools: a command line interface to control tracing sessions.</p></li><li><p>LTTng-UST: user space tracing library.</p></li></ul><p>On Ubuntu this can be installed via <strong>aptitude</strong>:</p><pre><code class="">$ sudo aptitude install lttng-tools liblttng-ust-dev</code></pre><p>See <a href="http://lttng.org/docs/#doc-installing-lttng">Installing LTTng</a>
for more information on how to install LTTng on your system.</p><p>After LTTng is properly installed on the system Erlang/OTP can be built with LTTng support.</p><pre><code class="">$ ./configure --with-dynamic-trace=lttng
$ make </code></pre><h3>Dyntrace Tracepoints</h3><p>All tracepoints are in the domain of <strong>org_erlang_dyntrace</strong></p><p>All Erlang types are the string equivalent in LTTng.</p><p><em>process_spawn</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>parent : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>entry : string</strong> :: Code Location. Ex. <strong>"lists:sort/1"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>procs</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">process_spawn: { cpu_id = 3 }, { pid = "&lt;0.131.0&gt;", parent = "&lt;0.130.0&gt;", entry = "erlang:apply/2" }</code></pre><p><em>process_link</em></p><ul><li><strong>to : string</strong> :: Process ID or Port ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>from : string</strong> :: Process ID or Port ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>type : string</strong> :: <strong>"link" | "unlink"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>procs</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">process_link: { cpu_id = 3 }, { from = "&lt;0.130.0&gt;", to = "&lt;0.131.0&gt;", type = "link" }</code></pre><p><em>process_exit</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>reason : string</strong> :: Exit reason. Ex. <strong>"normal"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>procs</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">process_exit: { cpu_id = 3 }, { pid = "&lt;0.130.0&gt;", reason = "normal" }</code></pre><p><em>process_register</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>name : string</strong> :: Registered name. Ex. <strong>"logger"</strong></li><li><strong>type : string</strong> :: <strong>"register" | "unregister"</strong></li></ul><p>Example:</p><pre><code class="">process_register: { cpu_id = 0 }, { pid = "&lt;0.128.0&gt;", name = "dyntrace_lttng_SUITE" type = "register" }</code></pre><p><em>process_scheduled</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>entry : string</strong> :: Code Location. Ex. <strong>"lists:sort/1"</strong></li><li><strong>type : string</strong> :: <strong>"in" | "out" | "in_exiting" | "out_exiting" | "out_exited"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>running</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">process_scheduled: { cpu_id = 0 }, { pid = "&lt;0.136.0&gt;", entry = "erlang:apply/2", type = "in" }</code></pre><p><em>port_open</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>ports</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">port_open: { cpu_id = 5 }, { pid = "&lt;0.131.0&gt;", driver = "'/bin/sh -s unix:cmd'", port = "#Port&lt;0.1887&gt;" }</code></pre><p><em>port_exit</em></p><ul><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>reason : string</strong> :: Exit reason. Ex. <strong>"normal"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>ports</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">port_exit: { cpu_id = 5 }, { port = "#Port&lt;0.1887&gt;", reason = "normal" }</code></pre><p><em>port_link</em></p><ul><li><strong>to : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>from : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>type : string</strong> :: <strong>"link" | "unlink"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>ports</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">port_link: { cpu_id = 5 }, { from = "#Port&lt;0.1887&gt;", to = "&lt;0.131.0&gt;", type = "unlink" }</code></pre><p><em>port_scheduled</em></p><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>running</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><ul><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>entry : string</strong> :: Callback. Ex. <strong>"open"</strong></li><li><strong>type : string</strong> :: <strong>"in" | "out" | "in_exiting" | "out_exiting" | "out_exited"</strong></li></ul><p>Example:</p><pre><code class="">port_scheduled: { cpu_id = 5 }, { pid = "#Port&lt;0.1905&gt;", entry = "close", type = "out" }</code></pre><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>running</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p><em>function_call</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>entry : string</strong> :: Code Location. Ex. <strong>"lists:sort/1"</strong></li><li><strong>depth : integer</strong> :: Stack depth. Ex. <strong>0</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>call</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">function_call: { cpu_id = 5 }, { pid = "&lt;0.145.0&gt;", entry = "dyntrace_lttng_SUITE:'-t_call/1-fun-1-'/0", depth = 0 }</code></pre><p><em>function_return</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>entry : string</strong> :: Code Location. Ex. <strong>"lists:sort/1"</strong></li><li><strong>depth : integer</strong> :: Stack depth. Ex. <strong>0</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>call</strong> or <strong>return_to</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">function_return: { cpu_id = 5 }, { pid = "&lt;0.145.0&gt;", entry = "dyntrace_lttng_SUITE:waiter/0", depth = 0 }</code></pre><p><em>function_exception</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>entry : string</strong> :: Code Location. Ex. <strong>"lists:sort/1"</strong></li><li><strong>class : string</strong> :: Error reason. Ex. <strong>"error"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>call</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">function_exception: { cpu_id = 5 }, { pid = "&lt;0.144.0&gt;", entry = "t:call_exc/1", class = "error" }</code></pre><p><em>message_send</em></p><ul><li><strong>from : string</strong> :: Process ID or Port ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>to : string</strong> :: Process ID or Port ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>message : string</strong> :: Message sent. Ex. <strong>"{&lt;0.162.0&gt;,ok}"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>send</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">message_send: { cpu_id = 3 }, { from = "#Port&lt;0.1938&gt;", to = "&lt;0.160.0&gt;", message = "{#Port&lt;0.1938&gt;,eof}" }</code></pre><p><em>message_receive</em></p><ul><li><strong>to : string</strong> :: Process ID or Port ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>message : string</strong> :: Message received. Ex. <strong>"{&lt;0.162.0&gt;,ok}"</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>'receive'</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">message_receive: { cpu_id = 7 }, { to = "&lt;0.167.0&gt;", message = "{&lt;0.165.0&gt;,ok}" }</code></pre><p><em>gc_minor_start</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>need : integer</strong> :: Heap need. Ex. <strong>2</strong></li><li><strong>heap : integer</strong> :: Young heap word size. Ex. <strong>233</strong></li><li><strong>old_heap : integer</strong> :: Old heap word size. Ex. <strong>233</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>garbage_collection</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">gc_minor_start: { cpu_id = 0 }, { pid = "&lt;0.172.0&gt;", need = 0, heap = 610, old_heap = 0 }</code></pre><p><em>gc_minor_end</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>reclaimed : integer</strong> :: Heap reclaimed. Ex. <strong>2</strong></li><li><strong>heap : integer</strong> :: Young heap word size. Ex. <strong>233</strong></li><li><strong>old_heap : integer</strong> :: Old heap word size. Ex. <strong>233</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>garbage_collection</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">gc_minor_end: { cpu_id = 0 }, { pid = "&lt;0.172.0&gt;", reclaimed = 120, heap = 1598, old_heap = 1598 }</code></pre><p><em>gc_major_start</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>need : integer</strong> :: Heap need. Ex. <strong>2</strong></li><li><strong>heap : integer</strong> :: Young heap word size. Ex. <strong>233</strong></li><li><strong>old_heap : integer</strong> :: Old heap word size. Ex. <strong>233</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>garbage_collection</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">gc_major_start: { cpu_id = 0 }, { pid = "&lt;0.172.0&gt;", need = 8, heap = 2586, old_heap = 1598 }</code></pre><p><em>gc_major_end</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>reclaimed : integer</strong> :: Heap reclaimed. Ex. <strong>2</strong></li><li><strong>heap : integer</strong> :: Young heap word size. Ex. <strong>233</strong></li><li><strong>old_heap : integer</strong> :: Old heap word size. Ex. <strong>233</strong></li></ul><p>
Available through
<a href="../erts/erlang#trace-3">erts/erlang#trace-3</a> with trace flag <strong>garbage_collection</strong> and <strong>{tracer,dyntrace,[]}</strong> as tracer module.
</p><p>Example:</p><pre><code class="">gc_major_end: { cpu_id = 0 }, { pid = "&lt;0.172.0&gt;", reclaimed = 240, heap = 4185, old_heap = 0 }</code></pre><h3>BEAM Tracepoints</h3><p>All tracepoints are in the domain of <strong>org_erlang_otp</strong></p><p>All Erlang types are the string equivalent in LTTng.</p><p><em>scheduler_poll</em></p><ul><li><strong>scheduler : integer</strong> :: Scheduler ID. Ex. <strong>1</strong></li><li><strong>runnable : integer</strong> :: Runnable. Ex. <strong>1</strong></li></ul><p>Example:</p><pre><code class="">scheduler_poll: { cpu_id = 4 }, { scheduler = 1, runnable = 1 }</code></pre><p><em>driver_init</em></p><ul><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>major : integer</strong> :: Major version. Ex. <strong>3</strong></li><li><strong>minor : integer</strong> :: Minor version. Ex. <strong>1</strong></li><li><strong>flags : integer</strong> :: Flags. Ex. <strong>1</strong></li></ul><p>Example:</p><pre><code class="">driver_init: { cpu_id = 2 }, { driver = "caller_drv", major = 3, minor = 3, flags = 1 }</code></pre><p><em>driver_start</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li></ul><p>Example:</p><pre><code class="">driver_start: { cpu_id = 2 }, { pid = "&lt;0.198.0&gt;", driver = "caller_drv", port = "#Port&lt;0.3676&gt;" }</code></pre><p><em>driver_output</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>bytes : integer</strong> :: Size of data returned. Ex. <strong>82</strong></li></ul><p>Example:</p><pre><code class="">driver_output: { cpu_id = 2 }, { pid = "&lt;0.198.0&gt;", port = "#Port&lt;0.3677&gt;", driver = "/bin/sh -s unix:cmd", bytes = 36 }</code></pre><p><em>driver_outputv</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>bytes : integer</strong> :: Size of data returned. Ex. <strong>82</strong></li></ul><p>Example:</p><pre><code class="">driver_outputv: { cpu_id = 5 }, { pid = "&lt;0.194.0&gt;", port = "#Port&lt;0.3663&gt;", driver = "tcp_inet", bytes = 3 }</code></pre><p><em>driver_ready_input</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_ready_input: { cpu_id = 5 }, { pid = "&lt;0.189.0&gt;", port = "#Port&lt;0.3637&gt;", driver = "inet_gethost 4 " }</code></pre><p><em>driver_ready_output</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_ready_output: { cpu_id = 5 }, { pid = "&lt;0.194.0&gt;", port = "#Port&lt;0.3663&gt;", driver = "tcp_inet" }</code></pre><p><em>driver_timeout</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_timeout: { cpu_id = 5 }, { pid = "&lt;0.196.0&gt;", port = "#Port&lt;0.3664&gt;", driver = "tcp_inet" }</code></pre><p><em>driver_stop_select</em></p><ul><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_stop_select: { cpu_id = 5 }, { driver = "unknown" }</code></pre><p><em>driver_flush</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_flush: { cpu_id = 7 }, { pid = "&lt;0.204.0&gt;", port = "#Port&lt;0.3686&gt;", driver = "tcp_inet" }</code></pre><p><em>driver_stop</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_stop: { cpu_id = 5 }, { pid = "[]", port = "#Port&lt;0.3673&gt;", driver = "tcp_inet" }</code></pre><p><em>driver_process_exit</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p><em>driver_ready_async</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li></ul><p>Example:</p><pre><code class="">driver_ready_async: { cpu_id = 3 }, { pid = "&lt;0.181.0&gt;", port = "#Port&lt;0.3622&gt;", driver = "tcp_inet" }</code></pre><p><em>driver_call</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>command : integer</strong> :: Command integer. Ex. <strong>1</strong></li><li><strong>bytes : integer</strong> :: Size of data returned. Ex. <strong>82</strong></li></ul><p>Example:</p><pre><code class="">driver_call: { cpu_id = 2 }, { pid = "&lt;0.202.0&gt;", port = "#Port&lt;0.3676&gt;", driver = "caller_drv", command = 0, bytes = 2 }</code></pre><p><em>driver_control</em></p><ul><li><strong>pid : string</strong> :: Process ID. Ex. <strong>"&lt;0.131.0&gt;"</strong></li><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>driver : string</strong> :: Driver name. Ex. <strong>"tcp_inet"</strong></li><li><strong>command : integer</strong> :: Command integer. Ex. <strong>1</strong></li><li><strong>bytes : integer</strong> :: Size of data returned. Ex. <strong>82</strong></li></ul><p>Example:</p><pre><code class="">driver_control: { cpu_id = 3 }, { pid = "&lt;0.32767.8191&gt;", port = "#Port&lt;0.0&gt;", driver = "forker", command = 83, bytes = 32 }</code></pre><p><em>aio_pool_get</em></p><ul><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>length : integer</strong> :: Async queue length. Ex. <strong>0</strong></li></ul><p>Example:</p><pre><code class="">aio_pool_get: { cpu_id = 4 }, { port = "#Port&lt;0.3614&gt;", length = 0 }</code></pre><p><em>aio_pool_put</em></p><ul><li><strong>port : string</strong> :: Port ID. Ex. <strong>"#Port&lt;0.1031&gt;"</strong></li><li><strong>length : integer</strong> :: Async queue length. Ex. <strong>-1</strong></li></ul><p>Async queue length is not defined for <strong>put</strong> operations.</p><p>Example:</p><pre><code class="">aio_pool_put: { cpu_id = 3 }, { port = "#Port&lt;0.3614&gt;", length = -1 }</code></pre><p><em>carrier_create</em></p><ul><li><strong>type : string</strong> :: Carrier type. Ex. <strong>"ets_alloc"</strong></li><li><strong>instance : integer</strong> :: Allocator instance. Ex. <strong>1</strong></li><li><strong>size : integer</strong> :: Carrier size. Ex. <strong>262144</strong></li><li><strong>mbc_carriers : integer</strong> :: Number of multiblock carriers in instance. Ex. <strong>3</strong></li><li><strong>mbc_carriers_size : integer</strong> :: Total size of multiblock blocks carriers in instance. Ex. <strong>1343488</strong></li><li><strong>mbc_blocks : integer</strong> :: Number of multiblock blocks in instance. Ex. <strong>122</strong></li><li><strong>mbc_blocks_size : integer</strong> :: Total size of all multiblock blocks in instance. Ex. <strong>285296</strong></li><li><strong>sbc_carriers : integer</strong> :: Number of singleblock carriers in instance. Ex. <strong>1</strong></li><li><strong>sbc_carriers_size : integer</strong> :: Total size of singleblock blocks carriers in instance. Ex. <strong>1343488</strong></li><li><strong>sbc_blocks : integer</strong> :: Number of singleblocks in instance. Ex. <strong>1</strong></li><li><strong>sbc_blocks_size : integer</strong> :: Total size of all singleblock blocks in instance. Ex. <strong>285296</strong></li></ul><p>Example:</p><pre><code class="">carrier_create: { cpu_id = 2 }, { type = "ets_alloc", instance = 7, size = 2097152, mbc_carriers = 4, mbc_carriers_size = 3440640, mbc_blocks = 526, mbc_blocks_size = 1278576, sbc_carriers = 0, sbc_carriers_size = 0, sbc_blocks = 0, sbc_blocks_size = 0 }</code></pre><p><em>carrier_destroy</em></p><ul><li><strong>type : string</strong> :: Carrier type. Ex. <strong>"ets_alloc"</strong></li><li><strong>instance : integer</strong> :: Allocator instance. Ex. <strong>1</strong></li><li><strong>size : integer</strong> :: Carrier size. Ex. <strong>262144</strong></li><li><strong>mbc_carriers : integer</strong> :: Number of multiblock carriers in instance. Ex. <strong>3</strong></li><li><strong>mbc_carriers_size : integer</strong> :: Total size of multiblock blocks carriers in instance. Ex. <strong>1343488</strong></li><li><strong>mbc_blocks : integer</strong> :: Number of multiblock blocks in instance. Ex. <strong>122</strong></li><li><strong>mbc_blocks_size : integer</strong> :: Total size of all multiblock blocks in instance. Ex. <strong>285296</strong></li><li><strong>sbc_carriers : integer</strong> :: Number of singleblock carriers in instance. Ex. <strong>1</strong></li><li><strong>sbc_carriers_size : integer</strong> :: Total size of singleblock blocks carriers in instance. Ex. <strong>1343488</strong></li><li><strong>sbc_blocks : integer</strong> :: Number of singleblocks in instance. Ex. <strong>1</strong></li><li><strong>sbc_blocks_size : integer</strong> :: Total size of all singleblock blocks in instance. Ex. <strong>285296</strong></li></ul><p>Example:</p><pre><code class="">carrier_destroy: { cpu_id = 6 }, { type = "ets_alloc", instance = 7, size = 262144, mbc_carriers = 3, mbc_carriers_size = 3178496, mbc_blocks = 925, mbc_blocks_size = 2305336, sbc_carriers = 0, sbc_carriers_size = 0, sbc_blocks = 0, sbc_blocks_size = 0 }</code></pre><p><em>carrier_pool_put</em></p><ul><li><strong>type : string</strong> :: Carrier type. Ex. <strong>"ets_alloc"</strong></li><li><strong>instance : integer</strong> :: Allocator instance. Ex. <strong>1</strong></li><li><strong>size : integer</strong> :: Carrier size. Ex. <strong>262144</strong></li></ul><p>Example:</p><pre><code class="">carrier_pool_put: { cpu_id = 3 }, { type = "ets_alloc", instance = 5, size = 1048576 }</code></pre><p><em>carrier_pool_get</em></p><ul><li><strong>type : string</strong> :: Carrier type. Ex. <strong>"ets_alloc"</strong></li><li><strong>instance : integer</strong> :: Allocator instance. Ex. <strong>1</strong></li><li><strong>size : integer</strong> :: Carrier size. Ex. <strong>262144</strong></li></ul><p>Example:</p><pre><code class="">carrier_pool_get: { cpu_id = 7 }, { type = "ets_alloc", instance = 4, size = 3208 }</code></pre><h3>Example of process tracing</h3><p>An example of process tracing of <strong>os_mon</strong> and friends.</p><p>Clean start of lttng in a bash shell.</p><pre>$ lttng create erlang-demo
Spawning a session daemon
Session erlang-demo created.
Traces will be written in /home/egil/lttng-traces/erlang-demo-20160526-165920</pre><p>Start an Erlang node with lttng enabled.</p><pre>$ erl
Erlang/OTP 19 [erts-8.0] [source-4d7b24d] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false] [lttng]

Eshell V8.0  (abort with ^G)
1&gt;</pre><p>Load the <strong>dyntrace</strong> module.</p><pre>1&gt; <span class="input">l(dyntrace).</span>
{module,dyntrace}</pre><p>All tracepoints via dyntrace are now visibile and can be listed through <strong>lttng list -u</strong>.</p><p>Enable the process_register LTTng tracepoint for Erlang.</p><pre>$ lttng enable-event -u org_erlang_dyntrace:process_register
UST event org_erlang_dyntrace:process_register created in channel channel0</pre><p>Enable process tracing for new processes and use <strong>dyntrace</strong> as tracer backend.</p><pre>2&gt; <span class="input">erlang:trace(new,true,[procs,{tracer,dyntrace,[]}]).</span>
0</pre><p>Start LTTng tracing.</p><pre>$ lttng start
Tracing started for session erlang-demo</pre><p>Start the <strong>os_mon</strong> application in Erlang.</p><pre>3&gt; <span class="input">application:ensure_all_started(os_mon).</span>
{ok,[sasl,os_mon]}</pre><p>Stop LTTng tracing and view the result.</p><pre>$ lttng stop
Tracing stopped for session erlang-demo
$ lttng view
[17:20:42.561168759] (+?.?????????) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.66.0&gt;", name = "sasl_sup", type = "register" }
[17:20:42.561215519] (+0.000046760) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.67.0&gt;", name = "sasl_safe_sup", type = "register" }
[17:20:42.562149024] (+0.000933505) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.68.0&gt;", name = "alarm_handler", type = "register" }
[17:20:42.571035803] (+0.008886779) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.69.0&gt;", name = "release_handler", type = "register" }
[17:20:42.574939868] (+0.003904065) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.74.0&gt;", name = "os_mon_sup", type = "register" }
[17:20:42.576818712] (+0.001878844) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.75.0&gt;", name = "disksup", type = "register" }
[17:20:42.580032013] (+0.003213301) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.76.0&gt;", name = "memsup", type = "register" }
[17:20:42.583046339] (+0.003014326) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.78.0&gt;", name = "cpu_sup", type = "register" }
[17:20:42.586206242] (+0.003159903) elxd1168lx9 org_erlang_dyntrace:process_register: \
    { cpu_id = 5 }, { pid = "&lt;0.82.0&gt;", name = "timer_server", type = "register" }</pre><a name="History"></a><h3>History</h3><p>
The first implementation of DTrace probes for the Erlang virtual
machine was presented at the <a href="http://www.erlang.org/euc/08/">2008 Erlang User Conference</a>.  That
work, based on the Erlang/OTP R12 release, was discontinued due to
what appears to be miscommunication with the original developers.
</p><p>
Several users have created Erlang port drivers, linked-in drivers, or
NIFs that allow Erlang code to try to activate a probe,
e.g. <strong>foo_module:dtrace_probe("message goes here!")</strong>.
</p><a name="Goals"></a><h3>Goals</h3><ul><li> Annotate as much of the Erlang VM as is practical. </li><li> The initial goal is to trace file I/O operations. </li><li> Support all platforms that implement DTrace: OS X, Solaris, and (I hope) FreeBSD and NetBSD. </li><li> To the extent that it's practical, support SystemTap on Linux via DTrace provider compatibility. </li><li> Allow Erlang code to supply annotations. </li></ul><a name="Supported-platforms"></a><h3>Supported platforms</h3><ul><li> OS X 10.6.x / Snow Leopard, OS X 10.7.x / Lion and probably newer versions. </li><li> Solaris 10.  I have done limited testing on Solaris 11 and OpenIndiana release 151a, and both appear to work. </li><li> FreeBSD 9.0 and 10.0. </li><li> Linux via SystemTap compatibility.  Please see <a href="SYSTEMTAP">$ERL_TOP/HOWTO/SYSTEMTAP.md</a> for more details. </li></ul><p>
Just add the <strong>--with-dynamic-trace=dtrace</strong> option to your command when you 
run the <strong>configure</strong> script. If you are using systemtap, the configure option 
is <strong>--with-dynamic-trace=systemtap</strong>
</p><a name="Status"></a><h3>Status</h3><p>
As of R15B01, the dynamic trace code is included in the OTP source distribution,
although it's considered experimental. The main development of the dtrace code 
still happens outside of Ericsson, but there is no need to fetch a patched 
version of the OTP source to get the basic functionality.
</p><a name="DTrace-probe-specifications"></a><h3>DTrace probe specifications</h3><p>
Probe specifications can be found in <strong>erts/emulator/beam/erlang_dtrace.d</strong>, and
a few example scripts can be found under <strong>lib/runtime_tools/examples/</strong>.
</p><a name="Introduction"></a><h3>Introduction</h3><p>
SystemTap is DTrace for Linux. In fact Erlang's SystemTap support
is build using SystemTap's DTrace compatibility's layer. For an
introduction to Erlang DTrace support read <a href="DTRACE">$ERL_TOP/HOWTO/DTRACE.md</a>.
</p><a name="Requisites"></a><h3>Requisites</h3><ul><li> <p>Linux Kernel with UTRACE support
</p> <p>check for UTRACE support in your current kernel:
</p> <pre><code class="">
# grep CONFIG_UTRACE /boot/config-`uname -r`
CONFIG_UTRACE=y
</code></pre> <p>Fedora 16 is known to contain UTRACE, for most other Linux distributions
a custom build kernel will be required.
Check Fedora's SystemTap documentation for additional required packages
(e.g. Kernel Debug Symbols)
</p> </li><li> <p>SystemTap &gt; 1.6
</p> <p>A the time of writing this, the latest released version of SystemTap is
version 1.6. Erlang's DTrace support requires a MACRO that was introduced
after that release. So either get a newer release or build SystemTap from
git yourself (see: http://sourceware.org/systemtap/getinvolved.html)
</p> </li></ul><a name="Building-Erlang"></a><h3>Building Erlang</h3><p>
Configure and build Erlang with SystemTap support:
</p><pre><code class="">
# ./configure --with-dynamic-trace=systemtap + whatever args you need
# make
</code></pre><a name="Testing"></a><h3>Testing</h3><p>
SystemTap, unlike DTrace, needs to know what binary it is tracing and has to
be able to read that binary before it starts tracing. Your probe script
therefor has to reference the correct beam emulator and stap needs to be able
to find that binary.
The examples are written for "beam", but other versions such as "beam.smp" or
"beam.debug.smp" might exist (depending on your configuration). Make sure you
either specify the full the path of the binary in the probe or your "beam"
binary is in the search path.
</p><p>
All available probes can be listed like this:
</p><pre><code class="">
# stap -L 'process("beam").mark("*")'
</code></pre><p>
or:
</p><pre><code class="">
# PATH=/path/to/beam:$PATH stap -L 'process("beam").mark("*")'
</code></pre><p>
Probes in the dtrace.so NIF library like this:
</p><pre><code class="">
# PATH=/path/to/dtrace/priv/lib:$PATH stap -L 'process("dtrace.so").mark("*")'
</code></pre><a name="Running-SystemTap-scripts"></a><h3>Running SystemTap scripts</h3><p>
Adjust the process("beam") reference to your beam version and attach the script
to a running "beam" instance:
</p><pre><code class="">
# stap /path/to/probe/script/port1.systemtap -x &lt;pid of beam&gt;
</code></pre></body></html>
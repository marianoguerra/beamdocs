<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>SASL User's Guide</h1><p>The System Architecture Support Libraries SASL application
provides support for alarm handling, release handling, and
related functions.</p><h3>Scope</h3><p>The SASL application provides support for:</p><ul><li>Error logging</li><li>Alarm handling</li><li>Release handling</li><li>Report browsing</li></ul><p>Section
<a href="error_logging">SASL Error Logging</a> 
describes the error
handler that produces the supervisor, progress, and crash
reports, which can be written to screen or to a specified file.
It also describes the Report Browser (RB).</p><p>The sections about release structure and release handling have
been moved to section
<a href="./users_guide">OTP Design Principles</a>
in <em>System Documentation</em>.</p><h3>Prerequisites</h3><p>It is assumed that the reader is familiar with the Erlang
programming language.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The SASL error logging concept described in this section is
deprecated since Erlang/OTP 21.0, when the
new <a href="./logger_chapter">logging API</a> was introduced.</p><p>The new default behaviour is that the SASL application no
longer affects which log events that are logged.
<a href="#supervisor_report">Supervisor reports</a> and <a href="#crash_report">crash reports</a> are logged via the default logger handler
which is setup by
Kernel. <a href="#progress_report">Progress reports</a> are by default not logged, but can be enabled
by setting the primary log level to <strong>info</strong>, for example by
using the Kernel configuration
parameter <a href="../kernel/kernel_app#logger_level">kernel/kernel_app#logger_level</a>.</p><p>The old SASL error logging behaviour can be re-enabled by setting the
Kernel configuration
parameter <a href="../kernel/kernel_app#logger_sasl_compatible">kernel/kernel_app#logger_sasl_compatible</a> to <strong>true</strong>.</p><p>The mechanism
for <a href="#multi_file_logging">multi-file error report logging</a> as described in this section is also kept for
backwards compatibility. However, the new logging API also
introduces <a href="./logger_disk_log_h">kernel/logger_disk_log_h</a>, which is a logger
handler that can print to multiple files
using <a href="./disk_log">kernel/disk_log</a>.</p></div><h3>SASL reports</h3><p>The SASL application introduces three types of reports:</p><ul><li>Supervisor report</li><li>Progress report</li><li>Crash report</li></ul><p>When the SASL application is started, it adds a Logger handler
that formats and writes these reports, as specified in
the <a href="./sasl_app#deprecated_error_logger_config">configuration parameters for SASL</a>.</p><a name="supervisor_report"></a><h3>Supervisor Report</h3><p>A supervisor report is issued when a supervised child terminates
unexpectedly. A supervisor report contains the following
items:</p><dl><dt><strong>Supervisor</strong></dt><dd><p>Name of the reporting supervisor.</p></dd><dt><strong>Context</strong></dt><dd><p>Indicates in which phase the child terminated
from the supervisor's point of view. This can be
<strong>start_error</strong>, <strong>child_terminated</strong>, or
<strong>shutdown_error</strong>.</p></dd><dt><strong>Reason</strong></dt><dd><p>Termination reason.</p></dd><dt><strong>Offender</strong></dt><dd><p>Start specification for the child.</p></dd></dl><a name="progress_report"></a><h3>Progress Report</h3><p>A progress report is issued when a supervisor starts or
restarts a child. A progress report contains the following items:</p><dl><dt><strong>Supervisor</strong></dt><dd><p>Name of the reporting supervisor.</p></dd><dt><strong>Started</strong></dt><dd><p>Start specification for the successfully
started child.</p></dd></dl><a name="CRASH"></a><a name="crash_report"></a><h3>Crash Report</h3><p>Processes started with functions 
<a href="../stdlib/proc_lib#spawn/1">stdlib/proc_lib#spawn/1</a> or
<a href="../stdlib/proc_lib#spawn_link/1">stdlib/proc_lib#spawn_link/1</a> 
are wrapped within a <strong>catch</strong>. A crash report is issued when such 
a process terminates with an unexpected reason, which is any reason 
other than <strong>normal</strong>, <strong>shutdown</strong>, or <strong>{shutdown,Term}</strong>.
Processes using behaviors
<a href="./gen_server">stdlib/gen_server</a>,
<a href="./gen_fsm">stdlib/gen_fsm</a> or
<a href="./gen_statem">stdlib/gen_statem</a>
are examples of such processes. A crash report contains the following items:</p><dl><dt><strong>Crasher</strong></dt><dd><p>Information about the crashing process, such
as initial function call, exit reason, and message queue.</p></dd><dt><strong>Neighbours</strong></dt><dd><p>Information about processes that are linked to the crashing
process and do not trap exits. These processes are the
neighbours that terminate because of this process
crash. The information gathered is the same as the information
for Crasher, described in the previous item.</p></dd></dl><h3>Example</h3><p>The following example shows the reports generated
when a process crashes. The example process is a
<strong>permanent</strong> process supervised by the <strong>test_sup</strong>
supervisor. A division by zero is executed and the error is
first reported by the faulty process. A crash report is
generated, as the process was started using function
<a href="../stdlib/proc_lib#spawn/3">stdlib/proc_lib#spawn/3</a>. 
The supervisor generates a
supervisor report showing the crashed process. A
progress report is generated when the process is finally
restarted.</p><pre>
        =ERROR REPORT==== 27-May-1996::13:38:56 ===
        &lt;0.63.0&gt;: Divide by zero !
        
        =CRASH REPORT==== 27-May-1996::13:38:56 ===
        crasher:
        pid: &lt;0.63.0&gt;
        registered_name: []
        error_info: {badarith,{test,s,[]}}
        initial_call: {test,s,[]}
        ancestors: [test_sup,&lt;0.46.0&gt;]
        messages: []
        links: [&lt;0.47.0&gt;]
        dictionary: []
        trap_exit: false
        status: running
        heap_size: 128
        stack_size: 128
        reductions: 348
        neighbours:
        
        =SUPERVISOR REPORT==== 27-May-1996::13:38:56 ===
        Supervisor: {local,test_sup}
        Context:    child_terminated
        Reason:     {badarith,{test,s,[]}}
        Offender:   [{pid,&lt;0.63.0&gt;},
        {name,test},
        {mfa,{test,t,[]}},
        {restart_type,permanent},
        {shutdown,200},
        {child_type,worker}]
        
        =PROGRESS REPORT==== 27-May-1996::13:38:56 ===
        Supervisor: {local,test_sup}
        Started:  [{pid,&lt;0.64.0&gt;},
        {name,test},
        {mfa,{test,t,[]}},
        {restart_type,permanent},
        {shutdown,200},
        {child_type,worker}]</pre><a name="multi_file_logging"></a><h3>Multi-File Error Report Logging</h3><p>Multi-file error report logging is used to store error messages
received by <strong>error_logger</strong>. The error messages
are stored in several files and each file is smaller than a
specified number of kilobytes. No more than a specified number
of files exist at the same time. The logging is very fast, as
each error message is written as a binary term.</p><p>For more details, see the
<a href="./sasl_app#deprecated_error_logger_config">sasl_app#deprecated_error_logger_config</a>
application in the Reference Manual.</p><h3>Report Browser</h3><p>The report browser is used to browse and format error reports
written by the error logger handler 
<a href="./log_mf_h">stdlib/log_mf_h</a> 
defined in STDLIB.</p><p>The <strong>log_mf_h</strong> handler writes all reports to a
report logging directory, which is specified when
configuring the SASL application.</p><p>If the report browser is
used offline, the reports can be copied to another directory
specified when starting the browser. If no such directory
is specified, the browser reads reports from the SASL
<strong>error_logger_mf_dir</strong>.</p><h3>Starting Report Browser</h3><p>Start the <strong>rb_server</strong> with function
<a href="./rb#start/1">rb#start/1</a> 
as shown in the following example:</p><pre>
        5&gt; <span class="input">rb:start([{max, 20}]).</span>
        rb: reading report...done.
        rb: reading report...done.
        rb: reading report...done.
        rb: reading report...done.
        {ok,&lt;0.199.0&gt;}</pre><h3>Online Help</h3><p>Enter command 
<a href="./rb#help/0">rb#help/0</a> 
to access the report browser online help system.</p><h3>List Reports in Server</h3><p>Use function 
<a href="./rb#list/0">rb#list/0</a> 
to list all loaded reports:</p><pre>
        4&gt; <span class="input">rb:list().</span>
        No                Type          Process       Date     Time
        ==                ====          =======       ====     ====
        20            progress         &lt;0.17.0&gt; 1996-10-16 16:14:54
        19            progress         &lt;0.14.0&gt; 1996-10-16 16:14:55
        18               error         &lt;0.15.0&gt; 1996-10-16 16:15:02
        17            progress         &lt;0.14.0&gt; 1996-10-16 16:15:06
        16            progress         &lt;0.38.0&gt; 1996-10-16 16:15:12
        15            progress         &lt;0.17.0&gt; 1996-10-16 16:16:14
        14            progress         &lt;0.17.0&gt; 1996-10-16 16:16:14
        13            progress         &lt;0.17.0&gt; 1996-10-16 16:16:14
        12            progress         &lt;0.14.0&gt; 1996-10-16 16:16:14
        11               error         &lt;0.17.0&gt; 1996-10-16 16:16:21
        10               error         &lt;0.17.0&gt; 1996-10-16 16:16:21
        9        crash_report  release_handler 1996-10-16 16:16:21
        8   supervisor_report         &lt;0.17.0&gt; 1996-10-16 16:16:21
        7            progress         &lt;0.17.0&gt; 1996-10-16 16:16:21
        6            progress         &lt;0.17.0&gt; 1996-10-16 16:16:36
        5            progress         &lt;0.17.0&gt; 1996-10-16 16:16:36
        4            progress         &lt;0.17.0&gt; 1996-10-16 16:16:36
        3            progress         &lt;0.14.0&gt; 1996-10-16 16:16:36
        2               error         &lt;0.15.0&gt; 1996-10-16 16:17:04
        1            progress         &lt;0.14.0&gt; 1996-10-16 16:17:09
        ok</pre><h3>Show Reports</h3><p>Use function 
<a href="./rb#show/1">rb#show/1</a> 
to show details of a specific report:</p><pre>
7&gt; <span class="input">rb:show(4).</span>
        
PROGRESS REPORT  &lt;0.20.0&gt;                                   1996-10-16 16:16:36
===============================================================================
supervisor                                                     {local,sasl_sup}
started
[{pid,&lt;0.24.0&gt;},
{name,release_handler},
{mfa,{release_handler,start_link,[]}},
{restart_type,permanent},
{shutdown,2000},
{child_type,worker}]
        
ok
8&gt; <span class="input">rb:show(9).</span>
        
CRASH REPORT  &lt;0.24.0&gt;                                      1996-10-16 16:16:21
===============================================================================
Crashing process                                                               
pid                                                                 &lt;0.24.0&gt;
registered_name                                              release_handler
error_info                             {undef,{release_handler,mbj_func,[]}}
initial_call
{gen,init_it,
[gen_server,
&lt;0.20.0&gt;,
&lt;0.20.0&gt;,
{erlang,register},
release_handler,
release_handler,
[],
[]]}
ancestors                                                [sasl_sup,&lt;0.18.0&gt;]
messages                                                                  []
links                                                    [&lt;0.23.0&gt;,&lt;0.20.0&gt;]
dictionary                                                                []
trap_exit                                                              false
status                                                               running
heap_size                                                                610
stack_size                                                               142
reductions                                                                54

ok</pre><h3>Search Reports</h3><p>All reports containing a common pattern can be shown.
Suppose a process crashes because it tries to call a
non-existing function <strong>release_handler:mbj_func/1</strong>.
The reports can then be shown as follows:</p><pre>
12&gt; <span class="input">rb:grep("mbj_func").</span>
Found match in report number 11
        
ERROR REPORT  &lt;0.24.0&gt;                                      1996-10-16 16:16:21
===============================================================================
        
** undefined function: release_handler:mbj_func[] **
Found match in report number 10

ERROR REPORT  &lt;0.24.0&gt;                                      1996-10-16 16:16:21
===============================================================================
        
** Generic server release_handler terminating 
** Last message in was {unpack_release,hej}
** When Server state == {state,[],
"/home/dup/otp2/otp_beam_sunos5_p1g_7",
[{release,
"OTP  APN 181 01",
"P1G",
undefined,
[],
permanent}],
undefined}
** Reason for termination == 
** {undef,{release_handler,mbj_func,[]}}
Found match in report number 9
        
CRASH REPORT  &lt;0.24.0&gt;                                      1996-10-16 16:16:21
===============================================================================
Crashing process                                                               
pid                                                                 &lt;0.24.0&gt;
registered_name                                              release_handler
error_info                             {undef,{release_handler,mbj_func,[]}}
initial_call
{gen,init_it,
[gen_server,
&lt;0.20.0&gt;,
&lt;0.20.0&gt;,
{erlang,register},
release_handler,
release_handler,
[],
[]]}
ancestors                                                [sasl_sup,&lt;0.18.0&gt;]
messages                                                                  []
links                                                    [&lt;0.23.0&gt;,&lt;0.20.0&gt;]
dictionary                                                                []
trap_exit                                                              false
status                                                               running
heap_size                                                                610
stack_size                                                               142
reductions                                                                54
        
Found match in report number 8
        
SUPERVISOR REPORT  &lt;0.20.0&gt;                                 1996-10-16 16:16:21
===============================================================================
Reporting supervisor                                           {local,sasl_sup}
        
Child process                                                                  
errorContext                                                child_terminated
reason                                 {undef,{release_handler,mbj_func,[]}}
pid                                                                 &lt;0.24.0&gt;
name                                                         release_handler
start_function                               {release_handler,start_link,[]}
restart_type                                                       permanent
shutdown                                                                2000
child_type                                                            worker
        
ok</pre><h3>Stop Server</h3><p>Use function 
<a href="./rb#stop/0">rb#stop/0</a> 
to stop the <strong>rb_server</strong>:</p><pre>
13&gt; <span class="input">rb:stop().</span>
ok</pre></body></html>
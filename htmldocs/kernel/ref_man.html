<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>Kernel Reference Manual</h1><h2>kernel</h2><p>The Kernel application.</p><p>The Kernel application has all the code necessary to run
the Erlang runtime system: file servers, code servers,
and so on.The Kernel application is the first application started. It is
mandatory in the sense that the minimal system based on
Erlang/OTP consists of Kernel and STDLIB. Kernel
contains the following functional areas:<ul><li>Start, stop, supervision, configuration, and distribution of applications</li><li>Code loading</li><li>Logging</li><li>Global name service</li><li>Supervision of Erlang/OTP</li><li>Communication with sockets</li><li>Operating system interface</li></ul></p><h3>Logger Handlers</h3><p>Two standard logger handlers are defined in
the Kernel application. These are described in the
<a href="logger_chapter">Kernel User's Guide</a>,
and in the <a href="logger_std_h">logger_std_h</a>
and <a href="logger_disk_log_h">logger_disk_log_h</a> manual pages.</p><a name="erl_signal_server"></a><h3>OS Signal Event Handler</h3><p>Asynchronous OS signals may be subscribed to via the Kernel applications event manager
(see <a href="./des_princ">OTP Design Principles</a> and
<a href="./gen_event">stdlib/gen_event</a>) registered as <strong>erl_signal_server</strong>.
A default signal handler is installed which handles the following signals:</p><dl><dt><strong>sigusr1</strong></dt><dd><p>The default handler will halt Erlang and produce a crashdump
with slogan "Received SIGUSR1".
This is equivalent to calling <strong>erlang:halt("Received SIGUSR1")</strong>.
</p></dd><dt><strong>sigquit</strong></dt><dd><p>The default handler will halt Erlang immediately.
This is equivalent to calling <strong>erlang:halt()</strong>.
</p></dd><dt><strong>sigterm</strong></dt><dd><p>The default handler will terminate Erlang normally.
This is equivalent to calling <strong>init:stop()</strong>.
</p></dd></dl><h3>Events</h3><p>Any event handler added to <strong>erl_signal_server</strong> must handle the following events.</p><dl><dt><strong>sighup</strong></dt><dd><p>Hangup detected on controlling terminal or death of controlling process</p></dd><dt><strong>sigquit</strong></dt><dd><p>Quit from keyboard</p></dd><dt><strong>sigabrt</strong></dt><dd><p>Abort signal from abort</p></dd><dt><strong>sigalrm</strong></dt><dd><p>Timer signal from alarm</p></dd><dt><strong>sigterm</strong></dt><dd><p>Termination signal</p></dd><dt><strong>sigusr1</strong></dt><dd><p>User-defined signal 1</p></dd><dt><strong>sigusr2</strong></dt><dd><p>User-defined signal 2</p></dd><dt><strong>sigchld</strong></dt><dd><p>Child process stopped or terminated</p></dd><dt><strong>sigstop</strong></dt><dd><p>Stop process</p></dd><dt><strong>sigtstp</strong></dt><dd><p>Stop typed at terminal</p></dd></dl><p>Setting OS signals are described in <a href="./os#set_signal/2">os#set_signal/2</a>.</p><a name="configuration"></a><h3>Configuration</h3><p>The following configuration parameters are defined for the Kernel
application. For more information about configuration parameters,
see file <a href="app">app</a>.</p><dl><dt><strong>distributed = [Distrib]</strong></dt><dd> <p>Specifies which applications that are distributed and on which
nodes they are allowed to execute. In this parameter:</p> <ul><li><strong>Distrib = {App,Nodes} | {App,Time,Nodes}</strong></li><li><strong>App = atom()</strong></li><li><strong>Time = integer()&gt;0</strong></li><li><strong>Nodes = [node() | {node(),...,node()}]</strong></li></ul> <p>The parameter is described in
<a href="./application#load/2">application#load/2</a>.</p> </dd><dt><strong>dist_auto_connect = Value</strong></dt><dd> <p>Specifies when nodes are automatically connected. If
this parameter is not specified, a node is always
automatically connected, for example, when a message is to be sent to
that node. <strong>Value</strong> is one of:</p> <dl><dt><strong>never</strong></dt><dd><p>Connections are never automatically established, they
must be explicitly connected. See
<a href="net_kernel">net_kernel</a>.</p></dd><dt><strong>once</strong></dt><dd><p>Connections are established automatically, but only
once per node. If a node goes down, it must thereafter be
explicitly connected. See
<a href="net_kernel">net_kernel</a>.</p></dd></dl> </dd><dt><strong>permissions = [Perm]</strong></dt><dd> <p>Specifies the default permission for applications when they
are started. In this parameter:</p> <ul><li><strong>Perm = {ApplName,Bool}</strong></li><li><strong>ApplName = atom()</strong></li><li><strong>Bool = boolean()</strong></li></ul> <p>Permissions are described in
<a href="./application#permit/2">application#permit/2</a>.</p> </dd><dt><a name="logger"></a><strong>logger = [Config]</strong></dt><dd> <p>Specifies the configuration
for <a href="logger">Logger</a>, except the
primary log level, which is specified
with <a href="#logger_level">logger_level</a>,
and the compatibility
with <a href="./error_logging">SASL Error Logging</a>, which is specified
with <a href="#logger_sasl_compatible">logger_sasl_compatible</a>.</p> <p>The <strong>logger </strong> parameter is described in
section <a href="./logger_chapter#logger_parameter"> Logging</a> in the Kernel User's Guide.</p> </dd><dt><a name="logger_level"></a><strong>logger_level = Level</strong></dt><dd> <p>Specifies the primary log level for Logger. Log events with
the same, or a more severe level, pass through the primary
log level check. See
section <a href="logger_chapter">Logging</a>
in the Kernel User's Guide for more information about Logger
and log levels.</p> <p><strong>Level = emergency | alert | critical | error | warning | notice | info | debug | all | none</strong></p> <p>To change the primary log level at runtime, use
<a href="./logger#set_primary_config/2">logger#set_primary_config/2</a>.</p> <p>Defaults to <strong>notice</strong>.</p> </dd><dt><a name="logger_sasl_compatible"></a> <strong>logger_sasl_compatible = true | false</strong></dt><dd> <p>Specifies if Logger behaves backwards compatible with the
SASL error logging functionality from releases prior to
Erlang/OTP 21.0.</p> <p>If this parameter is set to <strong>true</strong>, the default Logger
handler does not log any progress-, crash-, or supervisor
reports. If the SASL application is then started, it adds a
Logger handler named <strong>sasl</strong>, which logs these events
according to values of the SASL configuration
parameter <strong>sasl_error_logger</strong>
and <strong>sasl_errlog_type</strong>.</p> <p>See section
<a href="../sasl/sasl_app#deprecated_error_logger_config"> Deprecated Error Logger Event Handlers and Configuration</a> in the sasl(6) manual page for
information about the SASL configuration parameters.</p> <p>See section <a href="./error_logging">SASL Error Logging</a> in the SASL User's Guide, and
section <a href="./logger_chapter#compatibility">Backwards Compatibility with error_logger</a> in the Kernel
User's Guide for information about the SASL error logging
functionality, and how Logger can be backwards compatible
with this.</p> <p>Defaults to <strong>false</strong>.</p> <div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>If this parameter is set to <strong>true</strong>,
<strong>sasl_errlog_type</strong> indicates that progress reports
shall be logged, and the configured primary log level
is <strong>notice</strong> or more severe, then SASL automatically
sets the primary log level to <strong>info</strong>. That is, this
setting can potentially overwrite the value of the Kernel
configuration parameter <strong>logger_level</strong>. This is to
allow progress reports, which have log level <strong>info</strong>,
to be forwarded to the handlers.</p></div> </dd><dt><strong>global_groups = [GroupTuple]</strong></dt><dd> <a name="global_groups"></a> <p>Defines global groups, see
<a href="global_group">global_group</a>.
In this parameter:</p> <ul><li><p><strong>GroupTuple = {GroupName, [Node]} | {GroupName, PublishType, [Node]}</strong></p></li><li><p><strong>GroupName = atom()</strong></p></li><li><p><strong>PublishType = normal | hidden</strong></p></li><li><p><strong>Node = node()</strong></p></li></ul> </dd><dt><strong>inet_default_connect_options = [{Opt, Val}]</strong></dt><dd> <p>Specifies default options for <strong>connect</strong> sockets,
see <a href="inet">inet</a>.</p> </dd><dt><strong>inet_default_listen_options = [{Opt, Val}]</strong></dt><dd> <p>Specifies default options for <strong>listen</strong> (and
<strong>accept</strong>) sockets, see <a href="inet">inet</a>.</p> </dd><dt><strong>{inet_dist_use_interface, ip_address()}</strong></dt><dd> <p>If the host of an Erlang node has many network interfaces,
this parameter specifies which one to listen on. For the type definition
of <strong>ip_address()</strong>,
see <a href="inet">inet</a>.</p> </dd><dt><strong>{inet_dist_listen_min, First}</strong> and <strong>{inet_dist_listen_max, Last}</strong></dt><dd> <p>Defines the <strong>First..Last</strong> port range for the listener
socket of a distributed Erlang node.</p> </dd><dt><strong>{inet_dist_listen_options, Opts}</strong></dt><dd> <a name="inet_dist_listen_options"></a> <p>Defines a list of extra socket options to be used when opening the
listening socket for a distributed Erlang node.
See <a href="./gen_tcp#listen/2">gen_tcp#listen/2</a>.</p> </dd><dt><strong>{inet_dist_connect_options, Opts}</strong></dt><dd> <a name="inet_dist_connect_options"></a> <p>Defines a list of extra socket options to be used when connecting to
other distributed Erlang nodes.
See <a href="./gen_tcp#connect/4">gen_tcp#connect/4</a>.</p> </dd><dt><strong>inet_parse_error_log = silent</strong></dt><dd> <p>If set, no log events are issued when erroneous lines are
found and skipped in the various Inet configuration
files.</p> </dd><dt><strong>inetrc = Filename</strong></dt><dd> <p>The name (string) of an Inet user configuration file. For details,
see section
<a href="./inet_cfg">erts/inet_cfg</a>
in the ERTS User's Guide.</p> </dd><dt><strong>net_setuptime = SetupTime</strong></dt><dd> <a name="net_setuptime"></a> <p><strong>SetupTime</strong> must be a positive integer or floating point
number, and is interpreted as the maximum allowed time
for each network operation during connection setup to another
Erlang node. The maximum allowed value is <strong>120</strong>. If higher values
are specified, <strong>120</strong> is used. Default is 7 seconds if the variable
is not specified, or if the value is incorrect (for example, not a number).</p> <p>Notice that this value does not limit the total connection
setup time, but rather each individual network operation during
the connection setup and handshake.</p> </dd><dt><strong>net_ticktime = TickTime</strong></dt><dd> <a name="net_ticktime"></a> <p>Specifies the <strong>net_kernel</strong> tick time in seconds. This is the
approximate time a connected node may be unresponsive until it is
considered down and thereby disconnected.</p> <p>Once every <strong>TickTime/4</strong> seconds, each connected node is ticked
if nothing has been sent to it during that last <strong>TickTime/4</strong>
interval. A tick is a small package sent on the connection. A connected
node is considered to be down if no ticks or payload packages have been
received during the last four <strong>TickTime/4</strong> intervals. This ensures
that nodes that are not responding, for reasons such as hardware errors,
are considered to be down.</p> <p>As the availability is only checked every <strong>TickTime/4</strong> seconds,
the actual time <strong>T</strong> a node have been unresponsive when
detected may vary between <strong>MinT</strong> and <strong>MaxT</strong>,
where:</p> <pre><code class="">
MinT = TickTime - TickTime / 4
MaxT = TickTime + TickTime / 4</code></pre> <p><strong>TickTime</strong> defaults to <strong>60</strong> seconds. Thus,
<strong>45 &lt; T &lt; 75</strong> seconds.</p> <p>Notice that <em>all</em> communicating nodes are to have the
<em>same</em> <strong>TickTime</strong> value specified, as it determines both the
frequency of outgoing ticks and the expected frequency of incominging
ticks.</p> <p>Normally, a terminating node is detected immediately by the transport
protocol (like TCP/IP).</p> </dd><dt><strong>shutdown_timeout = integer() | infinity</strong></dt><dd> <p>Specifies the time <strong>application_controller</strong> waits
for an application to terminate during node shutdown. If the
timer expires, <strong>application_controller</strong> brutally
kills <strong>application_master</strong> of the hanging
application. If this parameter is undefined, it defaults
to <strong>infinity</strong>.</p> </dd><dt><strong>sync_nodes_mandatory = [NodeName]</strong></dt><dd> <p>Specifies which other nodes that <em>must</em> be alive
for this node to start properly. If some node in the list
does not start within the specified time, this node does not
start either. If this parameter is undefined, it defaults to
<strong>[]</strong>.</p> </dd><dt><strong>sync_nodes_optional = [NodeName]</strong></dt><dd> <p>Specifies which other nodes that <em>can</em> be alive
for this node to start properly. If some node in this list
does not start within the specified time, this node starts
anyway. If this parameter is undefined, it defaults to
the empty list.</p> </dd><dt><strong>sync_nodes_timeout = integer() | infinity</strong></dt><dd> <p>Specifies the time (in milliseconds) that this node
waits for the mandatory and optional nodes to start. If
this parameter is undefined, no node synchronization is
performed. This option ensures that <strong>global</strong> is
synchronized.</p> </dd><dt><strong>start_distribution = true | false</strong></dt><dd> <p>Starts all distribution services, such as <strong>rpc</strong>,
<strong>global</strong>, and <strong>net_kernel</strong> if the parameter is
<strong>true</strong>. This parameter is to be set to <strong>false</strong>
for systems who want to disable all distribution functionality.</p> <p>Defaults to <strong>true</strong>.</p> </dd><dt><strong>start_dist_ac = true | false</strong></dt><dd> <p>Starts the <strong>dist_ac</strong> server if the parameter is
<strong>true</strong>. This parameter is to be set to <strong>true</strong> for
systems using distributed applications.</p> <p>Defaults to <strong>false</strong>.  If this parameter is
undefined, the server is started if parameter
<strong>distributed</strong> is set.</p> </dd><dt><strong>start_boot_server = true | false</strong></dt><dd> <p>Starts the <strong>boot_server</strong> if the parameter is <strong>true</strong>
(see <a href="erl_boot_server">erl_boot_server</a>).
This parameter is to be set to <strong>true</strong> in an embedded system
using this service.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><strong>boot_server_slaves = [SlaveIP]</strong></dt><dd> <p>If configuration parameter <strong>start_boot_server</strong> is
<strong>true</strong>, this parameter can be used to initialize
<strong>boot_server</strong> with a list of slave IP addresses:</p> <p>
<strong>SlaveIP = string() | atom | {integer(),integer(),integer(),integer()}</strong>,</p> <p>where <strong>0 &lt;= integer() &lt;=255</strong>.</p> <p>Examples of <strong>SlaveIP</strong> in atom, string, and tuple form:</p> <p><strong>'150.236.16.70', "150,236,16,70", {150,236,16,70}</strong>.</p> <p>Defaults to <strong>[]</strong>.</p> </dd><dt><strong>start_disk_log = true | false</strong></dt><dd> <p>Starts the <strong>disk_log_server</strong> if the parameter is
<strong>true</strong> (see <a href="disk_log">disk_log</a>).
This parameter is to be set to <strong>true</strong> in an embedded system
using this service.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><strong>start_pg2 = true | false</strong></dt><dd> <a name="start_pg2"></a> <p>Starts the <strong>pg2</strong> server (see
<a href="pg2">pg2</a>) if
the parameter is <strong>true</strong>. This parameter is to be set to
<strong>true</strong> in an embedded system that uses this service.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><strong>start_timer = true | false</strong></dt><dd> <p>Starts the <strong>timer_server</strong> if the parameter is
<strong>true</strong> (see <a href="./timer">stdlib/timer</a>).
This parameter is to be set to <strong>true</strong> in an embedded system
using this service.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><strong>shell_history = enabled | disabled </strong></dt><dd> <p>Specifies whether shell history should be logged to disk
between usages of <strong>erl</strong>.</p> </dd><dt><strong>shell_history_drop = [string()]</strong></dt><dd> <p>Specific log lines that should not be persisted. For
example <strong>["q().", "init:stop()."]</strong> will allow to
ignore commands that shut the node down. Defaults to
<strong>[]</strong>.</p> </dd><dt><strong>shell_history_file_bytes = integer()</strong></dt><dd> <p>how many bytes the shell should remember. By default, the
value is set to 512kb, and the minimal value is 50kb.</p> </dd><dt><strong>shell_history_path = string()</strong></dt><dd> <p>Specifies where the shell history files will be stored.
defaults to the user's cache directory as returned by
<strong>filename:basedir(user_cache, "erlang-history")</strong>.</p> </dd><dt><strong>shutdown_func = {Mod, Func}</strong></dt><dd> <p>Where:</p> <ul><li><strong>Mod = atom()</strong></li><li><strong>Func = atom()</strong></li></ul> <p>Sets a function that <strong>application_controller</strong> calls
when it starts to terminate. The function is called as
<strong>Mod:Func(Reason)</strong>, where <strong>Reason</strong> is the terminate
reason for <strong>application_controller</strong>, and it must
return as soon as possible for <strong>application_controller</strong>
to terminate properly.</p> </dd><dt><strong>source_search_rules = [DirRule] | [SuffixRule] </strong></dt><dd> <a name="source_search_rules"></a> <p>Where:</p> <ul><li><strong>DirRule = {ObjDirSuffix,SrcDirSuffix}</strong></li><li><strong>SuffixRule = {ObjSuffix,SrcSuffix,[DirRule]}</strong></li><li><strong>ObjDirSuffix = string()</strong></li><li><strong>SrcDirSuffix = string()</strong></li><li><strong>ObjSuffix = string()</strong></li><li><strong>SrcSuffix = string()</strong></li></ul> <p>Specifies a list of rules for use by
<a href="../stdlib/filelib#find_file/2">stdlib/filelib#find_file/2</a>
<a href="../stdlib/filelib#find_source/2">stdlib/filelib#find_source/2</a>
If this is set to some other value
than the empty list, it replaces the default rules. Rules can be
simple pairs of directory suffixes, such as <strong>{"ebin", "src"}</strong>, which are used by <strong>filelib:find_file/2</strong>, or
triples specifying separate directory suffix rules depending on
file name extensions, for example <strong>[{".beam", ".erl", [{"ebin", "src"}]}</strong>, which are used by <strong>filelib:find_source/2</strong>. Both
kinds of rules can be mixed in the list.</p> <p>The interpretation of <strong>ObjDirSuffix</strong> and <strong>SrcDirSuffix</strong>
is as follows: if the end of the directory name where an
object is located matches <strong>ObjDirSuffix</strong>, then the
name created by replacing <strong>ObjDirSuffix</strong> with
<strong>SrcDirSuffix</strong> is expanded by calling
<a href="../stdlib/filelib#wildcard/1">stdlib/filelib#wildcard/1</a>, and the first regular
file found among the matches is the source file.
</p> </dd></dl><h3>Deprecated Configuration Parameters</h3><p>In Erlang/OTP 21.0, a new API for logging was added. The
old <strong>error_logger</strong> event manager, and event handlers
running on this manager, still work, but they are no longer used
by default.</p><p>The following application configuration parameters can still be
set, but they are only used if the corresponding configuration
parameters for Logger are not set.</p><dl><dt><strong>error_logger</strong></dt><dd>Replaced by setting the <a href="./logger_std_h#type">logger_std_h#type</a>, and possibly <a href="./logger_std_h#file">logger_std_h#file</a> and <a href="./logger_std_h#modes">logger_std_h#modes</a> parameters of the default <strong>logger_std_h</strong> handler. Example: <pre><code class="">
erl -kernel logger '[{handler,default,logger_std_h,#{config=&gt;#{file=&gt;"/tmp/erlang.log"}}}]'
      </code></pre> </dd><dt><strong>error_logger_format_depth</strong></dt><dd>Replaced by setting the <a href="./logger_formatter#depth">logger_formatter#depth</a> parameter of the default handlers formatter. Example: <pre><code class="">
erl -kernel logger '[{handler,default,logger_std_h,#{formatter=&gt;{logger_formatter,#{legacy_header=&gt;true,template=&gt;[{logger_formatter,header},"\n",msg,"\n"],depth=&gt;10}}}]'
      </code></pre> </dd></dl><p>See <a href="./logger_chapter#compatibility">Backwards compatibility with error_logger</a> for more
information.</p><h3>See Also</h3><p><a href="app">app</a>,
<a href="application">application</a>,
<a href="code">code</a>,
<a href="disk_log">disk_log</a>,
<a href="erl_boot_server">erl_boot_server</a>,
<a href="erl_ddll">erl_ddll</a>,
<a href="file">file</a>,
<a href="global">global</a>,
<a href="global_group">global_group</a>,
<a href="heart">heart</a>,
<a href="inet">inet</a>,
<a href="logger">logger</a>,
<a href="net_kernel">net_kernel</a>,
<a href="os">os</a>,
<a href="pg2">pg2</a>,
<a href="rpc">rpc</a>,
<a href="seq_trace">seq_trace</a>,
<a href="user">user</a>,
<a href="./timer">stdlib/timer</a></p><h2>app</h2><p>Application resource file.</p><p>The <em>application resource file</em> specifies the resources an
application uses, and how the application is started. There must
always be one application resource file called
<strong>Application.app</strong> for each application <strong>Application</strong> in
the system.The file is read by the application controller when an
application is loaded/started. It is also used by the functions in
<strong>systools</strong>, for example when generating start scripts.</p><h3>File Syntax</h3><p>The application resource file is to be called
<strong>Application.app</strong>, where <strong>Application</strong> is the
application name. The file is to be located in directory <strong>ebin</strong>
for the application.</p><p>The file must contain a single Erlang term, which is called an
<em>application specification</em>:</p><pre><code class="">
{application, Application,
  [{description,  Description},
   {id,           Id},
   {vsn,          Vsn},
   {modules,      Modules},
   {maxP,         MaxP},
   {maxT,         MaxT},
   {registered,   Names},
   {included_applications, Apps},
   {applications, Apps},
   {env,          Env},
   {mod,          Start},
   {start_phases, Phases},
   {runtime_dependencies, RTDeps}]}.

             Value                Default
             -----                -------
Application  atom()               -
Description  string()             ""
Id           string()             ""
Vsn          string()             ""
Modules      [Module]             []
MaxP         int()                infinity
MaxT         int()                infinity
Names        [Name]               []
Apps         [App]                []
Env          [{Par,Val}]          []
Start        {Module,StartArgs}   []
Phases       [{Phase,PhaseArgs}]  undefined
RTDeps       [ApplicationVersion] []

Module = Name = App = Par = Phase = atom()
Val = StartArgs = PhaseArgs = term()
ApplicationVersion = string()</code></pre><dl><dt><strong>Application</strong></dt><dd>Application name.</dd></dl><p>For the application controller, all keys are optional.
The respective default values are used for any omitted keys.</p><p>The functions in <strong>systools</strong> require more information. If
they are used, the following keys are mandatory:</p><ul><li><strong>description</strong></li><li><strong>vsn</strong></li><li><strong>modules</strong></li><li><strong>registered</strong></li><li><strong>applications</strong></li></ul><p>The other keys are ignored by <strong>systools</strong>.</p><dl><dt><strong>description</strong></dt><dd> <p>A one-line description of the application.</p> </dd><dt><strong>id</strong></dt><dd> <p>Product identification, or similar.</p> </dd><dt><strong>vsn</strong></dt><dd> <p>Version of the application.</p> </dd><dt><strong>modules</strong></dt><dd> <p>All modules introduced by this application. <strong>systools</strong>
uses this list when generating start scripts and tar files. A
module can only be defined in one application.</p> </dd><dt><strong>maxP</strong></dt><dd> <p><em>Deprecated - is ignored</em></p> <p>Maximum number of processes allowed in the application.</p> </dd><dt><strong>maxT</strong></dt><dd> <p>Maximum time, in milliseconds, that the application is
allowed to run. After the specified time, the application
terminates automatically.</p> </dd><dt><strong>registered</strong></dt><dd> <p>All names of registered processes started in this
application. <strong>systools</strong> uses this list to detect name
clashes between different applications.</p> </dd><dt><strong>included_applications</strong></dt><dd> <p>All applications included by this application.
When this application is started, all included applications
are loaded automatically, but not started, by
the application controller. It is assumed that the top-most
supervisor of the included application is started by a
supervisor of this application.</p> </dd><dt><strong>applications</strong></dt><dd> <p>All applications that must be started before this
application is allowed to be started. <strong>systools</strong> uses
this list to generate correct start scripts. Defaults to
the empty list, but notice that all applications have
dependencies to (at least) Kernel and STDLIB.</p> </dd><dt><strong>env</strong></dt><dd> <p>Configuration parameters used by the application. The value
of a configuration parameter is retrieved by calling
<strong>application:get_env/1,2</strong>. The values in the application
resource file can be overridden by values in a configuration
file (see <a href="config">config</a>)
or by command-line flags (see
<a href="./erl">erts/erl</a>).</p> </dd><dt><strong>mod</strong></dt><dd> <p>Specifies the application callback module and a start argument, see
<a href="application">application</a>.</p> <p>Key <strong>mod</strong> is necessary for an application
implemented as a supervision tree, otherwise the application
controller does not know how to start it. <strong>mod</strong>
can be omitted for applications without processes, typically
code libraries, for example, STDLIB.</p> </dd><dt><strong>start_phases</strong></dt><dd> <p>A list of start phases and corresponding start arguments for
the application. If this key is present, the application
master, in addition to the usual call to
<strong>Module:start/2</strong>, also calls
<strong>Module:start_phase(Phase,Type,PhaseArgs)</strong> for each
start phase defined by key <strong>start_phases</strong>. Only
after this extended start procedure,
<strong>application:start(Application)</strong> returns.</p> <p>Start phases can be used to synchronize startup of an
application and its included applications. In this case,
key <strong>mod</strong> must be specified as follows:</p> <pre><code class="">
{mod, {application_starter,[Module,StartArgs]}}</code></pre> <p>The application master then calls <strong>Module:start/2</strong>
for the primary application, followed by calls to
<strong>Module:start_phase/3</strong> for each start phase (as defined
for the primary application), both for the primary application
and for each of its included applications, for which the start
phase is defined.</p> <p>This implies that for an included application, the set of
start phases must be a subset of the set of phases defined
for the primary application. For more information, see
<a href="./applications">OTP Design Principles</a>.
</p> </dd><dt> <a name="runtime_dependencies"></a> <strong>runtime_dependencies</strong></dt><dd> <p>A list of application versions that the application
depends on. An example of such an application version is
<strong>"kernel-3.0"</strong>. Application versions specified as runtime
dependencies are minimum requirements. That is, a larger
application version than the one specified in the
dependency satisfies the requirement. For information about
how to compare application versions, see section
<a href="./versions">Versions</a>
in the System Principles User's Guide.</p> <p>Notice that the application version
specifies a source code version. One more, indirect,
requirement is that the installed binary application of
the specified version is built so that it is
compatible with the rest of the system.</p> <p>Some dependencies can only be required in specific runtime
scenarios. When such optional dependencies exist, these are
specified and documented in the corresponding "App" documentation
of the specific application.</p> <div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>The <strong>runtime_dependencies</strong> key was introduced in
OTP 17.0. The type of its value might be subject to changes during
the OTP 17 release.</p></div> <div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>All runtime dependencies specified in OTP applications
during the OTP 17 release may not be completely correct. This
is actively being worked on. Declared runtime dependencies in OTP
applications are expected to be correct in OTP 18.</p></div> </dd></dl><h3>See Also</h3><p><a href="application">application</a>,
<a href="./systools">sasl/systools</a></p><h2>application</h2><p>Generic OTP application functions</p><p>In OTP, <em>application</em> denotes a component implementing
some specific functionality, that can be started and stopped as a
unit, and that can be reused in other systems. This
module interacts with <em>application controller</em>, a process
started at every Erlang runtime system. This module contains functions
for controlling applications (for example, starting and stopping
applications), and functions to access information about
applications (for example, configuration parameters).An application is defined by an <em>application specification</em>.
The specification is normally located in an
<em>application resource file</em> named <strong>Application.app</strong>,
where <strong>Application</strong> is the application name. For details
about the application specification, see
<a href="app">app</a>.This module can also be viewed as a behaviour for an application
implemented according to the OTP design principles as a
supervision tree. The definition of how to start and stop
the tree is to be located in an <em>application callback module</em>,
exporting a predefined set of functions.For details about applications and behaviours, see
<a href="./des_princ">OTP Design Principles</a>.</p><h2>Data Types</h2><span class="name">start_type</span><span class="name">restart_type</span><span class="name">tuple_of(T)</span><p>A tuple where the elements are of type <strong>T</strong>.</p><h2>Functions</h2><h3>ensure_all_started/1</h3><h3>ensure_all_started/2</h3><p>Load and start an application and its dependencies, recursively.</p><p>Equivalent to calling
<a href="#start/1">start/1</a>
repeatedly on all dependencies that are not yet started for an application.</p><p>Returns <strong>{ok, AppNames}</strong> for a successful start or for an already started
application (which is, however, omitted from the <strong>AppNames</strong> list).</p><p>The function reports <strong>{error, {AppName,Reason}}</strong> for errors, where
<strong>Reason</strong> is any possible reason returned by
<a href="#start/1">start/1</a>
when starting a specific dependency.</p><p>If an error occurs, the applications started by the function are stopped
to bring the set of running applications back to its initial state.</p><h3>ensure_started/1</h3><h3>ensure_started/2</h3><p>Load and start an application.</p><p>Equivalent to
<a href="#start/1">start/1</a>
except it returns <strong>ok</strong> for already started applications.</p><h3>get_all_env/0</h3><h3>get_all_env/1</h3><p>Get the configuration parameters for an application.</p><p>Returns the configuration parameters and their values for
<strong><span class="anno">Application</span></strong>. If the argument is omitted, it defaults to
the application of the calling process.</p><p>If the specified application is not loaded, or if the process
executing the call does not belong to any application,
the function returns <strong>[]</strong>.</p><h3>get_all_key/0</h3><h3>get_all_key/1</h3><p>Get the application specification keys.</p><p>Returns the application specification keys and their values
for <strong><span class="anno">Application</span></strong>. If the argument is omitted, it
defaults to the application of the calling process.</p><p>If the specified application is not loaded, the function
returns <strong>undefined</strong>. If the process executing the call
does not belong to any application, the function returns
<strong>[]</strong>.</p><h3>get_application/0</h3><h3>get_application/1</h3><p>Get the name of an application containing a certain process or module.</p><p>Returns the name of the application to which the process
<strong><span class="anno">Pid</span></strong> or the module <strong><span class="anno">Module</span></strong> belongs. Providing no
argument is the same as calling
<strong>get_application(self())</strong>.</p><p>If the specified process does not belong to any application,
or if the specified process or module does not exist,
the function returns <strong>undefined</strong>.</p><h3>get_env/1</h3><h3>get_env/2</h3><p>Get the value of a configuration parameter.</p><p>Returns the value of configuration parameter <strong><span class="anno">Par</span></strong>
for <strong><span class="anno">Application</span></strong>. If the application argument is
omitted, it defaults to the application of the calling
process.</p><p>Returns <strong>undefined</strong> if any of the following applies:</p><ul><li>The specified application is not loaded.</li><li>The configuration parameter does not exist.</li><li>The process executing the call does not belong to any application.</li></ul><h3>get_env/3</h3><p>Get the value of a configuration parameter using a default.</p><p>Works like <a href="#get_env/2">get_env/2</a> but returns
value <strong><span class="anno">Def</span></strong> when configuration parameter
<strong><span class="anno">Par</span></strong> does not exist.</p><h3>get_key/1</h3><h3>get_key/2</h3><p>Get the value of an application specification key.</p><p>Returns the value of the application specification key
<strong><span class="anno">Key</span></strong> for <strong><span class="anno">Application</span></strong>. If the application
argument is omitted, it defaults to the application of
the calling process.</p><p>Returns <strong>undefined</strong> if any of the following applies:</p><ul><li>The specified application is not loaded.</li><li>The specification key does not exist.</li><li>The process executing the call does not belong to any application.</li></ul><h3>load/1</h3><h3>load/2</h3><p>Load an application.</p><ul><li>application_spec</li></ul><ul><li>application_opt</li></ul><p>Loads the application specification for an application into
the application controller. It also loads the application
specifications for any included applications. Notice that
the function does not load the Erlang object code.</p><p>The application can be specified by its name <strong><span class="anno">Application</span></strong>.
In this case, the application controller searches the code
path for the application resource file <strong><span class="anno">Application</span>.app</strong>
and loads the specification it contains.</p><p>The application specification can also be specified directly as a
tuple <strong><span class="anno">AppSpec</span></strong>, having the format and
contents as described in
<a href="app">app</a>.</p><p>If <strong><span class="anno">Distributed</span> == {<span class="anno">Application</span>,[<span class="anno">Time</span>,]<span class="anno">Nodes</span>}</strong>,
the application becomes distributed. The argument overrides
the value for the application in the Kernel configuration
parameter <strong>distributed</strong>. <strong><span class="anno">Application</span></strong> must be
the application name (same as in the first argument).
If a node crashes and <strong><span class="anno">Time</span></strong> is specified,
the application controller waits for <strong><span class="anno">Time</span></strong>
milliseconds before attempting to restart the application on
another node. If <strong><span class="anno">Time</span></strong> is not specified, it
defaults to <strong>0</strong> and the application is restarted
immediately.</p><p><strong><span class="anno">Nodes</span></strong> is a list of node names where the application
can run, in priority from left to right. Node names can be
grouped using tuples to indicate that they have the same
priority.</p><p><em>Example:</em></p><pre><code class="">
Nodes = [cp1@cave, {cp2@cave, cp3@cave}]</code></pre><p>This means that the application is preferably to be started
at <strong>cp1@cave</strong>. If <strong>cp1@cave</strong> is down,
the application is to be started at <strong>cp2@cave</strong>
or <strong>cp3@cave</strong>.</p><p>If <strong>Distributed == default</strong>, the value for
the application in the Kernel configuration parameter
<strong>distributed</strong> is used.</p><h3>loaded_applications/0</h3><p>Get the currently loaded applications.</p><p>Returns a list with information about the applications, and included
applications, which are loaded using <strong>load/1,2</strong>.
<strong><span class="anno">Application</span></strong> is the application name.
<strong><span class="anno">Description</span></strong> and <strong><span class="anno">Vsn</span></strong> are the values
of their <strong>description</strong> and <strong>vsn</strong> application specification
keys, respectively.</p><h3>set_env/1</h3><h3>set_env/2</h3><p>Sets the configuration parameters of multiple applications.</p><p>Sets the configuration <strong><span class="anno">Config</span></strong> for multiple
applications. It is equivalent to calling <strong>set_env/4</strong> on
each application individially, except it is more efficient.
The given <strong><span class="anno">Config</span></strong> is validated before the
configuration is set.</p><p><strong>set_env/2</strong> uses the standard <strong>gen_server</strong> time-out
value (5000 ms). Option <strong>timeout</strong> can be specified
if another time-out value is useful, for example, in situations
where the application controller is heavily loaded.</p><p>Option <strong>persistent</strong> can be set to <strong>true</strong>
to guarantee that parameters set with <strong>set_env/2</strong>
are not overridden by those defined in the application resource
file on load. This means that persistent values will stick after the application
is loaded and also on application reload.</p><p>If an application is given more than once or if an application
has the same key given more than once, the behaviour is undefined
and a warning message will be logged. In future releases, an error
will be raised.</p><p><strong>set_env/1</strong> is equivalent to <strong>set_env(Config, [])</strong>.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Use this function only if you know what you are doing,
that is, on your own applications. It is very
application-dependent and
configuration parameter-dependent when and how often
the value is read by the application. Careless use
of this function can put the application in a
weird, inconsistent, and malfunctioning state.</p></div><h3>permit/2</h3><p>Change the permission for an application to run at a node.</p><p>Changes the permission for <strong><span class="anno">Application</span></strong> to run at
the current node. The application must be loaded using
<strong>load/1,2</strong> for the function to have effect.</p><p>If the permission of a loaded, but not started, application
is set to <strong>false</strong>, <strong>start</strong> returns <strong>ok</strong> but
the application is not started until the permission is
set to <strong>true</strong>.</p><p>If the permission of a running application is set to
<strong>false</strong>, the application is stopped. If
the permission later is set to <strong>true</strong>, it is
restarted.</p><p>If the application is distributed, setting the permission to
<strong>false</strong> means that the application will be started at, or
moved to, another node according to how its distribution is
configured
(see <a href="#load/2">load/2</a>).</p><p>The function does not return until the application is
started, stopped, or successfully moved to another node.
However, in some cases where permission is set to <strong>true</strong>,
the function returns <strong>ok</strong> even though the application
is not started. This is true when an application
cannot start because of dependencies to other
applications that are not yet started. When they are
started, <strong>Application</strong> is started as well.</p><p>By default, all applications are loaded with permission
<strong>true</strong> on all nodes. The permission can be configured
using the Kernel configuration parameter <strong>permissions</strong>.</p><h3>set_env/3</h3><h3>set_env/4</h3><p>Set the value of a configuration parameter.</p><p>Sets the value of configuration parameter <strong><span class="anno">Par</span></strong> for
<strong><span class="anno">Application</span></strong>.</p><p><strong>set_env/4</strong> uses the standard <strong>gen_server</strong> time-out
value (5000 ms). Option <strong>timeout</strong> can be specified
if another time-out value is useful, for example, in situations
where the application controller is heavily loaded.</p><p>If <strong>set_env/4</strong> is called before the application is loaded,
the application environment values specified in file <strong>Application.app</strong>
override the ones previously set. This is also true for application
reloads.</p><p>Option <strong>persistent</strong> can be set to <strong>true</strong>
to guarantee that parameters set with <strong>set_env/4</strong>
are not overridden by those defined in the application resource
file on load. This means that persistent values will stick after the application
is loaded and also on application reload.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Use this function only if you know what you are doing,
that is, on your own applications. It is very
application-dependent and
configuration parameter-dependent when and how often
the value is read by the application. Careless use
of this function can put the application in a
weird, inconsistent, and malfunctioning state.</p></div><h3>start/1</h3><h3>start/2</h3><p>Load and start an application.</p><p>Starts <strong><span class="anno">Application</span></strong>. If it is not loaded,
the application controller first loads it using
<strong>load/1</strong>. It ensures that any included applications
are loaded, but does not start them. That is assumed to be
taken care of in the code for <strong><span class="anno">Application</span></strong>.</p><p>The application controller checks the value of
the application specification key <strong>applications</strong>, to
ensure that all applications needed to be started before
this application are running. Otherwise,
<strong>{error,{not_started,App}}</strong> is returned, where <strong>App</strong>
is the name of the missing application.</p><p>The application controller then creates an <em>application master</em>
for the application. The application master becomes the
group leader of all the processes in the application. I/O is
forwarded to the previous group leader, though, this is just
a way to identify processes that belong to the application.
Used for example to find itself from any process, or,
reciprocally, to kill them all when it terminates.</p><p>
The application master starts the application by calling
the application callback function <strong>Module:start/2</strong> as
defined by the application specification key <strong>mod</strong>.</p><p>Argument <strong><span class="anno">Type</span></strong> specifies the type of
the application. If omitted, it defaults to <strong>temporary</strong>.</p><ul><li>If a permanent application terminates, all other applications and the entire Erlang node are also terminated.</li><li> <ul><li>If a transient application terminates with <strong>Reason == normal</strong>, this is reported but no other applications are terminated.</li><li>If a transient application terminates abnormally, all other applications and the entire Erlang node are also terminated.</li></ul> </li><li>If a temporary application terminates, this is reported but no other applications are terminated.</li></ul><p>Notice that an application can always be stopped
explicitly by calling <strong>stop/1</strong>. Regardless of the type of
the application, no other applications are affected.</p><p>Notice also that the transient type is of little practical use,
because when a supervision tree terminates, the reason is set to
<strong>shutdown</strong>, not <strong>normal</strong>.</p><h3>start_type/0</h3><p>Get the start type of an ongoing application startup.</p><p>This function is intended to be called by a process belonging
to an application, when the application is started, to
determine the start type, which is <strong><span class="anno">StartType</span></strong> or
<strong>local</strong>.</p><p>For a description of <strong><span class="anno">StartType</span></strong>, see
<a href="#start_type">start_type</a>.</p><p><strong>local</strong> is returned if only parts of the application are
restarted (by a supervisor), or if the function is
called outside a startup.</p><p>If the process executing the call does not belong to any
application, the function returns <strong>undefined</strong>.</p><h3>stop/1</h3><p>Stop an application.</p><p>Stops <strong><span class="anno">Application</span></strong>. The application master calls
<strong>Module:prep_stop/1</strong>, if such a function is defined, and
then tells the top supervisor of the application to shut down
(see <a href="./supervisor">stdlib/supervisor</a>).
This means that the entire
supervision tree, including included applications, is
terminated in reversed start order. After the shutdown,
the application master calls <strong>Module:stop/1</strong>.
<strong>Module</strong> is the callback module as defined by
the application specification key <strong>mod</strong>.</p><p>Last, the application master terminates. Notice that all
processes with the application master as group leader, that is,
processes spawned from a process belonging to the application,
are also terminated.</p><p>When stopped, the application is still loaded.</p><p>To stop a distributed application, <strong>stop/1</strong>
must be called on all nodes where it can execute (that is,
on all nodes where it has been started). The call to
<strong>stop/1</strong> on the node where the application currently
executes stops its execution. The application is not
moved between nodes, as <strong>stop/1</strong> is called on
the node where the application currently executes before
<strong>stop/1</strong> is called on the other nodes.</p><h3>takeover/2</h3><p>Take over a distributed application.</p><p>Takes over the distributed application
<strong><span class="anno">Application</span></strong>, which executes at another node
<strong>Node</strong>. At the current node, the application is
restarted by calling
<strong>Module:start({takeover,Node},StartArgs)</strong>. <strong>Module</strong>
and <strong>StartArgs</strong> are retrieved from the loaded application
specification. The application at the other node is not
stopped until the startup is completed, that is, when
<strong>Module:start/2</strong> and any calls to
<strong>Module:start_phase/3</strong> have returned.</p><p>Thus, two instances of the application run simultaneously
during the takeover, so that data can be transferred
from the old to the new instance. If this is not an acceptable
behavior, parts of the old instance can be shut down when
the new instance is started. However, the application cannot
be stopped entirely, at least the top supervisor
must remain alive.</p><p>For a description of <strong>Type</strong>, see
<a href="#start/1">start/1</a>.</p><h3>unload/1</h3><p>Unload an application.</p><p>Unloads the application specification for <strong><span class="anno">Application</span></strong>
from the application controller. It also unloads
the application specifications for any included applications.
Notice that the function does not purge the Erlang
object code.</p><h3>unset_env/2</h3><h3>unset_env/3</h3><p>Unset the value of a configuration parameter.</p><p>Removes the configuration parameter <strong><span class="anno">Par</span></strong> and its value
for <strong><span class="anno">Application</span></strong>.</p><p><strong>unset_env/2</strong> uses the standard <strong>gen_server</strong>
time-out value (5000 ms). Option <strong>timeout</strong> can be
specified if another time-out value is useful, for example, in
situations where the application controller is heavily loaded.</p><p><strong>unset_env/3</strong> also allows the persistent option to be passed
(see <a href="#set_env/4">set_env/4</a>).</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Use this function only if you know what you are doing,
that is, on your own applications. It is very
application-dependent and configuration
parameter-dependent when and how often
the value is read by the application. Careless use
of this function can put the application in a
weird, inconsistent, and malfunctioning state.</p></div><h3>which_applications/0</h3><h3>which_applications/1</h3><p>Get the currently running applications.</p><p>Returns a list with information about the applications that
are currently running. <strong><span class="anno">Application</span></strong> is the application
name. <strong><span class="anno">Description</span></strong> and <strong><span class="anno">Vsn</span></strong> are the
values of their <strong>description</strong> and <strong>vsn</strong> application specification
keys, respectively.</p><p><strong>which_applications/0</strong> uses the standard
<strong>gen_server</strong> time-out value (5000 ms). A <strong><span class="anno">Timeout</span></strong>
argument can be specified if another time-out value is useful,
for example, in situations where the application controller
is heavily loaded.</p><h3>Callback Module</h3><p>The following functions are to be exported from an
<strong>application</strong> callback module.</p><h2>Functions</h2><h3>Module:start(StartType, StartArgs) -&gt; {ok, Pid} | {ok, Pid, State} | {error, Reason}</h3><p>Start an application.</p><ul><li><span class="v">StartType = </span></li><li><span class="v">StartArgs = term()</span></li><li><span class="v">Pid = pid()</span></li><li><span class="v">State = term()</span></li></ul><p>This function is called whenever an application is started
using <strong>start/1,2</strong>, and is to start
the processes of the application. If the application is
structured according to the OTP design principles as a
supervision tree, this means starting the top supervisor of
the tree.</p><p><a name="start_type"></a><strong>StartType</strong> defines the type of start:</p><ul><li><strong>normal</strong> if it is a normal startup.</li><li><strong>normal</strong> also if the application is distributed and started at the current node because of a failover from another node, and the application specification key <strong>start_phases == undefined</strong>.</li><li><strong>{takeover,Node}</strong> if the application is distributed and started at the current node because of a takeover from <strong>Node</strong>, either because <strong>takeover/2</strong> has been called or because the current node has higher priority than <strong>Node</strong>.</li><li><strong>{failover,Node}</strong> if the application is distributed and started at the current node because of a failover from <strong>Node</strong>, and the application specification key <strong>start_phases /= undefined</strong>.</li></ul><p><strong>StartArgs</strong> is the <strong>StartArgs</strong> argument defined by
the application specification key <strong>mod</strong>.</p><p>The function is to return <strong>{ok,Pid}</strong> or
<strong>{ok,Pid,State}</strong>, where <strong>Pid</strong> is the pid of the top
supervisor and <strong>State</strong> is any term. If omitted,
<strong>State</strong> defaults to <strong>[]</strong>. If the application
is stopped later, <strong>State</strong> is passed to
<strong>Module:prep_stop/1</strong>.</p><h3>Module:start_phase(Phase, StartType, PhaseArgs) -&gt; ok | {error, Reason}</h3><p>Extended start of an application.</p><ul><li><span class="v">Phase = atom()</span></li><li><span class="v">StartType = </span></li><li><span class="v">PhaseArgs = term()</span></li><li><span class="v">Pid = pid()</span></li><li><span class="v">State = state()</span></li></ul><p>Starts an application with included
applications, when synchronization is needed between
processes in the different applications during startup.</p><p>The start phases are defined by the application specification
key <strong>start_phases == [{Phase,PhaseArgs}]</strong>. For included
applications, the set of phases must be a subset of the set of
phases defined for the including application.</p><p>The function is called for each start phase (as defined for
the primary application) for the primary application and all
included applications, for which the start phase is defined.</p><p>For a description of <strong>StartType</strong>, see
<a href="#Module:start/2">Module:start/2</a>.</p><h3>Module:prep_stop(State) -&gt; NewState</h3><p>Prepare an application for termination.</p><ul><li><span class="v">State = NewState = term()</span></li></ul><p>This function is called when an application is about to be
stopped, before shutting down the processes of
the application.</p><p><strong>State</strong> is the state returned from
<strong>Module:start/2</strong>, or <strong>[]</strong> if no state was returned.
<strong>NewState</strong> is any term and is passed to
<strong>Module:stop/1</strong>.</p><p>The function is optional. If it is not defined, the processes
are terminated and then <strong>Module:stop(State)</strong> is called.</p><h3>Module:stop(State)</h3><p>Clean up after termination of an application.</p><ul><li><span class="v">State = term()</span></li></ul><p>This function is called whenever an application has stopped.
It is intended to be the opposite of <strong>Module:start/2</strong>
and is to do any necessary cleaning up. The return value is
ignored.</p><p><strong>State</strong> is the return value of <strong>Module:prep_stop/1</strong>,
if such a function exists. Otherwise <strong>State</strong> is taken from
the return value of <strong>Module:start/2</strong>.</p><h3>Module:config_change(Changed, New, Removed) -&gt; ok</h3><p>Update the configuration parameters for an application.</p><ul><li><span class="v">Changed = [{Par,Val}]</span></li><li><span class="v">New = [{Par,Val}]</span></li><li><span class="v">Removed = [Par]</span></li><li><span class="v">Â Par = atom()</span></li><li><span class="v">Â Val = term()</span></li></ul><p>This function is called by an application after a code
replacement, if the configuration parameters have changed.</p><p><strong>Changed</strong> is a list of parameter-value tuples including all
configuration parameters with changed values.</p><p><strong>New</strong> is a list of parameter-value tuples including all
added configuration parameters.</p><p><strong>Removed</strong> is a list of all removed parameters.</p><h3>See Also</h3><p><a href="./des_princ">OTP Design Principles</a>,
<a href="kernel_app">kernel(6)</a>,
<a href="app">app(4)</a></p><h2>auth</h2><p>Erlang network authentication server.</p><p>This module is deprecated. For a description of the Magic
Cookie system, refer to
<a href="./distributed">Distributed Erlang</a> in the Erlang Reference Manual.</p><h2>Data Types</h2><span class="name">cookie</span><h2>Functions</h2><h3>cookie/0</h3><p>Magic cookie for local node (deprecated).</p><p>Use
<a href="../erts/erlang#get_cookie/0">erts/erlang#get_cookie/0</a>
in ERTS instead.</p><h3>cookie/1</h3><p>Set the magic for the local node (deprecated).</p><dl><dt>TheCookie</dt><dd> The cookie can also be specified as a list with a single atom element. </dd></dl><p>Use
<a href="../erts/erlang#set_cookie/2"> in ERTS</a> instead.</p><h3>is_auth/1</h3><p>Status of communication authorization (deprecated).</p><p>Returns <strong>yes</strong> if communication with <strong><span class="anno">Node</span></strong> is
authorized. Notice that a connection to <strong><span class="anno">Node</span></strong>
is established in this case. Returns <strong>no</strong> if <strong><span class="anno">Node</span></strong>
does not exist or communication is not authorized (it has
another cookie than <strong>auth</strong> thinks it has).</p><p>Use <a href="./net_adm#ping/1">net_adm#ping/1</a>
instead.</p><h3>node_cookie([Node, Cookie]) -&gt; yes | no</h3><p>Set the magic cookie for a node and verify authorization (deprecated).</p><ul><li><span class="v">Node = node()</span></li><li><span class="v">Cookie = </span></li></ul><p>Equivalent to
<a href="#node_cookie/2">node_cookie/2</a>.</p><h3>node_cookie/2</h3><p>Set the magic cookie for a node and verify authorization (deprecated).</p><p>Sets the magic cookie of <strong><span class="anno">Node</span></strong> to
<strong><span class="anno">Cookie</span></strong> and verifies the status of the authorization.
Equivalent to calling
<a href="../erts/erlang#set_cookie/2">erts/erlang#set_cookie/2</a>, followed by
<a href="#is_auth/1">is_auth/1</a>.</p><h2>code</h2><p>Erlang code server.</p><p>This module contains the interface to the Erlang
<em>code server</em>, which deals with the loading of compiled
code into a running Erlang runtime system.The runtime system can be started in <em>interactive</em> or
<em>embedded</em> mode. Which one is decided by the command-line
flag <strong>-mode</strong>:<pre>
% <span class="input">erl -mode interactive</span></pre>The modes are as follows:<ul><li> <p>In interactive mode, which is default, only some code is loaded
during system startup, basically the modules needed by the runtime
system. Other code is dynamically loaded when first
referenced. When a call to a function in a certain module is
made, and the module is not loaded, the code server searches
for and tries to load the module.</p> </li><li> <p>In embedded mode, modules are not auto loaded. Trying to use
a module that has not been loaded results in an error. This mode is
recommended when the boot script loads all modules, as it is
typically done in OTP releases. (Code can still be loaded later
by explicitly ordering the code server to do so).</p> </li></ul>To prevent accidentally reloading of modules affecting the Erlang
runtime system, directories <strong>kernel</strong>, <strong>stdlib</strong>,
and <strong>compiler</strong> are considered <em>sticky</em>. This
means that the system issues a warning and rejects the request if
a user tries to reload a module residing in any of them.
The feature can be disabled by using command-line flag
<strong>-nostick</strong>.</p><h3>Code Path</h3><p>In interactive mode, the code server maintains a search path,
usually called the <em>code path</em>, consisting of a list of
directories, which it searches sequentially when trying to load a
module.</p><p>Initially, the code path consists of the current working
directory and all Erlang object code directories under library
directory <strong>$OTPROOT/lib</strong>, where <strong>$OTPROOT</strong> is
the installation directory of Erlang/OTP, <strong>code:root_dir()</strong>.
Directories can be named <strong>Name[-Vsn]</strong> and the code server,
by default, chooses the directory with the highest version number
among those having the same <strong>Name</strong>. Suffix <strong>-Vsn</strong>
is optional. If an <strong>ebin</strong> directory exists under
<strong>Name[-Vsn]</strong>, this directory is added to the code path.</p><p>Environment variable <strong>ERL_LIBS</strong> (defined in the operating
system) can be used to define more library directories to
be handled in the same way as the standard OTP library
directory described above, except that directories without
an <strong>ebin</strong> directory are ignored.</p><p>All application directories found in the additional directories
appears before the standard OTP applications, except for the
Kernel and STDLIB applications, which are placed before
any additional applications. In other words, modules found in any
of the additional library directories override modules with
the same name in OTP, except for modules in Kernel and
STDLIB.</p><p>Environment variable <strong>ERL_LIBS</strong> (if defined) is to contain
a colon-separated (for Unix-like systems) or semicolon-separated
(for Windows) list of additional libraries.</p><p><em>Example:</em></p><p>On a Unix-like system, <strong>ERL_LIBS</strong> can be set to the following</p><pre><code class="">
/usr/local/jungerl:/home/some_user/my_erlang_lib</code></pre><p>On Windows, use semi-colon as separator.</p><h3>Loading of Code From Archive Files</h3><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>The support for loading code from archive files is
experimental. The purpose of releasing it before it is ready
is to obtain early feedback. The file format, semantics,
interfaces, and so on, can be changed in a future release. The function
<a href="#lib_dir/2">lib_dir/2</a>
and  flag <strong>-code_path_choice</strong> are also
experimental.</p></div><p>The Erlang archives are <strong>ZIP</strong>
files with extension <strong>.ez</strong>. Erlang archives can also be
enclosed in <strong>escript</strong> files whose file extension is arbitrary.</p><p>Erlang archive files can contain entire Erlang applications or
parts of applications. The structure in an archive file is the
same as the directory structure for an application. If you, for
example, create an archive of <strong>mnesia-4.4.7</strong>, the
archive file must be named <strong>mnesia-4.4.7.ez</strong> and it must
contain a top directory named <strong>mnesia-4.4.7</strong>. If the
version part of the name is omitted, it must also be omitted in
the archive. That is, a <strong>mnesia.ez</strong> archive must contain a
<strong>mnesia</strong> top directory.</p><p>An archive file for an application can, for example, be
created like this:</p><pre>
zip:create("mnesia-4.4.7.ez",
	["mnesia-4.4.7"],
	[{cwd, code:lib_dir()},
	 {compress, all},
	 {uncompress,[".beam",".app"]}]).</pre><p>Any file in the archive can be compressed, but to
speed up the access of frequently read files, it can be a good
idea to store <strong>beam</strong> and <strong>app</strong> files uncompressed in
the archive.</p><p>Normally the top directory of an application is located
in library directory <strong>$OTPROOT/lib</strong> or in a directory
referred to by environment variable <strong>ERL_LIBS</strong>. At
startup, when the initial code path is computed, the code server
also looks for archive files in these directories and
possibly adds <strong>ebin</strong> directories in archives to the code path. The
code path then contains paths to directories that look like
<strong>$OTPROOT/lib/mnesia.ez/mnesia/ebin</strong> or
<strong>$OTPROOT/lib/mnesia-4.4.7.ez/mnesia-4.4.7/ebin</strong>.</p><p>The code server uses module <strong>erl_prim_loader</strong> in ERTS
(possibly through <strong>erl_boot_server</strong>) to read code files from
archives. However, the functions in <strong>erl_prim_loader</strong> can also be
used by other applications to read files from archives. For
example, the call
<strong>erl_prim_loader:list_dir( "/otp/root/lib/mnesia-4.4.7.ez/mnesia-4.4.7/examples/bench)"</strong>
would list the contents of a directory inside an archive.
See <a href="./erl_prim_loader">erts/erl_prim_loader</a>.</p><p>An application archive file and a regular application directory
can coexist. This can be useful when it is needed to have
parts of the application as regular files. A typical case is the
<strong>priv</strong> directory, which must reside as a regular directory
to link in drivers dynamically and start port programs.
For other applications that do not need this, directory
<strong>priv</strong> can reside in the archive and the files
under the directory <strong>priv</strong> can be read through
<strong>erl_prim_loader</strong>.</p><p>When a directory is added to the code path and
when the entire code path is (re)set, the code server
decides which subdirectories in an application that are to be
read from the archive and which that are to be read as regular
files. If directories are added or removed afterwards, the file
access can fail if the code path is not updated (possibly to the
same path as before, to trigger the directory resolution
update).</p><p>For each directory on the second level in the application archive
(<strong>ebin</strong>, <strong>priv</strong>, <strong>src</strong>, and so on), the code server first
chooses the regular directory if it exists and second from the
archive. Function <strong>code:lib_dir/2</strong> returns the path to the
subdirectory. For example, <strong>code:lib_dir(megaco,ebin)</strong> can return
<strong>/otp/root/lib/megaco-3.9.1.1.ez/megaco-3.9.1.1/ebin</strong> while
<strong>code:lib_dir(megaco,priv)</strong> can return
<strong>/otp/root/lib/megaco-3.9.1.1/priv</strong>.</p><p>When an <strong>escript</strong> file contains an archive, there are
no restrictions on the name of the <strong>escript</strong> and no restrictions
on how many applications that can be stored in the embedded
archive. Single Beam files can also reside on the top
level in the archive. At startup, the top directory in the
embedded archive and all (second level) <strong>ebin</strong>
directories in the embedded archive are added to the code path.
See <a href="./escript">erts/escript</a>.</p><p>When the choice of directories in the code path is
<strong>strict</strong>, the directory that ends up in the code path is
exactly the stated one. This means that if, for example, the
directory <strong>$OTPROOT/lib/mnesia-4.4.7/ebin</strong> is explicitly
added to the code path, the code server does not load files from
<strong>$OTPROOT/lib/mnesia-4.4.7.ez/mnesia-4.4.7/ebin</strong>.</p><p>This behavior can be controlled through command-line flag
<strong>-code_path_choice Choice</strong>. If the flag is set to <strong>relaxed</strong>,
the code server instead chooses a suitable directory
depending on the actual file structure. If a regular
application <strong>ebin</strong> directory exists, it is chosen. Otherwise,
the directory <strong>ebin</strong> in the archive is chosen if it
exists. If neither of them exists, the original directory is
chosen.</p><p>Command-line flag <strong>-code_path_choice Choice</strong> also
affects how module <strong>init</strong> interprets the <strong>boot script</strong>.
The interpretation of the explicit code paths in the <strong>boot script</strong> can be <strong>strict</strong> or <strong>relaxed</strong>. It is
particularly useful to set the flag to <strong>relaxed</strong> when
elaborating with code loading from archives without editing the
<strong>boot script</strong>. The default is <strong>relaxed</strong>. See <a href="./init">erts/init</a>.</p><h3>Current and Old Code</h3><p>The code for a module can exist in two variants in a system:
<em>current code</em> and <em>old code</em>. When a module is
loaded into the system for the first time, the module code
becomes 'current' and the global <em>export table</em> is updated
with references to all functions exported from the module.</p><p>If then a new instance of the module is loaded (for example, because of
error correction), the code of the previous
instance becomes 'old', and all export entries referring to
the previous instance are removed. After that, the new instance is
loaded as for the first time, and becomes 'current'.</p><p>Both old and current code for a module are valid, and can even be
evaluated concurrently. The difference is that exported functions
in old code are unavailable. Hence, a global call cannot be made
to an exported function in old code, but old code can
still be evaluated because of processes lingering in it.</p><p>If a third instance of the module is loaded, the code server
removes (purges) the old code and any processes lingering in it
are terminated. Then the third instance becomes 'current' and
the previously current code becomes 'old'.</p><p>For more information about old and current code, and how to
make a process switch from old to current code, see section
Compilation and Code Loading in the
<a href="./code_loading">Erlang Reference Manual</a>.</p><h3>Argument Types and Invalid Arguments</h3><p>Module and application names are atoms, while file and directory
names are strings. For backward compatibility reasons, some functions accept
both strings and atoms, but a future release will probably only allow
the arguments that are documented.</p><p>Functions in this module generally fail with an
exception if they are passed an incorrect type (for example, an integer or a tuple
where an atom is expected). An error tuple is returned if the argument type
is correct, but there are some other errors (for example, a non-existing directory
is specified to <strong>set_path/1</strong>).</p><a name="error_reasons"></a><h3>Error Reasons for Code-Loading Functions</h3><p>Functions that load code (such as <strong>load_file/1</strong>) will
return <strong>{error,Reason}</strong> if the load operation fails.
Here follows a description of the common reasons.</p><dl><dt><strong>badfile</strong></dt><dd> <p>The object code has an incorrect format or the module
name in the object code is not the expected module name.</p> </dd><dt><strong>nofile</strong></dt><dd> <p>No file with object code was found.</p> </dd><dt><strong>not_purged</strong></dt><dd> <p>The object code could not be loaded because an old version
of the code already existed.</p> </dd><dt><strong>on_load_failure</strong></dt><dd> <p>The module has an
<a href="../doc/reference_manual/code_loading#on_load">-on_load function</a>
that failed when it was called.</p> </dd><dt><strong>sticky_directory</strong></dt><dd> <p>The object code resides in a sticky directory.</p> </dd></dl><h2>Data Types</h2><span class="name">load_ret</span><span class="name">load_error_rsn</span><span class="name">prepared_code</span><p>An opaque term holding prepared code.</p><h2>Functions</h2><h3>set_path/1</h3><p>Set the code server search path.</p><p>Sets the code path to the list of directories <strong><span class="anno">Path</span></strong>.</p><p>Returns:</p><dl><dt><strong>true</strong></dt><dd><p>If successful</p></dd><dt><strong>{error, bad_directory}</strong></dt><dd><p>If any <strong><span class="anno">Dir</span></strong> is not a directory name</p></dd></dl><h3>get_path/0</h3><p>Return the code server search path.</p><p>Returns the code path.</p><h3>add_path/1</h3><h3>add_pathz/1</h3><p>Add a directory to the end of the code path.</p><ul><li>add_path_ret</li></ul><p>Adds <strong><span class="anno">Dir</span></strong> to the code path. The directory is added as
the last directory in the new path. If <strong><span class="anno">Dir</span></strong> already
exists in the path, it is not added.</p><p>Returns <strong>true</strong> if successful, or
<strong>{error, bad_directory}</strong> if <strong><span class="anno">Dir</span></strong> is not the name
of a directory.</p><h3>add_patha/1</h3><p>Add a directory to the beginning of the code path.</p><ul><li>add_path_ret</li></ul><p>Adds <strong><span class="anno">Dir</span></strong> to the beginning of the code path. If
<strong><span class="anno">Dir</span></strong> exists, it is removed from the old
position in the code path.</p><p>Returns <strong>true</strong> if successful, or
<strong>{error, bad_directory}</strong> if <strong><span class="anno">Dir</span></strong> is not the name
of a directory.</p><h3>add_paths/1</h3><h3>add_pathsz/1</h3><p>Add directories to the end of the code path.</p><p>Adds the directories in <strong><span class="anno">Dirs</span></strong> to the end of the code
path. If a <strong><span class="anno">Dir</span></strong> exists, it is not added.</p><p>Always returns <strong>ok</strong>, regardless of the validity
of each individual <strong><span class="anno">Dir</span></strong>.</p><h3>add_pathsa/1</h3><p>Add directories to the beginning of the code path.</p><p>Traverses <strong><span class="anno">Dirs</span></strong> and adds
each <strong><span class="anno">Dir</span></strong> to the beginning of the code
path. This means that the order of <strong><span class="anno">Dirs</span></strong>
is reversed in the resulting code path. For example, if you
add <strong>[Dir1,Dir2]</strong>, the resulting path will
be <strong>[Dir2,Dir1|OldCodePath]</strong>.</p><p>If a <strong><span class="anno">Dir</span></strong> already exists in the code
path, it is removed from the old position.</p><p>Always returns <strong>ok</strong>, regardless of the validity of each
individual <strong><span class="anno">Dir</span></strong>.</p><h3>del_path/1</h3><p>Delete a directory from the code path.</p><p>Deletes a directory from the code path. The argument can be
an atom <strong><span class="anno">Name</span></strong>, in which case the directory with
the name <strong>.../<span class="anno">Name</span>[-Vsn][/ebin]</strong> is deleted from the code
path. Also, the complete directory name <strong><span class="anno">Dir</span></strong> can be
specified as argument.</p><p>Returns:</p><dl><dt><strong>true</strong></dt><dd><p>If successful</p></dd><dt><strong>false</strong></dt><dd><p>If the directory is not found</p></dd><dt><strong>{error, bad_name}</strong></dt><dd><p>If the argument is invalid</p></dd></dl><h3>replace_path/2</h3><p>Replace a directory with another in the code path.</p><p>Replaces an old occurrence of a directory
named <strong>.../<span class="anno">Name</span>[-Vsn][/ebin]</strong> in the code path, with
<strong><span class="anno">Dir</span></strong>. If <strong><span class="anno">Name</span></strong> does not exist, it adds
the new directory <strong><span class="anno">Dir</span></strong> last in the code path. The new
directory must also be named <strong>.../<span class="anno">Name</span>[-Vsn][/ebin]</strong>.
This function is to be used if a new version of the directory (library) is
added to a running system.</p><p>Returns:</p><dl><dt><strong>true</strong></dt><dd><p>If successful</p></dd><dt><strong>{error, bad_name}</strong></dt><dd><p>If <strong><span class="anno">Name</span></strong> is not found</p></dd><dt><strong>{error, bad_directory}</strong></dt><dd><p>If <strong><span class="anno">Dir</span></strong> does not exist</p></dd><dt><strong>{error, {badarg, [<span class="anno">Name</span>, <span class="anno">Dir</span>]}}</strong></dt><dd><p>If <strong><span class="anno">Name</span></strong> or <strong><span class="anno">Dir</span></strong> is invalid</p></dd></dl><h3>load_file/1</h3><p>Load a module.</p><ul><li>load_ret</li></ul><p>Tries to load the Erlang module <strong><span class="anno">Module</span></strong>, using
the code path. It looks for the object code file with an
extension corresponding to the Erlang machine used, for
example, <strong><span class="anno">Module</span>.beam</strong>. The loading fails if the module
name found in the object code differs from the name
<strong><span class="anno">Module</span></strong>.
<a href="#load_binary/3">load_binary/3</a> must
be used to load object code with a module name that is
different from the file name.</p><p>Returns <strong>{module, <span class="anno">Module</span>}</strong> if successful, or
<strong>{error, Reason}</strong> if loading fails.
See <a href="#error_reasons">Error Reasons for Code-Loading Functions</a> for a description of the possible error reasons.</p><h3>load_abs/1</h3><p>Load a module, residing in a specified file.</p><ul><li>load_ret</li></ul><ul><li>loaded_filename</li></ul><ul><li>loaded_ret_atoms</li></ul><p>Same as <strong>load_file(<span class="anno">Module</span>)</strong>, but
<strong><span class="anno">Filename</span></strong> is an absolute or
relative filename. The code path is not searched. It returns
a value in the same way as
<a href="#load_file/1">load_file/1</a>. Notice
that <strong><span class="anno">Filename</span></strong> must not contain the extension (for
example, <strong>.beam</strong>) because <strong>load_abs/1</strong> adds the correct
extension.</p><h3>ensure_loaded/1</h3><p>Ensure that a module is loaded.</p><p>Tries to load a module in the same way as
<a href="#load_file/1">load_file/1</a>,
unless the module is already loaded.
However, in embedded mode it does not load a module that is not
already loaded, but returns <strong>{error, embedded}</strong> instead.
See <a href="#error_reasons">Error Reasons for Code-Loading Functions</a> for a description of other possible error reasons.</p><h3>load_binary/3</h3><p>Load object code for a module.</p><ul><li>loaded_filename</li></ul><ul><li>loaded_ret_atoms</li></ul><p>This function can be used to load object code on remote
Erlang nodes. Argument <strong><span class="anno">Binary</span></strong> must contain
object code for <strong><span class="anno">Module</span></strong>.
<strong><span class="anno">Filename</span></strong> is only used by the code server to keep a
record of from which file the object code for <strong><span class="anno">Module</span></strong>
comes. Thus, <strong><span class="anno">Filename</span></strong> is not opened and read by
the code server.</p><p>Returns <strong>{module, <span class="anno">Module</span>}</strong> if successful, or
<strong>{error, Reason}</strong> if loading fails.
See <a href="#error_reasons">Error Reasons for Code-Loading Functions</a> for a description of the possible error reasons.</p><h3>atomic_load/1</h3><p>Load a list of modules atomically</p><p>Tries to load all of the modules in the list
<strong><span class="anno">Modules</span></strong> atomically.  That means that
either all modules are loaded at the same time, or
none of the modules are loaded if there is a problem with any
of the modules.</p><p>Loading can fail for one the following reasons:</p><dl><dt><strong>badfile</strong></dt><dd> <p>The object code has an incorrect format or the module
name in the object code is not the expected module name.</p> </dd><dt><strong>nofile</strong></dt><dd> <p>No file with object code exists.</p> </dd><dt><strong>on_load_not_allowed</strong></dt><dd> <p>A module contains an
<a href="../doc/reference_manual/code_loading#on_load">-on_load function</a>.</p> </dd><dt><strong>duplicated</strong></dt><dd> <p>A module is included more than once in
<strong><span class="anno">Modules</span></strong>.</p> </dd><dt><strong>not_purged</strong></dt><dd> <p>The object code cannot be loaded because an old version
of the code already exists.</p> </dd><dt><strong>sticky_directory</strong></dt><dd> <p>The object code resides in a sticky directory.</p> </dd><dt><strong>pending_on_load</strong></dt><dd> <p>A previously loaded module contains an
<strong>-on_load</strong> function that never finished.</p> </dd></dl><p>If it is important to minimize the time that an application
is inactive while changing code, use
<a href="#prepare_loading/1">prepare_loading/1</a>
and
<a href="#finish_loading/1">finish_loading/1</a>
instead of <strong>atomic_load/1</strong>. Here is an example:</p><pre>
{ok,Prepared} = code:prepare_loading(Modules),
%% Put the application into an inactive state or do any
%% other preparation needed before changing the code.
ok = code:finish_loading(Prepared),
%% Resume the application.</pre><h3>prepare_loading/1</h3><p>Prepare a list of modules atomically</p><p>Prepares to load the modules in the list
<strong><span class="anno">Modules</span></strong>.
Finish the loading by calling
<a href="#finish_loading/1">finish_loading(Prepared)</a>.</p><p>This function can fail with one of the following error reasons:</p><dl><dt><strong>badfile</strong></dt><dd> <p>The object code has an incorrect format or the module
name in the object code is not the expected module name.</p> </dd><dt><strong>nofile</strong></dt><dd> <p>No file with object code exists.</p> </dd><dt><strong>on_load_not_allowed</strong></dt><dd> <p>A module contains an
<a href="../doc/reference_manual/code_loading#on_load">-on_load function</a>.</p> </dd><dt><strong>duplicated</strong></dt><dd> <p>A module is included more than once in
<strong><span class="anno">Modules</span></strong>.</p> </dd></dl><h3>finish_loading/1</h3><p>Finish loading a list of prepared modules atomically</p><p>Tries to load code for all modules that have been previously
prepared by
<a href="#prepare_loading/1">prepare_loading/1</a>.
The loading occurs atomically, meaning that
either all modules are loaded at the same time, or
none of the modules are loaded.</p><p>This function can fail with one of the following error reasons:</p><dl><dt><strong>not_purged</strong></dt><dd> <p>The object code cannot be loaded because an old version
of the code already exists.</p> </dd><dt><strong>sticky_directory</strong></dt><dd> <p>The object code resides in a sticky directory.</p> </dd><dt><strong>pending_on_load</strong></dt><dd> <p>A previously loaded module contains an
<strong>-on_load</strong> function that never finished.</p> </dd></dl><h3>ensure_modules_loaded/1</h3><p>Ensure that a list of modules is loaded</p><p>Tries to load any modules not already loaded in the list
<strong><span class="anno">Modules</span></strong> in the same way as
<a href="#load_file/1">load_file/1</a>.</p><p>Returns <strong>ok</strong> if successful, or
<strong>{error,[{Module,Reason}]}</strong> if loading of some modules fails.
See <a href="#error_reasons">Error Reasons for Code-Loading Functions</a> for a description of other possible error reasons.</p><h3>delete/1</h3><p>Remove current code for a module.</p><p>Removes the current code for <strong><span class="anno">Module</span></strong>, that is,
the current code for <strong><span class="anno">Module</span></strong> is made old. This means
that processes can continue to execute the code in the module,
but no external function calls can be made to it.</p><p>Returns <strong>true</strong> if successful, or <strong>false</strong> if there
is old code for <strong><span class="anno">Module</span></strong> that must be purged first, or
if <strong><span class="anno">Module</span></strong> is not a (loaded) module.</p><h3>purge/1</h3><p>Remove old code for a module.</p><p>Purges the code for <strong><span class="anno">Module</span></strong>, that is, removes code
marked as old. If some processes still linger in the old code,
these processes are killed before the code is removed.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>As of ERTS version 9.0, a process is only considered
to be lingering in the code if it has direct references to the code.
For more information see documentation of
<a href="../erts/erlang#check_process_code/3">erts/erlang#check_process_code/3</a>,
which is used in order to determine this.</p></div><p>Returns <strong>true</strong> if successful and any process is needed to
be killed, otherwise <strong>false</strong>.</p><h3>soft_purge/1</h3><p>Remove old code for a module, unless no process uses it.</p><p>Purges the code for <strong><span class="anno">Module</span></strong>, that is, removes code
marked as old, but only if no processes linger in it.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>As of ERTS version 9.0, a process is only considered
to be lingering in the code if it has direct references to the code.
For more information see documentation of
<a href="../erts/erlang#check_process_code/3">erts/erlang#check_process_code/3</a>,
which is used in order to determine this.</p></div><p>Returns <strong>false</strong> if the module cannot be purged because
of processes lingering in old code, otherwise <strong>true</strong>.</p><h3>is_loaded/1</h3><p>Check if a module is loaded.</p><ul><li>loaded_filename</li></ul><ul><li>loaded_ret_atoms</li></ul><strong><span class="anno">Filename</span></strong> is an absolute filename.<p>Checks if <strong><span class="anno">Module</span></strong> is loaded. If it is,
<strong>{file, <span class="anno">Loaded</span>}</strong> is returned, otherwise <strong>false</strong>.</p><p>Normally, <strong><span class="anno">Loaded</span></strong> is the absolute filename
<strong>Filename</strong> from which the code is obtained. If the module
is preloaded (see
<a href="./script">sasl/script</a>),
<strong>Loaded==preloaded</strong>. If the module is Cover-compiled (see
<a href="./cover">tools/cover</a>),
<strong>Loaded==cover_compiled</strong>.</p><h3>all_loaded/0</h3><p>Get all loaded modules.</p><ul><li>loaded_filename</li></ul><ul><li>loaded_ret_atoms</li></ul><strong><span class="anno">Filename</span></strong> is an absolute filename.<p>Returns a list of tuples <strong>{<span class="anno">Module</span>, <span class="anno">Loaded</span>}</strong> for all
loaded modules. <strong><span class="anno">Loaded</span></strong> is normally the absolute filename,
as described for
<a href="#is_loaded/1">is_loaded/1</a>.</p><h3>which/1</h3><p>The object code file of a module.</p><ul><li>loaded_ret_atoms</li></ul><p>If the module is not loaded, this function searches the code
path for the first file containing object code for
<strong><span class="anno">Module</span></strong> and returns the absolute filename.</p><p>If the module is loaded, it returns the name of the file
containing the loaded object code.</p><p>If the module is preloaded, <strong>preloaded</strong> is returned.</p><p>If the module is Cover-compiled, <strong>cover_compiled</strong> is returned.</p><p>If the module cannot be found, <strong>non_existing</strong> is returned.</p><h3>get_object_code/1</h3><p>Gets the object code for a module.</p><p>Searches the code path for the object code of module
<strong><span class="anno">Module</span></strong>. Returns <strong>{<span class="anno">Module</span>, <span class="anno">Binary</span>, <span class="anno">Filename</span>}</strong>
if successful, otherwise <strong>error</strong>. <strong><span class="anno">Binary</span></strong> is a
binary data object, which contains the object code for
the module. This can be useful if code is to be loaded on a
remote node in a distributed system. For example, loading
module <strong><span class="anno">Module</span></strong> on a node <strong>Node</strong> is done as
follows:</p><pre><code class="">
...
{_Module, Binary, Filename} = code:get_object_code(Module),
rpc:call(Node, code, load_binary, [Module, Filename, Binary]),
...</code></pre><h3>root_dir/0</h3><p>Root directory of Erlang/OTP.</p><p>Returns the root directory of Erlang/OTP, which is
the directory where it is installed.</p><p><em>Example:</em></p><pre>
&gt; <span class="input">code:root_dir().</span>
"/usr/local/otp"</pre><h3>lib_dir/0</h3><p>Library directory of Erlang/OTP.</p><p>Returns the library directory, <strong>$OTPROOT/lib</strong>, where
<strong>$OTPROOT</strong> is the root directory of Erlang/OTP.</p><p><em>Example:</em></p><pre>
&gt; <span class="input">code:lib_dir().</span>
"/usr/local/otp/lib"</pre><h3>lib_dir/1</h3><p>Library directory for an application.</p><p>Returns the path
for the "library directory", the top directory, for an
application <strong><span class="anno">Name</span></strong> located under <strong>$OTPROOT/lib</strong> or
on a directory referred to with environment variable <strong>ERL_LIBS</strong>.</p><p>If a regular directory called <strong><span class="anno">Name</span></strong> or
<strong><span class="anno">Name</span>-Vsn</strong> exists in the code path with an <strong>ebin</strong>
subdirectory, the path to this directory is returned (not
the <strong>ebin</strong> directory).</p><p>If the directory refers to a directory in an archive, the
archive name is stripped away before the path is returned.
For example, if directory
<strong>/usr/local/otp/lib/mnesia-4.2.2.ez/mnesia-4.2.2/ebin</strong>
is in the path, <strong>/usr/local/otp/lib/mnesia-4.2.2/ebin</strong>
is returned. This means that the library directory for
an application is the same, regardless if the
application resides in an archive or not.</p><p><em>Example:</em></p><pre>
&gt; <span class="input">code:lib_dir(mnesia).</span>
"/usr/local/otp/lib/mnesia-4.2.2"</pre><p>Returns <strong>{error, bad_name}</strong> if <strong><span class="anno">Name</span></strong>
is not the name of an application under <strong>$OTPROOT/lib</strong> or
on a directory referred to through environment variable <strong>ERL_LIBS</strong>.
Fails with an exception if <strong>Name</strong> has the wrong type.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>For backward compatibility, <strong><span class="anno">Name</span></strong> is also
allowed to be a string. That will probably change in a future release.</p></div><h3>lib_dir/2</h3><p>Subdirectory for an application.</p><p>Returns the path to a subdirectory directly under the top
directory of an application. Normally the subdirectories
reside under the top directory for the application, but when
applications at least partly resides in an archive, the
situation is different. Some of the subdirectories can reside
as regular directories while other reside in an archive
file. It is not checked whether this directory exists.</p><p><em>Example:</em></p><pre>
&gt; <span class="input">code:lib_dir(megaco, priv).</span>
"/usr/local/otp/lib/megaco-3.9.1.1/priv"</pre><p>Fails with an exception if <strong><span class="anno">Name</span></strong> or <strong><span class="anno">SubDir</span></strong> has
the wrong type.</p><h3>compiler_dir/0</h3><p>Library directory for the compiler.</p><p>Returns the compiler library directory. Equivalent to
<strong>code:lib_dir(compiler)</strong>.</p><h3>priv_dir/1</h3><p>Priv directory for an application.</p><p>Returns the path to the <strong>priv</strong> directory in an
application. Equivalent to <strong>code:lib_dir(<span class="anno">Name</span>, priv)</strong>.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>For backward compatibility, <strong><span class="anno">Name</span></strong> is also allowed to
be a string. That will probably change in a future release.</p></div><h3>objfile_extension/0</h3><p>Object code file extension.</p><p>Returns the object code file extension corresponding to
the Erlang machine used, namely <strong>.beam</strong>.</p><h3>stick_dir/1</h3><p>Mark a directory as sticky.</p><p>Marks <strong><span class="anno">Dir</span></strong> as sticky.</p><p>Returns <strong>ok</strong> if successful, otherwise <strong>error</strong>.</p><h3>unstick_dir/1</h3><p>Remove a sticky directory mark.</p><p>Unsticks a directory that is marked as
sticky.</p><p>Returns <strong>ok</strong> if successful, otherwise <strong>error</strong>.</p><h3>is_sticky/1</h3><p>Test if a module is sticky.</p><p>Returns <strong>true</strong> if <strong><span class="anno">Module</span></strong> is the
name of a module that has been loaded from a sticky directory
(in other words: an attempt to reload the module will fail),
or <strong>false</strong> if <strong><span class="anno">Module</span></strong> is not a loaded module or is
not sticky.</p><h3>where_is_file/1</h3><p>Full name of a file located in the code path.</p><p>Searches the code path for <strong><span class="anno">Filename</span></strong>, a file of
arbitrary type. If found, the full name is returned.
<strong>non_existing</strong> is returned if the file cannot be found.
The function can be useful, for example, to locate
application resource files.</p><h3>clash/0</h3><p>Search for modules with identical names.</p><p>Searches all directories in the code path for module names with
identical names and writes a report to <strong>stdout</strong>.</p><h3>module_status/1</h3><p>Return the status of the module in relation to object file on disk.</p><p>Returns:</p><dl><dt><strong>not_loaded</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is not currently loaded.</p></dd><dt><strong>loaded</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is loaded and the object file
exists and contains the same code.</p></dd><dt><strong>removed</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is loaded but no
corresponding object file can be found in the code path.</p></dd><dt><strong>modified</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is loaded but the object file
contains code with a different MD5 checksum.</p></dd></dl><p>Preloaded modules are always reported as <strong>loaded</strong>, without
inspecting the contents on disk. Cover compiled modules will always
be reported as <strong>modified</strong> if an object file exists, or as
<strong>removed</strong> otherwise. Modules whose load path is an empty string
(which is the convention for auto-generated code) will only be
reported as <strong>loaded</strong> or <strong>not_loaded</strong>.</p><p>For modules that have native code loaded (see
<a href="#is_module_native/1">is_module_native/1</a>),
the MD5 sum of the native code in the object file is used for the
comparison, if it exists; the Beam code in the file is ignored.
Reversely, for modules that do not currently have native code
loaded, any native code in the file will be ignored.</p><p>See also <a href="#modified_modules/0">modified_modules/0</a>.</p><h3>modified_modules/0</h3><p>Return a list of all modules modified on disk.</p><p>Returns the list of all currently loaded modules for which
<a href="#module_status/1">module_status/1</a>
returns <strong>modified</strong>. See also <a href="#all_loaded/0">all_loaded/0</a>.</p><h3>is_module_native/1</h3><p>Test if a module has native code.</p><p>Returns:</p><dl><dt><strong>true</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is the
name of a loaded module that has native code loaded</p></dd><dt><strong>false</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is loaded but does not have
native code</p></dd><dt><strong>undefined</strong></dt><dd><p>If <strong><span class="anno">Module</span></strong> is not loaded</p></dd></dl><h3>get_mode/0</h3><p>The mode of the code server.</p><p>Returns an atom describing the mode of the code server:
<strong>interactive</strong> or <strong>embedded</strong>.</p><p>This information is useful when an external entity (for example,
an IDE) provides additional code for a running node. If the code server is
in interactive mode, it only has to add the path to the code. If the code server
is in embedded mode, the code must be loaded with
<a href="#load_binary/3">load_binary/3</a>.</p><h2>config</h2><p>Configuration file.</p><p>A <em>configuration file</em> contains values for configuration
parameters for the applications in the system. The <strong>erl</strong>
command-line argument <strong>-config Name</strong> tells the system to use
data in the system configuration file <strong>Name.config</strong>.Configuration parameter values in the configuration file
override the values in the application resource files (see
<a href="app">app</a>).
The values in the configuration file can be
overridden by command-line flags (see
<a href="./erl">erts/erl</a>).The value of a configuration parameter is retrieved by calling
<strong>application:get_env/1,2</strong>.</p><h3>File Syntax</h3><p>The configuration file is to be called <strong>Name.config</strong>, where
<strong>Name</strong> is any name.</p><p>File <strong>.config</strong> contains a single Erlang term and
has the following syntax:</p><pre><code class="">
[{Application1, [{Par11, Val11}, ...]},
 ...
 {ApplicationN, [{ParN1, ValN1}, ...]}].</code></pre><dl><dt><strong>Application = atom()</strong></dt><dd><p>Application name.</p></dd><dt><strong>Par = atom()</strong></dt><dd><p>Name of a configuration parameter.</p></dd><dt><strong>Val = term()</strong></dt><dd><p>Value of a configuration parameter.</p></dd></dl><h3>sys.config</h3><p>When starting Erlang in embedded mode, it is assumed that
exactly one system configuration file is used, named
<strong>sys.config</strong>. This file is to be located in
<strong>$ROOT/releases/Vsn</strong>, where <strong>$ROOT</strong> is the Erlang/OTP
root installation directory and <strong>Vsn</strong> is the release version.</p><p>Release handling relies on this assumption. When installing a
new release version, the new <strong>sys.config</strong> is read and used
to update the application configurations.</p><p>This means that specifying another <strong>.config</strong> file, or more
<strong>.config</strong> files, leads to inconsistent update of application
configurations. There is, however, a syntax for
<strong>sys.config</strong> that allows pointing out other
<strong>.config</strong> files:</p><pre><code class="">
[{Application, [{Par, Val}]} | File].</code></pre><dl><dt><strong>File = string()</strong></dt><dd>Name of another <strong>.config</strong> file. Extension <strong>.config</strong> can be omitted. It is recommended to use absolute paths. If a relative path is used, <strong>File</strong> is searched, first, relative from <strong>sys.config</strong> directory, then relative to the current working directory of the emulator, for backward compatibility. This allow to use a <strong>sys.config</strong> pointing out other <strong>.config</strong> files in a release or in a node started manually using <strong>-config ...</strong> with same result whatever the current working directory. </dd></dl><p>When traversing the contents of <strong>sys.config</strong> and a filename
is encountered, its contents are read and merged with the result
so far. When an application configuration tuple
<strong>{Application, Env}</strong> is found, it is merged with the result
so far. Merging means that new parameters are added and existing
parameter values overwritten.</p><p><em>Example:</em></p><pre><code class="">
sys.config:

[{myapp,[{par1,val1},{par2,val2}]},
 "/home/user/myconfig"].

myconfig.config:

[{myapp,[{par2,val3},{par3,val4}]}].</code></pre><p>This yields the following environment for <strong>myapp</strong>:</p><pre><code class="">
[{par1,val1},{par2,val3},{par3,val4}]</code></pre><p>The behavior if a file specified in <strong>sys.config</strong> does not
exist, or is erroneous, is backwards compatible.
Starting the runtime system will fail. Installing a new release
version will not fail, but an error message is returned and
the erroneous file is ignored.</p><h3>See Also</h3><p><a href="app">app</a>,
<a href="./erl">erts/erl</a>,
<a href="./des_princ">OTP Design Principles</a></p><h2>disk_log</h2><p>A disk-based term logging facility.</p><p><strong>disk_log</strong> is a disk-based term logger that enables
efficient logging of items on files.Two types of logs are supported:<dl><dt>halt logs</dt><dd><p>Appends items to a single file, which size can
be limited by the <strong>disk_log</strong> module.</p></dd><dt>wrap logs</dt><dd><p>Uses a sequence of wrap log files of limited size. As a
wrap log file is filled up, further items are logged on to the next
file in the sequence, starting all over with the first file when
the last file is filled up.</p></dd></dl>For efficiency reasons, items are always written to files as binaries.Two formats of the log files are supported:<dl><dt>internal format</dt><dd><p>Supports automatic repair of log files that are not
properly closed and enables efficient reading of logged items in
<em>chunks</em> using a set of functions defined in this module.
This is the only way to read internally formatted logs.
An item logged to an internally formatted log must not occupy more
than 4 GB of disk space (the size must fit in 4 bytes).</p></dd><dt>external format</dt><dd><p>Leaves it up to the user to read and interpret the logged data.
The <strong>disk_log</strong> module cannot repair externally formatted logs.</p></dd></dl>For each open disk log, one process handles requests
made to the disk log. This process is created when
<a href="#open/1">open/1</a>
is called, provided there exists no process handling the disk log.
A process that opens a disk log can be an <em>owner</em>
or an anonymous <em>user</em> of the disk log. Each owner is 
linked to the disk log process, and an owner can close the disk log
either explicitly (by calling <strong>close/1</strong> or <strong>lclose/1,2</strong>)
or by terminating.Owners can subscribe to <em>notifications</em>,
messages of the form <strong>{disk_log, Node, Log, Info}</strong>, which are sent
from the disk log process when certain events occur, see 
the functions and in particular the <strong>open/1</strong> option
<a href="#notify">notify</a>.
A log can have many owners, but a process cannot own a
log more than once. However, the same process can open the log
as a user more than once.For a disk log process to close its file properly and terminate,
it must be closed by its owners and once by some non-owner process
for each time the log was used anonymously. The users are counted
and there must not be any users left when the disk log process terminates.
Items can be logged <em>synchronously</em> by using functions
<a href="#log/2">log/2</a>,
<a href="#blog/2">blog/2</a>,
<a href="#log_terms/2">log_terms/2</a>, and
<a href="#blog_terms/2">blog_terms/2</a>.
For each of these functions, the caller is put
on hold until the items are logged (but not necessarily
written, use <strong>sync/1</strong> to ensure that). By adding an <strong>a</strong>
to each of the mentioned function names, we get functions that log
items <em>asynchronously</em>. Asynchronous functions do not wait for
the disk log process to write the items to the file, but
return the control to the caller more or less immediately.
When using the internal format for logs, use functions
<a href="#log/2">log/2</a>,
<a href="#log_terms/2">log_terms/2</a>,
<a href="#alog/2">alog/2</a>, and
<a href="#alog_terms/2">alog_terms/2</a>.
These functions log one or more Erlang terms.
By prefixing each of the functions with a <strong>b</strong> (for "binary"),
we get the corresponding <strong>blog()</strong> functions for the external format.
These functions log one or more chunks of bytes.
For example, to log the string <strong>"hello"</strong> in ASCII format, you
can use <strong>disk_log:blog(Log, "hello")</strong>, or
<strong>disk_log:blog(Log, list_to_binary("hello"))</strong>. The two
alternatives are equally efficient.The <strong>blog()</strong> functions can also be used for internally formatted
logs, but in this case they must be called with binaries constructed
with calls to
<a href="../erts/erlang#term_to_binary/1">erts/erlang#term_to_binary/1</a>.
There is no check to ensure
this, it is entirely the responsibility of the caller. If these
functions are called with binaries that do not correspond to
Erlang terms, the
<a href="#chunk/2">chunk/2</a>
and automatic repair
functions fail. The corresponding terms (not the binaries)
are returned when <strong>chunk/2,3</strong> is called.
A collection of open disk logs with the same name running on
different nodes is said to be a <em>distributed disk log</em>
if requests made to any of the logs are automatically made to
the other logs as well. The members of such a collection are
called individual distributed disk logs, or just distributed
disk logs if there is no risk of confusion. There is no order
between the members of such a collection. For example, logged
terms are not necessarily written to the node where the
request was made before written to the other nodes. However,
a few functions do not make requests to all
members of distributed disk logs, namely
<a href="#info/1">info/1</a>,
<a href="#chunk/2">chunk/2</a>,
<a href="#bchunk/2">bchunk/2</a>,
<a href="#chunk_step/3">chunk_step/3</a>, and
<a href="#lclose/1">lclose/1</a>.An open disk log that is not a distributed disk
log is said to be a <em>local disk log</em>. A local disk log is
only accessible from the node where the disk log process runs,
whereas a distributed disk log is accessible from all nodes in
the Erlang system, except for those nodes where a local
disk log with the same name as the distributed disk log exists.
All processes on nodes that have access to a local or
distributed disk log can log items or otherwise change, inspect,
or close the log.
It is not guaranteed that all log files of a distributed disk log 
contain the same log items. No attempt is made to synchronize
the contents of the files. However, as long as at least one of 
the involved nodes is alive at each time, all items are logged.
When logging items to a distributed log, or otherwise trying to
change the log, the replies from individual logs are
ignored. If all nodes are down, the disk log functions
reply with a <strong>nonode</strong> error.
Errors are reported differently for asynchronous log attempts
and other uses of the <strong>disk_log</strong> module. When used synchronously,
this module replies with an error message, but when called
asynchronously, this module does not know where to send
the error message. Instead, owners subscribing to notifications
receive an <strong>error_status</strong> message. 
The <strong>disk_log</strong> module does not report errors to the
<a href="error_logger">error_logger</a>
module. It is up to the caller to decide
whether to employ the error logger. Function
<a href="#format_error/1">format_error/1</a>
can be used to produce readable messages from error replies.
However, information events are sent to the error logger in two
situations, namely when a log is repaired, or when a file is missing
while reading chunks.
Error message <strong>no_such_log</strong> means that the specified
disk log is not open. Nothing is said about whether the disk log
files exist or not.
</p><h2>Data Types</h2><span class="name">log</span><span class="name">dlog_size</span><span class="name">dlog_format</span><span class="name">dlog_head_opt</span><span class="name">dlog_mode</span><span class="name">dlog_type</span><span class="name">continuation</span><p>Chunk continuation returned by
<strong>chunk/2,3</strong>, <strong>bchunk/2,3</strong>, or <strong>chunk_step/3</strong>.</p><span class="name">invalid_header</span><span class="name">file_error</span><h2>Functions</h2><h3>accessible_logs/0</h3><p>Return the accessible disk logs on the current node.</p><p>Returns the names of the disk logs accessible on the current node.
The first list contains local disk logs and the
second list contains distributed disk logs.
</p><h3>alog/2</h3><h3>balog/2</h3><p>Asynchronously log an item on to a disk log.</p><ul><li>Log</li></ul><ul><li>Term</li></ul><ul><li>Bytes</li></ul><ul><li>notify_ret</li></ul><p>Asynchronously append an item to a disk log. <strong>alog/2</strong> is
used for internally formatted logs and <strong>balog/2</strong>
for externally formatted logs. <strong>balog/2</strong> can also be used
for internally formatted logs if the binary is
constructed with a call to
<a href="../erts/erlang#term_to_binary/1">erts/erlang#term_to_binary/1</a>.
</p><p>Owners subscribing to notifications receive
message <strong>read_only</strong>, <strong>blocked_log</strong>,
or <strong>format_external</strong> if the item cannot be written
on the log, and possibly one of the messages <strong>wrap</strong>,
<strong>full</strong>, or <strong>error_status</strong> if an item is written
on the log. Message <strong>error_status</strong> is sent if
something is wrong with the header function or if a file error
occurs.
</p><h3>alog_terms/2</h3><h3>balog_terms/2</h3><p>Asynchronously log many items on to a disk log.</p><ul><li>Log</li></ul><ul><li>TermList</li></ul><ul><li>ByteList</li></ul><ul><li>notify_ret</li></ul><p>Asynchronously append a list of items to a disk log.
<strong>alog_terms/2</strong> is used for internally
formatted logs and <strong>balog_terms/2</strong>
for externally formatted logs. <strong>balog_terms/2</strong> can also be used
for internally formatted logs if the binaries are
constructed with calls to
<a href="../erts/erlang#term_to_binary/1">erts/erlang#term_to_binary/1</a>.
</p><p>Owners subscribing to notifications receive
message <strong>read_only</strong>, <strong>blocked_log</strong>,
or <strong>format_external</strong> if the items cannot be written
on the log, and possibly one or more of the messages <strong>wrap</strong>,
<strong>full</strong>, and <strong>error_status</strong> if items are written
on the log. Message <strong>error_status</strong> is sent if
something is wrong with the header function or if a file error
occurs.
</p><h3>block/1</h3><h3>block/2</h3><p>Block a disk log.</p><ul><li>block_error_rsn</li></ul><p>With a call to <strong>block/1,2</strong> a process can block a log.
If the blocking process is not an owner of the log, a temporary
link is created between the disk log process and the blocking
process. The link ensures that the disk log is
unblocked if the blocking process terminates without
first closing or unblocking the log.
</p><p>Any process can probe a blocked log with <strong>info/1</strong> or
close it with <strong>close/1</strong>. The blocking process can also
use functions <strong>chunk/2,3</strong>, <strong>bchunk/2,3</strong>,
<strong>chunk_step/3</strong>, and <strong>unblock/1</strong> without being
affected by the block. Any other attempt than those
mentioned so far to update or read a blocked log suspends the
calling process until the log is unblocked or returns
error message <strong>{blocked_log, <span class="anno">Log</span>}</strong>, depending on
whether the value of <strong><span class="anno">QueueLogRecords</span></strong> is <strong>true</strong>
or <strong>false</strong>. <strong><span class="anno">QueueLogRecords</span></strong> defaults to
<strong>true</strong>, which is used by <strong>block/1</strong>.
</p><h3>change_header/2</h3><p>Change option head or head_func for an owner of a disk log.</p><p>Changes the value of option <strong>head</strong> or <strong>head_func</strong> for an owner of a disk log.</p><h3>change_notify/3</h3><p>Change option notify for an owner of a disk log.</p><p>Changes the value of option <strong>notify</strong> for an owner of a disk log. </p><h3>change_size/2</h3><p>Change the size of an open disk log.</p><p>Changes the size of an open log.
For a halt log, the size can always be increased,
but it cannot be decreased to something less than
the current file size.
</p><p>For a wrap log, both the size and the number of files can always
be increased, as long as the number of files does not
exceed 65000. If the maximum number of files is decreased, the
change is not valid until the current file is full and the
log wraps to the next file.
The redundant files are removed the next time the log wraps around,
that is, starts to log to file number 1.
</p><p>As an example, assume that the old maximum number of files 
is 10 and that the new maximum number of files is 6. If 
the current file number is not greater than the new maximum number 
of files, files 7-10 are removed when file 6
is full and the log starts to write to file number 1 again. 
Otherwise, the files greater than the current
file are removed when the current file is full (for example, if
the current file is 8, files 9 and 10 are removed). The files between
the new maximum number of files and the current
file (that is, files 7 and 8) are removed the next time file 6
is full.
</p><p>If the size of the files is decreased, the change immediately
affects the current log. It does not change the
size of log files already full until the next time they are used.
</p><p>If the log size is decreased, for example, to save space,
function
<a href="#inc_wrap_file/1">inc_wrap_file/1</a>
can be used to force the log to wrap.
</p><h3>chunk/2</h3><h3>chunk/3</h3><h3>bchunk/2</h3><h3>bchunk/3</h3><p>Read a chunk of items written to a disk log.</p><ul><li>Log</li></ul><ul><li>Continuation</li></ul><ul><li>N</li></ul><ul><li>chunk_ret</li></ul><ul><li>bchunk_ret</li></ul><ul><li>chunk_error_rsn</li></ul><p>Efficiently reads the terms that are appended
to an internally formatted log. It minimizes disk
I/O by reading 64 kilobyte chunks from the file. Functions
<strong>bchunk/2,3</strong> return the binaries read from
the file, they do not call <strong>binary_to_term()</strong>. Apart from that,
they work just like <strong>chunk/2,3</strong>.
</p><p>The first time <strong>chunk()</strong> (or <strong>bchunk()</strong>) is called,
an initial continuation, the atom <strong>start</strong>, must be
provided. If a disk log process is running on the
current node, terms are read from that log. Otherwise, an
individual distributed log on some other node is chosen, if
such a log exists.
</p><p>When <strong>chunk/3</strong> is called, <strong><span class="anno">N</span></strong> controls the
maximum number of terms that are read from the log in each
chunk. Defaults to <strong>infinity</strong>, which means that all the
terms contained in the 64 kilobyte chunk are read. If less than
<strong><span class="anno">N</span></strong> terms are returned, this does not necessarily mean
that the end of the file is reached.
</p><p><strong>chunk()</strong> returns a tuple
<strong>{<span class="anno">Continuation2</span>, <span class="anno">Terms</span>}</strong>, where
<strong><span class="anno">Terms</span></strong> is a list
of terms found in the log. <strong><span class="anno">Continuation2</span></strong> is yet
another continuation, which must be passed on to any
subsequent calls to <strong>chunk()</strong>. With a series of calls to
<strong>chunk()</strong>, all terms from a log can be extracted.
</p><p><strong>chunk()</strong> returns a tuple
<strong>{<span class="anno">Continuation2</span>, <span class="anno">Terms</span>, <span class="anno">Badbytes</span>}</strong>
if the log is opened in read-only mode and the read chunk is corrupt.
<strong><span class="anno">Badbytes</span></strong> is the number of bytes in the file found not to be
Erlang terms in the chunk. Notice that the log is not repaired.
When trying to read chunks from a log opened in read-write mode,
tuple <strong>{corrupt_log_file, <span class="anno">FileName</span>}</strong> is returned if the
read chunk is corrupt.
</p><p><strong>chunk()</strong> returns <strong>eof</strong> when the end of the log is
reached, or <strong>{error, <span class="anno">Reason</span>}</strong> if an error occurs. If
a wrap log file is missing, a message is output on the error log.
</p><p>When <strong>chunk/2,3</strong> is used with wrap logs, the returned
continuation might not be valid in the next call to
<strong>chunk()</strong>. This is because the log can wrap and delete
the file into which the continuation points. To prevent this,
the log can be blocked during the search.
</p><h3>chunk_info/1</h3><p>Return information about a chunk continuation of a disk log.</p><p>Returns the pair <strong>{node, <span class="anno">Node</span>}</strong>,
describing the chunk continuation returned by
<strong>chunk/2,3</strong>, <strong>bchunk/2,3</strong>, or <strong>chunk_step/3</strong>.</p><p>Terms are read from the disk log running on <strong><span class="anno">Node</span></strong>.</p><h3>chunk_step/3</h3><p>Step forward or backward among the wrap log files of a disk log.</p><p>Can be used with <strong>chunk/2,3</strong> and <strong>bchunk/2,3</strong>
to search through an internally formatted wrap log. It takes as
argument a continuation as returned by <strong>chunk/2,3</strong>,
<strong>bchunk/2,3</strong>, or <strong>chunk_step/3</strong>, and steps forward
(or backward) <strong><span class="anno">Step</span></strong> files in the wrap log. The
continuation returned, points to the first log item in the
new current file.
</p><p>If atom <strong>start</strong> is specified as continuation, a disk log
to read terms from is chosen. A local or distributed disk log
on the current node is preferred to an
individual distributed log on some other node.
</p><p>If the wrap log is not full because all files are not yet
used, <strong>{error, end_of_log}</strong> is returned if trying to
step outside the log.
</p><h3>close/1</h3><p>Close a disk log.</p><ul><li>close_error_rsn</li></ul><p><a name="close_1"></a>Closes a
local or distributed disk log properly. An internally
formatted log must be closed before the Erlang system is
stopped. Otherwise, the log is regarded as unclosed and the
automatic repair procedure is activated next time the
log is opened.
</p><p>The disk log process is not terminated as long as there are
owners or users of the log. All owners must close the log,
possibly by terminating. Also, any other process, not only the processes
that have opened the log anonymously, can decrement the <strong>users</strong>
counter by closing the log. 
Attempts to close a log by a process that is 
not an owner are ignored if there are no users.
</p><p>If the log is blocked by the closing process, the log is also
unblocked.
</p><h3>format_error/1</h3><p>Return an English description of a disk log error reply.</p><p>Given the error returned by any function in this module, 
this function returns a descriptive string
of the error in English. For file errors, function
<strong>format_error/1</strong> in module
<a href="./file#format_error/1">file#format_error/1</a>
is called.</p><h3>inc_wrap_file/1</h3><p>Change to the next wrap log file of a disk log.</p><ul><li>inc_wrap_error_rsn</li></ul><ul><li>invalid_header</li></ul><p>Forces the internally formatted disk log to start logging to the
next log file. It can be used, for example, with
<strong>change_size/2</strong> to reduce the amount of disk space allocated
by the disk log.
</p><p>Owners subscribing to notifications normally
receive a <strong>wrap</strong> message, but if
an error occurs with a reason tag of <strong>invalid_header</strong> or
<strong>file_error</strong>, an <strong>error_status</strong> message is sent.</p><h3>info/1</h3><p>Return information about a disk log.</p><ul><li>dlog_info</li></ul><p>Returns a list of <strong>{Tag, Value}</strong> pairs describing the log.
If a disk log process is running on the current node,
that log is used as source of information, otherwise an individual
distributed log on some other node is chosen, if such a log exists.
</p><p>The following pairs are returned for all logs:
</p><dl><dt><strong>{name, <span class="anno">Log</span>}</strong></dt><dd> <p><strong><span class="anno">Log</span></strong> is the log name
as specified by the <strong>open/1</strong> option <strong>name</strong>.</p> </dd><dt><strong>{file, <span class="anno">File</span>}</strong></dt><dd> <p>For halt logs <strong><span class="anno">File</span></strong> is the
filename, and for wrap logs <strong><span class="anno">File</span></strong> is the base name.</p> </dd><dt><strong>{type, <span class="anno">Type</span>}</strong></dt><dd> <p><strong><span class="anno">Type</span></strong> is the log type
as specified by the <strong>open/1</strong> option <strong>type</strong>.</p> </dd><dt><strong>{format, <span class="anno">Format</span>}</strong></dt><dd> <p><strong><span class="anno">Format</span></strong> is the log format
as specified by the <strong>open/1</strong> option <strong>format</strong>.</p> </dd><dt><strong>{size, <span class="anno">Size</span>}</strong></dt><dd> <p><strong><span class="anno">Size</span></strong> is the log size
as specified by the <strong>open/1</strong> option <strong>size</strong>,
or the size set by <strong>change_size/2</strong>. The value set by 
<strong>change_size/2</strong> is reflected immediately.</p> </dd><dt><strong>{mode, <span class="anno">Mode</span>}</strong></dt><dd> <p><strong><span class="anno">Mode</span></strong> is the log mode
as specified by the <strong>open/1</strong> option <strong>mode</strong>.</p> </dd><dt><strong>{owners, [{pid(), <span class="anno">Notify</span>}]}</strong></dt><dd> <p><strong><span class="anno">Notify</span></strong>
is the value set by the <strong>open/1</strong> option <strong>notify</strong>
or function <strong>change_notify/3</strong> for the owners of
the log.</p> </dd><dt><strong>{users, <span class="anno">Users</span>}</strong></dt><dd> <p><strong><span class="anno">Users</span></strong> is the number
of anonymous users of the log, see the <strong>open/1</strong> option
<a href="#linkto">linkto</a>.</p> </dd><dt><strong>{status, <span class="anno">Status</span>}</strong></dt><dd> <p><strong><span class="anno">Status</span></strong> is <strong>ok</strong>
or <strong>{blocked, <span class="anno">QueueLogRecords</span>}</strong> as set by functions
<strong>block/1,2</strong> and <strong>unblock/1</strong>.</p> </dd><dt><strong>{node, <span class="anno">Node</span>}</strong></dt><dd> <p>The information returned by the
current invocation of function <strong>info/1</strong> is
gathered from the disk log process running on <strong><span class="anno">Node</span></strong>.</p> </dd><dt><strong>{distributed, <span class="anno">Dist</span>}</strong></dt><dd> <p>If the log is local on
the current node, <strong><span class="anno">Dist</span></strong> has the value <strong>local</strong>,
otherwise all nodes where the log is distributed
are returned as a list.</p> </dd></dl><p>The following pairs are returned for all logs opened in 
<strong>read_write</strong> mode:
</p><dl><dt><strong>{head, <span class="anno">Head</span>}</strong></dt><dd> <p>Depending on the value of
the <strong>open/1</strong> options <strong>head</strong> and <strong>head_func</strong>,
or set by function <strong>change_header/2</strong>, the value
of <strong><span class="anno">Head</span></strong> is <strong>none</strong> (default),
<strong>{head, H}</strong> (<strong>head</strong> option), or <strong>{M,F,A}</strong>
(<strong>head_func</strong> option).</p> </dd><dt><strong>{no_written_items, <span class="anno">NoWrittenItems</span>}</strong></dt><dd> <p><strong><span class="anno">NoWrittenItems</span></strong> is the number of items
written to the log since the disk log process was created.</p> </dd></dl><p>The following pair is returned for halt logs opened in 
<strong>read_write</strong> mode:
</p><dl><dt><strong>{full, <span class="anno">Full</span>}</strong></dt><dd> <p><strong><span class="anno">Full</span></strong> is <strong>true</strong> or
<strong>false</strong> depending on whether the halt log is full or not.</p> </dd></dl><p>The following pairs are returned for wrap logs opened in 
<strong>read_write</strong> mode:
</p><dl><dt><strong>{no_current_bytes, integer() &gt;= 0}</strong></dt><dd> <p>The number
of bytes written to the current wrap log file.</p> </dd><dt><strong>{no_current_items, integer() &gt;= 0}</strong></dt><dd> <p>The number
of items written to the current wrap log file, header
inclusive.</p> </dd><dt><strong>{no_items, integer() &gt;= 0}</strong></dt><dd> <p>The total number
of items in all wrap log files.</p> </dd><dt><strong>{current_file, integer()}</strong></dt><dd> <p>The ordinal for
the current wrap log file in the range <strong>1..MaxNoFiles</strong>,
where <strong>MaxNoFiles</strong> is specified by the <strong>open/1</strong> option
<strong>size</strong> or set by <strong>change_size/2</strong>.</p> </dd><dt><strong>{no_overflows, {<span class="anno">SinceLogWasOpened</span>, <span class="anno">SinceLastInfo</span>}}</strong></dt><dd> <p><strong><span class="anno">SinceLogWasOpened</span></strong> (<strong><span class="anno">SinceLastInfo</span></strong>)
is the number of times a wrap log file has been filled up and a
new one is opened or <strong>inc_wrap_file/1</strong> has been called since
the disk log was last opened (<strong>info/1</strong> 
was last called). The first time <strong>info/2</strong> is called 
after a log was (re)opened or truncated, the two values 
are equal.</p> </dd></dl><p>Notice that functions <strong>chunk/2,3</strong>, <strong>bchunk/2,3</strong>, and
<strong>chunk_step/3</strong> do not affect any value
returned by <strong>info/1</strong>.
</p><h3>lclose/1</h3><h3>lclose/2</h3><p>Close a disk log on one node.</p><ul><li>lclose_error_rsn</li></ul><p><strong>lclose/1</strong> closes a local log or an individual distributed
log on the current node.</p><p><strong>lclose/2</strong> closes an individual distributed log on the
specified node if the node is not the current one.</p><p><strong>lclose(<span class="anno">Log</span>)</strong> is equivalent to
<strong>lclose(<span class="anno">Log</span>,Â node())</strong>.
See also <a href="#close_1">close_1</a>.
</p><p>If no log with the specified name exist on the specified node,
<strong>no_such_log</strong> is returned.
</p><h3>log/2</h3><h3>blog/2</h3><p>Log an item onto a disk log.</p><ul><li>Log</li></ul><ul><li>Term</li></ul><ul><li>Bytes</li></ul><ul><li>log_error_rsn</li></ul><p>Synchronously
appends a term to a disk log. Returns <strong>ok</strong> or
<strong>{error, <span class="anno">Reason</span>}</strong> when the term is written to
disk. If the log is distributed, <strong>ok</strong> is returned,
unless all nodes are down. Terms are written by
the ordinary <strong>write()</strong> function of the
operating system. Hence, it is not guaranteed that the term
is written to disk, it can linger in
the operating system kernel for a while. To ensure that the
item is written to disk, function
<a href="#sync/1">sync/1</a>
must be called.
</p><p><strong>log/2</strong> is used for internally formatted logs,
and <strong>blog/2</strong> for externally formatted logs. 
<strong>blog/2</strong> can also be used
for internally formatted logs if the binary is
constructed with a call to
<a href="../erts/erlang#term_to_binary/1">erts/erlang#term_to_binary/1</a>.</p><p>Owners subscribing to notifications are notified
of an error with an <strong>error_status</strong> message if the error 
reason tag is <strong>invalid_header</strong> or <strong>file_error</strong>.
</p><h3>log_terms/2</h3><h3>blog_terms/2</h3><p>Log many items onto a disk log.</p><ul><li>Log</li></ul><ul><li>TermList</li></ul><ul><li>BytesList</li></ul><ul><li>log_error_rsn</li></ul><p>Synchronously appends a list of items to the log. It is more
efficient to use these functions instead of functions <strong>log/2</strong>
and <strong>blog/2</strong>. The specified list is split into as large
sublists as possible (limited by the size of wrap log files),
and each sublist is logged as one single item, which reduces
the overhead.
</p><p><strong>log_terms/2</strong> is used for internally formatted
logs, and <strong>blog_terms/2</strong> for externally formatted logs.
<strong>blog_terms/2</strong> can also be used
for internally formatted logs if the binaries are
constructed with calls to
<a href="../erts/erlang#term_to_binary/1">erts/erlang#term_to_binary/1</a>.</p><p>Owners subscribing to notifications are notified
of an error with an <strong>error_status</strong> message if the error 
reason tag is <strong>invalid_header</strong> or <strong>file_error</strong>.
</p><h3>open/1</h3><p>Open a disk log file.</p><ul><li>dlog_options</li></ul><ul><li>dlog_option</li></ul><ul><li>open_ret</li></ul><ul><li>ret</li></ul><ul><li>dist_open_ret</li></ul><ul><li>dist_error_rsn</li></ul><ul><li>open_error_rsn</li></ul><ul><li>dlog_optattr</li></ul><ul><li>dlog_size</li></ul><p>Parameter <strong><span class="anno">ArgL</span></strong> is a list of the following
options:</p><dl><dt><strong>{name, <span class="anno">Log</span>}</strong></dt><dd> <p>Specifies the log name.
This name must be passed on as a parameter in
all subsequent logging operations. A name must always
be supplied.
</p> </dd><dt><strong>{file, <span class="anno">FileName</span>}</strong></dt><dd> <p>Specifies the name of the
file to be used for logged terms. If this value is
omitted and the log name is an atom or a string,
the filename defaults to <strong>lists:concat([<span class="anno">Log</span>, ".LOG"])</strong>
for halt logs.</p> <p>For wrap logs, this is the base name of the files. Each file in
a wrap log is called <strong>&lt;base_name&gt;.N</strong>, where <strong>N</strong>
is an integer. Each wrap log also has two files called
<strong>&lt;base_name&gt;.idx</strong> and <strong>&lt;base_name&gt;.siz</strong>.
</p> </dd><dt><strong>{linkto, <span class="anno">LinkTo</span>}</strong><a name="linkto"></a></dt><dd> <p>If <strong><span class="anno">LinkTo</span></strong> is a pid, it becomes an owner of the
log. If <strong><span class="anno">LinkTo</span></strong> is <strong>none</strong>, the log records
that it is used anonymously by some process by
incrementing the <strong>users</strong> counter. By default, the
process that calls <strong>open/1</strong> owns the log.
</p> </dd><dt><strong>{repair, <span class="anno">Repair</span>}</strong></dt><dd> <p>If <strong><span class="anno">Repair</span></strong> is <strong>true</strong>,
the current log file is repaired, if needed. As the
restoration is initiated, a message is output on the error log.
If <strong>false</strong> is specified,
no automatic repair is attempted. Instead, the
tuple <strong>{error, {need_repair, <span class="anno">Log</span>}}</strong> is returned if an
attempt is made to open a corrupt log file. 
If <strong>truncate</strong> is specified, the log file becomes
truncated, creating an empty log. Defaults to
<strong>true</strong>, which has no effect on logs opened in 
read-only mode.
</p> </dd><dt><strong>{type, <span class="anno">Type</span>}</strong></dt><dd> <p>The log type. Defaults to <strong>halt</strong>.
</p> </dd><dt><strong>{format, <span class="anno">Format</span>}</strong></dt><dd> <p>Disk log format. Defaults to <strong>internal</strong>.
</p> </dd><dt><strong>{size, <span class="anno">Size</span>}</strong></dt><dd> <p>Log size.</p> <p>When a halt log has reached its maximum size, all attempts to
log more items are rejected. Defaults to
<strong>infinity</strong>, which for halt implies that there is no
maximum size.</p> <p>For wrap logs, parameter <strong><span class="anno">Size</span></strong>
can be a pair
<strong>{<span class="anno">MaxNoBytes</span>, <span class="anno">MaxNoFiles</span>}</strong> or
<strong>infinity</strong>.
In the latter case, if the files of an existing wrap log
with the same name can be found, the size is read
from the existing wrap log, otherwise an error is returned.</p> <p>Wrap logs write at most <strong><span class="anno">MaxNoBytes</span></strong>
bytes on each file and use <strong><span class="anno">MaxNoFiles</span></strong>
files before starting all over with the first wrap log
file. Regardless of <strong><span class="anno">MaxNoBytes</span></strong>,
at least the header (if there is one) and one
item are written on each wrap log file before
wrapping to the next file.</p> <p>When opening an existing wrap log, it is not
necessary to supply a value for option <strong>Size</strong>, but any
supplied value must equal the current log size, otherwise
the tuple <strong>{error, {size_mismatch, <span class="anno">CurrentSize</span>, <span class="anno">NewSize</span>}}</strong> is returned.</p> </dd><dt><strong>{distributed, <span class="anno">Nodes</span>}</strong></dt><dd> <p>This option can be used for
adding members to a distributed disk log.
Defaults to <strong>[]</strong>, which means that
the log is local on the current node.
</p> </dd><dt><strong>{notify, boolean()}</strong><a name="notify"></a></dt><dd> <p>If <strong>true</strong>, the log owners
are notified when certain log events occur.
Defaults to <strong>false</strong>. The owners are sent one of the
following messages when an event occurs:
</p> <dl><dt><strong>{disk_log, Node, Log, {wrap, NoLostItems}}</strong></dt><dd> <p>Sent when a wrap log has
filled up one of its files and a new file is
opened. <strong>NoLostItems</strong> is the number of
previously logged items that were lost when
truncating existing files.
</p> </dd><dt><strong>{disk_log, Node, Log, {truncated, NoLostItems}}</strong></dt><dd> <p>Sent when a log is
truncated or reopened. For halt logs <strong>NoLostItems</strong>
is the number of items written on the log since the 
disk log process was created. For wrap logs 
<strong>NoLostItems</strong> is the number of items on all 
wrap log files.
</p> </dd><dt><strong>{disk_log, Node, Log, {read_only, Items}}</strong></dt><dd> <p>Sent when an asynchronous log attempt is made to
a log file opened in read-only mode. 
<strong>Items</strong> is the items from the log attempt.
</p> </dd><dt><strong>{disk_log, Node, Log, {blocked_log, Items}}</strong></dt><dd> <p>Sent when an asynchronous log attempt is made to
a blocked log that does not queue log attempts.
<strong>Items</strong> is the items from the log attempt.
</p> </dd><dt><strong>{disk_log, Node, Log, {format_external, Items}}</strong></dt><dd> <p>Sent when function <strong>alog/2</strong> or <strong>alog_terms/2</strong> is
used for internally formatted logs. <strong>Items</strong> is the 
items from the log attempt.
</p> </dd><dt><strong>{disk_log, Node, Log, full}</strong></dt><dd> <p>Sent when
an attempt to log items to a wrap log would write more
bytes than the limit set by option <strong>size</strong>.
</p> </dd><dt><strong>{disk_log, Node, Log, {error_status, Status}}</strong></dt><dd> <p>Sent when the error status changes. The error status
is defined by the outcome of the last attempt to log
items to the log, or to truncate the log, or the last
use of function <strong>sync/1</strong>, <strong>inc_wrap_file/1</strong>, or
<strong>change_size/2</strong>. <strong>Status</strong> is either <strong>ok</strong> or
<strong>{error, Error}</strong>, the former is the initial value.
</p> </dd></dl> </dd><dt><strong>{head, <span class="anno">Head</span>}</strong></dt><dd> <p>Specifies a header to be
written first on the log file. If the log is a wrap
log, the item <strong><span class="anno">Head</span></strong> is written first in each new file.
<strong><span class="anno">Head</span></strong> is to be a term if the format is
<strong>internal</strong>, otherwise a sequence of bytes.
Defaults to <strong>none</strong>, which means that
no header is written first on the file.
</p> </dd><dt><strong>{head_func, {M,F,A}}</strong></dt><dd> <p>Specifies a function
to be called each time a new log file is opened.
The call <strong>M:F(A)</strong> is assumed to return <strong>{ok, Head}</strong>.
The item <strong>Head</strong> is written first in each file.
<strong>Head</strong> is to be a term if the format is
<strong>internal</strong>, otherwise a sequence of bytes.
</p> </dd><dt><strong>{mode, <span class="anno">Mode</span>}</strong></dt><dd> <p>Specifies if the log is to be
opened in read-only or read-write mode. Defaults to
<strong>read_write</strong>.
</p> </dd><dt><strong>{quiet, Boolean}</strong></dt><dd> <p>Specifies if messages will be sent to
<strong>error_logger</strong> on recoverable errors with
the log files. Defaults to <strong>false</strong>.</p> </dd></dl><p><strong>open/1</strong> returns <strong>{ok, <span class="anno">Log</span>}</strong> if the
log file is successfully opened. If the file is
successfully repaired, the tuple <strong>{repaired, <span class="anno">Log</span>, {recovered, <span class="anno">Rec</span>}, {badbytes, <span class="anno">Bad</span>}}</strong>
is returned, where <strong><span class="anno">Rec</span></strong> is the number of
whole Erlang terms found in the file and <strong><span class="anno">Bad</span></strong>
is the number of bytes in the file that
are non-Erlang terms. If the parameter <strong>distributed</strong>
is specified, <strong>open/1</strong> returns a list of
successful replies and a list of erroneous replies. Each
reply is tagged with the node name.
</p><p>When a disk log is opened in read-write mode, any existing
log file is checked for. If there is none, a new empty
log is created, otherwise the existing file is opened at the
position after the last logged item, and the logging of items
starts from there. If the format is <strong>internal</strong>
and the existing file is not recognized as an internally
formatted log, a tuple
<strong>{error, {not_a_log_file, <span class="anno">FileName</span>}}</strong>
is returned.
</p><p><strong>open/1</strong> cannot be used for changing the
values of options of an open log. When there are prior
owners or users of a log, all option values except <strong>name</strong>, 
<strong>linkto</strong>, and <strong>notify</strong> are only checked against
the values supplied before as option values
to function <strong>open/1</strong>, <strong>change_header/2</strong>, <strong>change_notify/3</strong>,
or <strong>change_size/2</strong>. Thus,
none of the options except <strong>name</strong> is mandatory. If some
specified value differs from the current value, a tuple
<strong>{error, {arg_mismatch, <span class="anno">OptionName</span>, <span class="anno">CurrentValue</span>, <span class="anno">Value</span>}}</strong>
is returned.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>If an owner attempts to open a log
as owner once again, it is acknowledged with the return value
<strong>{ok, <span class="anno">Log</span>}</strong>, but the state of the disk log is not
affected.</p></div><p>If a log with a specified name is local on some node,
and one tries to open the log distributed on the same node,
the tuple <strong>{error, {node_already_open, <span class="anno">Log</span>}}</strong> is
returned. The same tuple is returned if the log is distributed on
some node, and one tries to open the log locally on the same node.
Opening individual distributed disk logs for the first time
adds those logs to a (possibly empty) distributed disk log.
The supplied option values are used
on all nodes mentioned by option <strong>distributed</strong>.
Individual distributed logs know nothing
about each other's option values, so each node can be
given unique option values by creating a distributed
log with many calls to <strong>open/1</strong>.
</p><p>A log file can be opened more than once by giving
different values to option <strong>name</strong> or by using the
same file when distributing a log on different nodes.
It is up to the user of module <strong>disk_log</strong>
to ensure that not more than one disk log process has write
access to any file, otherwise the file can be corrupted.
</p><p>If an attempt to open a log file for the first time fails, 
the disk log process terminates with the EXIT message 
<strong>{{failed,Reason},[{disk_log,open,1}]}</strong>.
The function returns <strong>{error, Reason}</strong> for all other errors.
</p><h3>pid2name/1</h3><p>Return the name of the disk log handled by a pid.</p><p>Returns the log name
given the pid of a disk log process on the current node, or
<strong>undefined</strong> if the specified pid is not a disk log process.
</p><p>This function is meant to be used for debugging only.
</p><h3>reopen/2</h3><h3>reopen/3</h3><h3>breopen/3</h3><p>Reopen a disk log and save the old log.</p><ul><li>Log</li></ul><ul><li>File</li></ul><ul><li>Head</li></ul><ul><li>BHead</li></ul><ul><li>reopen_error_rsn</li></ul><p>Renames the log file
to <strong><span class="anno">File</span></strong> and then recreates a new log file.
If a wrap log exists, <strong><span class="anno">File</span></strong> is used as the base name
of the renamed files.
By default the header given to <strong>open/1</strong> is written first in
the newly opened log file, but if argument <strong><span class="anno">Head</span></strong> or
<strong><span class="anno">BHead</span></strong> is specified, this item is used instead.
The header argument is used only once. Next time a wrap log file
is opened, the header given to <strong>open/1</strong> is used.
</p><p><strong>reopen/2,3</strong> are used for internally formatted
logs, and <strong>breopen/3</strong> for externally formatted logs.
</p><p>Owners subscribing to notifications receive
a <strong>truncate</strong> message.
</p><p>Upon failure to reopen the log, the disk log process terminates
with the EXIT message <strong>{{failed,Error},[{disk_log,Fun,Arity}]}</strong>.
Other processes having requests queued receive the message
<strong>{disk_log, Node, {error, disk_log_stopped}}</strong>.
</p><h3>sync/1</h3><p>Flush the contents of a disk log to the disk.</p><ul><li>sync_error_rsn</li></ul><p>Ensures that the contents of the log are written to the disk.
This is usually a rather expensive operation.
</p><h3>truncate/1</h3><h3>truncate/2</h3><h3>btruncate/2</h3><p>Truncate a disk log.</p><ul><li>Log</li></ul><ul><li>Head</li></ul><ul><li>BHead</li></ul><ul><li>trunc_error_rsn</li></ul><p>Removes all items from a disk log.
If argument <strong><span class="anno">Head</span></strong> or <strong><span class="anno">BHead</span></strong> is
specified, this item is written first in the newly truncated
log, otherwise the header given to <strong>open/1</strong> is used.
The header argument is used only once. Next time a wrap log file
is opened, the header given to <strong>open/1</strong> is used.
</p><p><strong>truncate/1,2</strong> are used for internally
formatted logs, and <strong>btruncate/2</strong> for externally formatted
logs.
</p><p>Owners subscribing to notifications receive
a <strong>truncate</strong> message.
</p><p>If the attempt to truncate the log fails, the disk log process
terminates with the EXIT message 
<strong>{{failed,Reason},[{disk_log,Fun,Arity}]}</strong>.
Other processes having requests queued receive the message
<strong>{disk_log, Node, {error, disk_log_stopped}}</strong>.
</p><h3>unblock/1</h3><p>Unblock a disk log.</p><ul><li>unblock_error_rsn</li></ul><p>Unblocks a log.
A log can only be unblocked by the blocking process.
</p><h3>See Also</h3><p><a href="file">file</a>,
<a href="pg2">pg2</a>,
<a href="wrap_log_reader">wrap_log_reader</a></p><h2>erl_boot_server</h2><p>Boot server for other Erlang machines.</p><p>This server is used to assist diskless Erlang nodes that fetch
all Erlang code from another machine.This server is used to fetch all code, including the start
script, if an Erlang runtime system is started with
command-line flag <strong>-loader inet</strong>. All hosts specified
with command-line flag <strong>-hosts Host</strong> must have one
instance of this server running.This server can be started with the Kernel configuration
parameter <strong>start_boot_server</strong>.The <strong>erl_boot_server</strong> can read regular files and
files in archives. See <a href="code">code</a>
and
<a href="./erl_prim_loader">erts/erl_prim_loader</a>
in ERTS.</p><h2>Functions</h2><h3>add_slave/1</h3><p>Add a slave to the list of allowed slaves.</p><p>Adds a <strong><span class="anno">Slave</span></strong> node to the list of allowed slave hosts.</p><h3>delete_slave/1</h3><p>Delete a slave from the list of allowed slaves.</p><p>Deletes a <strong><span class="anno">Slave</span></strong> node from the list of allowed slave
hosts.</p><h3>start/1</h3><p>Start the boot server.</p><p>Starts the boot server. <strong><span class="anno">Slaves</span></strong> is a list of
IP addresses for hosts, which are allowed to use this server as a
boot server.</p><h3>start_link/1</h3><p>Start the boot server and link to the the caller.</p><p>Starts the boot server and links to the caller. This function
is used to start the server if it is included in a supervision
tree.</p><h3>which_slaves/0</h3><p>Return the current list of allowed slave hosts.</p><p>Returns the current list of allowed slave hosts.</p><h3>SEE ALSO</h3><p><a href="./init">erts/init</a>,
<a href="./erl_prim_loader">erts/erl_prim_loader</a></p><h2>erl_ddll</h2><p>Dynamic driver loader and linker.</p><p>This module provides an interface for loading
and unloading <em>Erlang linked-in drivers</em> in runtime.The driver is to be provided as a dynamically linked library
in an object code format specific for the platform in use,
that is, <strong>.so</strong> files on most Unix systems and <strong>.ddl</strong>
files on Windows. An Erlang linked-in driver must provide
specific interfaces to the emulator, so this module is not
designed for loading arbitrary dynamic libraries. For more
information about Erlang drivers, see
<a href="./erl_driver">erts/erl_driver</a>
.<a name="users"></a>When describing a set of functions (that is, a module, a part of a
module, or an application), executing in a process and wanting to
use a ddll-driver, we use the term <em>user</em>. A process can
have many users (different modules needing the same
driver) and many processes running the same code, making up
many <em>users</em> of a driver.In the basic scenario, each user loads the driver before
starting to use it and unloads the driver when done.
The reference counting keeps track of
processes and the number of loads by each process. This way
the driver is only unloaded when no one wants it (it has no user).
The driver also keeps track of ports that are
opened to it. This enables delay of unloading until all
ports are closed, or killing of all ports that use the driver when
it is unloaded.<a name="scenarios"></a>The interface supports two basic scenarios of loading and
unloading. Each scenario can also have the option of either
killing ports when the driver is unloading, or waiting for the
ports to close themselves. The scenarios are as follows:<dl><dt><em>Load and Unload on a "When Needed Basis"</em></dt><dd> <p>This (most common) scenario simply supports that each
<a href="#users">user</a> of the driver loads
it when needed and unloads it when no longer needed.
The driver is always reference counted and as long as a
process keeping the driver loaded is still alive, the driver
is present in the system.</p> <p>Each <a href="#users">user</a> of the driver
use <em>literally</em> the same pathname for the driver when
demanding load, but the
<a href="#users">users</a> are not concerned
with if the driver is already loaded from the file system or
if the object code must be loaded from file system.</p> <p>The following two pairs of functions support this scenario:</p> <dl><dt><em>load/2 and unload/1</em></dt><dd> <p>When using the <strong>load/unload</strong> interfaces, the
driver is not unloaded until the
<em>last port</em> using the driver is closed. Function
<strong>unload/1</strong> can return immediately, as the
<a href="#users">users</a>
have no interrest in when the unloading occurs. The
driver is unloaded when no one needs it any longer.</p> <p>If a process having the driver loaded dies, it has
the same effect as if unloading is done.</p> <p>When loading, function <strong>load/2</strong> returns
<strong>ok</strong> when any instance of the driver is
present. Thus, if a driver is waiting to get unloaded
(because of open ports), it simply changes state to no
longer need unloading.</p> </dd><dt><em>load_driver/2 and unload_driver/1</em></dt><dd> <p>These interfaces are intended to be used when it is considered an
error that ports are open to a driver that no
<a href="#users">user</a>
has loaded. The ports that are still open when the
last <a href="#users">user</a> calls
<strong>unload_driver/1</strong> or when the last process having the
driver loaded dies, are killed with reason
<strong>driver_unloaded</strong>.</p> <p>The function names <strong>load_driver</strong> and
<strong>unload_driver</strong> are kept for backward
compatibility.</p> </dd></dl> </dd><dt><em>Loading and Reloading for Code Replacement</em></dt><dd> <p>This scenario can occur if the driver code needs
replacement during operation of the Erlang
emulator. Implementing driver code replacement is a little
more tedious than Beam code replacement, as one driver
cannot be loaded as both "old" and "new" code. All
<a href="#users">users</a> of a driver must have it
closed (no open ports) before the old code can be unloaded
and the new code can be loaded.</p> <p>The unloading/loading is done as one atomic
operation, blocking all processes in the system from using
the driver in question while in progress.</p> <p>The preferred way to do driver code replacement is to let
<em>one single process</em> keep track of the driver. When
the process starts, the driver is loaded. When replacement
is required, the driver is reloaded. Unload is probably never
done, or done when the process exits. If more than one
<a href="#users">user</a> has a driver
loaded when code replacement is demanded, the replacement cannot
occur until the last "other"
<a href="#users">user</a> has
unloaded the driver.</p> <p>Demanding reload when a reload is already in progress is
always an error. Using the high-level functions, it is also
an error to demand reloading when more than one
<a href="#users">user</a> has the driver loaded.</p> <p>To simplify driver replacement, avoid designing your system so
that more than one
<a href="#users">user</a> has the driver loaded.</p> <p>The two functions for reloading drivers are to be used
together with corresponding load functions to support the two
different behaviors concerning open ports:</p> <dl><dt><em>load/2 and reload/2</em></dt><dd> <p>This pair of functions is used when reloading is to be
done after the last open port to the driver is
closed.</p> <p>As <strong>reload/2</strong> waits for the reloading to
occur, a misbehaving process keeping open ports to
the driver (or keeping the driver loaded) can cause
infinite waiting for reload. Time-outs must be provided
outside of the process demanding the reload or by using
the low-level interface
<a href="#try_load/3">try_load/3</a>
in combination with driver monitors.</p> </dd><dt><em>load_driver/2 and reload_driver/2</em></dt><dd> <p>This pair of functions are used when open ports to
the driver are to be killed with reason
<strong>driver_unloaded</strong> to allow for new driver code to
get loaded.</p> <p>However, if another process has the driver loaded,
calling <strong>reload_driver</strong> returns error code
<strong>pending_process</strong>. As stated earlier,
the recommended design is to not allow other
<a href="#users">users</a> than the "driver
reloader" to demand loading of the driver in question.</p> </dd></dl> </dd></dl></p><h2>Data Types</h2><span class="name">driver</span><span class="name">path</span><h2>Functions</h2><h3>demonitor/1</h3><p>Remove a monitor for a driver.</p><p>Removes a driver monitor in much the same way as 
<a href="../erts/erlang#demonitor/1">erts/erlang#demonitor/1</a>
in ERTS
does with process monitors. For details about how to create
driver monitors, see
<a href="#monitor/2">monitor/2</a>,
<a href="#try_load/3">try_load/3</a>, and
<a href="#try_unload/2">try_unload/2</a>.</p><p>The function throws a <strong>badarg</strong> exception if the
parameter is not a <strong>reference()</strong>.</p><h3>format_error/1</h3><p>Format an error descriptor.</p><p>Takes an <strong><span class="anno">ErrorDesc</span></strong> returned by load, unload, or
reload functions and returns a string that
describes the error or warning.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Because of peculiarities in the dynamic loading interfaces on
different platforms, the returned string is only guaranteed
to describe the correct error <em>if format_error/1 is called in the same instance of the Erlang virtual machine as the error appeared in</em> (meaning the same operating
system process).</p></div><h3>info/0</h3><p>Retrieve information about all drivers.</p><p>Returns a list of tuples <strong>{<span class="anno">DriverName</span>, <span class="anno">InfoList</span>}</strong>,
where <strong><span class="anno">InfoList</span></strong> is the result of calling
<a href="#info/1">info/1</a> for that
<strong><span class="anno">DriverName</span></strong>. Only dynamically linked-in drivers are
included in the list.</p><h3>info/1</h3><p>Retrieve information about one driver.</p><p>Returns a list of tuples <strong>{<span class="anno">Tag</span>, <span class="anno">Value</span>}</strong>,
where <strong><span class="anno">Tag</span></strong> is the information item and
<strong><span class="anno">Value</span></strong> is the result of calling
<a href="#info/2">info/2</a> with this driver
name and this tag. The result is a tuple list containing all information
available about a driver.</p><p>The following tags appears in the list:</p><ul><li><strong>processes</strong></li><li><strong>driver_options</strong></li><li><strong>port_count</strong></li><li><strong>linked_in_driver</strong></li><li><strong>permanent</strong></li><li><strong>awaiting_load</strong></li><li><strong>awaiting_unload</strong></li></ul><p>For a detailed description of each value, see
<a href="#info/2">info/2</a>.</p><p>The function throws a <strong>badarg</strong> exception if the driver
is not present in the system.</p><h3>info/2</h3><p>Retrieve specific information about one driver.</p><p>Returns specific information about one aspect of a driver.
Parameter <strong><span class="anno">Tag</span></strong> specifies which aspect
to get information about. The return <strong><span class="anno">Value</span></strong> differs
between different tags:</p><dl><dt><strong>processes</strong></dt><dd> <p>Returns all processes containing
<a href="#users">users</a> of the specific drivers
as a list of tuples <strong>{pid(),integer() &gt;= 0}</strong>, where
<strong>integer()</strong> denotes the number of users in process
<strong>pid()</strong>.</p> </dd><dt><strong>driver_options</strong></dt><dd> <p>Returns a list of the driver options provided when
loading, and any options set by the driver
during initialization. The only valid option
is <strong>kill_ports</strong>.</p> </dd><dt><strong>port_count</strong></dt><dd> <p>Returns the number of ports (an <strong>integer() &gt;= 0</strong>)
using the driver.</p> </dd><dt><strong>linked_in_driver</strong></dt><dd> <p>Returns a <strong>boolean()</strong>, which is <strong>true</strong> if the driver is a
statically linked-in one, otherwise <strong>false</strong>.</p> </dd><dt><strong>permanent</strong></dt><dd> <p>Returns a <strong>boolean()</strong>, which is <strong>true</strong> if the driver has
made itself permanent (and is <em>not</em> a statically
linked-in driver), otherwise <strong>false</strong>.</p> </dd><dt><strong>awaiting_load</strong></dt><dd> <p>Returns a list of all processes having monitors for
<strong>loading</strong> active. Each process is returned as
<strong>{pid(),integer() &gt;= 0}</strong>, where <strong>integer()</strong> is the
number of monitors held by process <strong>pid()</strong>.</p> </dd><dt><strong>awaiting_unload</strong></dt><dd> <p>Returns a list of all processes having monitors for
<strong>unloading</strong> active. Each process is returned as
<strong>{pid(),integer() &gt;= 0}</strong>, where <strong>integer()</strong> is the
number of monitors held by process <strong>pid()</strong>.</p> </dd></dl><p>If option <strong>linked_in_driver</strong> or <strong>permanent</strong>
returns <strong>true</strong>, all other options return
<strong>linked_in_driver</strong> or <strong>permanent</strong>, respectively.</p><p>The function throws a <strong>badarg</strong> exception if the driver
is not present in the system or if the tag is not supported.</p><h3>load/2</h3><p>Load a driver.</p><p>Loads and links the dynamic driver <strong><span class="anno">Name</span></strong>.
<strong><span class="anno">Path</span></strong>
is a file path to the directory containing the driver.
<strong><span class="anno">Name</span></strong> must be a sharable object/dynamic library. Two
drivers with different <strong><span class="anno">Path</span></strong> parameters cannot be
loaded under the same name. <strong><span class="anno">Name</span></strong> is a string or
atom containing at least one character.</p><p>The <strong><span class="anno">Name</span></strong> specified is to correspond to the filename
of the dynamically loadable object file residing in
the directory specified as <strong><span class="anno">Path</span></strong>, but <em>without</em> the
extension (that is, <strong>.so</strong>). The driver name provided in
the driver initialization routine must correspond with the
filename, in much the same way as Erlang module names
correspond to the names of the <strong>.beam</strong> files.</p><p>If the driver was previously unloaded, but is still
present because of open ports to it, a call to
<strong>load/2</strong> stops the unloading and keeps the driver
(as long as <strong><span class="anno">Path</span></strong> is the same), and <strong>ok</strong> is
returned. If you really want the object code to be
reloaded, use <a href="#reload/2">reload/2</a>
or the low-level interface
<a href="#try_load/3">try_load/3</a> instead.
See also the description of
<a href="#scenarios">scenarios</a> for
loading/unloading in the introduction.</p><p>If more than one process tries to load an already loaded
driver with the same <strong><span class="anno">Path</span></strong>, or if the same process
tries to load it many times, the function returns
<strong>ok</strong>. The emulator keeps track of the
<strong>load/2</strong> calls, so that a corresponding number of
<strong>unload/2</strong> calls must be done from the same
process before the driver gets unloaded. It is
therefore safe for an application to load a driver that is
shared between processes or applications when needed. It can
safely be unloaded without causing trouble for other
parts of the system.</p><p>It is not allowed to load multiple drivers with
the same name but with different <strong>Path</strong> parameters.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p><strong><span class="anno">Path</span></strong> is interpreted
literally, so that all loaders of the same driver must
specify the same <em>literal</em> <strong><span class="anno">Path</span></strong> string,
although different paths can point out the same directory
in the file system (because of use of relative paths and
links).</p></div><p>On success, the function returns <strong>ok</strong>. On
failure, the return value is <strong>{error,<span class="anno">ErrorDesc</span>}</strong>,
where <strong><span class="anno">ErrorDesc</span></strong> is an opaque term to be
translated into human readable form by function
<a href="#format_error/1">format_error/1</a>.</p><p>For more control over the error handling, use the
<a href="#try_load/3">try_load/3</a>
interface instead.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>load_driver/2</h3><p>Load a driver.</p><p>Works essentially as <strong>load/2</strong>, but loads the driver
with other options. All ports using the
driver are killed with reason <strong>driver_unloaded</strong>
when the driver is to be unloaded.</p><p>The number of loads and unloads by different
<a href="#users">users</a> influences the loading
and unloading of a driver file. The port killing
therefore only occurs when the <em>last</em>
<a href="#users">user</a> unloads the driver,
or when the last process having loaded the driver exits.</p><p>This interface (or at least the name of the functions) is
kept for backward compatibility.
Using <a href="#try_load/3">try_load/3</a> with
<strong>{driver_options,[kill_ports]}</strong> in the option list
gives the same effect regarding the port killing.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>loaded_drivers/0</h3><p>List loaded drivers.</p><p>Returns a list of all the available drivers, both
(statically) linked-in and dynamically loaded ones.</p><p>The driver names are returned as a list of strings rather
than a list of atoms for historical reasons.</p><p>For more information about drivers, see
<a href="#info/0">info/0</a>.</p><h3>monitor/2</h3><p>Create a monitor for a driver.</p><p>Creates a driver monitor and works in many
ways as
<a href="../erts/erlang#monitor/2">erts/erlang#monitor/2</a>
in ERTS,
does for processes. When a driver changes state, the monitor
results in a monitor message that is sent to the calling
process. <strong><span class="anno">MonitorRef</span></strong> returned by this function is
included in the message sent.</p><p>As with process monitors, each driver monitor set only
generates <em>one single message</em>. The monitor is
"destroyed" after the message is sent, so it is then not
needed to call
<a href="#demonitor/1">demonitor/1</a>.</p><p><strong><span class="anno">MonitorRef</span></strong> can also be used in subsequent calls
to <a href="#demonitor/1">demonitor/1</a> to
remove a monitor.</p><p>The function accepts the following parameters:</p><dl><dt><strong><span class="anno">Tag</span></strong></dt><dd> <p>The monitor tag is always <strong>driver</strong>, as this function
can only be used to create driver monitors. In the future,
driver monitors will be integrated with process monitors,
why this parameter has to be specified for consistence.</p> </dd><dt><strong><span class="anno">Item</span></strong></dt><dd> <p>Parameter <strong><span class="anno">Item</span></strong> specifies
which driver to monitor (the driver name) and
which state change to monitor. The parameter
is a tuple of arity two whose first element is the
driver name and second element is one of the following:</p> <dl><dt><strong>loaded</strong></dt><dd> <p>Notifies when the driver is reloaded (or loaded if
loading is underway). It only makes sense to monitor
drivers that are in the process of being loaded or
reloaded. A future driver name for loading cannot be
monitored. That only results in a
<strong>DOWN</strong> message sent immediately.
Monitoring for loading is therefore most useful when
triggered by function
<a href="#try_load/3">try_load/3</a>,
where the monitor is created <em>because</em> the
driver is in such a pending state.</p> <p>Setting a driver monitor for <strong>loading</strong>
eventually leads to one of the following messages
being sent:</p> <dl><dt><strong>{'UP', reference(), driver, Name, loaded}</strong></dt><dd> <p>This message is sent either immediately if the
driver is already loaded and no reloading is
pending, or when reloading is executed if
reloading is pending. </p> <p>The <a href="#users">user</a> is
expected to know if reloading is demanded before
creating a monitor for loading.</p> </dd><dt><strong>{'UP', reference(), driver, Name, permanent}</strong></dt><dd> <p>This message is sent if reloading was
expected, but the (old) driver made itself
permanent before reloading. It is also
sent if the driver was permanent or statically
linked-in when trying to create the monitor.</p> </dd><dt><strong>{'DOWN', reference(), driver, Name, load_cancelled}</strong></dt><dd> <p>This message arrives if reloading was
underway, but the requesting
<a href="#users">user</a>
cancelled it by dying or calling
<a href="#try_unload/2">try_unload/2</a>
(or <strong>unload/1</strong>/<strong>unload_driver/1</strong>)
again before it was reloaded.</p> </dd><dt><strong>{'DOWN', reference(), driver, Name, {load_failure, Failure}}</strong></dt><dd> <p>This message arrives if reloading was
underway but the loading for some reason
failed. The <strong>Failure</strong> term is one of the
errors that can be returned from
<a href="#try_load/3">try_load/3</a>.
The error term can be passed to
<a href="#format_error/1">format_error/1</a>
for translation into human readable form. Notice
that the translation must be done in the same
running Erlang virtual machine as the error
was detected in.</p> </dd></dl> </dd><dt><strong>unloaded</strong></dt><dd> <p>Monitors when a driver gets unloaded. If one
monitors a driver that is not present in the system,
one immediately gets notified that the driver got
unloaded. There is no guarantee that the driver was
ever loaded.</p> <p>A driver monitor for unload eventually results
in one of the following messages being sent:</p> <dl><dt><strong>{'DOWN', reference(), driver, Name, unloaded}</strong></dt><dd> <p>The monitored driver instance is now
unloaded. As the unload can be a result of a
<strong>reload/2</strong> request, the driver can once
again have been loaded when this message
arrives.</p> </dd><dt><strong>{'UP', reference(), driver, Name, unload_cancelled}</strong></dt><dd> <p>This message is sent if unloading was
expected, but while the driver was waiting for
all ports to get closed, a new
<a href="#users">user</a> of the driver
appeared, and the unloading was cancelled.</p> <p>This message appears if <strong>{ok, pending_driver}</strong>
was returned from
<a href="#try_unload/2">try_unload/2</a>
for the last <a href="#users">user</a>
of the driver, and then <strong>{ok, already_loaded}</strong> is returned
from a call to
<a href="#try_load/3">try_load/3</a>.</p> <p>If one <em>really</em> wants to monitor when the
driver gets unloaded, this message distorts
the picture, because no unloading was done.
Option <strong>unloaded_only</strong> creates a monitor
similar to an <strong>unloaded</strong> monitor, but
never results in this message.</p> </dd><dt><strong>{'UP', reference(), driver, Name, permanent}</strong></dt><dd> <p>This message is sent if unloading was
expected, but the driver made itself
permanent before unloading. It is also
sent if trying to monitor a permanent or
statically linked-in driver.</p> </dd></dl> </dd><dt><strong>unloaded_only</strong></dt><dd> <p>A monitor created as <strong>unloaded_only</strong> behaves
exactly as one created as <strong>unloaded</strong>
except that the
<strong>{'UP', reference(), driver, Name, unload_cancelled}</strong>
message is never sent, but the monitor instead persists until
the driver <em>really</em> gets unloaded.</p> </dd></dl> </dd></dl><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>reload/2</h3><p>Replace a driver.</p><p>Reloads the driver named <strong><span class="anno">Name</span></strong> from a possibly
different <strong><span class="anno">Path</span></strong> than previously used. This
function is used in the code change
<a href="#scenarios">scenarios</a> described in the
introduction.</p><p>If there are other <a href="#users">users</a>
of this driver, the function returns <strong>{error, pending_process}</strong>,
but if there are no other users, the function call hangs until all
open ports are closed.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Avoid mixing multiple
<a href="#users">users</a>
with driver reload requests.</p></div><p>To avoid hanging on open ports, use function
<a href="#try_load/3">try_load/3</a>
instead.</p><p>The <strong><span class="anno">Name</span></strong> and <strong><span class="anno">Path</span></strong> parameters
have exactly the same meaning as when calling the plain function
<a href="#load/2">load/2</a>.</p><p>On success, the function returns <strong>ok</strong>. On
failure, the function returns an opaque error,
except the <strong>pending_process</strong> error described
earlier. The opaque errors are to be translated into human
readable form by function
<a href="#format_error/1">format_error/1</a>.</p><p>For more control over the error handling,  use the
<a href="#try_load/3">try_load/3</a>
interface instead.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>reload_driver/2</h3><p>Replace a driver.</p><p>Works exactly as <a href="#reload/2">reload/2</a>,
but for drivers loaded with the
<a href="#load_driver/2">load_driver/2</a> interface.</p><p>As this interface implies that ports are killed when
the last user disappears, the function does not hang waiting for
ports to get closed.</p><p>For more details, see
<a href="#scenarios">scenarios</a> in this module
description and the function description for
<a href="#reload/2">reload/2</a>.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>try_load/3</h3><p>Load a driver.</p><p>Provides more control than the
<strong>load/2</strong>/<strong>reload/2</strong> and
<strong>load_driver/2</strong>/<strong>reload_driver/2</strong> interfaces. It
never waits for completion of other operations related
to the driver, but immediately returns the status of the
driver as one of the following:</p><dl><dt><strong>{ok, loaded}</strong></dt><dd> <p>The driver was loaded and is immediately usable.</p> </dd><dt><strong>{ok, already_loaded}</strong></dt><dd> <p>The driver was already loaded by another process
or is in use by a living port, or both. The load by you is
registered and a corresponding <strong>try_unload</strong> is
expected sometime in the future.</p> </dd><dt><strong>{ok, pending_driver}</strong>or <strong>{ok, pending_driver, reference()}</strong></dt><dd> <p>The load request is registered, but the loading is
delayed because an earlier instance of the
driver is still waiting to get unloaded (open
ports use it). Still, unload is expected when you are
done with the driver. This return value
<em>mostly</em> occurs when options
<strong>{reload,pending_driver}</strong> or
<strong>{reload,pending}</strong> are used, but
<em>can</em> occur when another
<a href="#users">user</a> is unloading a
driver in parallel and driver option <strong>kill_ports</strong> is set.
In other words, this return value always needs
to be handled.</p> </dd><dt><strong>{ok, pending_process}</strong>or <strong>{ok, pending_process, reference()}</strong></dt><dd> <p>The load request is registered, but the loading is
delayed because an earlier instance of the
driver is still waiting to get unloaded by another
<a href="#users">user</a> (not only by a
port, in which case <strong>{ok,pending_driver}</strong> would
have been returned). Still, unload is expected when you
are done with the driver. This return value
<em>only</em> occurs when option <strong>{reload,pending}</strong>
is used.</p> </dd></dl><p>When the function returns <strong>{ok, pending_driver}</strong> or
<strong>{ok, pending_process}</strong>, one can get information
about when the driver is <em>actually</em> loaded  by using
option <strong>{monitor, <span class="anno">MonitorOption</span>}</strong>.</p><p>When monitoring is requested, and a corresponding
<strong>{ok, pending_driver}</strong> or <strong>{ok, pending_process}</strong> would
be returned, the function instead returns a tuple
<strong>{ok, <span class="anno">PendingStatus</span>, reference()}</strong>
and the process then gets a monitor message later, when the
driver gets loaded. The monitor message to expect is described in
the function description of
<a href="#monitor/2">monitor/2</a>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>In case of loading, monitoring can <em>not</em> only get
triggered by using option <strong>{reload, <span class="anno">ReloadOption</span>}</strong>,
but also in special cases where the load error is transient. Thus,
<strong>{monitor, pending_driver}</strong> is to be used under basically
<em>all</em> real world circumstances.</p></div><p>The function accepts the following parameters:</p><dl><dt><strong><span class="anno">Path</span></strong></dt><dd> <p>The file system path to the directory where the driver
object file is located. The filename of the object file
(minus extension) must correspond to the driver name
(used in parameter <strong><span class="anno">Name</span></strong>) and the driver must
identify itself with the same name.
<strong><span class="anno">Path</span></strong> can be provided as an <em>iolist()</em>,
meaning it can be a list of other <strong>iolist()</strong>s, characters
(8-bit integers), or binaries, all to be flattened
into a sequence of characters.</p> <p>The (possibly flattened) <strong><span class="anno">Path</span></strong> parameter must be
consistent throughout the system. A driver is to, by
all <a href="#users">users</a>, be loaded
using the same <em>literal</em> <strong><span class="anno">Path</span></strong>.
The exception is when <em>reloading</em> is requested,
in which case <strong><span class="anno">Path</span></strong> can be specified
differently. Notice that all
<a href="#users">users</a> trying to load the
driver later need to use the
<em>new</em> <strong><span class="anno">Path</span></strong> if <strong><span class="anno">Path</span></strong>
is changed using a <strong>reload</strong> option. This is yet another reason
to have <em>only one loader</em> of a driver one wants to
upgrade in a running system.</p> </dd><dt><strong><span class="anno">Name</span></strong></dt><dd> <p>This parameter is the name of the driver
to be used in subsequent calls to function
<a href="../erts/erlang#open_port/2">erts/erlang#open_port/2</a>
in ERTS.
The name can be specified as an <strong>iolist()</strong> or
an <strong>atom()</strong>. The name specified when loading is used
to find the object file (with the help of <strong><span class="anno">Path</span></strong>
and the system-implied extension suffix, that is, <strong>.so</strong>).
The name by which the driver identifies itself must also be consistent
with this <strong><span class="anno">Name</span></strong> parameter, much as
the module name of a Beam file much corresponds to its filename.</p> </dd><dt><strong><span class="anno">OptionList</span></strong></dt><dd> <p>Some options can be specified to control the
loading operation. The options are specified as a list of
two-tuples. The tuples have the following values and
meanings:</p> <dl><dt><strong>{driver_options, <span class="anno">DriverOptionList</span>}</strong></dt><dd> <p>This is to provide options that changes
its general behavior and "sticks" to the driver
throughout its lifespan.</p> <p>The driver options for a specified driver name need
always to be consistent, <em>even when the driver is reloaded</em>,
meaning that they are as much a part of the driver as the name.</p> <p>The only allowed driver option is
<strong>kill_ports</strong>, which means that all ports opened
to the driver are killed with exit reason
<strong>driver_unloaded</strong> when no process any longer
has the driver loaded. This situation arises either
when the last <a href="#users">user</a> calls
<a href="#try_unload/2">try_unload/2</a>, or
when the last process having loaded the driver exits.</p> </dd><dt><strong>{monitor, <span class="anno">MonitorOption</span>}</strong></dt><dd> <p>A <strong><span class="anno">MonitorOption</span></strong> tells <strong>try_load/3</strong> to
trigger a driver monitor under certain
conditions. When the monitor is triggered, the
function returns a three-tuple
<strong>{ok, <span class="anno">PendingStatus</span>, reference()}</strong>, where
<strong>reference()</strong> is the monitor reference for the driver monitor.</p> <p>Only one <strong><span class="anno">MonitorOption</span></strong> can be specified.
It is one of the following:</p> <ul><li> <p>The atom <strong>pending</strong>, which means
that a monitor is to be created whenever a load
operation is delayed,</p> </li><li> <p>The atom <strong>pending_driver</strong>, in which a monitor
is created whenever the operation is delayed because
of open ports to an otherwise unused driver.</p> </li></ul> <p>Option <strong>pending_driver</strong> is of little use, but
is present for completeness, as it is well defined which
reload options that can give rise to which delays.
However, it can be a good idea to use the same
<strong><span class="anno">MonitorOption</span></strong> as the
<strong><span class="anno">ReloadOption</span></strong>, if present.</p> <p>If reloading is not requested, it can still be
useful to specify option <strong>monitor</strong>, as
forced unloads (driver option <strong>kill_ports</strong> or
option <strong>kill_ports</strong> to
<a href="#try_unload/2">try_unload/2</a>)
trigger a transient state where driver loading
cannot be performed until all closing ports are
closed. Thus, as <strong>try_unload</strong> can, in
almost all situations, return <strong>{ok, pending_driver}</strong>,
always specify at least <strong>{monitor, pending_driver}</strong>
in production code (see the monitor discussion earlier).</p> </dd><dt><strong>{reload, <span class="anno">ReloadOption</span>}</strong></dt><dd> <p>This option is used to
<em>reload</em> a driver from disk, most often in a
code upgrade scenario. Having a <strong>reload</strong> option
also implies that parameter <strong><span class="anno">Path</span></strong> does
<em>not</em> need to be consistent with earlier loads of
the driver.</p> <p>To reload a driver, the process must have loaded the driver
before, that is, there must be an active
<a href="#users">user</a> of the driver
in the process.</p> <p>The <strong>reload</strong> option can be either of the following:</p> <dl><dt><strong>pending</strong></dt><dd> <p>With the atom <strong>pending</strong>, reloading is requested
for any driver and is effectuated when <em>all</em>
ports opened to the driver are closed. The driver
replacement in this case takes
place regardless if there are still
pending <a href="#users">users</a>
having the driver loaded.</p> <p>The option also triggers port-killing (if driver
option <strong>kill_ports</strong> is used) although
there are pending users, making it usable for forced
driver replacement, but laying much
responsibility on the driver
<a href="#users">users</a>.
The pending option is seldom used as one does not want other
<a href="#users">users</a> to have loaded
the driver when code change is underway.</p></dd><dt><strong>pending_driver</strong></dt><dd> <p>This option is more useful. Here, reloading is queued
if the driver is <em>not</em> loaded by any other
<a href="#users">users</a>, but the
driver has opened ports, in which case
<strong>{ok, pending_driver}</strong> is returned
(a <strong>monitor</strong> option is recommended).</p></dd></dl> <p>If the driver is unloaded (not present in the system),
error code <strong>not_loaded</strong> is returned. Option
<strong>reload</strong> is intended for when the user
has already loaded the driver in advance.</p> </dd></dl> </dd></dl><p>The function can return numerous errors, some
can only be returned given a certain combination of options.</p><p>Some errors are opaque and can only be interpreted by
passing them to function
<a href="#format_error/1">format_error/1</a>,
but some can be interpreted directly:</p><dl><dt><strong>{error,linked_in_driver}</strong></dt><dd> <p>The driver with the specified name is an Erlang
statically linked-in driver, which cannot be manipulated
with this API.</p> </dd><dt><strong>{error,inconsistent}</strong></dt><dd> <p>The driver is already loaded with other
<strong><span class="anno">DriverOptionList</span></strong> or a different
<em>literal</em> <strong>Path</strong> argument.</p> <p>This can occur even if a <strong>reload</strong> option is specified,
if <strong>DriverOptionList</strong> differs from the current.</p> </dd><dt><strong>{error, permanent}</strong></dt><dd> <p>The driver has requested itself to be permanent, making
it behave like an Erlang linked-in driver and can no
longer be manipulated with this API.</p> </dd><dt><strong>{error, pending_process}</strong></dt><dd> <p>The driver is loaded by other
<a href="#users">users</a> when
option <strong>{reload, pending_driver}</strong> was specified.</p> </dd><dt><strong>{error, pending_reload}</strong></dt><dd> <p>Driver reload is already requested by another
<a href="#users">user</a> when option
<strong>{reload, <span class="anno">ReloadOption</span>}</strong> was specified.</p> </dd><dt><strong>{error, not_loaded_by_this_process}</strong></dt><dd> <p>Appears when option <strong>reload</strong> is specified. The
driver <strong><span class="anno">Name</span></strong> is present in the system, but there
is no <a href="#users">user</a> of it in this
process.</p> </dd><dt><strong>{error, not_loaded}</strong></dt><dd> <p>Appears when option <strong>reload</strong> is specified. The
driver <strong><span class="anno">Name</span></strong> is not in the system. Only drivers
loaded by this process can be reloaded.</p> </dd></dl><p>All other error codes are to be translated by function
<a href="#format_error/1">format_error/1</a>.
Notice that calls to <strong>format_error</strong> are to be
performed from the same running instance of the Erlang
virtual machine as the error is detected in, because of
system-dependent behavior concerning error values.</p><p>If the arguments or options are malformed, the function
throws a <strong>badarg</strong> exception.</p><h3>try_unload/2</h3><p>Unload a driver.</p><p>This is the low-level function to unload (or decrement
reference counts of) a driver. It can be used to force port
killing, in much the same way as the driver option
<strong>kill_ports</strong> implicitly does. Also, it can trigger a
monitor either because other
<a href="#users">users</a> still have the driver
loaded or because open ports use the driver.</p><p>Unloading can be described as the process of telling the
emulator that this particular part of the code in this
particular process (that is, this
<a href="#users">user</a>) no longer needs
the driver. That can, if there are no other users, trigger
unloading of the driver, in which case the driver name
disappears from the system and (if possible) the memory
occupied by the driver executable code is reclaimed.</p><p>If the driver has option <strong>kill_ports</strong> set, or if
<strong>kill_ports</strong> is specified as an option to this
function, all pending ports using this driver are
killed when unloading is done by the last
<a href="#users">user</a>. If no port-killing
is involved and there are open ports, the unloading
is delayed until no more open ports use the
driver. If, in this case, another
<a href="#users">user</a> (or even this user)
loads the driver again before the driver is unloaded, the
unloading never takes place.</p><p>To allow the <a href="#users">user</a> to
<em>request unloading</em> to wait for <em>actual unloading</em>,
<strong>monitor</strong> triggers can be specified in much the same way as
when loading. However, as <a href="#users">users</a>
of this function seldom are interested in more than decrementing the
reference counts, monitoring is seldom needed.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p> If option <strong>kill_ports</strong> is used, monitor trigging is crucial,
as the ports are not guaranteed to be killed until the driver is unloaded.
Thus, a monitor must be triggered for at least the <strong>pending_driver</strong>
case.</p></div><p>The possible monitor messages to expect are the
same as when using option <strong>unloaded</strong> to function
<a href="#monitor/2">monitor/2</a>.</p><p>The function returns one of the following statuses upon
success:</p><dl><dt><strong>{ok, unloaded}</strong></dt><dd> <p>The driver was immediately unloaded, meaning that the
driver name is now free to use by other drivers and, if
the underlying OS permits it, the memory occupied by the
driver object code is now reclaimed.</p> <p>The driver can only be unloaded when there are no open
ports using it and no more
<a href="#users">users</a> require it to be
loaded.</p> </dd><dt><strong>{ok, pending_driver}</strong>or <strong>{ok, pending_driver, reference()}</strong></dt><dd> <p>Indicates that this call removed the last
<a href="#users">user</a> from the
driver, but there are still open ports using it.
When all ports are closed and no new
<a href="#users">users</a> have arrived,
the driver is reloaded and the name and memory
reclaimed.</p> <p>This return value is valid even if option <strong>kill_ports</strong>
was used, as killing ports can be a process that does not
complete immediately. However, the condition is in that case
transient. Monitors are always useful to detect when the driver
is really unloaded.</p> </dd><dt><strong>{ok, pending_process}</strong>or <strong>{ok, pending_process, reference()}</strong></dt><dd> <p>The unload request is registered, but
other <a href="#users">users</a> still hold
the driver. Notice that the term <strong>pending_process</strong>
can refer to the running process; there can be more
than one <a href="#users">user</a> in the
same process.</p> <p>This is a normal, healthy, return value if the call was
just placed to inform the emulator that you have no
further use of the driver. It is the most
common return value in the most common
<a href="#scenarios">scenarios</a>
described in the introduction.</p> </dd></dl><p>The function accepts the following parameters:</p><dl><dt><strong><span class="anno">Name</span></strong></dt><dd> <p><strong><span class="anno">Name</span></strong> is the name of the
driver to be unloaded. The name can be specified as an
<strong>iolist()</strong> or as an <strong>atom()</strong>.</p> </dd><dt><strong><span class="anno">OptionList</span></strong></dt><dd> <p>Argument <strong><span class="anno">OptionList</span></strong> can be used to specify
certain behavior regarding ports and triggering
monitors under certain conditions:</p> <dl><dt><strong>kill_ports</strong></dt><dd> <p>Forces killing of all ports opened using this driver,
with exit reason <strong>driver_unloaded</strong>, if you are
the <em>last</em> <a href="#users">user</a>
of the driver.</p> <p>If other <a href="#users">users</a>
have the driver loaded, this option has no effect.</p> <p>To get the consistent behavior of killing ports
when the last <a href="#users">user</a>
unloads, use driver option
<strong>kill_ports</strong> when loading the driver instead.</p> </dd><dt><strong>{monitor, <span class="anno">MonitorOption</span>}</strong></dt><dd> <p>Creates a driver monitor if the condition
specified in <strong><span class="anno">MonitorOption</span></strong> is true. The valid
options are:</p> <dl><dt><strong>pending_driver</strong></dt><dd> <p>Creates a driver monitor if the return value is to
be <strong>{ok, pending_driver}</strong>.</p> </dd><dt><strong>pending</strong></dt><dd> <p>Creates a monitor if the return value is
<strong>{ok, pending_driver}</strong> or <strong>{ok, pending_process}</strong>.</p> </dd></dl> <p>The <strong>pending_driver</strong> <strong><span class="anno">MonitorOption</span></strong> is
by far the most useful. It must be used to ensure that the
driver really is unloaded and the ports closed
whenever option <strong>kill_ports</strong> is used, or the
driver can have been loaded with driver option
<strong>kill_ports</strong>.</p> <p>Using the monitor triggers in the call to
<strong>try_unload</strong> ensures that the monitor is
added before the unloading is executed, meaning
that the monitor is always properly triggered,
which is not the case if <strong>monitor/2</strong> is called
separately.</p> </dd></dl> </dd></dl><p>The function can return the following error conditions,
all well specified (no opaque values):</p><dl><dt><strong>{error, linked_in_driver}</strong></dt><dd> <p>You were trying to unload an Erlang statically linked-in
driver, which cannot be manipulated with this interface
(and cannot be unloaded at all).</p> </dd><dt><strong>{error, not_loaded}</strong></dt><dd> <p>The driver <strong><span class="anno">Name</span></strong> is not present in the system.</p> </dd><dt><strong>{error, not_loaded_by_this_process}</strong></dt><dd> <p>The driver <strong><span class="anno">Name</span></strong> is present in the system, but
there is no <a href="#users">user</a> of
it in this process. </p> <p>As a special case, drivers can be unloaded from
processes that have done no corresponding call to
<strong>try_load/3</strong> if, and only if, there are
<em>no users of the driver at all</em>, which can occur if the
process containing the last user dies.</p> </dd><dt><strong>{error, permanent}</strong></dt><dd> <p>The driver has made itself permanent, in which case it
can no longer be manipulated by this interface (much
like a statically linked-in driver).</p> </dd></dl><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>unload/1</h3><p>Unload a driver.</p><p>Unloads, or at least dereferences the driver named
<strong><span class="anno">Name</span></strong>. If the caller is the last
<a href="#users">user</a> of the driver,
and no more open ports use the driver, the driver
gets unloaded. Otherwise, unloading
is delayed until all ports are closed and no
<a href="#users">users</a> remain.</p><p>If there are other <a href="#users">users</a>
of the driver, the reference counts of the driver is merely decreased,
so that the caller is no longer considered a
<a href="#users">user</a> of the driver. For use
scenarios, see the <a href="#scenarios">scenarios</a>
in the beginning of this module.</p><p>The <strong><span class="anno">ErrorDesc</span></strong> returned is an opaque value to be
passed further on to function
<a href="#format_error/1">format_error/1</a>.
For more control over the operation, use the
<a href="#try_unload/2">try_unload/2</a>
interface.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>unload_driver/1</h3><p>Unload a driver.</p><p>Unloads, or at least dereferences the driver named
<strong><span class="anno">Name</span></strong>. If the caller is the last
<a href="#users">user</a> of the driver, all
remaining open ports using the driver are killed with
reason <strong>driver_unloaded</strong> and the driver
eventually gets unloaded.</p><p>If there are other <a href="#users">users</a>
of the driver, the reference counts of the driver is merely
decreased, so that the caller is no longer considered a
<a href="#users">user</a>. For
use scenarios, see the
<a href="#scenarios">scenarios</a> in the
beginning of this module.</p><p>The <strong><span class="anno">ErrorDesc</span></strong> returned is an opaque value to be
passed further on to function
<a href="#format_error/1">format_error/1</a>.
For more control over the operation, use the
<a href="#try_unload/2">try_unload/2</a>
interface.</p><p>The function throws a <strong>badarg</strong> exception if the
parameters are not specified as described here.</p><h3>See Also</h3><p><a href="./erl_driver">erts/erl_driver</a>,
<a href="./driver_entry">erts/driver_entry</a></p><h2>erl_epmd</h2><p>
    Erlang interface towards epmd
</p><p>This module communicates with the EPMD daemon, see <a href="./epmd">epmd</a>. To implement your own epmd module please
see <a href="./alt_disco">ERTS User's Guide: How to Implement an Alternative Service Discovery for Erlang Distribution</a></p><h2>Functions</h2><h3>start_link/0</h3><p>Callback for erl_distribution supervisor.</p><p>This function is invoked as this module is added as a child of the
<strong>erl_distribution</strong> supervisor.</p><h3>register_node/2</h3><h3>register_node/3</h3><p>Registers the node with <strong>epmd</strong>.</p><p>Registers the node with <strong>epmd</strong> and tells epmd what port will be
used for the current node. It returns a creation number. This number is
incremented on each register to help with identifying if a node is
reconnecting to epmd.</p><h3>port_please/2</h3><h3>port_please/3</h3><p>Returns the port number for a given node.</p><p>Requests the distribution port for the given node of an EPMD
instance. Together with the port it returns a distribution protocol
version which has been 5 since Erlang/OTP R6.</p><h3>address_please/3</h3><p>Returns address and port.</p><p>Called by the distribution module. Resolves the <strong>Host</strong> to an IP
address.</p><p>Another epmd module may return port and distribution protocol version
as well.</p><h3>names/1</h3><p>Names of Erlang nodes at a host.</p><p>Called by <a href="net_adm">net_adm</a>.
<strong>Host</strong> defaults to the localhost. Returns the names and associated
port numbers of the Erlang nodes that <strong>epmd</strong> registered at the
specified host. Returns <strong>{error, address}</strong> if <strong>epmd</strong> is not
operational.</p><p><em>Example:</em></p><pre>
(arne@dunn)1&gt; <span class="input">erl_epmd:names(localhost).</span>
{ok,[{"arne",40262}]}</pre><h2>erl_prim_loader</h2><p>Low Level Erlang Loader</p><p>
The module erl_prim_loader is moved to the runtime system
application.  Please see <a href="./erl_prim_loader">erl_prim_loader(3)</a> in the
ERTS reference manual instead.
</p><h2>erlang</h2><p>The Erlang BIFs</p><p>
The module erlang is moved to the runtime system
application.  Please see <a href="./erlang">erlang(3)</a> in the
ERTS reference manual instead.
</p><h2>error_handler</h2><p>Default system error handler.</p><p>This module defines what happens when certain types
of errors occur.</p><h2>Functions</h2><h3>raise_undef_exception/3</h3><p>Raise an undef exception.</p><dl><dt>Args</dt><dd> A (possibly empty) list of arguments <strong>Arg1,..,ArgN</strong> </dd></dl><p>Raises an <strong>undef</strong> exception with a stacktrace, indicating
that <strong><span class="anno">Module</span>:<span class="anno">Function</span>/N</strong> is
undefined.
</p><h3>undefined_function/3</h3><p>Called when an undefined function is encountered.</p><dl><dt>Args</dt><dd> A (possibly empty) list of arguments <strong>Arg1,..,ArgN</strong> </dd></dl><p>This function is called by the runtime system if a call is made to
<strong><span class="anno">Module</span>:<span class="anno">Function</span>(Arg1,.., ArgN)</strong> and
<strong><span class="anno">Module</span>:<span class="anno">Function</span>/N</strong> is undefined.
Notice that this function is evaluated inside the process
making the original call.</p><p>This function first attempts to autoload
<strong><span class="anno">Module</span></strong>. If that is not possible,
an <strong>undef</strong> exception is raised.</p><p>If it is possible to load <strong><span class="anno">Module</span></strong>
and function <strong><span class="anno">Function</span>/N</strong> is exported,
it is called.</p><p>Otherwise, if function <strong>'$handle_undefined_function'/2</strong>
is exported, it is called as
<strong>'$handle_undefined_function'(</strong><span class="anno">Function</span>,
<span class="anno">Args</span>).
</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Defining <strong>'$handle_undefined_function'/2</strong> in
ordinary application code is highly discouraged. It is very
easy to make subtle errors that can take a long time to
debug. Furthermore, none of the tools for static code
analysis (such as Dialyzer and Xref) supports the use of
<strong>'$handle_undefined_function'/2</strong> and no such support
will be added. Only use this function after having carefully
considered other, less dangerous, solutions. One example of
potential legitimate use is creating stubs for other
sub-systems during testing and debugging.
</p></div><p>Otherwise an <strong>undef</strong> exception is raised.</p><h3>undefined_lambda/3</h3><p>Called when an undefined lambda (fun) is encountered.</p><dl><dt>Args</dt><dd> A (possibly empty) list of arguments <strong>Arg1,..,ArgN</strong> </dd></dl><p>This function is evaluated if a call is made to
<strong><span class="anno">Fun</span>(Arg1,.., ArgN)</strong> when the module defining
the fun is not loaded. The function is evaluated inside the process
making the original call.</p><p>If <strong><span class="anno">Module</span></strong> is interpreted, the interpreter is invoked
and the return value of the interpreted
<strong><span class="anno">Fun</span>(Arg1,.., ArgN)</strong> call is returned.</p><p>Otherwise, it returns, if possible, the value of
<strong>apply(<span class="anno">Fun</span>, <span class="anno">Args</span>)</strong> after an attempt
is made to autoload <strong><span class="anno">Module</span></strong>. If this is not possible,
the call fails with exit reason <strong>undef</strong>.</p><h3>Notes</h3><p>The code in <strong>error_handler</strong> is complex. Do not
change it without fully understanding the interaction between
the error handler, the <strong>init</strong> process of the code server,
and the I/O mechanism of the code.</p><p>Code changes that seem small can cause a deadlock,
as unforeseen consequences can occur. The use of <strong>input</strong> is
dangerous in this type of code.</p><h2>error_logger</h2><p>Erlang error logger.</p><p>The Erlang <em>error logger</em> is an event manager (see
<a href="./des_princ">OTP Design Principles</a> and
<a href="./gen_event">stdlib/gen_event</a>),
registered as <strong>error_logger</strong>.Error logger is no longer started by default, but is
automatically started when an event handler is added
with <a href="#add_report_handler/1">add_report_handler/1</a>. The <strong>error_logger</strong>
module is then also added as a handler to the new logger,
causing log events to be forwarded from logger to error logger,
and consequently to all installed error logger event
handlers.User-defined event handlers can be added to handle application-specific
events.Existing event handlers provided by STDLIB and SASL are still
available, but are no longer used by OTP.Warning events were introduced in Erlang/OTP R9C and are enabled
by default as from Erlang/OTP 18.0. To retain backwards compatibility
with existing user-defined event handlers, the warning events can be
tagged as <strong>errors</strong> or <strong>info</strong> using command-line flag
<strong>+W &lt;e | i | w&gt;</strong>, thus showing up as
<strong>ERROR REPORT</strong> or <strong>INFO REPORT</strong> in the logs.</p><h2>Data Types</h2><span class="name">report</span><h2>Functions</h2><h3>add_report_handler/1</h3><h3>add_report_handler/2</h3><p>Add an event handler to the error logger.</p><p>Adds a new event handler to the error logger. The event
handler must be implemented as a <strong>gen_event</strong> callback
module, see
<a href="./gen_event">stdlib/gen_event</a>.</p><p><strong><span class="anno">Handler</span></strong> is typically the name of the callback module
and <strong><span class="anno">Args</span></strong> is an optional term (defaults to []) passed
to the initialization callback function <strong><span class="anno">Handler</span>:init/1</strong>.
The function returns <strong>ok</strong> if successful.</p><p>The event handler must be able to handle the events in this module, see
section <a href="#events">Events</a>.</p><p>The first time this function is called,
<strong>error_logger</strong> is added as a Logger handler, and
the <strong>error_logger</strong> process is started.</p><h3>delete_report_handler/1</h3><p>Delete an event handler from the error logger.</p><p>Deletes an event handler from the error logger by calling
<strong>gen_event:delete_handler(error_logger, <span class="anno">Handler</span>, [])</strong>,
see <a href="./gen_event">stdlib/gen_event</a>.</p><p>If no more event handlers exist after the deletion,
<strong>error_logger</strong> is removed as a Logger handler, and
the <strong>error_logger</strong> process is stopped.</p><h3>error_msg/1</h3><h3>error_msg/2</h3><h3>format/2</h3><p>Log a standard error event.</p><p>Log a standard error event. The <strong><span class="anno">Format</span></strong>
and <strong><span class="anno">Data</span></strong> arguments are the same as the
arguments of
<a href="../stdlib/io#format/2">stdlib/io#format/2</a>
in STDLIB.</p><p>Error logger forwards the event to Logger, including
metadata that allows backwards compatibility with legacy
error logger event handlers.</p><p>The event is handled by the default Logger handler.</p><p>These functions are kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#error-1">logger#error-1</a>
instead.</p><p><em>Example:</em></p><pre>
1&gt; <span class="input">error_logger:error_msg("An error occurred in ~p", [a_module]).</span>
=ERROR REPORT==== 22-May-2018::11:18:43.376917 ===
An error occurred in a_module
ok</pre><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>If the Unicode translation modifier (<strong>t</strong>) is used in
the format string, all event handlers must ensure that the
formatted output is correctly encoded for the I/O
device.</p></div><h3>error_report/1</h3><p>Log a standard error event.</p><p>Log a standard error event. Error logger forwards the event
to Logger, including metadata that allows backwards
compatibility with legacy error logger event handlers.</p><p>The event is handled by the default Logger handler.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#error-1">logger#error-1</a>
instead.</p><p><em>Example:</em></p><pre>
2&gt; <span class="input">error_logger:error_report([{tag1,data1},a_term,{tag2,data}]).</span>
=ERROR REPORT==== 22-May-2018::11:24:23.699306 ===
    tag1: data1
    a_term
    tag2: data
ok
3&gt; <span class="input">error_logger:error_report("Serious error in my module").</span>
=ERROR REPORT==== 22-May-2018::11:24:45.972445 ===
Serious error in my module
ok</pre><h3>error_report/2</h3><p>Log a user-defined error event.</p><p>Log a user-defined error event. Error logger forwards the
event to Logger, including metadata that allows backwards
compatibility with legacy error logger event handlers.</p><p>Error logger also adds a <strong>domain</strong> field with
value <strong>[<span class="anno">Type</span>]</strong> to this event's metadata,
causing the filters of the default Logger handler to discard
the event. A different Logger handler, or an error logger
event handler, must be added to handle this event.</p><p>It is recommended that <strong><span class="anno">Report</span></strong> follows the same
structure as for
<a href="#error_report/1">error_report/1</a>.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#error-1">logger#error-1</a>
instead.</p><h3>get_format_depth/0</h3><p>Get the value of the Kernel application variable <strong>error_logger_format_depth</strong>.</p><p>Returns <strong>max(10, Depth)</strong>, where <strong>Depth</strong> is the
value of <strong>error_logger_format_depth</strong>
in the Kernel application, if Depth is an integer. Otherwise,
<strong>unlimited</strong> is returned.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The <strong>error_logger_format_depth</strong> variable
is <a href="./kernel_app#deprecated-configuration-parameters"> deprecated</a> since
the <a href="logger">Logger API</a> was
introduced in Erlang/OTP 21.0. The variable, and this
function, are kept for backwards compatibility since they
still might be used by legacy report handlers.</p></div><h3>info_msg/1</h3><h3>info_msg/2</h3><p>Log a standard information event.</p><p>Log a standard information event. The <strong><span class="anno">Format</span></strong>
and <strong><span class="anno">Data</span></strong> arguments are the same as the
arguments of
<a href="../stdlib/io#format/2">stdlib/io#format/2</a>
in STDLIB.</p><p>Error logger forwards the event to Logger, including
metadata that allows backwards compatibility with legacy
error logger event handlers.</p><p>The event is handled by the default Logger handler.</p><p>These functions are kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#info-1">logger#info-1</a>
instead.</p><p><em>Example:</em></p><pre>
1&gt; <span class="input">error_logger:info_msg("Something happened in ~p", [a_module]).</span>
=INFO REPORT==== 22-May-2018::12:03:32.612462 ===
Something happened in a_module
ok</pre><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>If the Unicode translation modifier (<strong>t</strong>) is used in
the format string, all event handlers must ensure that the
formatted output is correctly encoded for the I/O
device.</p></div><h3>info_report/1</h3><p>Log a standard information event.</p><p>Log a standard information event. Error logger forwards the
event to Logger, including metadata that allows backwards
compatibility with legacy error logger event handlers.</p><p>The event is handled by the default Logger handler.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#info-1">logger#info-1</a>
instead.</p><p><em>Example:</em></p><pre>
2&gt; <span class="input">error_logger:info_report([{tag1,data1},a_term,{tag2,data}]).</span>
=INFO REPORT==== 22-May-2018::12:06:35.994440 ===
    tag1: data1
    a_term
    tag2: data
ok
3&gt; <span class="input">error_logger:info_report("Something strange happened").</span>
=INFO REPORT==== 22-May-2018::12:06:49.066872 ===
Something strange happened
ok</pre><h3>info_report/2</h3><p>Log a user-defined information event.</p><p>Log a user-defined information event. Error logger forwards
the event to Logger, including metadata that allows
backwards compatibility with legacy error logger event
handlers.</p><p>Error logger also adds a <strong>domain</strong> field with
value <strong>[<span class="anno">Type</span>]</strong> to this event's metadata,
causing the filters of the default Logger handler to discard
the event. A different Logger handler, or an error logger
event handler, must be added to handle this event.</p><p>It is recommended that <strong><span class="anno">Report</span></strong> follows the same
structure as for
<a href="#info_report/1">info_report/1</a>.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#info-1">logger#info-1</a>
instead.</p><h3>logfile/1</h3><h3>logfile/1</h3><h3>logfile/1</h3><p>Enable or disable error printouts to a file.</p><ul><li>Filename</li></ul><ul><li>OpenReason</li></ul><ul><li>CloseReason</li></ul><ul><li>FilenameReason</li></ul><ul><li>open_error</li></ul><p>Enables or disables printout of standard events to a file.</p><p>This is done by adding or deleting
the <strong>error_logger_file_h</strong> event handler, and thus
indirectly adding <strong>error_logger</strong> as a Logger
handler.</p><p>Notice that this function does not manipulate the Logger
configuration directly, meaning that if the default Logger
handler is already logging to a file, this function can
potentially cause logging to a second file.</p><p>This function is useful as a shortcut during development
and testing, but must not be used in a production
system. See
section <a href="logger_chapter">Logging</a>
in the Kernel User's Guide, and
the <a href="logger">logger</a>
manual page for information about how to configure Logger
for live systems.</p><p><strong>Request</strong> is one of the following:</p><dl><dt><strong>{open, <span class="anno">Filename</span>}</strong></dt><dd> <p>Opens log file <strong><span class="anno">Filename</span></strong>. Returns <strong>ok</strong> if
successful, or <strong>{error, allready_have_logfile}</strong> if
logging to file is already enabled, or an error tuple if
another error occurred (for example, if <strong><span class="anno">Filename</span></strong>
cannot be opened). The file is opened with encoding UTF-8.</p> </dd><dt><strong>close</strong></dt><dd> <p>Closes the current log file. Returns <strong>ok</strong>, or
<strong>{error, module_not_found}</strong>.</p> </dd><dt><strong>filename</strong></dt><dd> <p>Returns the name of the log file <strong><span class="anno">Filename</span></strong>, or
<strong>{error, no_log_file}</strong> if logging to file is not
enabled.</p> </dd></dl><h3>tty/1</h3><p>Enable or disable printouts to the terminal.</p><p>Enables (<strong><span class="anno">Flag</span> == true</strong>) or disables
(<strong><span class="anno">Flag</span> == false</strong>) printout of standard events
to the terminal.</p><p>This is done by manipulating the Logger configuration. The
function is useful as a shortcut during development and
testing, but must not be used in a production system. See
section <a href="logger_chapter">Logging</a>
in the Kernel User's Guide, and
the <a href="logger">logger</a>
manual page for information about how to configure Logger
for live systems.</p><h3>warning_map/0</h3><p>Return the current mapping for warning events.</p><p>Returns the current mapping for warning events. Events sent
using <strong>warning_msg/1,2</strong> or <strong>warning_report/1,2</strong>
are tagged as errors, warnings (default), or info, depending
on the value of command-line flag <strong>+W</strong>.</p><p><em>Example:</em></p><pre>
os$ <span class="input">erl</span>
Erlang (BEAM) emulator version 5.4.8 [hipe] [threads:0] [kernel-poll]

Eshell V5.4.8  (abort with ^G)
1&gt; <span class="input">error_logger:warning_map().</span>
warning
2&gt; <span class="input">error_logger:warning_msg("Warnings tagged as: ~p~n", [warning]).</span>

=WARNING REPORT==== 11-Aug-2005::15:31:55 ===
Warnings tagged as: warning
ok
3&gt;
User switch command
 --&gt; q
os$ <span class="input">erl +W e</span>
Erlang (BEAM) emulator version 5.4.8 [hipe] [threads:0] [kernel-poll]

Eshell V5.4.8  (abort with ^G)
1&gt; <span class="input">error_logger:warning_map().</span>
error
2&gt; <span class="input">error_logger:warning_msg("Warnings tagged as: ~p~n", [error]).</span>

=ERROR REPORT==== 11-Aug-2005::15:31:23 ===
Warnings tagged as: error
ok</pre><h3>warning_msg/1</h3><h3>warning_msg/2</h3><p>Log a standard warning event.</p><p>Log a standard warning event. The <strong><span class="anno">Format</span></strong>
and <strong><span class="anno">Data</span></strong> arguments are the same as the
arguments of
<a href="../stdlib/io#format/2">stdlib/io#format/2</a>
in STDLIB.</p><p>Error logger forwards the event to Logger, including
metadata that allows backwards compatibility with legacy
error logger event handlers.</p><p>The event is handled by the default Logger handler. The log
level can be changed to error or info, see
<a href="#warning_map/0">warning_map/0</a>.</p><p>These functions are kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#warning-1">logger#warning-1</a>
instead.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>If the Unicode translation modifier (<strong>t</strong>) is used in
the format string, all event handlers must ensure that the
formatted output is correctly encoded for the I/O
device.</p></div><h3>warning_report/1</h3><p>Log a standard warning event.</p><p>Log a standard warning event. Error logger forwards the event
to Logger, including metadata that allows backwards
compatibility with legacy error logger event handlers.</p><p>The event is handled by the default Logger handler. The log
level can be changed to error or info, see
<a href="#warning_map/0">warning_map/0</a>.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#warning-1">logger#warning-1</a>
instead.</p><h3>warning_report/2</h3><p>Log a user-defined warning event.</p><p>Log a user-defined warning event. Error logger forwards the
event to Logger, including metadata that allows backwards
compatibility with legacy error logger event handlers.</p><p>Error logger also adds a <strong>domain</strong> field with
value <strong>[<span class="anno">Type</span>]</strong> to this event's metadata,
causing the filters of the default Logger handler to discard
the event. A different Logger handler, or an error logger
event handler, must be added to handle this event.</p><p>The log level can be changed to error or info, see
<a href="#warning_map/0">warning_map/0</a>.</p><p>It is recommended that <strong><span class="anno">Report</span></strong> follows the same
structure as for
<a href="#warning_report/1">warning_report/1</a>.</p><p>This functions is kept for backwards compatibility and
must not be used by new code. Use the <a href="./logger#macros">logger#macros</a> macro or
<a href="./logger#warning-1">logger#warning-1</a>
instead.</p><a name="events"></a><h3>Events</h3><p>All event handlers added to the error logger must handle
the following events. <strong>Gleader</strong> is the group leader pid of
the process that sent the event, and <strong>Pid</strong> is the process
that sent the event.</p><dl><dt><strong>{error, Gleader, {Pid, Format, Data}}</strong></dt><dd> <p>Generated when <strong>error_msg/1,2</strong> or <strong>format</strong> is
called.</p> </dd><dt><strong>{error_report, Gleader, {Pid, std_error, Report}}</strong></dt><dd> <p>Generated when <strong>error_report/1</strong> is called.</p> </dd><dt><strong>{error_report, Gleader, {Pid, Type, Report}}</strong></dt><dd> <p>Generated when <strong>error_report/2</strong> is called.</p> </dd><dt><strong>{warning_msg, Gleader, {Pid, Format, Data}}</strong></dt><dd> <p>Generated when <strong>warning_msg/1,2</strong> is called
if warnings are set to be tagged as warnings.</p> </dd><dt><strong>{warning_report, Gleader, {Pid, std_warning, Report}}</strong></dt><dd> <p>Generated when <strong>warning_report/1</strong> is called
if warnings are set to be tagged as warnings.</p> </dd><dt><strong>{warning_report, Gleader, {Pid, Type, Report}}</strong></dt><dd> <p>Generated when <strong>warning_report/2</strong> is called
if warnings are set to be tagged as warnings.</p> </dd><dt><strong>{info_msg, Gleader, {Pid, Format, Data}}</strong></dt><dd> <p>Generated when <strong>info_msg/1,2</strong> is called.</p> </dd><dt><strong>{info_report, Gleader, {Pid, std_info, Report}}</strong></dt><dd> <p>Generated when <strong>info_report/1</strong> is called.</p> </dd><dt><strong>{info_report, Gleader, {Pid, Type, Report}}</strong></dt><dd> <p>Generated when <strong>info_report/2</strong> is called.</p> </dd></dl><p>Notice that some system-internal events can also be
received. Therefore a catch-all clause last in the definition of
the event handler callback function <strong>Module:handle_event/2</strong>
is necessary. This also applies for
<strong>Module:handle_info/2</strong>, as the event handler must also take care of
some system-internal messages.</p><h3>See Also</h3><p><a href="./gen_event">stdlib/gen_event</a>,
<a href="./logger">kernel/logger</a>,
<a href="./log_mf_h">stdlib/log_mf_h</a>,
<a href="kernel_app">kernel_app</a>,
<a href="./sasl_app">sasl/sasl_app</a></p><h2>file</h2><p>File interface module.</p><p>This module provides an interface to the file system.Regarding filename encoding, the Erlang VM can operate in
two modes. The current mode can be queried using function
<a href="#native_name_encoding/0">native_name_encoding/0</a>.
It returns <strong>latin1</strong> or <strong>utf8</strong>.In <strong>latin1</strong> mode, the Erlang VM does not change the
encoding of filenames. In <strong>utf8</strong> mode, filenames can
contain Unicode characters greater than 255 and the VM
converts filenames back and forth to the native filename encoding
(usually UTF-8, but UTF-16 on Windows).The default mode depends on the operating system. Windows and
MacOS X enforce consistent filename encoding and therefore the
VM uses <strong>utf8</strong> mode.On operating systems with transparent naming (for example, all Unix
systems except MacOS X), default is <strong>utf8</strong> if the
terminal supports UTF-8, otherwise <strong>latin1</strong>. The default can
be overridden using <strong>+fnl</strong> (to force <strong>latin1</strong> mode)
or <strong>+fnu</strong> (to force <strong>utf8</strong> mode) when starting
<a href="./erl">erts/erl</a>.On operating systems with transparent naming, files can be
inconsistently named, for example, some files are encoded in UTF-8 while
others are encoded in ISO Latin-1. The concept of <em>raw filenames</em> is
introduced to handle file systems with inconsistent naming when running in
<strong>utf8</strong> mode.A <em>raw filename</em> is a filename specified as a binary. The Erlang VM
does not translate a filename specified as a binary on
systems with transparent naming.When running in <strong>utf8</strong> mode, functions
<a href="#list_dir/1">list_dir/1</a> and
<a href="#read_link/1">read_link/1</a>
never return raw filenames. To return all filenames including raw filenames,
use functions
<a href="#list_dir_all">list_dir_all</a> and
<a href="#read_link_all">read_link_all</a>.See also section <a href="../stdlib/unicode_usage#notes-about-raw-filenames">Notes About Raw Filenames</a> in the STDLIB User's Guide.</p><h2>Data Types</h2><span class="name">deep_list</span><span class="name">fd()</span><p>A file descriptor representing a file opened in
<a href="#raw">raw</a> mode.</p><span class="name">filename</span><p>
See also the documentation of the
<a href="#type-name_all">type-name_all</a> type.
</p><span class="name">filename_all</span><p>
See also the documentation of the
<a href="#type-name_all">type-name_all</a> type.
</p><span class="name">io_device</span><p>As returned by
<a href="#open/2">open/2</a>;
<strong>pid()</strong> is a process handling I/O-protocols.</p><span class="name">name</span><p>If VM is in Unicode filename mode, <strong>string()</strong> and <strong>char()</strong>
are allowed to be &gt; 255. See also the documentation of the
<a href="#type-name_all">type-name_all</a> type.
</p><span class="name">name_all</span><p>If VM is in Unicode filename mode, characters
are allowed to be &gt; 255.
<strong><span class="anno">RawFilename</span></strong> is a filename not subject to
Unicode translation,
meaning that it can contain characters not conforming to
the Unicode encoding expected from the file system
(that is, non-UTF-8 characters although the VM is started
in Unicode filename mode). Null characters (integer value zero)
are <em>not</em> allowed in filenames (not even at the end).
</p><span class="name">posix</span><p>An atom that is named from the POSIX error codes used in
Unix, and in the runtime libraries of most C compilers.</p><span class="name">date_time</span><p>Must denote a valid date and time.</p><span class="name">file_info</span><span class="name">location</span><span class="name">mode</span><span class="name">file_info_option</span><h2>Functions</h2><h3>advise/4</h3><p>Predeclare an access pattern for file data.</p><ul><li>posix_file_advise</li></ul><p><strong>advise/4</strong> can be used to announce an intention to access file
data in a specific pattern in the future, thus allowing the
operating system to perform appropriate optimizations.</p><p>On some platforms, this function might have no effect.</p><h3>allocate/3</h3><p>Allocate file space.</p><p><strong>allocate/3</strong> can be used to preallocate space for a file.</p><p>This function only succeeds in platforms that provide this
feature. When it succeeds, space is preallocated for the file but
the file size might not be updated. This behaviour depends on the
preallocation implementation. To guarantee that the file size is updated,
truncate the file to the new size.</p><h3>change_group/2</h3><p>Change group of a file.</p><p>Changes group of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>change_mode/2</h3><p>Change permissions of a file.</p><p>Changes permissions of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>change_owner/2</h3><p>Change owner of a file.</p><p>Changes owner of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>change_owner/3</h3><p>Change owner and group of a file.</p><p>Changes owner and group of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>change_time/2</h3><p>Change the modification time of a file.</p><p>Changes the modification and access times of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>change_time/3</h3><p>Change the modification and last access time of a file.</p><p>Changes the modification and last access times of a file. See
<a href="#write_file_info/2">write_file_info/2</a>.</p><h3>close/1</h3><p>Close a file.</p><p>Closes the file referenced by <strong><span class="anno">IoDevice</span></strong>. It mostly
returns <strong>ok</strong>, except for some severe errors such as out
of memory.</p><p>Notice that if option <strong>delayed_write</strong> was
used when opening the file, <strong>close/1</strong> can return an
old write error and not even try to close the file. See
<a href="#open/2">open/2</a>.</p><h3>consult/1</h3><p>Read Erlang terms from a file.</p><p>Reads Erlang terms, separated by '.', from
<strong><span class="anno">Filename</span></strong>. Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">Terms</span>}</strong></dt><dd> <p>The file was successfully read.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang terms in
the file. To convert the three-element tuple to an English
description of the error, use
<a href="#format_error/1">format_error/1</a>.</p> </dd></dl><p><em>Example:</em></p><pre><code class="">
f.txt:  {person, "kalle", 25}.
        {person, "pelle", 30}.</code></pre><pre>
1&gt; <span class="input">file:consult("f.txt").</span>
{ok,[{person,"kalle",25},{person,"pelle",30}]}</pre><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment, as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>copy/2</h3><h3>copy/3</h3><p>Copy file contents.</p><p>Copies <strong><span class="anno">ByteCount</span></strong> bytes from
<strong><span class="anno">Source</span></strong> to <strong><span class="anno">Destination</span></strong>.
<strong><span class="anno">Source</span></strong> and <strong><span class="anno">Destination</span></strong> refer
to either filenames or IO devices from, for example, <strong>open/2</strong>.
<strong><span class="anno">ByteCount</span></strong> defaults to <strong>infinity</strong>, denoting an
infinite number of bytes.</p><p>Argument <strong><span class="anno">Modes</span></strong> is a list of possible modes,
see <a href="#open/2">open/2</a>, and defaults to
<strong>[]</strong>.</p><p>If both <strong><span class="anno">Source</span></strong> and
<strong><span class="anno">Destination</span></strong> refer to
filenames, the files are opened with <strong>[read, binary]</strong>
and <strong>[write, binary]</strong> prepended to their mode lists,
respectively, to optimize the copy.</p><p>If <strong><span class="anno">Source</span></strong> refers to a filename, it is opened with
<strong>read</strong> mode prepended to the mode list before the copy,
and closed when done.</p><p>If <strong><span class="anno">Destination</span></strong> refers to a filename, it is opened
with <strong>write</strong> mode prepended to the mode list before
the copy, and closed when done.</p><p>Returns <strong>{ok, <span class="anno">BytesCopied</span>}</strong>, where
<strong><span class="anno">BytesCopied</span></strong> is
the number of bytes that was copied, which can be
less than <strong><span class="anno">ByteCount</span></strong> if end of file was
encountered on the source. If the operation fails,
<strong>{error, <span class="anno">Reason</span>}</strong> is returned.</p><p>Typical error reasons: as for
<a href="#open/2">open/2</a> if a file
had to be opened, and as for
<a href="#read/2">read/2</a> and
<a href="#write/2">write/2</a>.</p><h3>datasync/1</h3><p>Synchronize the in-memory data of a file, ignoring most of its metadata, with that on the physical medium.</p><p>Ensures that any buffers kept by the operating system
(not by the Erlang runtime system) are written to disk. In
many ways it resembles <strong>fsync</strong> but it does not update
some of the metadata of the file, such as the access time. On
some platforms this function has no effect.</p><p>Applications that access databases or log files often write
a tiny data fragment (for example, one line in a log file) and then
call <strong>fsync()</strong> immediately to ensure that the written
data is physically stored on the hard disk. Unfortunately, <strong>fsync()</strong>
always initiates two write operations: one for the newly
written data and another one to update the modification
time stored in the <strong>inode</strong>. If the modification time is not a part
of the transaction concept, <strong>fdatasync()</strong> can be used to avoid
unnecessary <strong>inode</strong> disk write operations.</p><p>Available only in some POSIX systems, this call results in a
call to <strong>fsync()</strong>, or has no effect in systems not providing
the <strong>fdatasync()</strong> syscall.</p><h3>del_dir/1</h3><p>Delete a directory.</p><p>Tries to delete directory <strong><span class="anno">Dir</span></strong>.
The directory must
be empty before it can be deleted. Returns <strong>ok</strong> if
successful.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search or write permissions for the parent
directories of <strong><span class="anno">Dir</span></strong>.</p> </dd><dt><strong>eexist</strong></dt><dd> <p>The directory is not empty.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The directory does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of <strong><span class="anno">Dir</span></strong> is not a directory.
On some platforms, <strong>enoent</strong> is returned instead.</p> </dd><dt><strong>einval</strong></dt><dd> <p>Attempt to delete the current directory. On some
platforms, <strong>eacces</strong> is returned instead.</p> </dd></dl><h3>delete/1</h3><p>Delete a file.</p><p>Tries to delete file <strong><span class="anno">Filename</span></strong>.
Returns <strong>ok</strong> if successful.</p><p>Typical error reasons:</p><dl><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>Missing permission for the file or one of its parents.</p> </dd><dt><strong>eperm</strong></dt><dd> <p>The file is a directory and the user is not superuser.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd><dt><strong>einval</strong></dt><dd> <p><strong><span class="anno">Filename</span></strong> has an improper type, such as tuple.</p> </dd></dl><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>In a future release, a bad type for argument
<strong><span class="anno">Filename</span></strong> will probably generate
an exception.</p></div><h3>eval/1</h3><p>Evaluate Erlang expressions in a file.</p><p>Reads and evaluates Erlang expressions, separated by '.' (or
',', a sequence of expressions is also an expression) from
<strong><span class="anno">Filename</span></strong>. The result of the evaluation
is not returned; any expression sequence in the file must be there
for its side effect. Returns one of the following:</p><dl><dt><strong>ok</strong></dt><dd> <p>The file was read and evaluated.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang
expressions in the file. To convert the three-element tuple
to an English description of the error, use
<a href="#format_error/1">format_error/1</a>.</p> </dd></dl><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment, as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>eval/2</h3><p>Evaluate Erlang expressions in a file.</p><p>The same as <strong>eval/1</strong>, but the variable bindings
<strong><span class="anno">Bindings</span></strong> are used in the evaluation. For information
about the variable bindings, see
<a href="./erl_eval">stdlib/erl_eval</a>.</p><h3>format_error/1</h3><p>Return a descriptive string for an error reason.</p><p>Given the error reason returned by any function in this
module, returns a descriptive string of the error in English.</p><h3>get_cwd/0</h3><p>Get the current working directory.</p><p>Returns <strong>{ok, <span class="anno">Dir</span>}</strong>, where <strong><span class="anno">Dir</span></strong>
is the current
working directory of the file server.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>In rare circumstances, this function can fail on Unix.
It can occur if read permission does not exist for
the parent directories of the current directory.</p></div><p>A typical error reason:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing read permission for one of the parents of
the current directory.</p> </dd></dl><h3>get_cwd/1</h3><p>Get the current working directory for the specified drive.</p><p>Returns <strong>{ok, <span class="anno">Dir</span>}</strong> or
<strong>{error, <span class="anno">Reason</span>}</strong>, where <strong><span class="anno">Dir</span></strong>
is the current working directory of the specified drive.</p><p><strong><span class="anno">Drive</span></strong> is to be of the form
"<strong>Letter</strong><strong>:</strong>", for example, "c:".</p><p>Returns <strong>{error, enotsup}</strong> on platforms
that have no concept of current drive (Unix, for example).</p><p>Typical error reasons:</p><dl><dt><strong>enotsup</strong></dt><dd> <p>The operating system has no concept of drives.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>The drive does not exist.</p> </dd><dt><strong>einval</strong></dt><dd> <p>The format of <strong><span class="anno">Drive</span></strong> is invalid.</p> </dd></dl><h3>list_dir/1</h3><p>List files in a directory.</p><p>Lists all files in a directory, <em>except</em> files
with raw filenames. Returns
<strong>{ok, <span class="anno">Filenames</span>}</strong> if successful,
otherwise <strong>{error, <span class="anno">Reason</span>}</strong>.
<strong><span class="anno">Filenames</span></strong> is a list of
the names of all the files in the directory. The names are
not sorted.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search or write permissions for <strong><span class="anno">Dir</span></strong>
or one of its parent directories.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The directory does not exist.</p> </dd><dt><strong>{no_translation, <span class="anno">Filename</span>}</strong></dt><dd> <p><strong><span class="anno">Filename</span></strong> is a <strong>binary()</strong> with
characters coded in ISO Latin-1 and the VM was started
with parameter <strong>+fnue</strong>.</p> </dd></dl><h3>list_dir_all/1</h3><p>List all files in a directory.</p><p><a name="list_dir_all"></a>Lists all the files in a directory,
including files with raw filenames.
Returns <strong>{ok, <span class="anno">Filenames</span>}</strong> if successful,
otherwise <strong>{error, <span class="anno">Reason</span>}</strong>.
<strong><span class="anno">Filenames</span></strong> is a list of
the names of all the files in the directory. The names are
not sorted.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search or write permissions for <strong><span class="anno">Dir</span></strong>
or one of its parent directories.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The directory does not exist.</p> </dd></dl><h3>make_dir/1</h3><p>Make a directory.</p><p>Tries to create directory <strong><span class="anno">Dir</span></strong>. Missing parent
directories are <em>not</em> created. Returns <strong>ok</strong> if
successful.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search or write permissions for the parent
directories of <strong><span class="anno">Dir</span></strong>.</p> </dd><dt><strong>eexist</strong></dt><dd> <p>A file or directory named <strong><span class="anno">Dir</span></strong> exists already.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>A component of <strong><span class="anno">Dir</span></strong> does not exist.</p> </dd><dt><strong>enospc</strong></dt><dd> <p>No space is left on the device.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of <strong><span class="anno">Dir</span></strong> is not a directory.
On some platforms, <strong>enoent</strong> is returned instead.</p> </dd></dl><h3>make_link/2</h3><p>Make a hard link to a file.</p><p>Makes a hard link from <strong><span class="anno">Existing</span></strong> to
<strong><span class="anno">New</span></strong> on
platforms supporting links (Unix and Windows). This function returns
<strong>ok</strong> if the link was successfully created, otherwise
<strong>{error, <span class="anno">Reason</span>}</strong>. On platforms not supporting
links, <strong>{error,enotsup}</strong> is returned.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing read or write permissions for the parent
directories of <strong><span class="anno">Existing</span></strong> or
<strong><span class="anno">New</span></strong>.</p> </dd><dt><strong>eexist</strong></dt><dd> <p><strong><span class="anno">New</span></strong> already exists.</p> </dd><dt><strong>enotsup</strong></dt><dd> <p>Hard links are not supported on this platform.</p> </dd></dl><h3>make_symlink/2</h3><p>Make a symbolic link to a file or directory.</p><p>Creates a symbolic link <strong><span class="anno">New</span></strong> to
the file or directory <strong><span class="anno">Existing</span></strong> on platforms
supporting symbolic links (most Unix systems and Windows, beginning with
Vista).
<strong><span class="anno">Existing</span></strong> does not need to exist.
Returns <strong>ok</strong> if the link is
successfully created, otherwise <strong>{error, <span class="anno">Reason</span>}</strong>.
On platforms not supporting symbolic links, <strong>{error, enotsup}</strong>
is returned.</p><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing read or write permissions for the parent directories
of <strong><span class="anno">Existing</span></strong> or <strong><span class="anno">New</span></strong>.</p> </dd><dt><strong>eexist</strong></dt><dd> <p><strong><span class="anno">New</span></strong> already exists.</p> </dd><dt><strong>enotsup</strong></dt><dd> <p>Symbolic links are not supported on this platform.</p> </dd><dt><strong>eperm</strong></dt><dd> <p>User does not have privileges to create symbolic links
(<strong>SeCreateSymbolicLinkPrivilege</strong> on Windows).</p> </dd></dl><h3>native_name_encoding/0</h3><p>Return the configured filename encoding of the VM.</p><p><a name="native_name_encoding"></a>Returns
the filename encoding mode. If it is <strong>latin1</strong>, the
system translates no filenames. If it is
<strong>utf8</strong>, filenames are converted back and forth to
the native filename encoding (usually UTF-8, but UTF-16 on
Windows).</p><h3>open/2</h3><p>Open a file.</p><p>Opens file <strong><span class="anno">File</span></strong> in the mode determined
by <strong><span class="anno">Modes</span></strong>, which can contain one or more of the
following options:</p><dl><dt><strong>read</strong></dt><dd> <p>The file, which must exist, is opened for reading.</p> </dd><dt><strong>write</strong></dt><dd> <p>The file is opened for writing. It is created if it does
not exist. If the file exists and <strong>write</strong> is not
combined with <strong>read</strong>, the file is truncated.</p> </dd><dt><strong>append</strong></dt><dd> <p>The file is opened for writing. It is created if it does
not exist. Every write operation to a file opened with
<strong>append</strong> takes place at the end of the file.</p> </dd><dt><strong>exclusive</strong></dt><dd> <p>The file is opened for writing. It is created if it does
not exist. If the file exists, <strong>{error, eexist}</strong>
is returned.</p> <div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>This option does not guarantee exclusiveness on
file systems not supporting <strong>O_EXCL</strong> properly,
such as NFS. Do not depend on this option unless you
know that the file system supports it (in general, local
file systems are safe).</p></div> </dd><dt><strong>raw</strong></dt><dd> <p><a name="raw"></a>
Allows faster access to a file,
as no Erlang process is needed to handle the file.
However, a file opened in this way has the following
limitations:</p> <ul><li><p>The functions in the <strong>io</strong> module cannot be used,
as they can only talk to an Erlang process.
Instead, use functions
<a href="#read/2">read/2</a>,
<a href="#read_line/1">read_line/1</a>, and
<a href="#write/2">write/2</a>.</p></li><li><p>Especially if <strong>read_line/1</strong> is to be used on a <strong>raw</strong>
file, it is recommended to combine this option with option
<strong>{read_ahead, Size}</strong> as line-oriented I/O is inefficient
without buffering.</p></li><li><p>Only the Erlang process that opened the file can use
it.</p></li><li><p>A remote Erlang file server cannot be used.
The computer on which the Erlang node is running must
have access to the file system (directly or through
NFS).</p></li></ul> </dd><dt><strong>binary</strong></dt><dd> <p>Read operations on the file return binaries rather than lists.</p> </dd><dt><strong>{delayed_write, Size, Delay}</strong></dt><dd> <p>Data in subsequent
<strong>write/2</strong> calls is buffered until at least
<strong>Size</strong> bytes are buffered, or until the oldest buffered
data is <strong>Delay</strong> milliseconds old. Then all buffered
data is written in one operating system call.
The buffered data is also flushed before some other file
operation than <strong>write/2</strong> is executed.</p> <p>The purpose of this option is to increase performance
by reducing the number of operating system calls. Thus, the
<strong>write/2</strong> calls must be for sizes significantly
less than <strong>Size</strong>, and not interspersed by too many
other file operations.</p> <p>When this option is used, the result of <strong>write/2</strong>
calls can prematurely be reported as successful, and if
a write error occurs, the error is reported as the result
of the next file operation, which is not executed.</p> <p>For example, when <strong>delayed_write</strong> is used, after a
number of <strong>write/2</strong> calls, <strong>close/1</strong> can
return <strong>{error, enospc}</strong>, as there is not enough
space on the disc for previously written data.
<strong>close/1</strong> must probably be called again, as the
file is still open.</p> </dd><dt><strong>delayed_write</strong></dt><dd> <p>The same as <strong>{delayed_write, Size, Delay}</strong> with
reasonable default values for <strong>Size</strong> and
<strong>Delay</strong> (roughly some 64 KB, 2 seconds).</p> </dd><dt><strong>{read_ahead, Size}</strong></dt><dd> <p>Activates read data buffering. If
<strong>read/2</strong> calls are for significantly less than
<strong>Size</strong> bytes, read operations to the operating
system are still performed for blocks of <strong>Size</strong>
bytes. The extra data is buffered and returned in
subsequent <strong>read/2</strong> calls, giving a performance gain
as the number of operating system calls is reduced.</p> <p>The <strong>read_ahead</strong> buffer is also highly used
by function <strong>read_line/1</strong> in <strong>raw</strong> mode,
therefore this option is recommended
(for performance reasons)
when accessing raw files using that function.</p> <p>If <strong>read/2</strong> calls are for sizes not significantly
less than, or even greater than <strong>Size</strong> bytes, no
performance gain can be expected.</p> </dd><dt><strong>read_ahead</strong></dt><dd> <p>The same as <strong>{read_ahead, Size}</strong> with a reasonable
default value for <strong>Size</strong> (roughly some 64 KB).</p> </dd><dt><strong>compressed</strong></dt><dd> <p>Makes it possible to read or write gzip compressed
files. Option <strong>compressed</strong> must be combined
with <strong>read</strong> or <strong>write</strong>, but not both.
Notice that the file size obtained with
<a href="#read_file_info/1">read_file_info/1</a>
does probably not match the number of bytes that can be
read from a compressed file.</p> </dd><dt><strong>{encoding, Encoding}</strong></dt><dd> <p>Makes the file perform automatic translation of characters to
and from a specific (Unicode) encoding. Notice that the data supplied
to
<a href="#write/2">write/2</a>
or returned by
<a href="#read/2">read/2</a>
still is byte-oriented; this option
denotes only how data is stored in the disk file.</p> <p>Depending on the encoding, different methods of reading and writing
data is preferred. The default encoding of <strong>latin1</strong> implies using
this module (<strong>file</strong>) for reading and writing data as the interfaces
provided here work with byte-oriented data. Using other (Unicode)
encodings makes the
<a href="./io">stdlib/io</a> functions
<strong>get_chars</strong>, <strong>get_line</strong>, and <strong>put_chars</strong> more suitable,
as they can work with the full Unicode range.</p> <p>If data is sent to an <strong>io_device()</strong> in a format that cannot be
converted to the specified encoding, or if data is read by a function
that returns data in a format that cannot cope with the character range
of the data, an error occurs and the file is closed.</p> <p>Allowed values for <strong>Encoding</strong>:</p> <dl><dt><strong>latin1</strong></dt><dd> <p>The default encoding. Bytes supplied to the file, that is,
<a href="#write/2">write/2</a>
are written "as is" on the file. Likewise, bytes read from the file,
that is,
<a href="#read/2">read/2</a> are
returned "as is". If module
<a href="./io">stdlib/io</a> is used for
writing, the file can only cope with Unicode characters up to code point
255 (the ISO Latin-1 range).</p> </dd><dt><strong>unicode or utf8</strong></dt><dd> <p>Characters are translated to and from UTF-8 encoding before they are
written to or read from the file. A file opened in this way can be
readable using function
<a href="#read/2">read/2</a>,
as long as no data stored on
the file lies beyond the ISO Latin-1 range (0..255), but failure occurs
if the data contains Unicode code points beyond that range. The file is
best read with the functions in the Unicode aware module
<a href="./io">stdlib/io</a>.</p> <p>Bytes written to the file by any means are translated to UTF-8 encoding
before being stored on the disk file.</p> </dd><dt><strong>utf16 or {utf16,big}</strong></dt><dd> <p>Works like <strong>unicode</strong>, but translation is done to and from big
endian UTF-16 instead of UTF-8.</p> </dd><dt><strong>{utf16,little}</strong></dt><dd> <p>Works like <strong>unicode</strong>, but translation is done to and from little
endian UTF-16 instead of UTF-8.</p> </dd><dt><strong>utf32 or {utf32,big}</strong></dt><dd> <p>Works like <strong>unicode</strong>, but translation is done to and from big
endian UTF-32 instead of UTF-8.</p> </dd><dt><strong>{utf32,little}</strong></dt><dd> <p>Works like <strong>unicode</strong>, but translation is done to and from little
endian UTF-32 instead of UTF-8.</p> </dd></dl> <p>The Encoding can be changed for a file "on the fly" by using function
<a href="../stdlib/io#setopts/2">stdlib/io#setopts/2</a>.
So a file can be analyzed in latin1 encoding for, for example, a BOM,
positioned beyond the BOM and then be set for the right encoding before
further reading. For functions identifying BOMs, see module
<a href="./unicode">stdlib/unicode</a>. </p> <p>This option is not allowed on <strong>raw</strong> files.</p> </dd><dt><strong>ram</strong></dt><dd> <p><strong>File</strong> must be <strong>iodata()</strong>. Returns an <strong>fd()</strong>, which lets
module <strong>file</strong> operate on the data in-memory as if it is a file.</p> </dd><dt><strong>sync</strong></dt><dd> <p>On platforms supporting it, enables the POSIX <strong>O_SYNC</strong> synchronous
I/O flag or its platform-dependent equivalent (for example,
<strong>FILE_FLAG_WRITE_THROUGH</strong> on Windows) so that writes to the file
block until the data is physically written to disk. However, be aware
that the exact semantics of this flag differ from platform to
platform. For example, none of Linux or Windows guarantees that all file
metadata are also written before the call returns. For precise semantics,
check the details of your platform documentation. On platforms with no
support for POSIX <strong>O_SYNC</strong> or equivalent, use of the <strong>sync</strong>
flag causes <strong>open</strong> to return <strong>{error, enotsup}</strong>.</p> </dd></dl><p>Returns:</p><dl><dt><strong>{ok, <span class="anno">IoDevice</span>}</strong></dt><dd> <p>The file is opened in the requested mode.
<strong><span class="anno">IoDevice</span></strong> is a reference to the file.</p> </dd><dt><strong>{error, <span class="anno">Reason</span>}</strong></dt><dd> <p>The file cannot be opened.</p> </dd></dl><p><strong><span class="anno">IoDevice</span></strong> is really the pid of the process that
handles the file. This process is linked to the process
that originally opened the file. If any process to which
the <strong><span class="anno">IoDevice</span></strong> is linked terminates, the file is
closed and the process itself is terminated.
An <strong><span class="anno">IoDevice</span></strong> returned from this call can be used
as an argument to the I/O functions (see
<a href="./io">stdlib/io</a>).</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>In previous versions of <strong>file</strong>, modes were specified
as one of the atoms <strong>read</strong>, <strong>write</strong>, or
<strong>read_write</strong> instead of a list. This is still allowed
for reasons of backwards compatibility, but is not to be
used for new code. Also note that <strong>read_write</strong> is not
allowed in a mode list.</p></div><p>Typical error reasons:</p><dl><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>Missing permission for reading the file or searching one
of the parent directories.</p> </dd><dt><strong>eisdir</strong></dt><dd> <p>The named file is a directory.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd><dt><strong>enospc</strong></dt><dd> <p>There is no space left on the device (if <strong>write</strong>
access was specified).</p> </dd></dl><h3>path_consult/2</h3><p>Read Erlang terms from a file.</p><p>Searches the path <strong><span class="anno">Path</span></strong> (a list of directory
names) until the file <strong><span class="anno">Filename</span></strong> is found.
If <strong><span class="anno">Filename</span></strong>
is an absolute filename, <strong><span class="anno">Path</span></strong> is ignored.
Then reads Erlang terms, separated by '.', from the file.</p><p>Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">Terms</span>, <span class="anno">FullName</span>}</strong></dt><dd> <p>The file is successfully read. <strong><span class="anno">FullName</span></strong> is
the full name of the file.</p> </dd><dt><strong>{error, enoent}</strong></dt><dd> <p>The file cannot be found in any of the directories in
<strong><span class="anno">Path</span></strong>.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang terms in
the file. Use
<a href="#format_error/1">format_error/1</a>
to convert the three-element tuple to an English description of
the error.</p> </dd></dl><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>path_eval/2</h3><p>Evaluate Erlang expressions in a file.</p><p>Searches the path <strong><span class="anno">Path</span></strong> (a list of directory
names) until the file <strong><span class="anno">Filename</span></strong> is found.
If <strong><span class="anno">Filename</span></strong> is an absolute filename,
<strong><span class="anno">Path</span></strong> is ignored. Then reads
and evaluates Erlang expressions, separated by '.' (or ',', a
sequence of expressions is also an expression), from the file.
The result of evaluation is not returned; any
expression sequence in the file must be there for its side
effect.</p><p>Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">FullName</span>}</strong></dt><dd> <p>The file is read and evaluated. <strong><span class="anno">FullName</span></strong> is
the full name of the file.</p> </dd><dt><strong>{error, enoent}</strong></dt><dd> <p>The file cannot be found in any of the directories in
<strong><span class="anno">Path</span></strong>.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang
expressions in the file. Use
<a href="#format_error/1">format_error/1</a>
to convert the three-element tuple to an English description
of the error.</p> </dd></dl><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>path_open/3</h3><p>Open a file.</p><p>Searches the path <strong><span class="anno">Path</span></strong> (a list of directory
names) until the file <strong><span class="anno">Filename</span></strong> is found.
If <strong><span class="anno">Filename</span></strong>
is an absolute filename, <strong><span class="anno">Path</span></strong> is ignored.
Then opens the file in the mode determined by <strong><span class="anno">Modes</span></strong>.</p><p>Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">IoDevice</span>, <span class="anno">FullName</span>}</strong></dt><dd> <p>The file is opened in the requested mode.
<strong><span class="anno">IoDevice</span></strong> is a reference to the file and
<strong><span class="anno">FullName</span></strong> is the full name of the file.</p> </dd><dt><strong>{error, enoent}</strong></dt><dd> <p>The file cannot be found in any of the directories in
<strong><span class="anno">Path</span></strong>.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>The file cannot be opened.</p> </dd></dl><h3>path_script/2</h3><p>Evaluate and return the value of Erlang expressions in a file.</p><p>Searches the path <strong><span class="anno">Path</span></strong> (a list of directory
names) until the file <strong><span class="anno">Filename</span></strong> is found.
If <strong><span class="anno">Filename</span></strong> is an absolute filename,
<strong><span class="anno">Path</span></strong> is ignored. Then reads
and evaluates Erlang expressions, separated by '.' (or ',', a
sequence of expressions is also an expression), from the file.</p><p>Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">Value</span>, <span class="anno">FullName</span>}</strong></dt><dd> <p>The file is read and evaluated. <strong><span class="anno">FullName</span></strong> is
the full name of the file and <strong><span class="anno">Value</span></strong> the value of
the last expression.</p> </dd><dt><strong>{error, enoent}</strong></dt><dd> <p>The file cannot be found in any of the directories in
<strong><span class="anno">Path</span></strong>.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang
expressions in the file. Use
<a href="#format_error/1">format_error/1</a>
to convert the three-element tuple to an English description
of the error.</p> </dd></dl><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>path_script/3</h3><p>Evaluate and return the value of Erlang expressions in a file.</p><p>The same as <strong>path_script/2</strong> but the variable bindings
<strong><span class="anno">Bindings</span></strong> are used in the evaluation. See
<a href="./erl_eval">stdlib/erl_eval</a> about
variable bindings.</p><h3>pid2name/1</h3><p>Return the name of the file handled by a pid.</p><p>If <strong><span class="anno">Pid</span></strong> is an I/O device, that is, a pid returned from
<strong>open/2</strong>, this function returns the filename, or rather:</p><dl><dt><strong>{ok, <span class="anno">Filename</span>}</strong></dt><dd> <p>If the file server of this node is not a slave, the file was
opened by the file server of this node (this implies that
<strong><span class="anno">Pid</span></strong> must be a local pid) and the file is not
closed. <strong><span class="anno">Filename</span></strong> is the filename in flat string
format.</p> </dd><dt><strong>undefined</strong></dt><dd> <p>In all other cases.</p> </dd></dl><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>This function is intended for debugging only.</p></div><h3>position/2</h3><p>Set position in a file.</p><p>Sets the position of the file referenced by <strong><span class="anno">IoDevice</span></strong>
to <strong><span class="anno">Location</span></strong>. Returns <strong>{ok, <span class="anno">NewPosition</span>}</strong>
(as absolute offset) if successful, otherwise
<strong>{error, <span class="anno">Reason</span>}</strong>. <strong><span class="anno">Location</span></strong> is
one of the following:</p><dl><dt><strong>Offset</strong></dt><dd> <p>The same as <strong>{bof, Offset}</strong>.</p> </dd><dt><strong>{bof, Offset}</strong></dt><dd> <p>Absolute offset.</p> </dd><dt><strong>{cur, Offset}</strong></dt><dd> <p>Offset from the current position.</p> </dd><dt><strong>{eof, Offset}</strong></dt><dd> <p>Offset from the end of file.</p> </dd><dt><strong>bof | cur | eof</strong></dt><dd> <p>The same as above with <strong>Offset</strong> 0.</p> </dd></dl><p>Notice that offsets are counted in bytes, not in characters. If the file
is opened using some other <strong>encoding</strong> than <strong>latin1</strong>, one byte
does not correspond to one character. Positioning in such a file can only
be done to known character boundaries. That is, to a position earlier retrieved
by getting a current position, to the beginning/end of the file or to some
other position <em>known</em> to be on a correct character boundary by some
other means (typically beyond a byte order mark in the file, which has a
known byte-size).</p><p>A typical error reason is:</p><dl><dt><strong>einval</strong></dt><dd> <p>Either <strong><span class="anno">Location</span></strong> is illegal, or it is
evaluated to a
negative offset in the file. Notice that if the resulting
position is a negative value, the result is an error, and
after the call the file position is undefined.</p> </dd></dl><h3>pread/2</h3><p>Read from a file at certain positions.</p><p>Performs a sequence of <strong>pread/3</strong> in one operation, 
which is more efficient than calling them one at a time.
Returns <strong>{ok, [<span class="anno">Data</span>, ...]}</strong> or
<strong>{error, <span class="anno">Reason</span>}</strong>,
where each <strong><span class="anno">Data</span></strong>, the result of the corresponding
<strong>pread</strong>, is either a list or a binary depending on
the mode of the file, or <strong>eof</strong> if the requested position
is beyond end of file.</p><p>As the position is specified as a byte-offset, take special caution
when working with files where <strong>encoding</strong> is set to something else
than <strong>latin1</strong>, as not every byte position is a valid character
boundary on such a file.</p><h3>pread/3</h3><p>Read from a file at a certain position.</p><p>Combines <strong>position/2</strong> and <strong>read/2</strong> in one
operation, which is more efficient than calling them one at a
time. If <strong><span class="anno">IoDevice</span></strong> is opened in <strong>raw</strong> mode,
some restrictions apply:</p><ul><li><strong><span class="anno">Location</span></strong> is only allowed to be an integer.</li><li>The current position of the file is undefined after the operation.</li></ul><p>As the position is specified as a byte-offset, take special caution
when working with files where <strong>encoding</strong> is set to something else
than <strong>latin1</strong>, as not every byte position is a valid character
boundary on such a file.</p><h3>pwrite/2</h3><p>Write to a file at certain positions.</p><p>Performs a sequence of <strong>pwrite/3</strong> in one operation, 
which is more efficient than calling them one at a time.
Returns <strong>ok</strong> or <strong>{error, {<span class="anno">N</span>, <span class="anno">Reason</span>}}</strong>, where
<strong><span class="anno">N</span></strong> is the number of successful writes done
before the failure.</p><p>When positioning in a file with other <strong>encoding</strong> than <strong>latin1</strong>,
caution must be taken to set the position on a correct character boundary.
For details, see <a href="#position/2">position/2</a>.</p><h3>pwrite/3</h3><p>Write to a file at a certain position.</p><p>Combines <strong>position/2</strong> and <strong>write/2</strong> in one
operation, which is more efficient than calling them one at a
time. If <strong><span class="anno">IoDevice</span></strong> has been opened in <strong>raw</strong> mode,
some restrictions apply:</p><ul><li><strong><span class="anno">Location</span></strong> is only allowed to be an integer.</li><li>The current position of the file is undefined after the operation.</li></ul><p>When positioning in a file with other <strong>encoding</strong> than <strong>latin1</strong>,
caution must be taken to set the position on a correct character boundary.
For details, see <a href="#position/2">position/2</a>.</p><h3>read/2</h3><p>Read from a file.</p><p>Reads <strong><span class="anno">Number</span></strong> bytes/characters from the file
referenced by <strong><span class="anno">IoDevice</span></strong>. The functions
<a href="#read/2">read/2</a>,
<a href="#pread/3">pread/3</a>, and
<a href="#read_line/1">read_line/1</a>
are the only ways to read from a file opened in <strong>raw</strong> mode
(although they work for normally opened files, too).</p><p>For files where <strong>encoding</strong> is set to something else than <strong>latin1</strong>,
one character can be represented by more than one byte on the file.
The parameter <strong>Number</strong> always denotes the number of <em>characters</em>
read from the file, while the position in the file can be moved much more than
this number when reading a Unicode file.</p><p>Also, if <strong>encoding</strong> is set to something else than <strong>latin1</strong>,
the <strong>read/3</strong> call fails if the data contains characters larger than 255,
which is why module <a href="./io">stdlib/io</a>
is to be preferred when reading such a file.</p><p>The function returns:</p><dl><dt><strong>{ok, <span class="anno">Data</span>}</strong></dt><dd> <p>If the file was opened in binary mode, the read bytes are
returned in a binary, otherwise in a list. The list or
binary is shorter than the number of bytes requested
if end of file was reached.</p> </dd><dt><strong>eof</strong></dt><dd> <p>Returned if <strong><span class="anno">Number</span>&gt;0</strong> and end of file was
reached before anything at all could be read.</p> </dd><dt><strong>{error, <span class="anno">Reason</span>}</strong></dt><dd> <p>An error occurred.</p> </dd></dl><p>Typical error reasons:</p><dl><dt><strong>ebadf</strong></dt><dd> <p>The file is not opened for reading.</p> </dd><dt><strong>{no_translation, unicode, latin1}</strong></dt><dd> <p>The file is opened with another <strong>encoding</strong> than <strong>latin1</strong> and
the data in the file cannot be translated to the byte-oriented data that
this function returns.</p> </dd></dl><h3>read_file/1</h3><p>Read a file.</p><p>Returns <strong>{ok, <span class="anno">Binary</span>}</strong>, where
<strong><span class="anno">Binary</span></strong> is a binary
data object that contains the contents of
<strong><span class="anno">Filename</span></strong>, or
<strong>{error, <span class="anno">Reason</span>}</strong> if an error occurs.</p><p>Typical error reasons:</p><dl><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>Missing permission for reading the file, or for
searching one of the parent directories.</p> </dd><dt><strong>eisdir</strong></dt><dd> <p>The named file is a directory.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd><dt><strong>enomem</strong></dt><dd> <p>There is not enough memory for the contents of the file.</p> </dd></dl><h3>read_file_info/1</h3><h3>read_file_info/2</h3><p>Retrieve information about a file.</p><p>Retrieves information about a file. Returns
<strong>{ok, <span class="anno">FileInfo</span>}</strong> if successful, otherwise
<strong>{error, <span class="anno">Reason</span>}</strong>. <strong><span class="anno">FileInfo</span></strong>
is a record
<strong>file_info</strong>, defined in the Kernel include file
<strong>file.hrl</strong>. Include the following directive in the module
from which the function is called:</p><pre><code class="">
 -include_lib("kernel/include/file.hrl").</code></pre><p>The time type returned in <strong>atime</strong>, <strong>mtime</strong>, and <strong>ctime</strong>
is dependent on the time type set in <strong>Opts :: {time, Type}</strong> as
follows:</p><dl><dt><strong>local</strong></dt><dd><p>Returns local time.</p></dd><dt><strong>universal</strong></dt><dd><p>Returns universal time.</p></dd><dt><strong>posix</strong></dt><dd><p>Returns seconds since or before Unix time epoch,
which is 1970-01-01 00:00 UTC.</p></dd></dl><p>Default is <strong>{time, local}</strong>.</p><p>If the option <strong>raw</strong> is set, the file server is not called and
only information about local files is returned. Note that this will
break this module's atomicity guarantees as it can race with a
concurrent call to
<a href="#write_file_info/2">write_file_info/2</a></p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>As file times are stored in POSIX time on most OS, it is faster to
query file information with option <strong>posix</strong>.</p></div><p>The record <strong>file_info</strong> contains the following fields:</p><dl><dt><strong>size = integer() &gt;= 0</strong></dt><dd> <p>Size of file in bytes.</p> </dd><dt><strong>type = device | directory | other | regular | symlink</strong></dt><dd> <p>The type of the file.</p> </dd><dt><strong>access = read | write | read_write | none</strong></dt><dd> <p>The current system access to the file.</p> </dd><dt><strong>atime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;= 0</strong></dt><dd> <p>The last time the file was read.</p> </dd><dt><strong>mtime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;= 0</strong></dt><dd> <p>The last time the file was written.</p> </dd><dt><strong>ctime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;=0</strong></dt><dd> <p>The interpretation of this time field depends on
the operating system. On Unix, it is the last time
the file or the <strong>inode</strong> was changed. In Windows, it is
the create time.</p> </dd><dt><strong>mode = integer() &gt;= 0</strong></dt><dd> <p>The file permissions as the sum of the following bit
values:</p> <dl><dt><strong>8#00400</strong></dt><dd><p>read permission: owner</p></dd><dt><strong>8#00200</strong></dt><dd><p>write permission: owner</p></dd><dt><strong>8#00100</strong></dt><dd><p>execute permission: owner</p></dd><dt><strong>8#00040</strong></dt><dd><p>read permission: group</p></dd><dt><strong>8#00020</strong></dt><dd><p>write permission: group</p></dd><dt><strong>8#00010</strong></dt><dd><p>execute permission: group</p></dd><dt><strong>8#00004</strong></dt><dd><p>read permission: other</p></dd><dt><strong>8#00002</strong></dt><dd><p>write permission: other</p></dd><dt><strong>8#00001</strong></dt><dd><p>execute permission: other</p></dd><dt><strong>16#800</strong></dt><dd><p>set user id on execution</p></dd><dt><strong>16#400</strong></dt><dd><p>set group id on execution</p></dd></dl> <p>On Unix platforms, other bits than those listed above
may be set.</p> </dd><dt><strong>links = integer() &gt;= 0</strong></dt><dd> <p>Number of links to the file (this is always 1 for
file systems that have no concept of links).</p> </dd><dt><strong>major_device = integer() &gt;= 0</strong></dt><dd> <p>Identifies the file system where the file is located.
In Windows, the number indicates a drive as follows:
0 means A:, 1 means B:, and so on.</p> </dd><dt><strong>minor_device = integer() &gt;= 0</strong></dt><dd> <p>Only valid for character devices on Unix. In all other
cases, this field is zero.</p> </dd><dt><strong>inode = integer() &gt;= 0</strong></dt><dd> <p>Gives the <strong>inode</strong> number. On non-Unix file systems,
this field is zero.</p> </dd><dt><strong>uid = integer() &gt;= 0</strong></dt><dd> <p>Indicates the owner of the file. On non-Unix file systems,
this field is zero.</p> </dd><dt><strong>gid = integer() &gt;= 0</strong></dt><dd> <p>Gives the group that the owner of the file belongs to.
On non-Unix file systems, this field is zero.</p> </dd></dl><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search permission for one of the parent
directories of the file.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd></dl><h3>read_line/1</h3><p>Read a line from a file.</p><p>Reads a line of bytes/characters from the file referenced by
<strong><span class="anno">IoDevice</span></strong>. Lines are defined to be delimited by the
linefeed (LF, <strong>\n</strong>) character, but any carriage return (CR, <strong>\r</strong>)
followed by a newline is also treated as a single LF character (the carriage
return is silently ignored). The line is returned <em>including</em> the LF,
but excluding any CR immediately followed by an LF. This behaviour is
consistent with the behaviour of
<a href="../stdlib/io#get_line/2">stdlib/io#get_line/2</a>.
If end of file is reached without any LF ending the last line, a line with no
trailing LF is returned.</p><p>The function can be used on files opened in <strong>raw</strong> mode. However, it is
inefficient to use it on <strong>raw</strong> files if the file is not opened with
option <strong>{read_ahead, Size}</strong> specified. Thus, combining <strong>raw</strong> and
<strong>{read_ahead, Size}</strong> is highly recommended when opening a text file for
raw line-oriented reading.</p><p>If <strong>encoding</strong> is set to something else than <strong>latin1</strong>, the
<strong>read_line/1</strong> call fails if the data contains characters larger than 255,
why module <a href="./io">stdlib/io</a> is to be
preferred when reading such a file.</p><p>The function returns:</p><dl><dt><strong>{ok, <span class="anno">Data</span>}</strong></dt><dd> <p>One line from the file is returned, including the trailing LF,
but with CRLF sequences replaced by a single LF (see above).</p> <p>If the file is opened in binary mode, the read bytes are
returned in a binary, otherwise in a list.</p> </dd><dt><strong>eof</strong></dt><dd> <p>Returned if end of file was reached
before anything at all could be read.</p> </dd><dt><strong>{error, <span class="anno">Reason</span>}</strong></dt><dd> <p>An error occurred.</p> </dd></dl><p>Typical error reasons:</p><dl><dt><strong>ebadf</strong></dt><dd> <p>The file is not opened for reading.</p> </dd><dt><strong>{no_translation, unicode, latin1}</strong></dt><dd> <p>The file is opened with another <strong>encoding</strong> than <strong>latin1</strong> and
the data on the file cannot be translated to the byte-oriented data that
this function returns.</p> </dd></dl><h3>read_link/1</h3><p>See what a link is pointing to.</p><p><a name="read_link_all"></a>Returns
<strong>{ok, <span class="anno">Filename</span>}</strong> if
<strong><span class="anno">Name</span></strong> refers to a symbolic link that is
not a raw filename, or <strong>{error, <span class="anno">Reason</span>}</strong>
otherwise.
On platforms that do not support symbolic links, the return
value is <strong>{error,enotsup}</strong>.</p><p>Typical error reasons:</p><dl><dt><strong>einval</strong></dt><dd> <p><strong><span class="anno">Name</span></strong> does not refer to a symbolic link
or the name of the file that it refers to does not conform
to the expected encoding.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>enotsup</strong></dt><dd> <p>Symbolic links are not supported on this platform.</p> </dd></dl><h3>read_link_all/1</h3><p>See what a link is pointing to.</p><p>Returns <strong>{ok, <span class="anno">Filename</span>}</strong> if
<strong><span class="anno">Name</span></strong> refers to a symbolic link or
<strong>{error, <span class="anno">Reason</span>}</strong> otherwise.
On platforms that do not support symbolic links, the return
value is <strong>{error,enotsup}</strong>.</p><p>Notice that <strong><span class="anno">Filename</span></strong> can be either a list
or a binary.</p><p>Typical error reasons:</p><dl><dt><strong>einval</strong></dt><dd> <p><strong><span class="anno">Name</span></strong> does not refer to a symbolic link.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>enotsup</strong></dt><dd> <p>Symbolic links are not supported on this platform.</p> </dd></dl><h3>read_link_info/1</h3><h3>read_link_info/2</h3><p>Retrieve information about a link or file.</p><p>Works like
<a href="#read_file_info/2">read_file_info/2</a>
except that if <strong><span class="anno">Name</span></strong> is a symbolic link, information
about the link is returned in the <strong>file_info</strong> record and
the <strong>type</strong> field of the record is set to <strong>symlink</strong>.</p><p>If the option <strong>raw</strong> is set, the file server is not called and
only information about local files is returned. Note that this will
break this module's atomicity guarantees as it can race with a
concurrent call to
<a href="#write_file_info/2">write_file_info/2</a></p><p>If <strong><span class="anno">Name</span></strong> is not a symbolic link, this function returns
the same result as <strong>read_file_info/1</strong>.
On platforms that do not support symbolic links, this function
is always equivalent to <strong>read_file_info/1</strong>.</p><h3>rename/2</h3><p>Rename a file.</p><p>Tries to rename the file <strong><span class="anno">Source</span></strong> to
<strong><span class="anno">Destination</span></strong>.
It can be used to move files (and directories) between
directories, but it is not sufficient to specify
the destination only. The destination filename must also be
specified. For example, if <strong>bar</strong> is a normal file and
<strong>foo</strong> and <strong>baz</strong> are directories,
<strong>rename("foo/bar", "baz")</strong> returns an error, but
<strong>rename("foo/bar", "baz/bar")</strong> succeeds. Returns
<strong>ok</strong> if it is successful.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Renaming of open files is not allowed on most platforms
(see <strong>eacces</strong> below).</p></div><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing read or write permissions for the parent
directories of <strong><span class="anno">Source</span></strong> or
<strong><span class="anno">Destination</span></strong>. On
some platforms, this error is given if either
<strong><span class="anno">Source</span></strong> or <strong><span class="anno">Destination</span></strong>
is open.</p> </dd><dt><strong>eexist</strong></dt><dd> <p><strong><span class="anno">Destination</span></strong> is not an empty directory.
On some platforms, also given when <strong><span class="anno">Source</span></strong> and
<strong><span class="anno">Destination</span></strong> are not of the same type.</p> </dd><dt><strong>einval</strong></dt><dd> <p><strong><span class="anno">Source</span></strong> is a root directory, or
<strong><span class="anno">Destination</span></strong>
is a subdirectory of <strong><span class="anno">Source</span></strong>.</p> </dd><dt><strong>eisdir</strong></dt><dd> <p><strong><span class="anno">Destination</span></strong> is a directory, but
<strong><span class="anno">Source</span></strong> is not.</p> </dd><dt><strong>enoent</strong></dt><dd> <p><strong>Source</strong> does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p><strong><span class="anno">Source</span></strong> is a directory, but
<strong><span class="anno">Destination</span></strong> is not.</p> </dd><dt><strong>exdev</strong></dt><dd> <p><strong><span class="anno">Source</span></strong> and <strong><span class="anno">Destination</span></strong>
are on different file systems.</p> </dd></dl><h3>script/1</h3><p>Evaluate and return the value of Erlang expressions in a file.</p><p>Reads and evaluates Erlang expressions, separated by '.' (or
',', a sequence of expressions is also an expression), from
the file.</p><p>Returns one of the following:</p><dl><dt><strong>{ok, <span class="anno">Value</span>}</strong></dt><dd> <p>The file is read and evaluated. <strong><span class="anno">Value</span></strong> is
the value of the last expression.</p> </dd><dt><strong>{error, atom()}</strong></dt><dd> <p>An error occurred when opening the file or reading it.
For a list of typical error codes, see
<a href="#open/2">open/2</a>.</p> </dd><dt><strong>{error, {<span class="anno">Line</span>, <span class="anno">Mod</span>, <span class="anno">Term</span>}}</strong></dt><dd> <p>An error occurred when interpreting the Erlang
expressions in the file. Use
<a href="#format_error/1">format_error/1</a>
to convert the three-element tuple to an English description
of the error.</p> </dd></dl><p>The encoding of <strong><span class="anno">Filename</span></strong> can be set
by a comment as described in
<a href="../stdlib/epp#encoding">stdlib/epp#encoding</a>.</p><h3>script/2</h3><p>Evaluate and return the value of Erlang expressions in a file.</p><p>The same as <strong>script/1</strong> but the variable bindings
<strong><span class="anno">Bindings</span></strong> are used in the evaluation. See
<a href="./erl_eval">stdlib/erl_eval</a> about
variable bindings.</p><h3>sendfile/2</h3><p>Send a file to a socket.</p><p>Sends the file <strong>Filename</strong> to <strong>Socket</strong>.
Returns <strong>{ok, BytesSent}</strong> if successful,
otherwise <strong>{error, Reason}</strong>.</p><h3>sendfile/5</h3><p>Send a file to a socket.</p><ul><li>sendfile_option</li></ul><p>Sends <strong>Bytes</strong> from the file
referenced by <strong>RawFile</strong> beginning at <strong>Offset</strong> to
<strong>Socket</strong>.
Returns <strong>{ok, BytesSent}</strong> if successful,
otherwise <strong>{error, Reason}</strong>. If <strong>Bytes</strong> is set to
<strong>0</strong> all data after the specified <strong>Offset</strong> is sent.</p><p>The file used must be opened using the <strong>raw</strong> flag, and the process
calling <strong>sendfile</strong> must be the controlling process of the socket.
See <a href="./gen_tcp#controlling_process-2">gen_tcp#controlling_process-2</a>.</p><p>If the OS used does not support non-blocking <strong>sendfile</strong>, an
Erlang fallback using <a href="#read/2">read/2</a>
and <a href="./gen_tcp#send/2">gen_tcp#send/2</a> is
used.</p><p>The option list can contain the following options:</p><dl><dt><strong>chunk_size</strong></dt><dd><p>The chunk size used by the Erlang fallback to send
data. If using the fallback, set this to a value
that comfortably fits in the systems memory. Default is 20 MB.</p></dd></dl><h3>set_cwd/1</h3><p>Set the current working directory.</p><p>Sets the current working directory of the file server to
<strong><span class="anno">Dir</span></strong>. Returns <strong>ok</strong> if successful.</p><p>The functions in the module <strong>file</strong> usually treat binaries
as raw filenames, that is, they are passed "as is" even when the
encoding of the binary does not agree with
<a href="#native_name_encoding/0">native_name_encoding/0</a>.
However, this function expects binaries to be encoded according to the
value returned by <strong>native_name_encoding()</strong>.</p><p>Typical error reasons are:</p><dl><dt><strong>enoent</strong></dt><dd> <p>The directory does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of <strong><span class="anno">Dir</span></strong> is not a directory.
On some platforms, <strong>enoent</strong> is returned.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>Missing permission for the directory or one of its
parents.</p> </dd><dt><strong>badarg</strong></dt><dd> <p><strong><span class="anno">Dir</span></strong> has an improper type,
such as tuple.</p> </dd><dt><strong>no_translation</strong></dt><dd> <p><strong><span class="anno">Dir</span></strong> is a <strong>binary()</strong> with
characters coded in ISO-latin-1 and the VM is operating
with unicode filename encoding.</p> </dd></dl><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>In a future release, a bad type for argument
<strong><span class="anno">Dir</span></strong>
will probably generate an exception.</p></div><h3>sync/1</h3><p>Synchronize the in-memory state of a file with that on the physical medium.</p><p>Ensures that any buffers kept by the operating system
(not by the Erlang runtime system) are written to disk. On
some platforms, this function might have no effect.</p><p>A typical error reason is:</p><dl><dt><strong>enospc</strong></dt><dd> <p>Not enough space left to write the file.</p> </dd></dl><h3>truncate/1</h3><p>Truncate a file.</p><p>Truncates the file referenced by <strong><span class="anno">IoDevice</span></strong> at
the current position. Returns <strong>ok</strong> if successful,
otherwise <strong>{error, <span class="anno">Reason</span>}</strong>.</p><h3>write/2</h3><p>Write to a file.</p><p>Writes <strong><span class="anno">Bytes</span></strong> to the file referenced by
<strong><span class="anno">IoDevice</span></strong>. This function is the only way to write to a
file opened in <strong>raw</strong> mode (although it works for normally opened
files too). Returns <strong>ok</strong> if successful, and
<strong>{error, <span class="anno">Reason</span>}</strong> otherwise.</p><p>If the file is opened with <strong>encoding</strong> set to something else than
<strong>latin1</strong>, each byte written can result in many bytes being written to
the file, as the byte range 0..255 can represent anything between one and
four bytes depending on value and UTF encoding type.</p><p>Typical error reasons:</p><dl><dt><strong>ebadf</strong></dt><dd> <p>The file is not opened for writing.</p> </dd><dt><strong>enospc</strong></dt><dd> <p>No space is left on the device.</p> </dd></dl><h3>write_file/2</h3><p>Write a file.</p><p>Writes the contents of the <strong>iodata</strong> term <strong><span class="anno">Bytes</span></strong>
to file <strong><span class="anno">Filename</span></strong>.
The file is created if it does not exist.
If it exists, the previous contents are overwritten.
Returns <strong>ok</strong> if successful, otherwise
<strong>{error, <span class="anno">Reason</span>}</strong>.</p><p>Typical error reasons:</p><dl><dt><strong>enoent</strong></dt><dd> <p>A component of the filename does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd><dt><strong>enospc</strong></dt><dd> <p>No space is left on the device.</p> </dd><dt><strong>eacces</strong></dt><dd> <p>Missing permission for writing the file or searching one
of the parent directories.</p> </dd><dt><strong>eisdir</strong></dt><dd> <p>The named file is a directory.</p> </dd></dl><h3>write_file/3</h3><p>Write a file.</p><p>Same as <strong>write_file/2</strong>, but takes a third argument
<strong><span class="anno">Modes</span></strong>, a list of possible modes, see
<a href="#open/2">open/2</a>. The mode flags
<strong>binary</strong> and <strong>write</strong> are implicit, so they are
not to be used.</p><h3>write_file_info/2</h3><h3>write_file_info/3</h3><p>Change file information.</p><p>Changes file information. Returns <strong>ok</strong> if successful,
otherwise <strong>{error, <span class="anno">Reason</span>}</strong>.
<strong><span class="anno">FileInfo</span></strong> is a record
<strong>file_info</strong>, defined in the Kernel include file
<strong>file.hrl</strong>. Include the following directive in the module
from which the function is called:</p><pre><code class="">
 -include_lib("kernel/include/file.hrl").</code></pre><p>The time type set in <strong>atime</strong>, <strong>mtime</strong>, and <strong>ctime</strong>
depends on the time type set in <strong>Opts :: {time, Type}</strong> as
follows:</p><dl><dt><strong>local</strong></dt><dd><p>Interprets the time set as local.</p></dd><dt><strong>universal</strong></dt><dd><p>Interprets it as universal time.</p></dd><dt><strong>posix</strong></dt><dd><p>Must be seconds since or before Unix time epoch,
which is 1970-01-01 00:00 UTC.</p></dd></dl><p>Default is <strong>{time, local}</strong>.</p><p>If the option <strong>raw</strong> is set, the file server is not called
and only information about local files is returned.</p><p>The following fields are used from the record, if they are
specified:</p><dl><dt><strong>atime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;= 0</strong></dt><dd> <p>The last time the file was read.</p> </dd><dt><strong>mtime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;= 0</strong></dt><dd> <p>The last time the file was written.</p> </dd><dt><strong>ctime = </strong> <a href="#type-date_time">type-date_time</a><strong> | integer() &gt;= 0</strong></dt><dd> <p>On Unix, any value specified for this field is ignored
(the "ctime" for the file is set to the current
time). On Windows, this field is the new creation time to
set for the file.</p> </dd><dt><strong>mode = integer() &gt;= 0</strong></dt><dd> <p>The file permissions as the sum of the following bit
values:</p> <dl><dt><strong>8#00400</strong></dt><dd><p>Read permission: owner</p></dd><dt><strong>8#00200</strong></dt><dd><p>Write permission: owner</p></dd><dt><strong>8#00100</strong></dt><dd><p>Execute permission: owner</p></dd><dt><strong>8#00040</strong></dt><dd><p>Read permission: group</p></dd><dt><strong>8#00020</strong></dt><dd><p>Write permission: group</p></dd><dt><strong>8#00010</strong></dt><dd><p>Execute permission: group</p></dd><dt><strong>8#00004</strong></dt><dd><p>Read permission: other</p></dd><dt><strong>8#00002</strong></dt><dd><p>Write permission: other</p></dd><dt><strong>8#00001</strong></dt><dd><p>Execute permission: other</p></dd><dt><strong>16#800</strong></dt><dd><p>Set user id on execution</p></dd><dt><strong>16#400</strong></dt><dd><p>Set group id on execution</p></dd></dl> <p>On Unix platforms, other bits than those listed above
may be set.</p> </dd><dt><strong>uid = integer() &gt;= 0</strong></dt><dd> <p>Indicates the file owner. Ignored for non-Unix
file systems.</p> </dd><dt><strong>gid = integer() &gt;= 0</strong></dt><dd> <p>Gives the group that the file owner belongs to.
Ignored for non-Unix file systems.</p> </dd></dl><p>Typical error reasons:</p><dl><dt><strong>eacces</strong></dt><dd> <p>Missing search permission for one of the parent
directories of the file.</p> </dd><dt><strong>enoent</strong></dt><dd> <p>The file does not exist.</p> </dd><dt><strong>enotdir</strong></dt><dd> <p>A component of the filename is not a directory. On some
platforms, <strong>enoent</strong> is returned instead.</p> </dd></dl><h3>POSIX Error Codes</h3><ul><li><strong>eacces</strong> - Permission denied</li><li><strong>eagain</strong> - Resource temporarily unavailable</li><li><strong>ebadf</strong> - Bad file number</li><li><strong>ebusy</strong> - File busy</li><li><strong>edquot</strong> - Disk quota exceeded</li><li><strong>eexist</strong> - File already exists</li><li><strong>efault</strong> - Bad address in system call argument</li><li><strong>efbig</strong> - File too large</li><li><strong>eintr</strong> - Interrupted system call</li><li><strong>einval</strong> - Invalid argument</li><li><strong>eio</strong> - I/O error</li><li><strong>eisdir</strong> - Illegal operation on a directory</li><li><strong>eloop</strong> - Too many levels of symbolic links</li><li><strong>emfile</strong> - Too many open files</li><li><strong>emlink</strong> - Too many links</li><li><strong>enametoolong</strong> - Filename too long</li><li><strong>enfile</strong> - File table overflow</li><li><strong>enodev</strong> - No such device</li><li><strong>enoent</strong> - No such file or directory</li><li><strong>enomem</strong> - Not enough memory</li><li><strong>enospc</strong> - No space left on device</li><li><strong>enotblk</strong> - Block device required</li><li><strong>enotdir</strong> - Not a directory</li><li><strong>enotsup</strong> - Operation not supported</li><li><strong>enxio</strong> - No such device or address</li><li><strong>eperm</strong> - Not owner</li><li><strong>epipe</strong> - Broken pipe</li><li><strong>erofs</strong> - Read-only file system</li><li><strong>espipe</strong> - Invalid seek</li><li><strong>esrch</strong> - No such process</li><li><strong>estale</strong> - Stale remote file handle</li><li><strong>exdev</strong> - Cross-domain link</li></ul><h3>Performance</h3><p>For increased performance, raw files are recommended.</p><p>A normal file is really a process so it can be used as an I/O
device (see <a href="./io">stdlib/io</a>).
Therefore, when data is written to a normal file, the sending of the
data to the file process, copies all data that are not binaries. Opening
the file in binary mode and writing binaries is therefore recommended.
If the file is opened on another node, or if the file server runs as
slave to the file server of another node, also binaries are copied.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Raw files use the file system of the host machine of the node.
For normal files (non-raw), the file server is used to find the files,
and if the node is running its file server as slave to the file server
of another node, and the other node runs on some other host machine,
they can have different file systems.
However, this is seldom a problem.</p></div><p><a href="#open/2">open/2</a> can be given the
options <strong>delayed_write</strong> and <strong>read_ahead</strong> to turn on caching,
which will reduce the number of operating system calls and greatly
improve performance for small reads and writes. However, the overhead
won't disappear completely and it's best to keep the number of file
operations to a minimum. As a contrived example, the following function
writes 4MB in 2.5 seconds when tested:</p><pre><code class="">
create_file_slow(Name) -&gt;
    {ok, Fd} = file:open(Name, [raw, write, delayed_write, binary]),
    create_file_slow_1(Fd, 4 bsl 20),
    file:close(Fd).

create_file_slow_1(_Fd, 0) -&gt;
    ok;
create_file_slow_1(Fd, M) -&gt;
    ok = file:write(Fd, &lt;&lt;0&gt;&gt;),
    create_file_slow_1(Fd, M - 1).</code></pre><p>The following functionally equivalent code writes 128 bytes per call
to <a href="#write/2">write/2</a> and so does the
same work in 0.08 seconds, which is roughly 30 times faster:</p><pre><code class="">
create_file(Name) -&gt;
    {ok, Fd} = file:open(Name, [raw, write, delayed_write, binary]),
    create_file_1(Fd, 4 bsl 20),
    file:close(Fd),
    ok.

create_file_1(_Fd, 0) -&gt;
    ok;
create_file_1(Fd, M) when M &gt;= 128 -&gt;
    ok = file:write(Fd, &lt;&lt;0:(128)/unit:8&gt;&gt;),
    create_file_1(Fd, M - 128);
create_file_1(Fd, M) -&gt;
    ok = file:write(Fd, &lt;&lt;0:(M)/unit:8&gt;&gt;),
    create_file_1(Fd, M - 1).</code></pre><p>When writing data it's generally more efficient to write a list of
binaries rather than a list of integers. It is not needed to
flatten a deep list before writing. On Unix hosts, scatter output,
which writes a set of buffers in one operation, is used when
possible. In this way <strong>write(FD, [Bin1, Bin2 | Bin3])</strong>
writes the contents of the binaries without copying the data
at all, except for perhaps deep down in the operating system
kernel.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>If an error occurs when accessing an open file with module
<a href="./io">stdlib/io</a>, the process
handling the file exits. The dead file process can hang if a process
tries to access it later. This will be fixed in a future release.
</p></div><h3>See Also</h3><p><a href="./filename">stdlib/filename</a></p><h2>gen_sctp</h2><p>Functions for communicating with sockets using the SCTP
    protocol.</p><p>This module provides functions for communicating with
sockets using the SCTP protocol. The implementation assumes that
the OS kernel supports SCTP
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">(RFC 2960)</a>
through the user-level
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions</a>.During development, this implementation was tested on:<ul><li>Linux Fedora Core 5.0 (kernel 2.6.15-2054 or later is needed)</li><li>Solaris 10, 11</li></ul>During OTP adaptation it was tested on:<ul><li>SUSE Linux Enterprise Server 10 (x86_64) kernel 2.6.16.27-0.6-smp, with lksctp-tools-1.0.6</li><li>Briefly on Solaris 10</li><li>SUSE Linux Enterprise Server 10 Service Pack 1 (x86_64) kernel 2.6.16.54-0.2.3-smp with lksctp-tools-1.0.7</li><li>FreeBSD 8.2</li></ul>This module was written for one-to-many style sockets
(type <strong>seqpacket</strong>). With the addition of
<a href="#peeloff/2">peeloff/2</a>,
one-to-one style sockets (type <strong>stream</strong>) were introduced.Record definitions for this module can be found using:<pre>
-include_lib("kernel/include/inet_sctp.hrl").</pre>These record definitions use the "new" spelling 'adaptation',
not the deprecated 'adaption', regardless of which
spelling the underlying C API uses.</p><h2>Data Types</h2><span class="name">assoc_id()</span><p>An opaque term returned in, for example, <strong>#sctp_paddr_change{}</strong>,
which identifies an association for an SCTP socket. The term
is opaque except for the special value <strong>0</strong>, which has a
meaning such as "the whole endpoint" or "all future associations".</p><span class="name">option</span><p>One of the
<a href="#options">SCTP Socket Options</a>.</p><span class="name">option_name</span><span class="name">sctp_socket()</span><p>Socket identifier returned from
<a href="#open/0">open/0</a>.</p><a name="exports"></a><h2>Functions</h2><h3>abort/2</h3><p>Abnormally terminate the association specified by <strong>Assoc</strong>, without flushing of unsent data.</p><p>Abnormally terminates the association specified by
<strong><span class="anno">Assoc</span></strong>, without
flushing of unsent data. The socket itself remains open. Other
associations opened on this socket are still valid, and the socket
can be used in new associations.</p><h3>close/1</h3><p>Close the socket and all associations on it.</p><p>Closes the socket and all associations on it. The unsent
data is flushed as in <a href="#eof/2">eof/2</a>.
The <strong>close/1</strong> call
is blocking or otherwise depending of the value of
the <a href="./inet#option-linger">inet#option-linger</a>
socket <a href="#options">option</a>.
If <strong>close</strong> does not linger or linger time-out expires,
the call returns and the data is flushed in the background.</p><h3>connect/4</h3><p>Same as <strong>connect(Socket, Addr, Port, Opts, infinity)</strong>.</p><p>Same as <strong>connect(<span class="anno">Socket</span>, <span class="anno">Addr</span>, <span class="anno">Port</span>, <span class="anno">Opts</span>, infinity)</strong>.</p><h3>connect/5</h3><p>Establish a new association for socket <strong>Socket</strong>, with a peer (SCTP server socket).</p><p>Establishes a new association for socket <strong><span class="anno">Socket</span></strong>,
with the peer (SCTP server socket) specified by
<strong><span class="anno">Addr</span></strong> and <strong><span class="anno">Port</span></strong>.
<strong><span class="anno">Timeout</span></strong>, is expressed in milliseconds.
A socket can be associated with multiple peers.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Using a value of <strong><span class="anno">Timeout</span></strong> less than
the maximum time taken by the OS to establish an association (around
4.5 minutes if the default values from
<a href="https://tools.ietf.org/html/rfc4960">RFC 4960</a>
are used), can result
in inconsistent or incorrect return values. This is especially
relevant for associations sharing the same <strong><span class="anno">Socket</span></strong>
(that is, source address and port), as the controlling process
blocks until <strong>connect/*</strong> returns.
<a href="#connect_init/4">connect_init/4</a>
provides an alternative without this limitation.</p></div><p><a name="record-sctp_assoc_change"></a>
The result of <strong>connect/*</strong> is an <strong>#sctp_assoc_change{}</strong>
event that contains, in particular, the new
<a href="#type-assoc_id">Association ID</a>:</p><pre>
#sctp_assoc_change{
      state             = atom(),
      error             = atom(),
      outbound_streams  = integer(),
      inbound_streams   = integer(),
      assoc_id          = assoc_id()
}</pre><p>The number of outbound and inbound streams can be set by
giving an <strong>sctp_initmsg</strong> option to <strong>connect</strong> as in:</p><pre>
connect(Socket, Ip, Port&gt;,
      [{sctp_initmsg,#sctp_initmsg{num_ostreams=OutStreams,
                                   max_instreams=MaxInStreams}}])</pre><p>All options <strong><span class="anno">Opt</span></strong> are set on the socket before the
association is attempted. If an option record has undefined
field values, the options record is first read from the socket
for those values. In effect, <strong><span class="anno">Opt</span></strong> option records
only define field values to change before connecting.</p><p>The returned <strong>outbound_streams</strong> and <strong>inbound_streams</strong>
are the stream numbers on the socket. These can be different
from the requested values (<strong>OutStreams</strong> and <strong>MaxInStreams</strong>,
respectively) if the peer requires lower values.</p><p><strong>state</strong> can have the following values:</p><dl><dt><strong>comm_up</strong></dt><dd><p>Association is successfully established. This
indicates a successful completion of <strong>connect</strong>.</p></dd><dt><strong>cant_assoc</strong></dt><dd><p>The association cannot be established
(<strong>connect/*</strong> failure).</p></dd></dl><p>Other states do not normally occur in the output from
<strong>connect/*</strong>. Rather, they can occur in
<strong>#sctp_assoc_change{}</strong> events received instead of data in
<a href="#recv/1">recv/1</a> calls.
All of them indicate losing the association because of various error
conditions, and are listed here for the sake of completeness:</p><dl><dt><strong>comm_lost</strong></dt><dd></dd><dt><strong>restart</strong></dt><dd></dd><dt><strong>shutdown_comp</strong></dt><dd></dd></dl><p>Field <strong>error</strong> can provide more detailed diagnostics.</p><h3>connect_init/4</h3><p>Same as <strong>connect_init(Socket, Addr, Port, Opts, infinity)</strong>..</p><p>Same as <strong>connect_init(<span class="anno">Socket</span>, <span class="anno">Addr</span>, <span class="anno">Port</span>, <span class="anno">Opts</span>, infinity)</strong>.</p><h3>connect_init/5</h3><p>Initiate a new association for socket <strong>Socket</strong>, with a peer (SCTP server socket).</p><p>Initiates a new association for socket <strong><span class="anno">Socket</span></strong>,
with the peer (SCTP server socket) specified by
<strong><span class="anno">Addr</span></strong> and <strong><span class="anno">Port</span></strong>.</p><p>The fundamental difference between this API
and <strong>connect/*</strong> is that the return value is that of the
underlying OS <strong>connect(2)</strong> system call. If <strong>ok</strong> is returned,
the result of the association establishment is received
by the calling process as an
<a href="#record-sctp_assoc_change">record-sctp_assoc_change</a>
event. The calling process must be prepared to receive this, or
poll for it using
<a href="#recv/1">recv/1</a>,
depending on the value of the active option.</p><p>The parameters are as described in
<a href="#connect/5">connect/5</a>,
except the <strong><span class="anno">Timeout</span></strong> value.</p><p>The timer associated with <strong><span class="anno">Timeout</span></strong> only supervises
IP resolution of <strong><span class="anno">Addr</span></strong>.</p><h3>controlling_process/2</h3><p>Assign a new controlling process pid to the socket.</p><p>Assigns a new controlling process <strong><span class="anno">Pid</span></strong> to
<strong><span class="anno">Socket</span></strong>. Same implementation as
<a href="./gen_udp#controlling_process/2">gen_udp#controlling_process/2</a>.
</p><h3>eof/2</h3><p>Gracefully terminate the association specified by <strong>Assoc</strong>, with flushing of all unsent data.</p><p>Gracefully terminates the association specified by
<strong><span class="anno">Assoc</span></strong>, with
flushing of all unsent data. The socket itself remains open. Other
associations opened on this socket are still valid. The socket can
be used in new associations.</p><h3>error_string/1</h3><p>Translate an SCTP error number into a string.</p><p>Translates an SCTP error number from, for example,
<strong>#sctp_remote_error{}</strong> or <strong>#sctp_send_failed{}</strong> into
an explanatory string, or one of the atoms <strong>ok</strong> for no
error or <strong>undefined</strong> for an unrecognized error.</p><h3>listen/2</h3><h3>listen/2</h3><p>Set up a socket to listen.</p><p>Sets up a socket to listen on the IP address and port number
it is bound to.</p><p>For type <strong>seqpacket</strong>, sockets (the default)
<strong><span class="anno">IsServer</span></strong> must be <strong>true</strong> or <strong>false</strong>.
In contrast to TCP, there is no listening queue length in SCTP.
If <strong><span class="anno">IsServer</span></strong> is <strong>true</strong>, the socket accepts
new associations, that is, it becomes an SCTP server socket.</p><p>For type <strong>stream</strong>, sockets <span class="anno">Backlog</span> define
the backlog queue length just like in TCP.</p><h3>open/0</h3><h3>open/1</h3><h3>open/1</h3><h3>open/2</h3><p>Create an SCTP socket and binds it to local addresses.</p><p>Creates an SCTP socket and binds it to the local addresses
specified by all <strong>{ip,<span class="anno">IP</span>}</strong> (or synonymously
<strong>{ifaddr,<span class="anno">IP</span>}</strong>)
options (this feature is called SCTP multi-homing). The default
<strong><span class="anno">IP</span></strong> and <strong><span class="anno">Port</span></strong> are <strong>any</strong>
and <strong>0</strong>, meaning bind to all local addresses on any
free port.</p><p>Other options:</p><dl><dt><strong>inet6</strong></dt><dd> <p>Sets up the socket for IPv6.</p> </dd><dt><strong>inet</strong></dt><dd> <p>Sets up the socket for IPv4. This is the default.</p> </dd></dl><p>A default set of socket <a href="#options">options</a>
is used. In particular, the socket is opened in
<a href="#option-binary">binary</a> and
<a href="#option-active">passive</a> mode,
with <span class="anno">SockType</span> <strong>seqpacket</strong>, and with reasonably large
<a href="./inet#option-sndbuf">kernel</a> and driver
<a href="./inet#option-buffer">buffers</a>.</p><p>
If the socket is in
<a href="#option-active">passive</a>
mode data can be received through the
<a href="#recv/1">recv/1</a>
calls.
</p><p>
If the socket is in
<a href="#option-active">active</a>
mode data received data is delivered to the controlling process
as messages:
</p><pre><code class="">
{sctp, <span class="anno">Socket</span>, FromIP, FromPort, {AncData, Data}}
	</code></pre><p>
See
<a href="#recv/1">recv/1</a>
for a description of the message fields.
</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>
This message format unfortunately differs slightly from the
<a href="./gen_udp#open/1">gen_udp#open/1</a>
message format with ancillary data,
and from the
<a href="#recv/1">recv/1</a>
return tuple format.
</p></div><h3>peeloff/2</h3><p>Peel off a type <strong>stream</strong> socket from a type <strong>seqpacket</strong> one.</p><p>Branches off an existing association <strong><span class="anno">Assoc</span></strong>
in a socket <strong><span class="anno">Socket</span></strong> of type <strong>seqpacket</strong>
(one-to-many style) into
a new socket <strong><span class="anno">NewSocket</span></strong> of type <strong>stream</strong>
(one-to-one style).</p><p>The existing association argument <strong><span class="anno">Assoc</span></strong>
can be either a
<a href="#record-sctp_assoc_change">record-sctp_assoc_change</a>
record as returned from, for example,
<a href="#recv-2">recv-2</a>,
<a href="#connect-5">connect-5</a>, or
from a listening socket in active mode. It can also be just
the field <strong>assoc_id</strong> integer from such a record.</p><h3>recv/1</h3><h3>recv/2</h3><p>Receive a message from a socket.</p><p>Receives the <strong><span class="anno">Data</span></strong> message from any association
of the socket.
If the receive times out, <strong>{error,timeout}</strong> is returned.
The default time-out is <strong>infinity</strong>. <strong><span class="anno">FromIP</span></strong>
and <strong><span class="anno">FromPort</span></strong> indicate the address of the
sender.</p><p><strong><span class="anno">AncData</span></strong> is a list of ancillary data items that
can be received along with the main <strong><span class="anno">Data</span></strong>.
This list can be empty, or contain a single
<a href="#record-sctp_sndrcvinfo">record-sctp_sndrcvinfo</a>
record if receiving of such ancillary data is enabled (see option
<a href="#option-sctp_events">option-sctp_events</a>).
It is enabled by default, as such ancillary data
provides an easy way of determining the association and stream
over which the message is received.
(An alternative way is to get the association ID from
<strong><span class="anno">FromIP</span></strong> and <strong><span class="anno">FromPort</span></strong> using
socket option
<a href="#option-sctp_get_peer_addr_info">option-sctp_get_peer_addr_info</a>,
but this does still not produce the stream number).</p><p>
<strong><span class="anno">AncData</span></strong> may also contain
<a href="./inet#type-ancillary_data"> ancillary data </a>
from the socket
<a href="#type-option">options</a>
<a href="./inet#option-recvtos">inet#option-recvtos</a>,
<a href="./inet#option-recvtclass">inet#option-recvtclass</a>
or
<a href="./inet#option-recvttl">inet#option-recvttl</a>,
if that is supported by the platform for the socket.
</p><p>The <strong><span class="anno">Data</span></strong> received can be a <strong>binary()</strong>
or a <strong>list()</strong> of bytes (integers in the range 0 through 255)
depending on the socket mode, or an SCTP event.</p><a name="sctp_events"></a><p>Possible SCTP events:</p><ul><li> <a href="#record-sctp_sndrcvinfo">record-sctp_sndrcvinfo</a> </li><li> <a href="#record-sctp_assoc_change">record-sctp_assoc_change</a> </li><li> <pre>
#sctp_paddr_change{
      addr      = {ip_address(),port()},
      state     = atom(),
      error     = integer(),
      assoc_id  = assoc_id()
}</pre> <p>Indicates change of the status of the IP address of the peer
specified by
<strong>addr</strong> within association <strong>assoc_id</strong>. Possible
values of <strong>state</strong> (mostly self-explanatory) include:</p> <dl><dt><strong>addr_unreachable</strong></dt><dd></dd><dt><strong>addr_available</strong></dt><dd></dd><dt><strong>addr_removed</strong></dt><dd></dd><dt><strong>addr_added</strong></dt><dd></dd><dt><strong>addr_made_prim</strong></dt><dd></dd><dt><strong>addr_confirmed</strong></dt><dd></dd></dl> <p>In case of an error (for example, <strong>addr_unreachable</strong>),
field <strong>error</strong> provides more diagnostics. In such cases,
event <strong>#sctp_paddr_change{}</strong> is automatically
converted into an <strong>error</strong> term returned by
<a href="#recv/1">recv/1</a>.
The <strong>error</strong> field value can be converted into a string using
<a href="#error_string/1">error_string/1</a>.
</p> </li><li> <pre>
#sctp_send_failed{
      flags     = true | false,
      error     = integer(),
      info      = #sctp_sndrcvinfo{},
      assoc_id  = assoc_id()
      data      = binary()
}</pre> <p>The sender can receive this event if a send operation fails.</p> <dl><dt><strong>flags</strong></dt><dd><p>A Boolean specifying if the data has been transmitted
over the wire.</p></dd><dt><strong>error</strong></dt><dd><p>Provides extended diagnostics, use
<a href="#error_string/1">.</a></p> </dd><dt><strong>info</strong></dt><dd><p>The original
<a href="#record-sctp_sndrcvinfo">record-sctp_sndrcvinfo</a>
record used in the failed
<a href="#send/3">.</a></p> </dd><dt><strong>data</strong></dt><dd><p>The whole original data chunk attempted to be sent.</p> </dd></dl> <p>In the current implementation of the Erlang/SCTP binding,
this event is internally converted into an <strong>error</strong> term
returned by
<a href="#recv/1">recv/1</a>.</p> </li><li> <pre>
#sctp_adaptation_event{
      adaptation_ind = integer(),
      assoc_id       = assoc_id()
}</pre> <p>Delivered when a peer sends an adaptation layer indication
parameter (configured through option
<a href="#option-sctp_adaptation_layer">option-sctp_adaptation_layer</a>).
Notice that with the current implementation of
the Erlang/SCTP binding, this event is disabled by default.</p> </li><li> <pre>
#sctp_pdapi_event{
      indication = sctp_partial_delivery_aborted,
      assoc_id   = assoc_id()
}</pre> <p>A partial delivery failure. In the current implementation of
the Erlang/SCTP binding, this event is internally converted
into an <strong>error</strong> term returned by
<a href="#recv/1">recv/1</a>.</p> </li></ul><h3>send/3</h3><p>Send a message using an <strong>#sctp_sndrcvinfo{}</strong>record.</p><p>Sends the <strong><span class="anno">Data</span></strong> message with all sending
parameters from a
<a href="#record-sctp_sndrcvinfo">record-sctp_sndrcvinfo</a>
record. This way, the user can specify the PPID (passed to the remote
end) and context (passed to the local SCTP layer), which can be used,
for example, for error identification.
However, such a fine level of user control is rarely required.
The function <strong>send/4</strong> is sufficient for most applications.</p><h3>send/4</h3><p>Send a message over an existing association and specified stream.</p><p>Sends a <strong><span class="anno">Data</span></strong> message over an existing association
and specified stream.</p><a name="options"></a><h3>SCTP Socket Options</h3><p>The set of admissible SCTP socket options is by construction
orthogonal to the sets of TCP, UDP, and generic <strong>inet</strong> options.
Only options listed here are allowed
for SCTP sockets. Options can be set on the socket using
<a href="#open/1">open/1</a> or
<a href="./inet#setopts/2">inet#setopts/2</a>,
retrieved using
<a href="./inet#getopts/2">inet#getopts/2</a>.
Options can be changed when calling
<a href="#connect/4">connect/4</a>.</p><a name="option-binary"></a><a name="option-list"></a><dl><dt><strong>{mode, list|binary}</strong> or just <strong>list</strong> or <strong>binary</strong></dt><dd> <p>Determines the type of data returned from
<a href="#recv/1">recv/1</a>.</p> <a name="option-active"></a> </dd><dt><strong>{active, true|false|once|N}</strong></dt><dd> <ul><li> <p>If <strong>false</strong> (passive mode, the default),
the caller must do an explicit
<a href="#recv/1">recv/1</a> call
to retrieve the available data from the socket.</p> </li><li> <p>
If <strong>true|once|N</strong> (active modes)
received data or events are sent to the owning process.
See <a href="#open/0">open/0</a>
for the message format.
</p> </li><li> <p>
If <strong>true</strong> (full active mode) there is no flow control.
</p> <div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>
Note that this can cause the message queue to overflow
causing for example the virtual machine
to run out of memory and crash.
</p></div> </li><li> <p>If <strong>once</strong>, only one message is automatically placed
in the message queue, and after that the mode is automatically
reset to passive. This provides flow control and
the possibility for the receiver to listen for its incoming
SCTP data interleaved with other inter-process messages.</p> </li><li> <p>If <strong>active</strong> is specified as an integer <strong>N</strong> in the
range -32768 to 32767 (inclusive), that number is added to
the socket's counting of data messages to be
delivered to the controlling process. If the result of the
addition is negative, the count is set to <strong>0</strong>. Once the
count reaches <strong>0</strong>, either through the delivery of messages
or by being explicitly set with
<a href="./inet#setopts/2">inet#setopts/2</a>,
the socket mode is automatically reset to passive (<strong>{active, false}</strong>). When a socket in this active mode transitions to
passive mode, the message <strong>{sctp_passive, Socket}</strong> is sent
to the controlling process to notify it that if it wants to
receive more data messages from the socket, it must call
<a href="./inet#setopts/2">inet#setopts/2</a>
to set the socket back into an active mode.</p> </li></ul> </dd><dt><strong>{tos, integer()}</strong></dt><dd> <p>Sets the Type-Of-Service field on the IP datagrams that are sent,
to the specified value. This effectively determines a prioritization
policy for the outbound packets. The acceptable values
are system-dependent.</p> </dd><dt><strong>{priority, integer()}</strong></dt><dd> <p>A protocol-independent equivalent of <strong>tos</strong> above. Setting
priority implies setting <strong>tos</strong> as well.</p> </dd><dt><strong>{dontroute, true|false}</strong></dt><dd> <p>Defaults to <strong>false</strong>. If <strong>true</strong>, the kernel does not
send packets through any gateway, only sends them to directly
connected hosts.</p> </dd><dt><strong>{reuseaddr, true|false}</strong></dt><dd> <p>Defaults to <strong>false</strong>. If true, the local binding address
<strong>{IP,Port}</strong> of the socket can be reused immediately.
No waiting in state <strong>CLOSE_WAIT</strong> is performed (can  be
required for high-throughput servers).</p> </dd><dt><strong>{sndbuf, integer()}</strong></dt><dd> <p>The size, in bytes, of the OS kernel send buffer for this socket.
Sending errors would occur for datagrams larger than
<strong>val(sndbuf)</strong>. Setting this option also adjusts
the size of the driver buffer (see <strong>buffer</strong> above).</p> </dd><dt><strong>{recbuf, integer()}</strong></dt><dd> <p>The size, in bytes, of the OS kernel receive buffer for this socket.
Sending errors would occur for datagrams larger than
<strong>val(recbuf)</strong>. Setting this option also adjusts
the size of the driver buffer (see <strong>buffer</strong> above).</p> </dd><dt><strong>{sctp_module, module()}</strong></dt><dd> <p>Overrides which callback module is used. Defaults to
<strong>inet_sctp</strong> for IPv4 and <strong>inet6_sctp</strong> for IPv6.</p> </dd><dt><strong>{sctp_rtoinfo, #sctp_rtoinfo{}}</strong></dt><dd> <pre>
#sctp_rtoinfo{
      assoc_id = assoc_id(),
      initial  = integer(),
      max      = integer(),
      min      = integer()
}</pre> <p>Determines retransmission time-out parameters, in milliseconds,
for the association(s) specified by <strong>assoc_id</strong>.</p> <p><strong>assoc_id = 0</strong> (default) indicates the whole endpoint. See
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">RFC 2960</a> and
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions for SCTP</a>
for the exact semantics of the field values.</p> </dd><dt><strong>{sctp_associnfo, #sctp_assocparams{}}</strong></dt><dd> <pre>
#sctp_assocparams{
      assoc_id                 = assoc_id(),
      asocmaxrxt               = integer(),
      number_peer_destinations = integer(),
      peer_rwnd                = integer(),
      local_rwnd               = integer(),
      cookie_life              = integer()
}</pre> <p>Determines association parameters for the association(s) specified by
<strong>assoc_id</strong>.</p> <p><strong>assoc_id = 0</strong> (default) indicates the whole endpoint. See
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions for SCTP</a>
for the discussion of their semantics. Rarely used.</p> </dd><dt><strong>{sctp_initmsg, #sctp_initmsg{}}</strong></dt><dd> <pre>
#sctp_initmsg{
     num_ostreams   = integer(),
     max_instreams  = integer(),
     max_attempts   = integer(),
     max_init_timeo = integer()
}</pre> <p>Determines the default parameters that this socket tries
to negotiate with its peer while establishing an association with it.
Is to be set after
<a href="#open/1">open/1</a>
but before the first
<a href="#connect/4">connect/4</a>.
<strong>#sctp_initmsg{}</strong> can also be used
as ancillary data with the first call of
<a href="#send/3">send/3</a> to
a new peer (when a new association is created).</p> <dl><dt><strong>num_ostreams</strong></dt><dd>Number of outbound streams</dd><dt><strong>max_instreams</strong></dt><dd>Maximum number of inbound streams</dd><dt><strong>max_attempts</strong></dt><dd>Maximum retransmissions while establishing an association</dd><dt><strong>max_init_timeo</strong></dt><dd>Time-out, in milliseconds, for establishing an association</dd></dl> </dd><dt><strong>{sctp_autoclose, integer() &gt;= 0}</strong></dt><dd> <p>Determines the time, in seconds, after which an idle association is
automatically closed. <strong>0</strong> means that the association is
never automatically closed.</p> </dd><dt><strong>{sctp_nodelay, true|false}</strong></dt><dd> <p>Turns on|off the Nagle algorithm for merging small packets
into larger ones. This improves throughput at the expense
of latency.</p> </dd><dt><strong>{sctp_disable_fragments, true|false}</strong></dt><dd> <p>If <strong>true</strong>, induces an error on an attempt to send
a message larger than the current PMTU size
(which would require fragmentation/reassembling).
Notice that message fragmentation does not affect
the logical atomicity of its delivery; this option
is provided for performance reasons only.</p> </dd><dt><strong>{sctp_i_want_mapped_v4_addr, true|false}</strong></dt><dd> <p>Turns on|off automatic mapping of IPv4 addresses into IPv6 ones
(if the socket address family is <strong>AF_INET6</strong>).</p> </dd><dt><strong>{sctp_maxseg, integer()}</strong></dt><dd> <p>Determines the maximum chunk size if message fragmentation is used.
If <strong>0</strong>, the chunk size is limited by the Path MTU only.</p> </dd><dt><strong>{sctp_primary_addr, #sctp_prim{}}</strong></dt><dd> <pre>
#sctp_prim{
      assoc_id = assoc_id(),
      addr     = {IP, Port}
}
 IP = ip_address()
 Port = port_number()</pre> <p>For the association specified by <strong>assoc_id</strong>,
<strong>{IP,Port}</strong> must be one of the peer addresses.
This option determines that the specified address is treated by
the local SCTP stack as the primary address of the peer.</p> </dd><dt><strong>{sctp_set_peer_primary_addr, #sctp_setpeerprim{}}</strong></dt><dd> <pre>
#sctp_setpeerprim{
      assoc_id = assoc_id(),
      addr     = {IP, Port}
}
 IP = ip_address()
 Port = port_number()</pre> <p>When set, informs the peer to use <strong>{IP, Port}</strong>
as the primary address of the local endpoint for the association
specified by <strong>assoc_id</strong>.</p> <a name="option-sctp_adaptation_layer"></a> </dd><dt><strong>{sctp_adaptation_layer, #sctp_setadaptation{}}</strong></dt><dd> <a name="record-sctp_setadaptation"></a> <pre>
#sctp_setadaptation{
      adaptation_ind = integer()
}</pre> <p>When set, requests that the local endpoint uses the value specified
by <strong>adaptation_ind</strong> as the Adaptation Indication parameter for
establishing new associations. For details, see
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">RFC 2960</a>
and
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extenstions for SCTP</a>.</p> </dd><dt><strong>{sctp_peer_addr_params, #sctp_paddrparams{}}</strong></dt><dd> <pre>
#sctp_paddrparams{
      assoc_id   = assoc_id(),
      address    = {IP, Port},
      hbinterval = integer(),
      pathmaxrxt = integer(),
      pathmtu    = integer(),
      sackdelay  = integer(),
      flags      = list()
}
IP = ip_address()
Port = port_number()</pre> <p>Determines various per-address parameters for
the association specified by <strong>assoc_id</strong> and the peer address
<strong>address</strong> (the SCTP protocol supports multi-homing, so
more than one address can correspond to a specified association).</p> <dl><dt><strong>hbinterval</strong></dt><dd><p>Heartbeat interval, in milliseconds</p></dd><dt><strong>pathmaxrxt</strong></dt><dd><p>Maximum number of retransmissions before this address is
considered unreachable (and an alternative address is selected)</p> </dd><dt><strong>pathmtu</strong></dt><dd><p>Fixed Path MTU, if automatic discovery is disabled (see
<strong>flags</strong> below)</p></dd><dt><strong>sackdelay</strong></dt><dd><p>Delay, in milliseconds, for SAC messages (if the delay is
enabled, see <strong>flags</strong> below)</p></dd><dt><strong>flags</strong></dt><dd><p>The following flags are available:</p> <dl><dt><strong>hb_enable</strong></dt><dd>Enables heartbeat</dd><dt><strong>hb_disable</strong></dt><dd>Disables heartbeat</dd><dt><strong>hb_demand</strong></dt><dd>Initiates heartbeat immediately</dd><dt><strong>pmtud_enable</strong></dt><dd>Enables automatic Path MTU discovery</dd><dt><strong>pmtud_disable</strong></dt><dd>Disables automatic Path MTU discovery</dd><dt><strong>sackdelay_enable</strong></dt><dd>Enables SAC delay</dd><dt><strong>sackdelay_disable</strong></dt><dd>Disables SAC delay</dd></dl></dd></dl> </dd><dt><strong>{sctp_default_send_param, #sctp_sndrcvinfo{}}</strong></dt><dd> <a name="record-sctp_sndrcvinfo"></a> <pre>
#sctp_sndrcvinfo{
      stream     = integer(),
      ssn        = integer(),
      flags      = list(),
      ppid       = integer(),
      context    = integer(),
      timetolive = integer(),
      tsn        = integer(),
      cumtsn     = integer(),
      assoc_id   = assoc_id()
}</pre> <p><strong>#sctp_sndrcvinfo{}</strong> is used both in this socket option, and as
ancillary data while sending or receiving SCTP messages. When
set as an option, it provides default values for subsequent
<a href="#send/3">send/3</a>
calls on the association specified by
<strong>assoc_id</strong>.</p> <p><strong>assoc_id = 0</strong> (default) indicates
the whole endpoint.</p> <p>The following fields typically must be specified by the sender:</p> <dl><dt><strong>sinfo_stream</strong></dt><dd><p>Stream number (0-base) within the association
to send the messages through;</p></dd><dt><strong>sinfo_flags</strong></dt><dd><p>The following flags are recognised:</p> <dl><dt><strong>unordered</strong></dt><dd>The message is to be sent unordered</dd><dt><strong>addr_over</strong></dt><dd>The address specified in <a href="#send/3">send/3</a> overwrites the primary peer address</dd><dt><strong>abort</strong></dt><dd>Aborts the current association without flushing any unsent data</dd><dt><strong>eof</strong></dt><dd>Gracefully shuts down the current association, with flushing of unsent data</dd></dl> <p>Other fields are rarely used. For complete information, see
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">RFC 2960</a>
and
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions for SCTP</a>.</p></dd></dl> <a name="option-sctp_events"></a> </dd><dt><strong>{sctp_events, #sctp_event_subscribe{}}</strong></dt><dd> <a name="record-sctp_event_subscribe"></a> <pre>
#sctp_event_subscribe{
        data_io_event          = true | false,
        association_event      = true | false,
        address_event          = true | false,
        send_failure_event     = true | false,
        peer_error_event       = true | false,
        shutdown_event         = true | false,
        partial_delivery_event = true | false,
        adaptation_layer_event = true | false
}</pre> <p>This option determines which
<a href="#sctp_events">SCTP Events</a> are to be
received (through
<a href="#recv/1">recv/1</a>)
along with the data. The only exception is <strong>data_io_event</strong>,
which enables or disables receiving of
<a href="#record-sctp_sndrcvinfo">record-sctp_sndrcvinfo</a>
ancillary data, not events.
By default, all flags except <strong>adaptation_layer_event</strong> are
enabled, although <strong>sctp_data_io_event</strong> and
<strong>association_event</strong> are used by the driver itself and not
exported to the user level.</p> </dd><dt><strong>{sctp_delayed_ack_time, #sctp_assoc_value{}}</strong></dt><dd> <pre>
#sctp_assoc_value{
      assoc_id    = assoc_id(),
      assoc_value = integer()
}</pre> <p>Rarely used. Determines the ACK time
(specified by <strong>assoc_value</strong>, in milliseconds) for
the specified association or the whole endpoint
if <strong>assoc_value = 0</strong> (default).</p> </dd><dt><strong>{sctp_status, #sctp_status{}}</strong></dt><dd> <pre>
#sctp_status{
      assoc_id            = assoc_id(),
      state               = atom(),
      rwnd                = integer(),
      unackdata           = integer(),
      penddata            = integer(),
      instrms             = integer(),
      outstrms            = integer(),
      fragmentation_point = integer(),
      primary             = #sctp_paddrinfo{}
}</pre> <p>This option is read-only. It determines the status of
the SCTP association specified by <strong>assoc_id</strong>.
The following are the
possible values of <strong>state</strong> (the state designations are mostly
self-explanatory):</p> <dl><dt><strong>sctp_state_empty</strong></dt><dd>Default. Means that no other state is active.</dd><dt><strong>sctp_state_closed</strong></dt><dd></dd><dt><strong>sctp_state_cookie_wait</strong></dt><dd></dd><dt><strong>sctp_state_cookie_echoed</strong></dt><dd></dd><dt><strong>sctp_state_established</strong></dt><dd></dd><dt><strong>sctp_state_shutdown_pending</strong></dt><dd></dd><dt><strong>sctp_state_shutdown_sent</strong></dt><dd></dd><dt><strong>sctp_state_shutdown_received</strong></dt><dd></dd><dt><strong>sctp_state_shutdown_ack_sent</strong></dt><dd></dd></dl> <p>Semantics of the other fields:</p> <dl><dt><strong>sstat_rwnd</strong></dt><dd>Current receiver window size of the association</dd><dt><strong>sstat_unackdata</strong></dt><dd>Number of unacked data chunks</dd><dt><strong>sstat_penddata</strong></dt><dd>Number of data chunks pending receipt</dd><dt><strong>sstat_instrms</strong></dt><dd>Number of inbound streams</dd><dt><strong>sstat_outstrms</strong></dt><dd>Number of outbound streams</dd><dt><strong>sstat_fragmentation_point</strong></dt><dd>Message size at which SCTP fragmentation occurs</dd><dt><strong>sstat_primary</strong></dt><dd>Information on the current primary peer address (see below for the format of <strong>#sctp_paddrinfo{}</strong>)</dd></dl> <a name="option-sctp_get_peer_addr_info"></a> </dd><dt><strong>{sctp_get_peer_addr_info, #sctp_paddrinfo{}}</strong></dt><dd> <a name="record-sctp_paddrinfo"></a> <pre>
#sctp_paddrinfo{
      assoc_id  = assoc_id(),
      address   = {IP, Port},
      state     = inactive | active | unconfirmed,
      cwnd      = integer(),
      srtt      = integer(),
      rto       = integer(),
      mtu       = integer()
}
IP = ip_address()
Port = port_number()</pre> <p>This option is read-only. It determines the parameters specific to
the peer address specified by <strong>address</strong> within the association
specified by <strong>assoc_id</strong>. Field <strong>address</strong> fmust be set by the
caller; all other fields are filled in on return.
If <strong>assoc_id = 0</strong> (default), the <strong>address</strong>
is automatically translated into the corresponding
association ID. This option is rarely used.
For the semantics of all fields, see
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">RFC 2960</a>
and
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions for SCTP</a>.</p> </dd></dl><a name="examples"></a><h3>SCTP Examples</h3><p>Example of an Erlang SCTP server that receives SCTP messages and
prints them on the standard output:</p><pre>
-module(sctp_server).

-export([server/0,server/1,server/2]).
-include_lib("kernel/include/inet.hrl").
-include_lib("kernel/include/inet_sctp.hrl").

server() -&gt;
    server(any, 2006).

server([Host,Port]) when is_list(Host), is_list(Port) -&gt;
    {ok, #hostent{h_addr_list = [IP|_]}} = inet:gethostbyname(Host),
    io:format("~w -&gt; ~w~n", [Host, IP]),
    server([IP, list_to_integer(Port)]).

server(IP, Port) when is_tuple(IP) orelse IP == any orelse IP == loopback,
                      is_integer(Port) -&gt;
    {ok,S} = gen_sctp:open(Port, [{recbuf,65536}, {ip,IP}]),
    io:format("Listening on ~w:~w. ~w~n", [IP,Port,S]),
    ok     = gen_sctp:listen(S, true),
    server_loop(S).

server_loop(S) -&gt;
    case gen_sctp:recv(S) of
    {error, Error} -&gt;
        io:format("SCTP RECV ERROR: ~p~n", [Error]);
    Data -&gt;
        io:format("Received: ~p~n", [Data])
    end,
    server_loop(S).</pre><p>Example of an Erlang SCTP client interacting with the above server.
Notice that in this example the client creates an association with
the server with 5 outbound streams. Therefore, sending of
<strong>"Test 0"</strong> over stream 0 succeeds, but sending of <strong>"Test 5"</strong>
over stream 5 fails. The client then <strong>abort</strong>s the association,
which results in that the corresponding event is received on
the server side.</p><pre>
-module(sctp_client).

-export([client/0, client/1, client/2]).
-include_lib("kernel/include/inet.hrl").
-include_lib("kernel/include/inet_sctp.hrl").

client() -&gt;
    client([localhost]).

client([Host]) -&gt;
    client(Host, 2006);
 
client([Host, Port]) when is_list(Host), is_list(Port) -&gt;
    client(Host,list_to_integer(Port)),
    init:stop().

client(Host, Port) when is_integer(Port) -&gt;
    {ok,S}     = gen_sctp:open(),
    {ok,Assoc} = gen_sctp:connect
        (S, Host, Port, [{sctp_initmsg,#sctp_initmsg{num_ostreams=5}}]),
    io:format("Connection Successful, Assoc=~p~n", [Assoc]),

    io:write(gen_sctp:send(S, Assoc, 0, &lt;&lt;"Test 0"&gt;&gt;)),
    io:nl(),
    timer:sleep(10000),
    io:write(gen_sctp:send(S, Assoc, 5, &lt;&lt;"Test 5"&gt;&gt;)),
    io:nl(),
    timer:sleep(10000),
    io:write(gen_sctp:abort(S, Assoc)),
    io:nl(),

    timer:sleep(1000),
    gen_sctp:close(S).</pre><p>A simple Erlang SCTP client that uses the <strong>connect_init</strong> API:</p><pre>
-module(ex3).

-export([client/4]).
-include_lib("kernel/include/inet.hrl").
-include_lib("kernel/include/inet_sctp.hrl").

client(Peer1, Port1, Peer2, Port2)
  when is_tuple(Peer1), is_integer(Port1), is_tuple(Peer2), is_integer(Port2) -&gt;
    {ok,S}     = gen_sctp:open(),
    SctpInitMsgOpt = {sctp_initmsg,#sctp_initmsg{num_ostreams=5}},
    ActiveOpt = {active, true},
    Opts = [SctpInitMsgOpt, ActiveOpt],
    ok = gen_sctp:connect(S, Peer1, Port1, Opts),
    ok = gen_sctp:connect(S, Peer2, Port2, Opts),
    io:format("Connections initiated~n", []),
    client_loop(S, Peer1, Port1, undefined, Peer2, Port2, undefined).

client_loop(S, Peer1, Port1, AssocId1, Peer2, Port2, AssocId2) -&gt;
    receive
        {sctp, S, Peer1, Port1, {_Anc, SAC}}
          when is_record(SAC, sctp_assoc_change), AssocId1 == undefined -&gt;
            io:format("Association 1 connect result: ~p. AssocId: ~p~n",
                      [SAC#sctp_assoc_change.state,
                       SAC#sctp_assoc_change.assoc_id]),
            client_loop(S, Peer1, Port1, SAC#sctp_assoc_change.assoc_id,
                        Peer2, Port2, AssocId2);

        {sctp, S, Peer2, Port2, {_Anc, SAC}}
          when is_record(SAC, sctp_assoc_change), AssocId2 == undefined -&gt;
            io:format("Association 2 connect result: ~p. AssocId: ~p~n",
                      [SAC#sctp_assoc_change.state, SAC#sctp_assoc_change.assoc_id]),
            client_loop(S, Peer1, Port1, AssocId1, Peer2, Port2,
                       SAC#sctp_assoc_change.assoc_id);

        {sctp, S, Peer1, Port1, Data} -&gt;
            io:format("Association 1: received ~p~n", [Data]),
            client_loop(S, Peer1, Port1, AssocId1,
                        Peer2, Port2, AssocId2);

        {sctp, S, Peer2, Port2, Data} -&gt;
            io:format("Association 2: received ~p~n", [Data]),
            client_loop(S, Peer1, Port1, AssocId1,
                        Peer2, Port2, AssocId2);

        Other -&gt;
            io:format("Other ~p~n", [Other]),
            client_loop(S, Peer1, Port1, AssocId1,
                        Peer2, Port2, AssocId2)

    after 5000 -&gt;
            ok
    end.</pre><a name="seealso"></a><h3>See Also</h3><p><a href="gen_tcp">gen_tcp</a>,
<a href="gen_udp">gen_udp</a>,
<a href="inet">inet</a>,
<a href="http://www.rfc-archive.org/getrfc.php?rfc=2960">RFC 2960</a>
(Stream Control Transmission Protocol),
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">Sockets API Extensions for SCTP</a></p><h2>gen_tcp</h2><p>Interface to TCP/IP sockets.</p><p>This module provides functions for communicating
with sockets using the TCP/IP protocol.The following code fragment is a simple example of
a client connecting to a server at port 5678, transferring a
binary, and closing the connection:<pre><code class="">
client() -&gt;
    SomeHostInNet = "localhost", % to make it runnable on one machine
    {ok, Sock} = gen_tcp:connect(SomeHostInNet, 5678, 
                                 [binary, {packet, 0}]),
    ok = gen_tcp:send(Sock, "Some Data"),
    ok = gen_tcp:close(Sock).</code></pre>At the other end, a server is listening on port 5678, accepts
the connection, and receives the binary:<pre><code class="">
server() -&gt;
    {ok, LSock} = gen_tcp:listen(5678, [binary, {packet, 0}, 
                                        {active, false}]),
    {ok, Sock} = gen_tcp:accept(LSock),
    {ok, Bin} = do_recv(Sock, []),
    ok = gen_tcp:close(Sock),
    ok = gen_tcp:close(LSock),
    Bin.

do_recv(Sock, Bs) -&gt;
    case gen_tcp:recv(Sock, 0) of
        {ok, B} -&gt;
            do_recv(Sock, [Bs, B]);
        {error, closed} -&gt;
            {ok, list_to_binary(Bs)}
    end.</code></pre>For more examples, see section
<a href="#examples">Examples</a>.</p><h2>Data Types</h2><span class="name">option</span><span class="name">pktoptions_value</span><p>
If the platform implements the IPv4 option
<strong>IP_PKTOPTIONS</strong>, or the IPv6 option
<strong>IPV6_PKTOPTIONS</strong> or <strong>IPV6_2292PKTOPTIONS</strong> for the socket
this value is returned from
<a href="./inet#getopts/2">inet#getopts/2</a>
when called with the option name
<a href="#type-option_name">type-option_name</a>.
</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>
This option appears to be VERY Linux specific,
and its existence in future Linux kernel versions
is also worrying since the option is part of RFC 2292
which is since long (2003) obsoleted by RFC 3542
that <em>explicitly</em> removes this possibility to get
packet information from a stream socket.
For comparision: it has existed in FreeBSD but is now removed,
at least since FreeBSD 10.
</p></div><span class="name">option_name</span><span class="name">connect_option</span><span class="name">listen_option</span><span class="name">socket()</span><p>As returned by
<a href="#accept/1">accept/1</a> and
<a href="#connect/3">connect/3</a>.</p><a name="connect"></a><h2>Functions</h2><h3>accept/1</h3><h3>accept/2</h3><p>Accept an incoming connection request on a listening socket.</p><dl><dt>ListenSocket</dt><dd>Returned by <a href="#listen/2">listen/2</a>. </dd></dl><p>Accepts an incoming connection request on a listening socket.
<strong><span class="anno">Socket</span></strong> must be a socket returned from
<a href="#listen/2">listen/2</a>.
<strong><span class="anno">Timeout</span></strong> specifies a time-out value in
milliseconds. Defaults to <strong>infinity</strong>.</p><p>Returns:</p><ul><li><p><strong>{ok, <span class="anno">Socket</span>}</strong> if a connection is
established</p></li><li><p><strong>{error, closed}</strong> if <strong><span class="anno">ListenSocket</span></strong>
is closed</p></li><li><p><strong>{error, timeout}</strong> if no connection is established
within the specified time</p></li><li><p><strong>{error, system_limit}</strong> if all available ports in the
Erlang emulator are in use</p></li><li><p>A POSIX error value if something else goes wrong, see
<a href="inet">inet</a> for possible
error values</p></li></ul><p>Packets can be sent to the returned socket <strong><span class="anno">Socket</span></strong>
using
<a href="#send/2">send/2</a>.
Packets sent from the peer are delivered as messages (unless
<strong>{active, false}</strong> is specified in the option list for the
listening socket, in which case packets are retrieved by calling
<a href="#recv/2">recv/2</a>):</p><pre><code class="">
{tcp, Socket, Data}</code></pre><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The <strong>accept</strong> call does
<em>not</em> have to be issued from the socket owner
process. Using version 5.5.3 and higher of the emulator,
multiple simultaneous accept calls can be issued from
different processes, which allows for a pool of acceptor
processes handling incoming connections.</p></div><h3>close/1</h3><p>Close a TCP socket.</p><p>Closes a TCP socket.</p><p>Note that in most implementations of TCP, doing a <strong>close</strong> does
not guarantee that any data sent is delivered to the recipient before
the close is detected at the remote side. If you want to guarantee
delivery of the data to the recipient there are two common ways to
achieve this.</p><ul><li><p>Use <a href="#shutdown/2">shutdown/2</a> to signal that
no more data is to be sent and wait for the read side of the
socket to be closed.</p> </li><li><p>Use the socket option <a href="./inet#packet">inet#packet</a> (or something similar) to make
it possible for the receiver to close the connection when it
knowns it has received all the data.</p> </li></ul><h3>connect/3</h3><h3>connect/4</h3><p>Connect to a TCP port.</p><p>Connects to a server on TCP port <strong><span class="anno">Port</span></strong> on the host
with IP address <strong><span class="anno">Address</span></strong>. Argument
<strong><span class="anno">Address</span></strong> can be a hostname or an IP address.</p><p>The following options are available:</p><dl><dt><strong>{ip, Address}</strong></dt><dd><p>If the host has many network interfaces, this option
specifies which one to use.</p></dd><dt><strong>{ifaddr, Address}</strong></dt><dd><p>Same as <strong>{ip, Address}</strong>. If the host has many
network interfaces, this option specifies which one to use.</p> </dd><dt><strong>{fd, integer() &gt;= 0}</strong></dt><dd><p>If a socket has somehow been connected without using
<strong>gen_tcp</strong>, use this option to pass the file descriptor
for it. If <strong>{ip, Address}</strong> and/or
<strong>{port, port_number()}</strong> is combined with this option,  the
<strong>fd</strong> is bound to the specified interface and port before
connecting. If these options are not specified, it is assumed that
the <strong>fd</strong> is already bound appropriately.</p></dd><dt><strong>inet</strong></dt><dd><p>Sets up the socket for IPv4.</p></dd><dt><strong>inet6</strong></dt><dd><p>Sets up the socket for IPv6.</p></dd><dt><strong>local</strong></dt><dd> <p>
Sets up a Unix Domain Socket. See
<a href="./inet#type-local_address">inet#type-local_address</a>
</p> </dd><dt><strong>{port, Port}</strong></dt><dd><p>Specifies which local port number to use.</p></dd><dt><strong>{tcp_module, module()}</strong></dt><dd><p>Overrides which callback module is used. Defaults to
<strong>inet_tcp</strong> for IPv4 and <strong>inet6_tcp</strong> for IPv6.</p></dd><dt><strong>Opt</strong></dt><dd><p>See
<a href="./inet#setopts/2">inet#setopts/2</a>.</p> </dd></dl><p>Packets can be sent to the returned socket <strong><span class="anno">Socket</span></strong>
using <a href="#send/2">send/2</a>.
Packets sent from the peer are delivered as messages:</p><pre><code class="">
{tcp, Socket, Data}</code></pre><p>If the socket is in <strong>{active, N}</strong> mode (see
<a href="./inet#setopts/2">inet#setopts/2</a>
for details) and its message counter drops to <strong>0</strong>, the following
message is delivered to indicate that the
socket has transitioned to passive (<strong>{active, false}</strong>) mode:</p><pre><code class="">
{tcp_passive, Socket}</code></pre><p>If the socket is closed, the following message is delivered:</p><pre><code class="">
{tcp_closed, Socket}</code></pre><p>If an error occurs on the socket, the following message is delivered
(unless <strong>{active, false}</strong> is specified in the option list for
the socket, in which case packets are retrieved by calling
<a href="#recv/2">recv/2</a>):</p><pre><code class="">
{tcp_error, Socket, Reason}</code></pre><p>The optional <strong><span class="anno">Timeout</span></strong> parameter specifies a
time-out in milliseconds. Defaults to <strong>infinity</strong>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Keep in mind that if the underlying OS <strong>connect()</strong> call returns
a timeout, <strong>gen_tcp:connect</strong> will also return a timeout
(i.e. <strong>{error, etimedout}</strong>), even if a larger <strong>Timeout</strong> was
specified.</p></div><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The default values for options specified to <strong>connect</strong> can
be affected by the Kernel configuration parameter
<strong>inet_default_connect_options</strong>. For details, see
<a href="inet">inet</a>.</p></div><h3>controlling_process/2</h3><p>Change controlling process of a socket.</p><p>Assigns a new controlling process <strong><span class="anno">Pid</span></strong> to
<strong><span class="anno">Socket</span></strong>. The controlling process is the process
that receives messages from the socket. If called by any other
process than the current controlling process,
<strong>{error, not_owner}</strong> is returned. If the process identified
by <strong><span class="anno">Pid</span></strong> is not an existing local pid,
<strong>{error, badarg}</strong> is returned. <strong>{error, badarg}</strong> may also
be returned in some cases when <strong><span class="anno">Socket</span></strong> is closed
during the execution of this function.</p><p>If the socket is set in active mode, this function
will transfer any messages in the mailbox of the caller
to the new controlling process.
If any other process is interacting with the socket while
the transfer is happening, the transfer may not work correctly
and messages may remain in the caller's mailbox. For instance
changing the sockets active mode before the transfere is complete
may cause this.</p><h3>listen/2</h3><p>Set up a socket to listen on a port.</p><p>Sets up a socket to listen on port <strong><span class="anno">Port</span></strong> on
the local host.</p><p>If <strong><span class="anno">Port</span> == 0</strong>, the underlying OS assigns an
available port number, use
<a href="./inet#port/1">inet#port/1</a>
to retrieve it.</p><p>The following options are available:</p><dl><dt><strong>list</strong></dt><dd><p>Received <strong>Packet</strong> is delivered as a list.</p></dd><dt><strong>binary</strong></dt><dd><p>Received <strong>Packet</strong> is delivered as a binary.</p></dd><dt><strong>{backlog, B}</strong></dt><dd><p><strong>B</strong> is an integer &gt;= <strong>0</strong>. The backlog value
defines the maximum length that the queue of pending connections
can grow to. Defaults to <strong>5</strong>.</p></dd><dt><strong>{ip, Address}</strong></dt><dd><p>If the host has many network interfaces, this option
specifies which one to listen on.</p></dd><dt><strong>{port, Port}</strong></dt><dd><p>Specifies which local port number to use.</p></dd><dt><strong>{fd, Fd}</strong></dt><dd><p>If a socket has somehow been connected without using
<strong>gen_tcp</strong>, use this option to pass the file
descriptor for it.</p></dd><dt><strong>{ifaddr, Address}</strong></dt><dd><p>Same as <strong>{ip, Address}</strong>. If the host has many
network interfaces, this option specifies which one to use.</p> </dd><dt><strong>inet6</strong></dt><dd><p>Sets up the socket for IPv6.</p></dd><dt><strong>inet</strong></dt><dd><p>Sets up the socket for IPv4.</p></dd><dt><strong>{tcp_module, module()}</strong></dt><dd><p>Overrides which callback module is used. Defaults to
<strong>inet_tcp</strong> for IPv4 and <strong>inet6_tcp</strong> for IPv6.</p></dd><dt><strong>Opt</strong></dt><dd><p>See
<a href="./inet#setopts/2">inet#setopts/2</a>.
</p></dd></dl><p>The returned socket <strong><span class="anno">ListenSocket</span></strong> should be used
in calls to <a href="#accept/1">accept/1</a> to
accept incoming connection requests.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The default values for options specified to <strong>listen</strong> can
be affected by the Kernel configuration parameter
<strong>inet_default_listen_options</strong>. For details, see
<a href="inet">inet</a>.</p></div><h3>recv/2</h3><h3>recv/3</h3><p>Receive a packet from a passive socket.</p><dl><dt>HttpPacket</dt><dd>See the description of <strong>HttpPacket</strong> in <a href="../erts/erlang#decode_packet/3">erts/erlang#decode_packet/3</a> in ERTS. </dd></dl><p>Receives a packet from a socket in passive
mode. A closed socket is indicated by return value
<strong>{error, closed}</strong>.</p><p>Argument <strong><span class="anno">Length</span></strong> is only meaningful when
the socket is in <strong>raw</strong> mode and denotes the number of
bytes to read. If <strong><span class="anno">Length</span></strong> is <strong>0</strong>, all
available bytes are returned.
If <strong><span class="anno">Length</span></strong> &gt; <strong>0</strong>, exactly
<strong><span class="anno">Length</span></strong> bytes are returned, or an error;
possibly discarding less than <strong><span class="anno">Length</span></strong> bytes of
data when the socket is closed from the other side.</p><p>The optional <strong><span class="anno">Timeout</span></strong> parameter specifies a
time-out in milliseconds. Defaults to <strong>infinity</strong>.</p><h3>send/2</h3><p>Send a packet.</p><p>Sends a packet on a socket.</p><p>There is no <strong>send</strong> call with a time-out option, use socket
option <strong>send_timeout</strong> if time-outs are desired. See section
<a href="#examples">Examples</a>.</p><h3>shutdown/2</h3><p>Asynchronously close a socket.</p><p>Closes a socket in one or two directions.</p><p><strong><span class="anno">How</span> == write</strong> means closing the socket for
writing, reading from it is still possible.</p><p>If <strong><span class="anno">How</span> == read</strong> or there is no outgoing
data buffered in the <strong><span class="anno">Socket</span></strong> port,
the socket is shut down immediately and any error encountered
is returned in <strong><span class="anno">Reason</span></strong>.</p><p>If there is data buffered in the socket port, the attempt
to shutdown the socket is postponed until that data is written to the
kernel socket send buffer. If any errors are encountered, the socket
is closed and <strong>{error, closed}</strong> is returned on the next
<a href="#recv/2">recv/2</a> or
<a href="#send/2">send/2</a>.</p><p>Option <strong>{exit_on_close, false}</strong> is useful if the peer has done
a shutdown on the write side.</p><h3>Examples</h3><a name="examples"></a><p>The following example illustrates use of option
<strong>{active,once}</strong> and multiple accepts by implementing a server
as a number of worker processes doing accept on a single listening
socket. Function <strong>start/2</strong> takes the number of worker
processes and the port number on which to listen for incoming
connections. If <strong>LPort</strong> is specified as <strong>0</strong>, an
ephemeral port number is used, which is why the start function
returns the actual port number allocated:</p><pre><code class="">
start(Num,LPort) -&gt;
    case gen_tcp:listen(LPort,[{active, false},{packet,2}]) of
        {ok, ListenSock} -&gt;
            start_servers(Num,ListenSock),
            {ok, Port} = inet:port(ListenSock),
            Port;
        {error,Reason} -&gt;
            {error,Reason}
    end.

start_servers(0,_) -&gt;
    ok;
start_servers(Num,LS) -&gt;
    spawn(?MODULE,server,[LS]),
    start_servers(Num-1,LS).

server(LS) -&gt;
    case gen_tcp:accept(LS) of
        {ok,S} -&gt;
            loop(S),
            server(LS);
        Other -&gt;
            io:format("accept returned ~w - goodbye!~n",[Other]),
            ok
    end.

loop(S) -&gt;
    inet:setopts(S,[{active,once}]),
    receive
        {tcp,S,Data} -&gt;
            Answer = process(Data), % Not implemented in this example
            gen_tcp:send(S,Answer),
            loop(S);
        {tcp_closed,S} -&gt;
            io:format("Socket ~w closed [~w]~n",[S,self()]),
            ok
    end.</code></pre><p>Example of a simple client:</p><pre><code class="">
client(PortNo,Message) -&gt;
    {ok,Sock} = gen_tcp:connect("localhost",PortNo,[{active,false},
                                                    {packet,2}]),
    gen_tcp:send(Sock,Message),
    A = gen_tcp:recv(Sock,0),
    gen_tcp:close(Sock),
    A.</code></pre><p>The <strong>send</strong> call does not accept a time-out
option because time-outs on send is handled through socket
option <strong>send_timeout</strong>. The behavior of a send operation with
no receiver is mainly defined by the underlying TCP
stack and the network infrastructure. To write
code that handles a hanging receiver that can eventually cause
the sender to hang on a <strong>send</strong> do like the following.</p><p>Consider a process that receives data from a client process
to be forwarded to a server on the network. The process is
connected to the server through TCP/IP and does not get any acknowledge
for each message it sends, but has to rely on the send time-out
option to detect that the other end is unresponsive. Option
<strong>send_timeout</strong> can be used when connecting:</p><pre><code class="">
...
{ok,Sock} = gen_tcp:connect(HostAddress, Port,
                            [{active,false},
                             {send_timeout, 5000},
                             {packet,2}]),
                loop(Sock), % See below
...</code></pre><p>In the loop where requests are handled, send time-outs can now be
detected:</p><pre><code class="">
loop(Sock) -&gt;
    receive
        {Client, send_data, Binary} -&gt;
            case gen_tcp:send(Sock,[Binary]) of
                {error, timeout} -&gt;
                    io:format("Send timeout, closing!~n",
                              []),
                    handle_send_timeout(), % Not implemented here
                    Client ! {self(),{error_sending, timeout}},
                    %% Usually, it's a good idea to give up in case of a 
                    %% send timeout, as you never know how much actually 
                    %% reached the server, maybe only a packet header?!
                    gen_tcp:close(Sock);
                {error, OtherSendError} -&gt;
                    io:format("Some other error on socket (~p), closing",
                              [OtherSendError]),
                    Client ! {self(),{error_sending, OtherSendError}},
                    gen_tcp:close(Sock);
                ok -&gt;
                    Client ! {self(), data_sent},
                    loop(Sock)
            end
    end.</code></pre><p>Usually it suffices to detect time-outs on receive, as most
protocols include some sort of acknowledgment from the server,
but if the protocol is strictly one way, option <strong>send_timeout</strong>
comes in handy.</p><h2>gen_udp</h2><p>Interface to UDP sockets.</p><p>This module provides functions for communicating
with sockets using the UDP protocol.</p><h2>Data Types</h2><span class="name">option</span><span class="name">option_name</span><span class="name">socket()</span><p>As returned by
<a href="#open/1">open/1</a>.</p><h2>Functions</h2><h3>close/1</h3><p>Close a UDP socket.</p><p>Closes a UDP socket.</p><h3>controlling_process/2</h3><p>Change controlling process of a socket.</p><p>Assigns a new controlling process <strong><span class="anno">Pid</span></strong> to
<strong><span class="anno">Socket</span></strong>. The controlling process is the process
that receives messages from the socket. If called by any other
process than the current controlling process,
<strong>{error, not_owner}</strong> is returned. If the process identified
by <strong><span class="anno">Pid</span></strong> is not an existing local pid,
<strong>{error, badarg}</strong> is returned. <strong>{error, badarg}</strong> may also
be returned in some cases when <strong><span class="anno">Socket</span></strong> is closed
during the execution of this function.</p><h3>open/1</h3><h3>open/2</h3><p>Associate a UDP port number with the process calling it.</p><p>Associates a UDP port number (<strong><span class="anno">Port</span></strong>) with the
calling process.</p><p>The following options are available:</p><dl><dt><strong>list</strong></dt><dd><p>Received <strong>Packet</strong> is delivered as a list.</p></dd><dt><strong>binary</strong></dt><dd><p>Received <strong>Packet</strong> is delivered as a binary.</p></dd><dt><strong>{ip, Address}</strong></dt><dd><p>If the host has many network interfaces, this option
specifies which one to use.</p></dd><dt><strong>{ifaddr, Address}</strong></dt><dd><p>Same as <strong>{ip, Address}</strong>. If the host has many
network interfaces, this option specifies which one to
use.</p></dd><dt><strong>{fd, integer() &gt;= 0}</strong></dt><dd><p>If a socket has somehow been opened without using
<strong>gen_udp</strong>, use this option to pass the file descriptor
for it. If <strong><span class="anno">Port</span></strong> is not set to <strong>0</strong> and/or
<strong>{ip, ip_address()}</strong> is combined with this option, the
<strong>fd</strong> is bound to the specified interface and port after it is
being opened. If these options are not specified, it is assumed that
the <strong>fd</strong> is already bound appropriately.</p></dd><dt><strong>inet6</strong></dt><dd><p>Sets up the socket for IPv6.</p></dd><dt><strong>inet</strong></dt><dd><p>Sets up the socket for IPv4.</p></dd><dt><strong>local</strong></dt><dd> <p>
Sets up a Unix Domain Socket. See
<a href="./inet#type-local_address">inet#type-local_address</a>
</p> </dd><dt><strong>{udp_module, module()}</strong></dt><dd><p>Overrides which callback module is used. Defaults to
<strong>inet_udp</strong> for IPv4 and <strong>inet6_udp</strong> for IPv6.</p></dd><dt><strong>{multicast_if, Address}</strong></dt><dd><p>Sets the local device for a multicast socket.</p></dd><dt><strong>{multicast_loop, true | false}</strong></dt><dd><p>When <strong>true</strong>, sent multicast packets are looped back to
the local sockets.</p></dd><dt><strong>{multicast_ttl, Integer}</strong></dt><dd><p>Option <strong>multicast_ttl</strong> changes the time-to-live (TTL)
for outgoing multicast datagrams to control the scope of the
multicasts.</p> <p>Datagrams with a TTL of 1 are not forwarded beyond the local
network. Defaults to <strong>1</strong>.</p></dd><dt><strong>{add_membership, {MultiAddress, InterfaceAddress}}</strong></dt><dd><p>Joins a multicast group.</p></dd><dt><strong>{drop_membership, {MultiAddress, InterfaceAddress}}</strong></dt><dd><p>Leaves a multicast group.</p></dd><dt><strong>Opt</strong></dt><dd><p>See
<a href="./inet#setopts/2">inet#setopts/2</a>.
</p></dd></dl><p>The returned socket <strong><span class="anno">Socket</span></strong> is used to send
packets from this port with
<a href="#send/4">send/4</a>.
When UDP packets arrive
at the opened port, if the socket is in an active mode, the packets
are delivered as messages to the controlling process:</p><pre><code class="">
{udp, Socket, IP, InPortNo, Packet} % Without ancillary data
{udp, Socket, IP, InPortNo, AncData, Packet} % With ancillary data
	</code></pre><p>
The message contains an <strong>AncData</strong> field
if any of the socket
<a href="#type-option">options</a>
<a href="./inet#option-recvtos">inet#option-recvtos</a>,
<a href="./inet#option-recvtclass">inet#option-recvtclass</a>
or
<a href="./inet#option-recvttl">inet#option-recvttl</a>
are active, otherwise it does not.
</p><p>
</p><p>If the socket is not in an active mode, data can be
retrieved through the
<a href="#recv/2">recv/2</a> calls.
Notice that arriving UDP packets that are longer than
the receive buffer option specifies can be truncated
without warning.</p><p>When a socket in <strong>{active, N}</strong> mode (see
<a href="./inet#setopts/2">inet#setopts/2</a>
for details), transitions to passive (<strong>{active, false}</strong>) mode,
the controlling process is notified by a message of the following
form:</p><pre><code class="">
{udp_passive, Socket}</code></pre><p><strong>IP</strong> and <strong>InPortNo</strong> define the address from which
<strong>Packet</strong> comes. <strong>Packet</strong> is a list of bytes if
option <strong>list</strong> is specified. <strong>Packet</strong> is a
binary if option <strong>binary</strong> is specified.</p><p>Default value for the receive buffer option is
<strong>{recbuf, 8192}</strong>.</p><p>If <strong><span class="anno">Port</span> == 0</strong>, the underlying OS assigns a free
UDP port, use
<a href="./inet#port/1">inet#port/1</a>
to retrieve it.</p><h3>recv/2</h3><h3>recv/3</h3><p>Receive a packet from a passive socket.</p><p>
Receives a packet from a socket in passive mode. Optional parameter
<strong><span class="anno">Timeout</span></strong> specifies a time-out in milliseconds.
Defaults to <strong>infinity</strong>.
</p><p>
If any of the socket
<a href="#type-option">options</a>
<a href="./inet#option-recvtos">inet#option-recvtos</a>,
<a href="./inet#option-recvtclass">inet#option-recvtclass</a>
or
<a href="./inet#option-recvttl">inet#option-recvttl</a>
are active, the <strong><span class="anno">RecvData</span></strong> tuple contains an
<strong><span class="anno">AncData</span></strong> field,
otherwise it does not.
</p><h3>send/4</h3><p>Send a packet.</p><p>
Sends a packet to the specified address and port. Argument
<strong><span class="anno">Address</span></strong> can be a hostname or a socket address.
</p><h2>global</h2><p>A global name registration facility.</p><p>This module consists of the following services:<ul><li>Registration of global names</li><li>Global locks</li><li>Maintenance of the fully connected network</li></ul>These services are controlled through the process
<strong>global_name_server</strong> that exists on every node. The global
name server starts automatically when a node is started.
With the term <em>global</em> is meant over a system consisting
of many Erlang nodes.The ability to globally register names is a central concept in
the programming of distributed Erlang systems. In this module,
the equivalent of the <strong>register/2</strong> and <strong>whereis/1</strong>
BIFs (for local name registration) are provided, but for a
network of Erlang nodes. A registered name is an alias for a
process identifier (pid). The global name server monitors
globally registered pids. If a process terminates, the name is
also globally unregistered.The registered names are stored in replica global name tables on
every node. There is no central storage point. Thus,
the translation of a name to a pid is fast, as it is always done
locally. For any action resulting in a change to the global name table,
all tables on other nodes are automatically updated.Global locks have lock identities and are set on a specific
resource. For example, the specified resource can be a pid.
When a global lock is set, access to the locked resource is
denied for all resources other than the lock requester.Both the registration and lock services are atomic.
All nodes involved in these actions have the same view of
the information.The global name server also performs the critical task of
continuously monitoring changes in node configuration. If a node
that runs a globally registered process goes down, the name
is globally unregistered. To this end, the global name
server subscribes to <strong>nodeup</strong> and <strong>nodedown</strong> messages
sent from module <strong>net_kernel</strong>. Relevant Kernel
application variables in this context are <strong>net_setuptime</strong>,
<strong>net_ticktime</strong>, and <strong>dist_auto_connect</strong>. See also
<a href="./kernel_app#net_setuptime">kernel_app#net_setuptime</a>.The name server also maintains a fully connected network. For
example, if node <strong>N1</strong> connects to node <strong>N2</strong> (which is
already connected to <strong>N3</strong>), the global name servers on the
nodes <strong>N1</strong> and <strong>N3</strong> ensure that also <strong>N1</strong>
and <strong>N3</strong> are connected. If this is not desired,
command-line flag <strong>-connect_all false</strong> can be used (see also
<a href="../erts/erl#connect_all">erts/erl#connect_all</a>).
In this case, the name registration service cannot be used, but the
lock mechanism still works.If the global name server fails to connect nodes (<strong>N1</strong> and
<strong>N3</strong> in the example), a warning event is sent to the
error logger. The presence of such an event does not exclude the
nodes to connect later (you can, for
example, try command <strong>rpc:call(N1, net_adm, ping, [N2])</strong> in
the Erlang shell), but it indicates a network problem.</p><h2>Data Types</h2><span class="name">id</span><h2>Functions</h2><h3>del_lock/1</h3><h3>del_lock/2</h3><p>Delete a lock.</p><p>Deletes the lock <strong><span class="anno">Id</span></strong> synchronously.</p><h3>notify_all_name/3</h3><p>Name resolving function that notifies both pids.</p><p>Can be used as a name resolving function for
<a href="#register_name/3">register_name/3</a>
and
<a href="#re_register_name/3">re_register_name/3</a>.</p><p>The function unregisters both pids and sends the message
<strong>{global_name_conflict, <span class="anno">Name</span>, OtherPid}</strong> to both
processes.</p><h3>random_exit_name/3</h3><p>Name resolving function that kills one pid.</p><p>Can be used as a name resolving function for
<a href="#register_name/3">register_name/3</a>
and
<a href="#re_register_name/3">re_register_name/3</a>.</p><p>The function randomly selects one of the pids for registration and
kills the other one.</p><h3>random_notify_name/3</h3><p>Name resolving function that notifies one pid.</p><p>Can be used as a name resolving function for
<a href="#register_name/3">register_name/3</a>
and
<a href="#re_register_name/3">re_register_name/3</a>.</p><p>The function randomly selects one of the pids for registration, and
sends the message <strong>{global_name_conflict, <span class="anno">Name</span>}</strong> to
the other pid.</p><h3>re_register_name/2</h3><h3>re_register_name/3</h3><p>Atomically re-register a name.</p><ul><li>method</li></ul>{<strong>Module</strong>, <strong>Function</strong>} is also allowed. <p>Atomically changes the registered name <strong><span class="anno">Name</span></strong> on
all nodes to refer to <strong><span class="anno">Pid</span></strong>.</p><p>Function <strong><span class="anno">Resolve</span></strong> has the same behavior as in
<a href="#register_name/2">register_name/2</a>.
</p><h3>register_name/2</h3><h3>register_name/3</h3><p>Globally register a name for a pid.</p><ul><li>method</li></ul>{<strong>Module</strong>, <strong>Function</strong>} is also allowed for backward compatibility, but its use is deprecated. <p>Globally associates name <strong><span class="anno">Name</span></strong> with a pid, that
is, globally notifies all nodes of a new global name in a network
of Erlang nodes.</p><p>When new nodes are added to the network, they are informed
of the globally registered names that already exist.
The network is also informed of any global names in newly
connected nodes. If any name clashes are discovered,
function <strong><span class="anno">Resolve</span></strong> is called. Its purpose is to
decide which pid is correct. If the function crashes, or
returns anything other than one of the pids, the name is
unregistered. This function is called once for each name
clash.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>If you plan to change code without restarting your system,
you must use an external fun (<strong>fun Module:Function/Arity</strong>)
as function <strong><span class="anno">Resolve</span></strong>. If you use a
local fun, you can never replace the code for the module that
the fun belongs to.</p></div><p>Three predefined resolve functions exist:
<strong>random_exit_name/3</strong>, <strong>random_notify_name/3</strong>, and
<strong>notify_all_name/3</strong>. If no <strong><span class="anno">Resolve</span></strong> function
is defined, <strong>random_exit_name</strong> is used. This means that one
of the two registered processes is selected as correct
while the other is killed.</p><p>This function is completely synchronous, that is,
when this function returns, the name is either registered on
all nodes or none.</p><p>The function returns <strong>yes</strong> if successful, <strong>no</strong> if
it fails. For example, <strong>no</strong> is returned if an attempt
is made to register an already registered process or to
register a process with a name that is already in use.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Releases up to and including Erlang/OTP R10 did not check if the
process was already registered. The global name table could
therefore become inconsistent. The old
(buggy) behavior can be chosen by giving the Kernel
application variable <strong>global_multi_name_action</strong> the
value <strong>allow</strong>.</p></div><p>If a process with a registered name dies, or the node goes
down, the name is unregistered on all nodes.</p><h3>registered_names/0</h3><p>All globally registered names.</p><p>Returns a list of all globally registered names.</p><h3>send/2</h3><p>Send a message to a globally registered pid.</p><p>Sends message <strong><span class="anno">Msg</span></strong> to the pid globally registered
as <strong><span class="anno">Name</span></strong>.</p><p>If <strong><span class="anno">Name</span></strong> is not a globally registered
name, the calling function exits with reason
<strong>{badarg, {<span class="anno">Name</span>, <span class="anno">Msg</span>}}</strong>.</p><h3>set_lock/1</h3><h3>set_lock/2</h3><h3>set_lock/3</h3><p>Set a lock on the specified nodes.</p><ul><li>id</li></ul><ul><li>retries</li></ul><p>Sets a lock on the specified nodes (or on all nodes if none
are specified) on <strong><span class="anno">ResourceId</span></strong> for
<strong><span class="anno">LockRequesterId</span></strong>. If a lock already exists on
<strong><span class="anno">ResourceId</span></strong> for another requester than
<strong><span class="anno">LockRequesterId</span></strong>, and <strong><span class="anno">Retries</span></strong>
is not equal to <strong>0</strong>, the process sleeps for a while and tries
to execute the action later. When <strong><span class="anno">Retries</span></strong>
attempts have been made, <strong>false</strong> is returned, otherwise
<strong>true</strong>. If <strong><span class="anno">Retries</span></strong> is <strong>infinity</strong>,
<strong>true</strong> is eventually returned (unless the lock is never
released).</p><p>If no value for <strong><span class="anno">Retries</span></strong> is specified,
<strong>infinity</strong> is used.</p><p>This function is completely synchronous.</p><p>If a process that holds a lock dies, or the node goes
down, the locks held by the process are deleted.</p><p>The global name server keeps track of all processes sharing
the same lock, that is, if two processes set the same lock,
both processes must delete the lock.</p><p>This function does not address the problem of a deadlock. A
deadlock can never occur as long as processes only lock one
resource at a time. A deadlock can occur if some processes
try to lock two or more resources. It is up to the
application to detect and rectify a deadlock.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Avoid the following values of <strong><span class="anno">ResourceId</span></strong>,
otherwise Erlang/OTP does not work properly:</p><ul><li><strong>dist_ac</strong></li><li><strong>global</strong></li><li><strong>mnesia_adjust_log_writes</strong></li><li><strong>mnesia_table_lock</strong></li><li><strong>pg2</strong></li></ul></div><h3>sync/0</h3><p>Synchronize the global name server.</p><p>Synchronizes the global name server with all nodes known to
this node. These are the nodes that are returned from
<strong>erlang:nodes()</strong>. When this function returns,
the global name server receives global information from
all nodes. This function can be called when new nodes are
added to the network.</p><p>The only possible error reason <strong>Reason</strong> is
<strong>{"global_groups definition error", Error}</strong>.</p><h3>trans/2</h3><h3>trans/3</h3><h3>trans/4</h3><p>Micro transaction facility.</p><ul><li>retries</li></ul><ul><li>trans_fun</li></ul><p>Sets a lock on <strong><span class="anno">Id</span></strong> (using
<a href="#set_lock/3">set_lock/3</a>).
If this succeeds, <strong><span class="anno">Fun</span>()</strong> is evaluated and the
result <strong><span class="anno">Res</span></strong>
is returned. Returns <strong>aborted</strong> if the lock attempt fails.
If <strong><span class="anno">Retries</span></strong> is set to <strong>infinity</strong>,
the transaction does not abort.</p><p><strong>infinity</strong> is the default setting and is used if
no value is specified for <strong><span class="anno">Retries</span></strong>.</p><h3>unregister_name/1</h3><p>Remove a globally registered name for a pid.</p><p>Removes the globally registered name <strong><span class="anno">Name</span></strong> from
the network of Erlang nodes.</p><h3>whereis_name/1</h3><p>Get the pid with a specified globally registered name.</p><p>Returns the pid with the globally registered name
<strong><span class="anno">Name</span></strong>. Returns <strong>undefined</strong> if the name is not
globally registered.</p><h3>See Also</h3><p><a href="global_group">global_group</a>,
<a href="net_kernel">net_kernel</a></p><h2>global_group</h2><p>Grouping nodes to global name registration groups.</p><p>This module makes it possible to partition the nodes of a
system into <em>global groups</em>. Each global group has its own
global namespace, see <a href="global">global</a>.The main advantage of dividing systems into global groups is that
the background load decreases while the number of nodes to be
updated is reduced when manipulating globally registered names.The Kernel configuration parameter <strong>global_groups</strong> defines
the global groups (see also
<a href="./kernel_app#global_groups">kernel_app#global_groups</a>
and <a href="config">config</a>):<pre><code class="">
{global_groups, [GroupTuple :: group_tuple()]}</code></pre>For the processes and nodes to run smoothly using the global
group functionality, the following criteria must be met:<ul><li> <p>An instance of the global group server, <strong>global_group</strong>,
must be running on each node. The processes are automatically
started and synchronized when a node is started.</p> </li><li> <p>All involved nodes must agree on the global group definition,
otherwise the behavior of the system is undefined.</p> </li><li> <p><em>All</em> nodes in the system must belong to exactly
one global group.</p> </li></ul>In the following descriptions, a <em>group node</em> is a node
belonging to the same global group as the local node.</p><h2>Data Types</h2><span class="name">group_tuple</span><p>A <strong>GroupTuple</strong> without <strong>PublishType</strong> is the same as a
<strong>GroupTuple</strong> with <strong>PublishType</strong> equal to <strong>normal</strong>.
</p><span class="name">group_name</span><span class="name">publish_type</span><p>A node started with command-line flag <strong>-hidden</strong> (see
<a href="./erl">erts/erl</a>) is said
to be a <em>hidden</em> node. A hidden node establishes hidden
connections to nodes not part of the same global group, but
normal (visible) connections to nodes part of the same global
group.</p><p>A global group defined with <strong>PublishType</strong> equal to
<strong>hidden</strong> is said to be a hidden global group.
All nodes in a hidden global
group are hidden nodes, whether they are started with
command-line flag <strong>-hidden</strong> or not.</p><span class="name">name</span><p>A registered name.</p><span class="name">where</span><h2>Functions</h2><h3>global_groups/0</h3><p>Return the global group names.</p><p>Returns a tuple containing the name of the global group that
the local node belongs to, and the list of all other known
group names. Returns <strong>undefined</strong> if no global groups are
defined.</p><h3>info/0</h3><p>Information about global groups.</p><ul><li>info_item</li></ul><ul><li>sync_state</li></ul><p>Returns a list containing information about the global
groups. Each list element is a tuple. The order of
the tuples is undefined.</p><dl><dt><strong>{state, <span class="anno">State</span>}</strong></dt><dd> <p>If the local node is part of a global group,
<strong><span class="anno">State</span></strong> is equal to <strong>synced</strong>.
If no global groups are defined,
<strong><span class="anno">State</span></strong> is equal to <strong>no_conf</strong>.</p> </dd><dt><strong>{own_group_name, <span class="anno">GroupName</span>}</strong></dt><dd> <p>The name (atom) of the group that the local node belongs
to.</p> </dd><dt><strong>{own_group_nodes, <span class="anno">Nodes</span>}</strong></dt><dd> <p>A list of node names (atoms), the group nodes.</p> </dd><dt><strong>{synced_nodes, <span class="anno">Nodes</span>}</strong></dt><dd> <p>A list of node names, the group nodes currently
synchronized with the local node.</p> </dd><dt><strong>{sync_error, <span class="anno">Nodes</span>}</strong></dt><dd> <p>A list of node names, the group nodes with which
the local node has failed to synchronize.</p> </dd><dt><strong>{no_contact, <span class="anno">Nodes</span>}</strong></dt><dd> <p>A list of node names, the group nodes to which there are
currently no connections.</p> </dd><dt><strong>{other_groups, <span class="anno">Groups</span>}</strong></dt><dd> <p><strong><span class="anno">Groups</span></strong> is a list of tuples
<strong>{<span class="anno">GroupName</span>, <span class="anno">Nodes</span>}</strong>,
specifying the name and nodes
of the other global groups.</p> </dd><dt><strong>{monitoring, <span class="anno">Pids</span>}</strong></dt><dd> <p>A list of pids, specifying the processes that have
subscribed to <strong>nodeup</strong> and <strong>nodedown</strong> messages.</p> </dd></dl><h3>monitor_nodes/1</h3><p>Subscribe to node status changes.</p><p>Depending on <strong><span class="anno">Flag</span></strong>, the calling process
starts subscribing (<strong><span class="anno">Flag</span></strong> equal to
<strong>true</strong>) or stops subscribing (<strong><span class="anno">Flag</span></strong>
equal to <strong>false</strong>) to node status change messages.</p><p>A process that has subscribed receives the messages
<strong>{nodeup, Node}</strong> and <strong>{nodedown, Node}</strong> when a
group node connects or disconnects, respectively.</p><h3>own_nodes/0</h3><p>Return the group nodes.</p><p>Returns the names of all group nodes, regardless of their
current status.</p><h3>registered_names/1</h3><p>Return globally registered names.</p><p>Returns a list of all names that are globally registered
on the specified node or in the specified global group.</p><h3>send/2</h3><h3>send/3</h3><p>Send a message to a globally registered pid.</p><p>Searches for <strong><span class="anno">Name</span></strong>, globally registered on
the specified node or in the specified global group, or
(if argument <strong><span class="anno">Where</span></strong> is not provided) in any
global group. The global groups are searched in the order that
they appear in the value of configuration parameter
<strong>global_groups</strong>.</p><p>If <strong><span class="anno">Name</span></strong> is found, message
<strong><span class="anno">Msg</span></strong> is sent to
the corresponding pid. The pid is also the return value of
the function. If the name is not found, the function returns
<strong>{badarg, {<span class="anno">Name</span>, <span class="anno">Msg</span>}}</strong>.</p><h3>sync/0</h3><p>Synchronize the group nodes.</p><p>Synchronizes the group nodes, that is, the global name
servers on the group nodes. Also checks the names globally
registered in the current global group and unregisters them
on any known node not part of the group.</p><p>If synchronization is not possible, an error report is sent
to the error logger (see also
<a href="error_logger">error_logger</a>.
</p><p>Returns <strong>{error, {'invalid global_groups definition', Bad}}</strong>
if configuration parameter <strong>global_groups</strong> has an
invalid value <strong>Bad</strong>.</p><h3>whereis_name/1</h3><h3>whereis_name/2</h3><p>Get the pid with a specified globally registered name.</p><p>Searches for <strong><span class="anno">Name</span></strong>, globally registered on
the specified node or in the specified global group, or
(if argument <strong><span class="anno">Where</span></strong> is not provided) in any global
group. The global groups are searched in the order that
they appear in the value of configuration parameter
<strong>global_groups</strong>.</p><p>If <strong><span class="anno">Name</span></strong> is found, the corresponding pid is
returned. If the name is not found, the function returns
<strong>undefined</strong>.</p><h3>Notes</h3><ul><li><p>In the situation where a node has lost its connections to other
nodes in its global group, but has connections to nodes in other
global groups, a request from another global group can produce an
incorrect or misleading result. For example, the isolated node can
have inaccurate information about registered names in its
global group.</p></li><li><p>Function
<a href="#send/2">send/2</a>
is not secure.</p></li><li><p>Distribution of applications is highly dependent of the global
group definitions. It is not recommended that an application is
distributed over many global groups, as
the registered names can be moved to another global group at
failover/takeover. Nothing prevents this to be done, but
the application code must then handle the situation.</p></li></ul><h3>See Also</h3><p><a href="global">global</a>,
<a href="./erl">erts/erl</a></p><h2>heart</h2><p>Heartbeat monitoring of an Erlang runtime system.</p><p>This modules contains the interface to the <strong>heart</strong> process.
<strong>heart</strong> sends periodic heartbeats to an external port
program, which is also named <strong>heart</strong>. The purpose of
the <strong>heart</strong> port program is to check that the Erlang runtime system
it is supervising is still running. If the port program has not
received any heartbeats within <strong>HEART_BEAT_TIMEOUT</strong> seconds
(defaults to 60 seconds), the system can be rebooted.An Erlang runtime system to be monitored by a heart program
is to be started with command-line flag <strong>-heart</strong> (see
also <a href="./erl">erts/erl</a>).
The <strong>heart</strong> process is then started automatically:<pre>
% <span class="input">erl -heart ...</span></pre>If the system is to be rebooted because of missing heartbeats,
or a terminated Erlang runtime system, environment variable
<strong>HEART_COMMAND</strong> must be set before the system is started.
If this variable is not set, a warning text is printed but
the system does not reboot.To reboot on Windows, <strong>HEART_COMMAND</strong> can be
set to <strong>heart -shutdown</strong> (included in the Erlang delivery)
or to any other suitable program that can activate a reboot.The environment variable <strong>HEART_BEAT_TIMEOUT</strong>
can be used to configure the heart
time-outs; it can be set in the operating system shell before Erlang
is started or be specified at the command line:<pre>
% <span class="input">erl -heart -env HEART_BEAT_TIMEOUT 30 ...</span></pre>The value (in seconds) must be in the range 10 &lt; X &lt;= 65535.When running on OSs lacking support for monotonic time,
<strong>heart</strong> is susceptible to system clock adjustments of more than
<strong>HEART_BEAT_TIMEOUT</strong> seconds. When  this happens, <strong>heart</strong>
times out and tries to reboot the system. This can occur, for
example, if the system clock is adjusted automatically by use of the
Network Time Protocol (NTP).If a crash occurs, an <strong>erl_crash.dump</strong> is <em>not</em>
written unless environment variable
<strong>ERL_CRASH_DUMP_SECONDS</strong> is set:<pre>
% <span class="input">erl -heart -env ERL_CRASH_DUMP_SECONDS 10 ...</span></pre>If a regular core dump is wanted, let <strong>heart</strong> know by setting
the kill signal to abort using environment variable
<strong>HEART_KILL_SIGNAL=SIGABRT</strong>. If unset, or not set to
<strong>SIGABRT</strong>, the default behavior is a kill signal using
<strong>SIGKILL</strong>:<pre>
% <span class="input">erl -heart -env HEART_KILL_SIGNAL SIGABRT ...</span></pre> If heart should <em>not</em> kill the Erlang runtime system, this can be indicated
using the environment variable <strong>HEART_NO_KILL=TRUE</strong>.
This can be useful if the command executed by heart takes care of this,
for example as part of a specific cleanup sequence. 
If unset, or not set to <strong>TRUE</strong>, the default behaviour
will be to kill as described above.
<pre>
% <span class="input">erl -heart -env HEART_NO_KILL 1 ...</span></pre>Furthermore, <strong>ERL_CRASH_DUMP_SECONDS</strong> has the
following behavior on <strong>heart</strong>:<dl><dt><strong>ERL_CRASH_DUMP_SECONDS=0</strong></dt><dd><p>Suppresses the writing of a crash dump file entirely,
thus rebooting the runtime system immediately.
This is the same as not setting the environment variable.</p> </dd><dt><strong>ERL_CRASH_DUMP_SECONDS=-1</strong></dt><dd><p>Setting the environment variable to a negative value does not
reboot the runtime system until the crash dump file is completly
written.</p> </dd><dt><strong>ERL_CRASH_DUMP_SECONDS=S</strong></dt><dd><p><strong>heart</strong> waits for <strong>S</strong> seconds to let the crash dump
file be written. After <strong>S</strong> seconds, <strong>heart</strong> reboots the
runtime system, whether the crash dump file is written or not.</p> </dd></dl>In the following descriptions, all functions fail with reason
<strong>badarg</strong> if <strong>heart</strong> is not started.</p><h2>Data Types</h2><span class="name">heart_option</span><h2>Functions</h2><h3>set_cmd/1</h3><p>Set a temporary reboot command.</p><p>Sets a temporary reboot command. This command is used if
a <strong>HEART_COMMAND</strong> other than the one specified with
the environment variable is to be used to reboot
the system. The new Erlang runtime system uses (if it misbehaves)
environment variable <strong>HEART_COMMAND</strong> to reboot.</p><p>Limitations: Command string <strong><span class="anno">Cmd</span></strong> is sent to the
<strong>heart</strong> program as an ISO Latin-1 or UTF-8 encoded binary,
depending on the filename encoding mode of the emulator (see
<a href="../kernel/file#native_name_encoding/0">kernel/file#native_name_encoding/0</a>).
The size of the encoded binary must be less than 2047 bytes.</p><h3>clear_cmd/0</h3><p>Clear the temporary boot command.</p><p>Clears the temporary boot command. If the system terminates,
the normal <strong>HEART_COMMAND</strong> is used to reboot.</p><h3>get_cmd/0</h3><p>Get the temporary reboot command.</p><p>Gets the temporary reboot command. If the command is cleared,
the empty string is returned.</p><h3>set_callback/2</h3><p>Set a validation callback</p><p> This validation callback will be executed before any
heartbeat is sent to the port program. For the validation to
succeed it needs to return with the value <strong>ok</strong>.
</p><p>An exception within the callback will be treated as a validation failure.</p><p>The callback will be removed if the system reboots.</p><h3>clear_callback/0</h3><p>Clear the validation callback</p><p>Removes the validation callback call before heartbeats.</p><h3>get_callback/0</h3><p>Get the validation callback</p><p>Get the validation callback. If the callback is cleared, <strong>none</strong> will be returned.</p><h3>set_options/1</h3><p>Set a list of options</p><p> Valid options <strong>set_options</strong> are: </p><dl><dt><strong>check_schedulers</strong></dt><dd> <p>If enabled, a signal will be sent to each scheduler to check its
responsiveness. The system check occurs before any heartbeat sent
to the port program. If any scheduler is not responsive enough the
heart program will not receive its heartbeat and thus eventually terminate the node.
</p> </dd></dl><p> Returns with the value <strong>ok</strong> if the options are valid.</p><h3>get_options/0</h3><p>Get the temporary reboot command</p><p>Returns <strong>{ok, Options}</strong> where <strong>Options</strong> is a list of current options enabled for heart.
If the callback is cleared, <strong>none</strong> will be returned.</p><h2>inet</h2><p>Access to TCP/IP protocols.</p><p>This module provides access to TCP/IP protocols.See also
<a href="./inet_cfg">ERTS User's Guide: Inet Configuration</a> for more information about how to
configure an Erlang runtime system for IP communication.The following two Kernel configuration parameters affect the
behavior of all sockets opened on an Erlang node:<ul><li><p><strong>inet_default_connect_options</strong> can contain a list of
default options used for all sockets returned when doing
<strong>connect</strong>.</p></li><li><p><strong>inet_default_listen_options</strong> can contain a list of
default options used when issuing a <strong>listen</strong> call.</p></li></ul>When <strong>accept</strong> is issued, the values of the listening socket options
are inherited. No such application variable is therefore needed for
<strong>accept</strong>.Using the Kernel configuration parameters above, one
can set default options for all TCP sockets on a node, but use this
with care. Options such as <strong>{delay_send,true}</strong> can be
specified in this way. The following is an example of starting an Erlang
node with all sockets using delayed send:<pre>
$ <span class="input">erl -sname test -kernel \</span>
<span class="input">inet_default_connect_options '[{delay_send,true}]' \</span>
<span class="input">inet_default_listen_options '[{delay_send,true}]'</span></pre>Notice that default option <strong>{active, true}</strong>
cannot be changed, for internal reasons.Addresses as inputs to functions can be either a string or a
tuple. For example, the IP address 150.236.20.73 can be passed to
<strong>gethostbyaddr/1</strong>, either as string <strong>"150.236.20.73"</strong>
or as tuple <strong>{150, 236, 20, 73}</strong>.<em>IPv4 address examples:</em><pre><code class="">
Address          ip_address()
-------          ------------
127.0.0.1        {127,0,0,1}
192.168.42.2     {192,168,42,2}</code></pre><em>IPv6 address examples:</em><pre><code class="">
Address          ip_address()
-------          ------------
::1             {0,0,0,0,0,0,0,1}
::192.168.42.2  {0,0,0,0,0,0,(192 bsl 8) bor 168,(42 bsl 8) bor 2}
::FFFF:192.168.42.2
                {0,0,0,0,0,16#FFFF,(192 bsl 8) bor 168,(42 bsl 8) bor 2}
3ffe:b80:1f8d:2:204:acff:fe17:bf38
                {16#3ffe,16#b80,16#1f8d,16#2,16#204,16#acff,16#fe17,16#bf38}
fe80::204:acff:fe17:bf38
                {16#fe80,0,0,0,0,16#204,16#acff,16#fe17,16#bf38}</code></pre>Function
<a href="#parse_address/1">parse_address/1</a>
can be useful:<pre>
1&gt; <span class="input">inet:parse_address("192.168.42.2").</span>
{ok,{192,168,42,2}}
2&gt; <span class="input">inet:parse_address("::FFFF:192.168.42.2").</span>
{ok,{0,0,0,0,0,65535,49320,10754}}</pre></p><h2>Data Types</h2><span class="name">hostent</span><p>The record is defined in the Kernel include file
<strong>"inet.hrl"</strong>.</p><p>Add the following directive to the module:</p><pre><code class="">
-include_lib("kernel/include/inet.hrl").</code></pre><span class="name">hostname</span><span class="name">ip_address</span><span class="name">ip4_address</span><span class="name">ip6_address</span><span class="name">port_number</span><span class="name">local_address</span><p>
This address family only works on Unix-like systems.
</p><p>
<strong><span class="anno">File</span></strong> is normally a file pathname
in a local filesystem.  It is limited in length by the
operating system, traditionally to 108 bytes.
</p><p>
A <strong>binary()</strong> is passed as is to the operating system,
but a <strong>string()</strong> is encoded according to the
<a href="./file#native_name_encoding/0"> system filename encoding mode. </a>
</p><p>
Other addresses are possible, for example Linux implements
"Abstract Addresses".  See the documentation for
Unix Domain Sockets on your system,
normally <strong>unix</strong> in manual section 7.
</p><p>
In most API functions where you can use
this address family the port number must be <strong>0</strong>.
</p><span class="name">socket_address</span><span class="name">socket_getopt</span><span class="name">socket_setopt</span><span class="name">returned_non_ip_address</span><p>
Addresses besides
<a href="#type-ip_address">type-ip_address</a>
ones that are returned from socket API functions.
See in particular
<a href="#type-local_address"> . </a>
The <strong>unspec</strong> family corresponds to AF_UNSPEC and can
occur if the other side has no socket address.
The <strong>undefined</strong> family can only occur in the unlikely
event of an address family that the VM does not recognize.
</p><span class="name">ancillary_data</span><p>
Ancillary data received with the data packet
or read with the socket option
<a href="./gen_tcp#type-pktoptions_value">gen_tcp#type-pktoptions_value</a>
from a TCP socket.
</p><p>
The value(s) correspond to the currently active socket
<a href="#type-socket_setopt">options</a>
<a href="./inet#option-recvtos">inet#option-recvtos</a>,
<a href="./inet#option-recvtclass">inet#option-recvtclass</a>
and
<a href="./inet#option-recvttl">inet#option-recvttl</a>.
</p><span class="name">getifaddrs_ifopts</span><p>
Interface address description list returned from
<a href="#getifaddrs/0">getifaddrs/0</a>
for a named interface, translated from the returned
data of the POSIX API function <strong>getaddrinfo()</strong>.
</p><p>
<strong><span class="anno">Hwaddr</span></strong> is hardware dependent,
for example, on Ethernet interfaces it is
the 6-byte Ethernet address (MAC address (EUI-48 address)).
</p><p>
The tuples <strong>{addr,<span class="anno">Addr</span>}</strong>,
<strong>{netmask,<span class="anno">Netmask</span>}</strong>, and possibly
<strong>{broadaddr,<span class="anno">Broadaddr</span>}</strong> or
<strong>{dstaddr,<span class="anno">Dstaddr</span>}</strong>
are repeated in the list
if the interface has got multiple addresses.
An interface may have multiple <strong>{flag,_}</strong> tuples
for example if it has different flags
for different address families.
Multiple <strong>{hwaddr,<span class="anno">Hwaddr</span>}</strong> tuples
is hard to say anything definite about, though.
The tuple <strong>{flag,<span class="anno">Flags</span>}</strong> is mandatory,
all others are optional.
</p><p>
Do not rely too much on the order
of <strong><span class="anno">Flags</span></strong> atoms
or the <strong><span class="anno">Ifopt</span></strong> tuples.
There are however some rules:
</p><ul><li><p>
A <strong>{flag,_}</strong> tuple applies to all other tuples that follow.
</p></li><li><p>
Immediately after <strong>{addr,_}</strong> follows <strong>{netmask,_}</strong>.
</p></li><li><p>
Immediately thereafter may <strong>{broadaddr,_}</strong> follow
if <strong>broadcast</strong> is member of <strong><span class="anno">Flags</span></strong>,
or <strong>{dstaddr,_}</strong> if <strong>pointtopoint</strong>
is member of <strong><span class="anno">Flags</span></strong>.
Both <strong>{dstaddr,_}</strong> and <strong>{broadaddr,_}</strong>
does not occur for the same <strong>{addr,_}</strong>.
</p></li><li><p>
Any <strong>{netmask,_}</strong>, <strong>{broadaddr,_}</strong>, or
<strong>{dstaddr,_}</strong> tuples that follow an
<strong>{addr,<span class="anno">Addr</span>}</strong>
tuple concerns the address <strong><span class="anno">Addr</span></strong>.
</p></li></ul><p>
The tuple <strong>{hwaddr,_}</strong> is not returned on Solaris, as the
hardware address historically belongs to the link layer
and it is not returned by the Solaris API function
<strong>getaddrinfo()</strong>.
</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>
On Windows, the data is fetched from different
OS API functions, so the <strong><span class="anno">Netmask</span></strong>
and <strong><span class="anno">Broadaddr</span></strong> values may be calculated,
just as some <strong><span class="anno">Flags</span></strong> values.
</p></div><span class="name">posix</span><p>An atom that is named from the POSIX error codes used in Unix,
and in the runtime libraries of most C compilers. See section
<a href="#error_codes">POSIX Error Codes</a>.</p><span class="name">socket()</span><p>See
<a href="./gen_tcp#type-socket">gen_tcp#type-socket</a>
and
<a href="./gen_udp#type-socket">gen_udp#type-socket</a>.
</p><span class="name">address_family</span><span class="name">socket_protocol</span><span class="name">stat_option</span><h2>Functions</h2><h3>close/1</h3><p>Close a socket of any type.</p><p>Closes a socket of any type.</p><h3>format_error/1</h3><p>Return a descriptive string for an error reason.</p><p>Returns a diagnostic error string. For possible POSIX values and
corresponding strings, see section
<a href="#error_codes">POSIX Error Codes</a>.</p><h3>get_rc/0</h3><p>Return a list of IP configuration parameters.</p><p>
Returns the state of the <strong>Inet</strong> configuration database in
form of a list of recorded configuration parameters. For more
information, see <a href="./inet_cfg">ERTS User's Guide: Inet Configuration</a>.
</p><p>
Only actual parameters with other than default values
are returned, for example not directives that specify
other sources for configuration parameters nor
directives that clear parameters.
</p><h3>getaddr/2</h3><p>Return the IP address for a host.</p><p>Returns the IP address for <strong><span class="anno">Host</span></strong> as a tuple of
integers. <strong><span class="anno">Host</span></strong> can be an IP address, a single
hostname, or a fully qualified hostname.</p><h3>getaddrs/2</h3><p>Return the IP addresses for a host.</p><p>Returns a list of all IP addresses for <strong><span class="anno">Host</span></strong>.
<strong><span class="anno">Host</span></strong> can be an IP address, a single hostname, or
a fully qualified hostname.</p><h3>gethostbyaddr/1</h3><p>Return a hostent record for the host with the specified address.</p><p>Returns a <strong>hostent</strong> record for the host with the specified
address.</p><h3>gethostbyname/1</h3><p>Return a hostent record for the host with the specified name. </p><p>Returns a <strong>hostent</strong> record for the host with the specified
hostname.</p><p>If resolver option <strong>inet6</strong> is <strong>true</strong>,
an IPv6 address is looked up.</p><h3>gethostbyname/2</h3><p>Return a hostent record for the host with the specified name. </p><p>Returns a <strong>hostent</strong> record for the host with the specified
name, restricted to the specified address family.</p><h3>gethostname/0</h3><p>Return the local hostname.</p><p>Returns the local hostname. Never fails.</p><h3>getifaddrs/0</h3><p>Return a list of interfaces and their addresses.</p><p>
Returns a list of 2-tuples containing interface names and
the interfaces' addresses. <strong><span class="anno">Ifname</span></strong>
is a Unicode string and
<strong><span class="anno">Ifopts</span></strong> is a list of
interface address description tuples.
</p><p>
The interface address description tuples
are documented under the type of the
<a href="#type-getifaddrs_ifopts">type-getifaddrs_ifopts</a>
value.
</p><h3>getifaddrs(Opts) -&gt;
        {ok, [{Ifname, Ifopts}]} | {error, Posix}
</h3><p>Return a list of interfaces and their addresses.</p><ul><li><span class="v"> Opts = [{netns, Namespace}] </span></li><li><span class="v"> Namespace =  </span></li><li><span class="v">Ifname = string()</span></li><li><span class="v"> Ifopts =  </span></li><li><span class="v">Posix = </span></li></ul><p>
The same as
<a href="#getifaddrs/0">getifaddrs/0</a>
but the <strong>Option</strong>
<strong>{netns, Namespace}</strong> sets a network namespace
for the OS call, on platforms that supports that feature.
</p><p>
See the socket option
<a href="#option-netns">option-netns</a>
under
<a href="#setopts/2">setopts/2</a>.
</p><h3>getopts/2</h3><p>Get one or more options for a socket.</p><p>Gets one or more options for a socket. For a list of available
options, see
<a href="#setopts/2">setopts/2</a>.
See also the description for the type
<a href="./gen_tcp#type-pktoptions_value">gen_tcp#type-pktoptions_value</a>.</p><p>The number of elements in the returned
<strong><span class="anno">OptionValues</span></strong>
list does not necessarily correspond to the number of options
asked for. If the operating system fails to support an option,
it is left out in the returned list. An error tuple is returned
only when getting options for the socket is impossible (that is,
the socket is closed or the buffer size in a raw request
is too large). This behavior is kept for backward
compatibility reasons.</p><p>A raw option request
<strong>RawOptReq = {raw, Protocol, OptionNum, ValueSpec}</strong>
can be used to get information about
socket options not (explicitly) supported by the emulator. The
use of raw socket options makes the code non-portable, but
allows the Erlang programmer to take advantage of unusual features
present on a particular platform.</p><p><strong>RawOptReq</strong> consists of tag <strong>raw</strong> followed
by the protocol level, the option number, and either a binary
or the size, in bytes, of the
buffer in which the option value is to be stored. A binary is to be
used when the underlying <strong>getsockopt</strong> requires <em>input</em>
in the argument field. In this case, the binary size
is to correspond to the required buffer
size of the return value. The supplied values in a <strong>RawOptReq</strong>
correspond to the second, third, and fourth/fifth parameters to the
<strong>getsockopt</strong> call in the C socket API. The value stored
in the buffer is returned as a binary <strong>ValueBin</strong>,
where all values are coded in the native endianess.</p><p>Asking for and inspecting raw socket options require low-level
information about the current operating system and TCP stack.</p><p><em>Example:</em></p><p>Consider a Linux machine where option
<strong>TCP_INFO</strong> can be used to collect TCP statistics
for a socket. Assume you are interested in field
<strong>tcpi_sacked</strong> of <strong>struct tcp_info</strong>
filled in when asking for <strong>TCP_INFO</strong>. To be able to access
this information, you need to know the following:</p><ul><li>The numeric value of protocol level <strong>IPPROTO_TCP</strong></li><li>The numeric value of option <strong>TCP_INFO</strong></li><li>The size of <strong>struct tcp_info</strong></li><li>The size and offset of the specific field</li></ul><p>By inspecting the headers or writing a small C program, it is found
that <strong>IPPROTO_TCP</strong> is 6, <strong>TCP_INFO</strong> is 11, the structure
size is 92 (bytes), the offset of <strong>tcpi_sacked</strong> is 28 bytes,
and the value is a 32-bit integer. The following code can be used
to retrieve the value:</p><pre><code class="">
get_tcpi_sacked(Sock) -&gt;
    {ok,[{raw,_,_,Info}]} = inet:getopts(Sock,[{raw,6,11,92}]),
    &lt;&lt;_:28/binary,TcpiSacked:32/native,_/binary&gt;&gt; = Info,
    TcpiSacked.</code></pre><p>Preferably, you would check the machine type, the operating system,
and the Kernel version before executing anything similar to
this code.</p><h3>getstat/1</h3><h3>getstat/2</h3><p>Get one or more statistic options for a socket.</p><ul><li>stat_option</li></ul><p>Gets one or more statistic options for a socket.</p><p><strong>getstat(<span class="anno">Socket</span>)</strong> is equivalent to
<strong>getstat(<span class="anno">Socket</span>, [recv_avg, recv_cnt, recv_dvi, recv_max, recv_oct, send_avg, send_cnt, send_dvi, send_max, send_oct])</strong>.</p><p>The following options are available:</p><dl><dt><strong>recv_avg</strong></dt><dd> <p>Average size of packets, in bytes, received by the socket.</p> </dd><dt><strong>recv_cnt</strong></dt><dd> <p>Number of packets received by the socket.</p> </dd><dt><strong>recv_dvi</strong></dt><dd> <p>Average packet size deviation, in bytes, received by the socket.</p> </dd><dt><strong>recv_max</strong></dt><dd> <p>Size of the largest packet, in bytes, received by the socket.</p> </dd><dt><strong>recv_oct</strong></dt><dd> <p>Number of bytes received by the socket.</p> </dd><dt><strong>send_avg</strong></dt><dd> <p>Average size of packets, in bytes, sent from the socket.</p> </dd><dt><strong>send_cnt</strong></dt><dd> <p>Number of packets sent from the socket.</p> </dd><dt><strong>send_dvi</strong></dt><dd> <p>Average packet size deviation, in bytes, sent from the socket.</p> </dd><dt><strong>send_max</strong></dt><dd> <p>Size of the largest packet, in bytes, sent from the socket.</p> </dd><dt><strong>send_oct</strong></dt><dd> <p>Number of bytes sent from the socket.</p> </dd></dl><h3>i/0</h3><h3>i/1</h3><h3>i/2</h3><p>Displays information and statistics about sockets on the terminal</p><p>
Lists all TCP, UDP and SCTP sockets, including those that the Erlang runtime system uses as well as
those created by the application.
</p><p>
The following options are available:
</p><dl><dt><strong>port</strong></dt><dd> <p>The internal index of the port.</p> </dd><dt><strong>module</strong></dt><dd> <p>The callback module of the socket.</p> </dd><dt><strong>recv</strong></dt><dd> <p>Number of bytes received by the socket.</p> </dd><dt><strong>sent</strong></dt><dd> <p>Number of bytes sent from the socket.</p> </dd><dt><strong>owner</strong></dt><dd> <p>The socket owner process.</p> </dd><dt><strong>local_address</strong></dt><dd> <p>The local address of the socket.</p> </dd><dt><strong>foreign_address</strong></dt><dd> <p>The address and port of the other end of the connection.</p> </dd><dt><strong>state</strong></dt><dd> <p>The connection state.</p> </dd><dt><strong>type</strong></dt><dd> <p>STREAM or DGRAM or SEQPACKET.</p> </dd></dl><h3>ntoa/1</h3><p>Convert IPv6/IPV4 address to ASCII.</p><p>Parses an
<a href="#type-ip_address">type-ip_address</a>
and returns an IPv4 or IPv6 address string.</p><h3>parse_address/1</h3><p>Parse an IPv4 or IPv6 address.</p><p>Parses an IPv4 or IPv6 address string and returns an
<a href="#type-ip4_address">type-ip4_address</a> or
<a href="#type-ip6_address">type-ip6_address</a>.
Accepts a shortened IPv4 address string.</p><h3>parse_ipv4_address/1</h3><p>Parse an IPv4 address.</p><p>Parses an IPv4 address string and returns an
<a href="#type-ip4_address">type-ip4_address</a>.
Accepts a shortened IPv4 address string.</p><h3>parse_ipv4strict_address/1</h3><p>Parse an IPv4 address strict.</p><p>Parses an IPv4 address string containing four fields, that is,
<em>not</em> shortened, and returns an
<a href="#type-ip4_address">type-ip4_address</a>.
</p><h3>parse_ipv6_address/1</h3><p>Parse an IPv6 address.</p><p>Parses an IPv6 address string and returns an
<a href="#type-ip6_address">type-ip6_address</a>.
If an IPv4 address string is specified, an IPv4-mapped IPv6 address
is returned.</p><h3>parse_ipv6strict_address/1</h3><p>Parse an IPv6 address strict.</p><p>Parses an IPv6 address string and returns an
<a href="#type-ip6_address">type-ip6_address</a>.
Does <em>not</em> accept IPv4 addresses.</p><h3>ipv4_mapped_ipv6_address/1</h3><p>Convert to and from IPv4-mapped IPv6 address.</p><p>
Convert an IPv4 address to an IPv4-mapped IPv6 address
or the reverse.  When converting from an IPv6 address
all but the 2 low words are ignored so this function also
works on some other types of addresses than IPv4-mapped.
</p><h3>parse_strict_address/1</h3><p>Parse an IPv4 or IPv6 address strict.</p><p>Parses an IPv4 or IPv6 address string and returns an
<a href="#type-ip4_address">type-ip4_address</a> or
<a href="#type-ip6_address">type-ip6_address</a>.
Does <em>not</em> accept a shortened IPv4 address string.</p><h3>peername/1</h3><p>Return the address and port for the other end of a connection. </p><p>Returns the address and port for the other end of a connection.</p><p>Notice that for SCTP sockets, this function returns only
one of the peer addresses of the socket. Function
<a href="#peernames/1">peernames/1</a>
returns all.</p><h3>peernames/1</h3><p>Return all address/port numbers for the other end of a connection.</p><p>Equivalent to
<a href="#peernames/2">peernames/2</a>.
</p><p>Notice that the behavior of this function for an SCTP
one-to-many style socket is not defined by the
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">SCTP Sockets API Extensions</a>.</p><h3>peernames/2</h3><p>Return all address/port numbers for the other end of a connection.</p><p>Returns a list of all address/port number pairs for the other end
of an association <strong><span class="anno">Assoc</span></strong> of a socket.</p><p>This function can return multiple addresses for multihomed
sockets, such as SCTP sockets. For other sockets it
returns a one-element list.</p><p>Notice that parameter <strong><span class="anno">Assoc</span></strong> is by the
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">SCTP Sockets API Extensions</a>
defined to be ignored for
one-to-one style sockets. What the special value <strong>0</strong>
means, hence its behavior for one-to-many style sockets,
is unfortunately undefined.</p><h3>port/1</h3><p>Return the local port number for a socket.</p><p>Returns the local port number for a socket.</p><h3>setopts/2</h3><p>Set one or more options for a socket.</p><p>Sets one or more options for a socket.</p><p>The following options are available:</p><dl><dt><strong>{active, true | false | once | N}</strong></dt><dd> <p>If the value is <strong>true</strong>, which is the default,
everything received from the socket is sent as
messages to the receiving process.</p> <p>If the value is <strong>false</strong> (passive mode), the process must
explicitly receive incoming data by calling
<a href="./gen_tcp#recv/2">gen_tcp#recv/2</a>,
<a href="./gen_udp#recv/2">gen_udp#recv/2</a>,
or <a href="./gen_sctp#recv/1">gen_sctp#recv/1</a>
(depending on the type of socket).</p> <p>If the value is <strong>once</strong> (<strong>{active, once}</strong>),
<em>one</em> data message from the socket is sent
to the process. To receive one more message,
<strong>setopts/2</strong> must be called again with option
<strong>{active, once}</strong>.</p> <p>If the value is an integer <strong>N</strong> in the range -32768 to 32767
(inclusive), the value is added to the socket's count of data
messages sent to the controlling process. A socket's default
message count is <strong>0</strong>. If a negative value is specified, and
its magnitude is equal to or greater than the socket's current
message count, the socket's message count is set to <strong>0</strong>.
Once the socket's message count reaches <strong>0</strong>, either because
of sending
received data messages to the process or by being explicitly set,
the process is then notified by a special message, specific to
the type of socket, that the socket has entered passive
mode. Once the socket enters passive mode, to receive more
messages <strong>setopts/2</strong> must be called again to set the
socket back into an active mode.</p> <p>When using <strong>{active, once}</strong> or <strong>{active, N}</strong>, the
socket changes behavior automatically when data is received.
This can be confusing in combination with connection-oriented
sockets (that is, <strong>gen_tcp</strong>), as a socket
with <strong>{active, false}</strong> behavior reports closing
differently than a socket with <strong>{active, true}</strong>
behavior. To simplify programming, a socket where
the peer closed, and this is detected while in
<strong>{active, false}</strong> mode, still generates message
<strong>{tcp_closed,Socket}</strong> when set to <strong>{active, once}</strong>,
<strong>{active, true}</strong>, or <strong>{active, N}</strong> mode.
It is therefore safe to assume that message
<strong>{tcp_closed,Socket}</strong>, possibly followed by socket port
termination (depending on option <strong>exit_on_close</strong>)
eventually appears when a socket changes
back and forth between <strong>{active, true}</strong> and
<strong>{active, false}</strong> mode. However,
<em>when</em> peer closing is detected it is all up to the
underlying TCP/IP stack and protocol.</p> <p>Notice that <strong>{active, true}</strong> mode provides no flow
control; a fast sender can easily overflow the
receiver with incoming messages. The same is true for
<strong>{active, N}</strong> mode, while the message count is greater
than zero.</p> <p>Use active mode only if
your high-level protocol provides its own flow control
(for example, acknowledging received messages) or the
amount of data exchanged is small. <strong>{active, false}</strong>
mode, use of the <strong>{active, once}</strong> mode, or <strong>{active, N}</strong>
mode with values of <strong>N</strong> appropriate for the application
provides flow control. The other side cannot send
faster than the receiver can read.</p> </dd><dt><strong>{broadcast, Boolean}</strong> (UDP sockets)</dt><dd> <p>Enables/disables permission to send broadcasts.</p> <a name="option-buffer"></a> </dd><dt><strong>{buffer, Size}</strong></dt><dd> <p>The size of the user-level buffer used by
the driver. Not to be confused with options <strong>sndbuf</strong>
and <strong>recbuf</strong>, which correspond to the
Kernel socket buffers. For TCP it is recommended
to have <strong>val(buffer) &gt;= val(recbuf)</strong> to
avoid performance issues because of unnecessary copying.
For UDP the same recommendation applies, but the max should
not be larger than the MTU of the network path.
<strong>val(buffer)</strong> is automatically set to the above
maximum when <strong>recbuf</strong> is set.
However, as the size set for <strong>recbuf</strong>
usually become larger, you are encouraged to use
<a href="#getopts/2">getopts/2</a>
to analyze the behavior of your operating system.</p> <p>Note that this is also the maximum amount of data that can be
received from a single recv call. If you are using higher than
normal MTU consider setting buffer higher.</p> </dd><dt><strong>{delay_send, Boolean}</strong></dt><dd> <p>Normally, when an Erlang process sends to a socket,
the driver tries to send the data immediately. If that
fails, the driver uses any means available to queue
up the message to be sent whenever the operating system
says it can handle it. Setting <strong>{delay_send, true}</strong>
makes <em>all</em> messages queue up. The messages sent
to the network are then larger but fewer.
The option affects the scheduling of send
requests versus Erlang processes instead of changing any
real property of the socket. The option is
implementation-specific. Defaults to <strong>false</strong>.</p> </dd><dt><strong>{deliver, port | term}</strong></dt><dd> <p>When <strong>{active, true}</strong>, data is delivered on the form
<strong>port</strong> : <strong>{S, {data, [H1,..Hsz | Data]}}</strong> or
<strong>term</strong> : <strong>{tcp, S, [H1..Hsz | Data]}</strong>.</p> </dd><dt><strong>{dontroute, Boolean}</strong></dt><dd> <p>Enables/disables routing bypass for outgoing messages.</p> </dd><dt><strong>{exit_on_close, Boolean}</strong></dt><dd> <p>This option is set to <strong>true</strong> by default.</p> <p>The only reason to set it to <strong>false</strong> is if you want
to continue sending data to the socket after a close is
detected, for example, if the peer uses
<a href="./gen_tcp#shutdown/2">gen_tcp#shutdown/2</a>
to shut down the write side.</p> </dd><dt><strong>{header, Size}</strong></dt><dd> <p>This option is only meaningful if option <strong>binary</strong>
was specified when the socket was created. If option
<strong>header</strong> is specified, the first
<strong>Size</strong> number bytes of data received from the socket
are elements of a list, and the remaining data is
a binary specified as the tail of the same list. For example,
if <strong>Size == 2</strong>, the data received matches
<strong>[Byte1,Byte2|Binary]</strong>.</p> </dd><dt><strong>{high_msgq_watermark, Size}</strong></dt><dd> <p>The socket message queue is set to a busy
state when the amount of data on the message
queue reaches this limit. Notice that this limit only
concerns data that has not yet reached the ERTS internal
socket implementation. Defaults to 8 kB.</p> <p>Senders of data to the socket are suspended if
either the socket message queue is busy or the socket
itself is busy.</p> <p>For more information, see options <strong>low_msgq_watermark</strong>,
<strong>high_watermark</strong>, and <strong>low_watermark</strong>.</p> <p>Notice that distribution sockets disable the use of
<strong>high_msgq_watermark</strong> and <strong>low_msgq_watermark</strong>.
Instead use the
<a href="../erts/erlang#system_info_dist_buf_busy_limit">distribution buffer busy limit</a>,
which is a similar feature.</p> </dd><dt><strong>{high_watermark, Size}</strong> (TCP/IP sockets)</dt><dd> <p>The socket is set to a busy state when the amount
of data queued internally by the ERTS socket implementation
reaches this limit. Defaults to 8 kB.</p> <p>Senders of data to the socket are suspended if
either the socket message queue is busy or the socket
itself is busy.</p> <p>For more information, see options <strong>low_watermark</strong>,
<strong>high_msgq_watermark</strong>, and <strong>low_msqg_watermark</strong>.</p> </dd><dt><strong>{ipv6_v6only, Boolean}</strong></dt><dd> <p>Restricts the socket to use only IPv6, prohibiting any
IPv4 connections. This is only applicable for
IPv6 sockets (option <strong>inet6</strong>).</p> <p>On most platforms this option must be set on the socket
before associating it to an address. It is therefore only
reasonable to specify it when creating the socket and not
to use it when calling function
(<a href="#setopts/2">setopts/2</a>)
containing this description.</p> <p>The behavior of a socket with this option set to
<strong>true</strong> is the only portable one. The original
idea when IPv6 was new of using IPv6 for all traffic
is now not recommended by FreeBSD (you can use
<strong>{ipv6_v6only,false}</strong> to override the recommended
system default value),
forbidden by OpenBSD (the supported GENERIC kernel),
and impossible on Windows (which has separate
IPv4 and IPv6 protocol stacks). Most Linux distros
still have a system default value of <strong>false</strong>.
This policy shift among operating systems to
separate IPv6 from IPv4 traffic has evolved, as
it gradually proved hard and complicated to get
a dual stack implementation correct and secure.</p> <p>On some platforms, the only allowed value for this option
is <strong>true</strong>, for example, OpenBSD and Windows. Trying to set
this option to <strong>false</strong>, when creating the socket, fails
in this case.</p> <p>Setting this option on platforms where it does not exist
is ignored. Getting this option with
<a href="#getopts/2">getopts/2</a>
returns no value, that is, the returned list does not contain an
<strong>{ipv6_v6only,_}</strong> tuple. On Windows, the option
does not exist, but it is emulated as a
read-only option with value <strong>true</strong>.</p> <p>Therefore, setting this option to <strong>true</strong>
when creating a socket never fails, except possibly on a
platform where you
have customized the kernel to only allow <strong>false</strong>,
which can be doable (but awkward) on, for example, OpenBSD.</p> <p>If you read back the option value using
<a href="#getopts/2">getopts/2</a>
and get no value, the option does not exist in the host
operating system. The behavior of both an IPv6 and an IPv4
socket listening on the same port, and for an IPv6 socket
getting IPv4 traffic is then no longer predictable.</p> </dd><dt><strong>{keepalive, Boolean}</strong>(TCP/IP sockets)</dt><dd> <p>Enables/disables periodic transmission on a connected
socket when no other data is exchanged. If
the other end does not respond, the connection is
considered broken and an error message is sent to
the controlling process. Defaults to <strong>disabled</strong>.</p> <a name="option-linger"></a> </dd><dt><strong>{linger, {true|false, Seconds}}</strong></dt><dd> <p>Determines the time-out, in seconds, for flushing unsent data
in the <strong>close/1</strong> socket call. </p> <p>The first component is if linger is enabled, the second component
is the flushing time-out, in seconds. There are 3 alternatives:</p> <dl><dt><strong>{false, _}</strong></dt><dd> <p>close/1 or shutdown/2 returns immediately,
not waiting for data to be flushed, with closing
happening in the background.</p> </dd><dt><strong>{true, 0}</strong></dt><dd> <p>Aborts the connection when it is closed.
Discards any data still remaining in the send buffers
and sends RST to the peer.</p> <p>This avoids TCP's TIME_WAIT state, but leaves open
the possibility that another "incarnation" of this connection
being created.</p> </dd><dt><strong>{true, Time} when Time &gt; 0</strong></dt><dd> <p>close/1 or shutdown/2 will not return until
all queued messages for the socket have been successfully
sent or the linger timeout (Time) has been reached.</p> </dd></dl> </dd><dt><strong>{low_msgq_watermark, Size}</strong></dt><dd> <p>If the socket message queue is in a busy state, the
socket message queue is set in a not busy state when
the amount of data queued in the message queue falls
below this limit. Notice that this limit only concerns data
that has not yet reached the ERTS internal socket
implementation. Defaults to 4 kB.</p> <p>Senders that are suspended because of either a
busy message queue or a busy socket are resumed
when the socket message queue and the socket
are not busy.</p> <p>For more information, see options <strong>high_msgq_watermark</strong>,
<strong>high_watermark</strong>, and <strong>low_watermark</strong>.</p> <p>Notice that distribution sockets disable the use of
<strong>high_msgq_watermark</strong> and <strong>low_msgq_watermark</strong>.
Instead they use the
<a href="../erts/erlang#system_info_dist_buf_busy_limit">distribution buffer busy limit</a>, which is a similar feature.</p> </dd><dt><strong>{low_watermark, Size}</strong> (TCP/IP sockets)</dt><dd> <p>If the socket is in a busy state, the socket is
set in a not busy state when the amount of data
queued internally by the ERTS socket implementation
falls below this limit. Defaults to 4 kB.</p> <p>Senders that are suspended because of a
busy message queue or a busy socket are resumed
when the socket message queue and the socket are not busy.</p> <p>For more information, see options <strong>high_watermark</strong>,
<strong>high_msgq_watermark</strong>, and <strong>low_msgq_watermark</strong>.</p> </dd><dt><strong>{mode, Mode :: binary | list}</strong></dt><dd> <p>
Received <strong>Packet</strong> is delivered as defined by <strong>Mode</strong>.
</p> </dd><dt> <a name="option-netns"></a> <strong>{netns, Namespace :: file:filename_all()}</strong> </dt><dd> <p>
Sets a network namespace for the socket. Parameter
<strong>Namespace</strong> is a filename defining the namespace, for
example, <strong>"/var/run/netns/example"</strong>, typically created by
command <strong>ip netns add example</strong>. This option must be used in
a function call that creates a socket, that is,
<a href="./gen_tcp#connect/3">gen_tcp#connect/3</a>,
<a href="./gen_tcp#listen/2">gen_tcp#listen/2</a>,
<a href="./gen_udp#open/1">gen_udp#open/1</a>
or
<a href="./gen_sctp#open/0">gen_sctp#open/0</a>,
and also
<a href="#getifaddrs/1">getifaddrs/1</a>.
</p> <p>This option uses the Linux-specific syscall
<strong>setns()</strong>, such as in Linux kernel 3.0 or later,
and therefore only exists when the runtime system
is compiled for such an operating system.</p> <p>The virtual machine also needs elevated privileges, either
running as superuser or (for Linux) having capability
<strong>CAP_SYS_ADMIN</strong> according to the documentation for
<strong>setns(2)</strong>.
However, during testing also <strong>CAP_SYS_PTRACE</strong>
and <strong>CAP_DAC_READ_SEARCH</strong> have proven to be necessary.</p> <p><em>Example:</em></p> <pre><code class="">
setcap cap_sys_admin,cap_sys_ptrace,cap_dac_read_search+epi beam.smp</code></pre> <p>Notice that the filesystem containing the virtual machine
executable (<strong>beam.smp</strong> in the example) must be local,
mounted without flag <strong>nosetuid</strong>,
support extended attributes, and
the kernel must support file capabilities.
All this runs out of the box on at least Ubuntu 12.04 LTS,
except that SCTP sockets appear to not support
network namespaces.</p> <p><strong>Namespace</strong> is a filename and is encoded
and decoded as discussed in module
<a href="file">file</a>, with the
following exceptions:</p> <ul><li><p>Emulator flag <strong>+fnu</strong> is ignored.</p></li><li><p><a href="#getopts/2">getopts/2</a>
for this option returns a binary for the filename if the stored
filename cannot be decoded. This is only to occur if you set the
option using a binary that cannot be decoded with the emulator's
filename encoding:
<a href="./file#native_name_encoding/0">file#native_name_encoding/0</a>.</p></li></ul> </dd><dt><strong>{bind_to_device, Ifname :: binary()}</strong></dt><dd> <p>Binds a socket to a specific network interface. This option
must be used in a function call that creates a socket, that is,
<a href="./gen_tcp#connect/3">gen_tcp#connect/3</a>,
<a href="./gen_tcp#listen/2">gen_tcp#listen/2</a>,
<a href="./gen_udp#open/1">gen_udp#open/1</a>, or
<a href="./gen_sctp#open/0">gen_sctp#open/0</a>.</p> <p>Unlike <a href="#getifaddrs/0">getifaddrs/0</a>, Ifname
is encoded a binary. In the unlikely case that a system is using
non-7-bit-ASCII characters in network device names, special care
has to be taken when encoding this argument.</p> <p>This option uses the Linux-specific socket option
<strong>SO_BINDTODEVICE</strong>, such as in Linux kernel 2.0.30 or later,
and therefore only exists when the runtime system
is compiled for such an operating system.</p> <p>Before Linux 3.8, this socket option could be set, but could not retrieved
with <a href="#getopts/2">getopts/2</a>. Since Linux 3.8,
it is readable.</p> <p>The virtual machine also needs elevated privileges, either
running as superuser or (for Linux) having capability
<strong>CAP_NET_RAW</strong>.</p> <p>The primary use case for this option is to bind sockets into
<a href="http://www.kernel.org/doc/Documentation/networking/vrf.txt">Linux VRF instances</a>.
</p> </dd><dt><strong>list</strong></dt><dd> <p>Received <strong>Packet</strong> is delivered as a list.</p> </dd><dt><strong>binary</strong></dt><dd> <p>Received <strong>Packet</strong> is delivered as a binary.</p> </dd><dt><strong>{nodelay, Boolean}</strong>(TCP/IP sockets)</dt><dd> <p>If <strong>Boolean == true</strong>, option <strong>TCP_NODELAY</strong>
is turned on for the socket, which means that also small
amounts of data are sent immediately.</p> </dd><dt><strong>{nopush, Boolean}</strong>(TCP/IP sockets)</dt><dd> <p>This translates to <strong>TCP_NOPUSH</strong> on BSD and
to <strong>TCP_CORK</strong> on Linux.</p> <p>If <strong>Boolean == true</strong>, the corresponding option
is turned on for the socket, which means that small
amounts of data are accumulated until a full MSS-worth
of data is available or this option is turned off.</p> <p>Note that while <strong>TCP_NOPUSH</strong> socket option is available on OSX, its semantics
is very different (e.g., unsetting it does not cause immediate send
of accumulated data). Hence, <strong>nopush</strong> option is intentionally ignored on OSX.</p> </dd><dt><strong>{packet, PacketType}</strong>(TCP/IP sockets)</dt><dd> <p><a name="packet"></a>Defines the type of packets to use for a socket.
Possible values:</p> <dl><dt><strong>raw | 0</strong></dt><dd> <p>No packaging is done.</p> </dd><dt><strong>1 | 2 | 4</strong></dt><dd> <p>Packets consist of a header specifying the number of
bytes in the packet, followed by that number of bytes.
The header length can be one, two, or four bytes, and
containing an unsigned integer in big-endian byte order.
Each send operation generates the header, and the header
is stripped off on each receive operation.</p> <p>The 4-byte header is limited to 2Gb.</p> </dd><dt><strong>asn1 | cdr | sunrm | fcgi | tpkt | line</strong></dt><dd> <p>These packet types only have effect on receiving.
When sending a packet, it is the responsibility of
the application to supply a correct header. On
receiving, however, one message is sent to
the controlling process for each complete packet
received, and, similarly, each call to
<strong>gen_tcp:recv/2,3</strong> returns one complete packet.
The header is <em>not</em> stripped off.</p> <p>The meanings of the packet types are as follows:</p> <ul><li><strong>asn1</strong> - ASN.1 BER</li><li><strong>sunrm</strong> - Sun's RPC encoding</li><li><strong>cdr</strong> - CORBA (GIOP 1.1)</li><li><strong>fcgi</strong> - Fast CGI</li><li><strong>tpkt</strong> - TPKT format [RFC1006]</li><li><strong>line</strong> - Line mode, a packet is a line-terminated with newline, lines longer than the receive buffer are truncated</li></ul> </dd><dt><strong>http | http_bin</strong></dt><dd> <p>The Hypertext Transfer Protocol. The packets
are returned with the format according to <strong>HttpPacket</strong>
described in
<a href="../erts/erlang#decode_packet/3">erts/erlang#decode_packet/3</a> in ERTS.
A socket in passive
mode returns <strong>{ok, HttpPacket}</strong> from <strong>gen_tcp:recv</strong>
while an active socket sends messages like
<strong>{http, Socket, HttpPacket}</strong>.</p> </dd><dt><strong>httph | httph_bin</strong></dt><dd> <p>These two types are often not needed, as the socket
automatically switches from <strong>http</strong>/<strong>http_bin</strong> to
<strong>httph</strong>/<strong>httph_bin</strong> internally after the first line
is read. However, there can be occasions when they are
useful, such as parsing trailers from chunked encoding.</p> </dd></dl> </dd><dt><strong>{packet_size, Integer}</strong>(TCP/IP sockets)</dt><dd> <p>Sets the maximum allowed length of the packet body. If
the packet header indicates that the length of the packet
is longer than the maximum allowed length, the packet is
considered invalid. The same occurs if the packet header
is too large for the socket receive buffer.</p> <p>For line-oriented protocols (<strong>line</strong>, <strong>http*</strong>),
option <strong>packet_size</strong> also guarantees that lines up to the
indicated length are accepted and not considered invalid
because of internal buffer limitations.</p> </dd><dt><strong>{line_delimiter, Char}</strong>(TCP/IP sockets)</dt><dd> <p>Sets the line delimiting character for line-oriented protocols
(<strong>line</strong>). Defaults to <strong>$\n</strong>.</p> </dd><dt><strong>{raw, Protocol, OptionNum, ValueBin}</strong></dt><dd> <p>See below.</p> </dd><dt><strong>{read_packets, Integer}</strong>(UDP sockets)</dt><dd> <p>Sets the maximum number of UDP packets to read without
intervention from the socket when data is available.
When this many packets have been read and delivered
to the destination process, new packets are not read
until a new notification of available data has arrived.
Defaults to <strong>5</strong>. If this parameter is set too
high, the system can become unresponsive because of
UDP packet flooding.</p> </dd><dt><strong>{recbuf, Size}</strong></dt><dd> <p>The minimum size of the receive buffer to use for
the socket. You are encouraged to use
<a href="#getopts/2">getopts/2</a>
to retrieve the size set by your operating system.</p> <a name="option-recvtclass"></a> </dd><dt><strong>{recvtclass, Boolean}</strong></dt><dd> <p>
If set to <strong>true</strong> activates returning the received
<strong>TCLASS</strong> value on platforms that implements
the protocol <strong>IPPROTO_IPV6</strong>
option <strong>IPV6_RECVTCLASS</strong> or <strong>IPV6_2292RECVTCLASS</strong>
for the socket.
The value is returned as a <strong>{tclass,TCLASS}</strong> tuple
regardless of if the platform returns an <strong>IPV6_TCLASS</strong>
or an <strong>IPV6_RECVTCLASS</strong> CMSG value.
</p> <p>
For packet oriented sockets that supports receiving
ancillary data with the payload data
(<strong>gen_udp</strong> and <strong>gen_sctp</strong>),
the <strong>TCLASS</strong> value is returned
in an extended return tuple contained in an
<a href="./inet#type-ancillary_data"> ancillary data </a>
list.
For stream oriented sockets (<strong>gen_tcp</strong>)
the only way to get the <strong>TCLASS</strong>
value is if the platform supports the
<a href="./gen_tcp#type-pktoptions_value">gen_tcp#type-pktoptions_value</a>
option.
</p> <a name="option-recvtos"></a> </dd><dt><strong>{recvtos, Boolean}</strong></dt><dd> <p>
If set to <strong>true</strong> activates returning the received
<strong>TOS</strong> value on platforms that implements
the protocol <strong>IPPROTO_IP</strong> option <strong>IP_RECVTOS</strong>
for the socket.
The value is returned as a <strong>{tos,TOS}</strong> tuple
regardless of if the platform returns an <strong>IP_TOS</strong>
or an <strong>IP_RECVTOS</strong> CMSG value.
</p> <p>
For packet oriented sockets that supports receiving
ancillary data with the payload data
(<strong>gen_udp</strong> and <strong>gen_sctp</strong>),
the <strong>TOS</strong> value is returned
in an extended return tuple contained in an
<a href="./inet#type-ancillary_data"> ancillary data </a>
list.
For stream oriented sockets (<strong>gen_tcp</strong>)
the only way to get the <strong>TOS</strong>
value is if the platform supports the
<a href="./gen_tcp#type-pktoptions_value">gen_tcp#type-pktoptions_value</a>
option.
</p> <a name="option-recvttl"></a> </dd><dt><strong>{recvttl, Boolean}</strong></dt><dd> <p>
If set to <strong>true</strong> activates returning the received
<strong>TTL</strong> value on platforms that implements
the protocol <strong>IPPROTO_IP</strong> option <strong>IP_RECVTTL</strong>
for the socket.
The value is returned as a <strong>{ttl,TTL}</strong> tuple
regardless of if the platform returns an <strong>IP_TTL</strong>
or an <strong>IP_RECVTTL</strong> CMSG value.
</p> <p>
For packet oriented sockets that supports receiving
ancillary data with the payload data
(<strong>gen_udp</strong> and <strong>gen_sctp</strong>),
the <strong>TTL</strong> value is returned
in an extended return tuple contained in an
<a href="./inet#type-ancillary_data"> ancillary data </a>
list.
For stream oriented sockets (<strong>gen_tcp</strong>)
the only way to get the <strong>TTL</strong>
value is if the platform supports the
<a href="./gen_tcp#type-pktoptions_value">gen_tcp#type-pktoptions_value</a>
option.
</p> </dd><dt><strong>{reuseaddr, Boolean}</strong></dt><dd> <p>Allows or disallows local reuse of port numbers. By
default, reuse is disallowed.</p> </dd><dt><strong>{send_timeout, Integer}</strong></dt><dd> <p>Only allowed for connection-oriented sockets.</p> <p>Specifies a longest time to wait for a send operation to
be accepted by the underlying TCP stack. When the limit is
exceeded, the send operation returns
<strong>{error,timeout}</strong>. How much of a packet that
got sent is unknown; the socket is therefore to be closed
whenever a time-out has occurred (see <strong>send_timeout_close</strong>
below). Defaults to <strong>infinity</strong>.</p> </dd><dt><strong>{send_timeout_close, Boolean}</strong></dt><dd> <p>Only allowed for connection-oriented sockets.</p> <p>Used together with <strong>send_timeout</strong> to specify whether
the socket is to be automatically closed when the send operation
returns <strong>{error,timeout}</strong>. The recommended setting is
<strong>true</strong>, which automatically closes the socket.
Defaults to <strong>false</strong> because of backward compatibility.</p> <a name="option-sndbuf"></a> </dd><dt><strong>{show_econnreset, Boolean}</strong>(TCP/IP sockets)</dt><dd> <p>When this option is set to <strong>false</strong>, which is
default, an RST received from the TCP peer is treated
as a normal close (as though an FIN was sent). A caller to
<a href="./gen_tcp#recv/2">gen_tcp#recv/2</a>
gets <strong>{error, closed}</strong>. In active
mode, the controlling process receives a
<strong>{tcp_closed, Socket}</strong> message, indicating that the
peer has closed the connection.</p> <p>Setting this option to <strong>true</strong> allows you to
distinguish between a connection that was closed normally,
and one that was aborted (intentionally or unintentionally)
by the TCP peer. A call to
<a href="./gen_tcp#recv/2">gen_tcp#recv/2</a>
returns <strong>{error, econnreset}</strong>. In
active mode, the controlling process receives a
<strong>{tcp_error, Socket, econnreset}</strong> message
before the usual <strong>{tcp_closed, Socket}</strong>, as is
the case for any other socket error. Calls to
<a href="./gen_tcp#send/2">gen_tcp#send/2</a>
also returns <strong>{error, econnreset}</strong> when it
is detected that a TCP peer has sent an RST.</p> <p>A connected socket returned from
<a href="./gen_tcp#accept/1">gen_tcp#accept/1</a>
inherits the <strong>show_econnreset</strong> setting from the
listening socket.</p> <a name="option-show_econnreset"></a> </dd><dt><strong>{sndbuf, Size}</strong></dt><dd> <p>The minimum size of the send buffer to use for the socket.
You are encouraged to use
<a href="#getopts/2">getopts/2</a>,
to retrieve the size set by your operating system.</p> </dd><dt><strong>{priority, Integer}</strong></dt><dd> <p>Sets the <strong>SO_PRIORITY</strong> socket level option on platforms
where this is implemented. The behavior and allowed range varies
between different systems.
The option is ignored on platforms where it
is not implemented. Use with caution.</p> </dd><dt><strong>{tos, Integer}</strong></dt><dd> <p>Sets <strong>IP_TOS IP</strong> level options on platforms where this is
implemented. The behavior and allowed range varies between
different systems.
The option is ignored on platforms where it is not
implemented. Use with caution.</p> </dd><dt><strong>{tclass, Integer}</strong></dt><dd> <p>
Sets <strong>IPV6_TCLASS IP</strong> level options on platforms
where this is implemented. The behavior and allowed range
varies between different systems.
The option is ignored on platforms where it is not
implemented. Use with caution.</p> </dd></dl><p>In addition to these options, <em>raw</em>
option specifications can be used. The raw options are
specified as a tuple of arity four, beginning with tag
<strong>raw</strong>, followed by the protocol level, the option number,
and the option value specified as a binary. This
corresponds to the second, third, and fourth arguments to the
<strong>setsockopt</strong> call in the C socket API. The option value
must be coded in the native endianess of the platform and,
if a structure is required, must follow the structure
alignment conventions on the specific platform.</p><p>Using raw socket options requires detailed knowledge about
the current operating system and TCP stack.</p><p><em>Example:</em></p><p>This example concerns the use of raw options. Consider a Linux
system where you want to set option <strong>TCP_LINGER2</strong> on
protocol level <strong>IPPROTO_TCP</strong> in the stack. You know
that on this particular system it defaults to 60 (seconds),
but you want to lower it to 30 for a particular
socket. Option <strong>TCP_LINGER2</strong> is not explicitly
supported by <strong>inet</strong>, but you know that the protocol level
translates to number 6, the option number to number 8,
and the value is to be specified as a 32-bit integer. You can use
this code line to set the option for the socket named
<strong>Sock</strong>:</p><pre><code class="">
inet:setopts(Sock,[{raw,6,8,&lt;&lt;30:32/native&gt;&gt;}]),</code></pre><p>As many options are silently discarded by the stack if they
are specified out of range; it can be a good idea to check that
a raw option is accepted. The following code places the value
in variable <strong>TcpLinger2:</strong></p><pre><code class="">
{ok,[{raw,6,8,&lt;&lt;TcpLinger2:32/native&gt;&gt;}]}=inet:getopts(Sock,[{raw,6,8,4}]),</code></pre><p>Code such as these examples is inherently non-portable,
even different versions of the same OS on the same platform
can respond differently to this kind of option
manipulation. Use with care.</p><p>Notice that the default options for TCP/IP sockets can be
changed with the Kernel configuration parameters mentioned in
the beginning of this manual page.</p><h3>sockname/1</h3><p>Return the local address and port number for a socket. </p><p>Returns the local address and port number for a socket.</p><p>Notice that for SCTP sockets this function returns only
one of the socket addresses. Function
<a href="#socknames/1">socknames/1</a>
returns all.</p><h3>socknames/1</h3><p>Return all local address/port numbers for a socket.</p><p>Equivalent to
<a href="#socknames/2">socknames/2</a>.
</p><h3>socknames/2</h3><p>Return all local address/port numbers for a socket.</p><p>Returns a list of all local address/port number pairs for a socket
for the specified association <strong><span class="anno">Assoc</span></strong>.</p><p>This function can return multiple addresses for multihomed
sockets, such as SCTP sockets. For other sockets it
returns a one-element list.</p><p>Notice that parameter <strong><span class="anno">Assoc</span></strong> is by the
<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-sctpsocket-13">SCTP Sockets API Extensions</a>
defined to be ignored for one-to-one style sockets.
For one-to-many style sockets, the special value <strong>0</strong>
is defined to mean that the returned addresses must be
without any particular association.
How different SCTP implementations interpret this varies somewhat.
</p><a name="error_codes"></a><h3>POSIX Error Codes</h3><ul><li><strong>e2big</strong> - Too long argument list</li><li><strong>eacces</strong> - Permission denied</li><li><strong>eaddrinuse</strong> - Address already in use</li><li><strong>eaddrnotavail</strong> - Cannot assign requested address</li><li><strong>eadv</strong> - Advertise error</li><li><strong>eafnosupport</strong> - Address family not supported by protocol family</li><li><strong>eagain</strong> - Resource temporarily unavailable</li><li><strong>ealign</strong> - EALIGN</li><li><strong>ealready</strong> - Operation already in progress</li><li><strong>ebade</strong> - Bad exchange descriptor</li><li><strong>ebadf</strong> - Bad file number</li><li><strong>ebadfd</strong> - File descriptor in bad state</li><li><strong>ebadmsg</strong> - Not a data message</li><li><strong>ebadr</strong> - Bad request descriptor</li><li><strong>ebadrpc</strong> - Bad RPC structure</li><li><strong>ebadrqc</strong> - Bad request code</li><li><strong>ebadslt</strong> - Invalid slot</li><li><strong>ebfont</strong> - Bad font file format</li><li><strong>ebusy</strong> - File busy</li><li><strong>echild</strong> - No children</li><li><strong>echrng</strong> - Channel number out of range</li><li><strong>ecomm</strong> - Communication error on send</li><li><strong>econnaborted</strong> - Software caused connection abort</li><li><strong>econnrefused</strong> - Connection refused</li><li><strong>econnreset</strong> - Connection reset by peer</li><li><strong>edeadlk</strong> - Resource deadlock avoided</li><li><strong>edeadlock</strong> - Resource deadlock avoided</li><li><strong>edestaddrreq</strong> - Destination address required</li><li><strong>edirty</strong> - Mounting a dirty fs without force</li><li><strong>edom</strong> - Math argument out of range</li><li><strong>edotdot</strong> - Cross mount point</li><li><strong>edquot</strong> - Disk quota exceeded</li><li><strong>eduppkg</strong> - Duplicate package name</li><li><strong>eexist</strong> - File already exists</li><li><strong>efault</strong> - Bad address in system call argument</li><li><strong>efbig</strong> - File too large</li><li><strong>ehostdown</strong> - Host is down</li><li><strong>ehostunreach</strong> - Host is unreachable</li><li><strong>eidrm</strong> - Identifier removed</li><li><strong>einit</strong> - Initialization error</li><li><strong>einprogress</strong> - Operation now in progress</li><li><strong>eintr</strong> - Interrupted system call</li><li><strong>einval</strong> - Invalid argument</li><li><strong>eio</strong> - I/O error</li><li><strong>eisconn</strong> - Socket is already connected</li><li><strong>eisdir</strong> - Illegal operation on a directory</li><li><strong>eisnam</strong> - Is a named file</li><li><strong>el2hlt</strong> - Level 2 halted</li><li><strong>el2nsync</strong> - Level 2 not synchronized</li><li><strong>el3hlt</strong> - Level 3 halted</li><li><strong>el3rst</strong> - Level 3 reset</li><li><strong>elbin</strong> - ELBIN</li><li><strong>elibacc</strong> - Cannot access a needed shared library</li><li><strong>elibbad</strong> - Accessing a corrupted shared library</li><li><strong>elibexec</strong> - Cannot exec a shared library directly</li><li><strong>elibmax</strong> - Attempting to link in more shared libraries than system limit</li><li><strong>elibscn</strong> - <strong>.lib</strong> section in <strong>a.out</strong> corrupted</li><li><strong>elnrng</strong> - Link number out of range</li><li><strong>eloop</strong> - Too many levels of symbolic links</li><li><strong>emfile</strong> - Too many open files</li><li><strong>emlink</strong> - Too many links</li><li><strong>emsgsize</strong> - Message too long</li><li><strong>emultihop</strong> - Multihop attempted</li><li><strong>enametoolong</strong> - Filename too long</li><li><strong>enavail</strong> - Unavailable</li><li><strong>enet</strong> - ENET</li><li><strong>enetdown</strong> - Network is down</li><li><strong>enetreset</strong> - Network dropped connection on reset</li><li><strong>enetunreach</strong> - Network is unreachable</li><li><strong>enfile</strong> - File table overflow</li><li><strong>enoano</strong> - Anode table overflow</li><li><strong>enobufs</strong> - No buffer space available</li><li><strong>enocsi</strong> - No CSI structure available</li><li><strong>enodata</strong> - No data available</li><li><strong>enodev</strong> - No such device</li><li><strong>enoent</strong> - No such file or directory</li><li><strong>enoexec</strong> - Exec format error</li><li><strong>enolck</strong> - No locks available</li><li><strong>enolink</strong> - Link has been severed</li><li><strong>enomem</strong> - Not enough memory</li><li><strong>enomsg</strong> - No message of desired type</li><li><strong>enonet</strong> - Machine is not on the network</li><li><strong>enopkg</strong> - Package not installed</li><li><strong>enoprotoopt</strong> - Bad protocol option</li><li><strong>enospc</strong> - No space left on device</li><li><strong>enosr</strong> - Out of stream resources or not a stream device</li><li><strong>enosym</strong> - Unresolved symbol name</li><li><strong>enosys</strong> - Function not implemented</li><li><strong>enotblk</strong> - Block device required</li><li><strong>enotconn</strong> - Socket is not connected</li><li><strong>enotdir</strong> - Not a directory</li><li><strong>enotempty</strong> - Directory not empty</li><li><strong>enotnam</strong> - Not a named file</li><li><strong>enotsock</strong> - Socket operation on non-socket</li><li><strong>enotsup</strong> - Operation not supported</li><li><strong>enotty</strong> - Inappropriate device for <strong>ioctl</strong></li><li><strong>enotuniq</strong> - Name not unique on network</li><li><strong>enxio</strong> - No such device or address</li><li><strong>eopnotsupp</strong> - Operation not supported on socket</li><li><strong>eperm</strong> - Not owner</li><li><strong>epfnosupport</strong> - Protocol family not supported</li><li><strong>epipe</strong> - Broken pipe</li><li><strong>eproclim</strong> - Too many processes</li><li><strong>eprocunavail</strong> - Bad procedure for program</li><li><strong>eprogmismatch</strong> - Wrong program version</li><li><strong>eprogunavail</strong> - RPC program unavailable</li><li><strong>eproto</strong> - Protocol error</li><li><strong>eprotonosupport</strong> - Protocol not supported</li><li><strong>eprototype</strong> - Wrong protocol type for socket</li><li><strong>erange</strong> - Math result unrepresentable</li><li><strong>erefused</strong> - EREFUSED</li><li><strong>eremchg</strong> - Remote address changed</li><li><strong>eremdev</strong> - Remote device</li><li><strong>eremote</strong> - Pathname hit remote filesystem</li><li><strong>eremoteio</strong> - Remote I/O error</li><li><strong>eremoterelease</strong> - EREMOTERELEASE</li><li><strong>erofs</strong> - Read-only filesystem</li><li><strong>erpcmismatch</strong> - Wrong RPC version</li><li><strong>erremote</strong> - Object is remote</li><li><strong>eshutdown</strong> - Cannot send after socket shutdown</li><li><strong>esocktnosupport</strong> - Socket type not supported</li><li><strong>espipe</strong> - Invalid seek</li><li><strong>esrch</strong> - No such process</li><li><strong>esrmnt</strong> - Srmount error</li><li><strong>estale</strong> - Stale remote file handle</li><li><strong>esuccess</strong> - Error 0</li><li><strong>etime</strong> - Timer expired</li><li><strong>etimedout</strong> - Connection timed out</li><li><strong>etoomanyrefs</strong> - Too many references</li><li><strong>etxtbsy</strong> - Text file or pseudo-device busy</li><li><strong>euclean</strong> - Structure needs cleaning</li><li><strong>eunatch</strong> - Protocol driver not attached</li><li><strong>eusers</strong> - Too many users</li><li><strong>eversion</strong> - Version mismatch</li><li><strong>ewouldblock</strong> - Operation would block</li><li><strong>exdev</strong> - Cross-domain link</li><li><strong>exfull</strong> - Message tables full</li><li><strong>nxdomain</strong> - Hostname or domain name cannot be found</li></ul><h2>inet_res</h2><p>A rudimentary DNS client.</p><p>This module performs DNS name resolving to recursive name servers.See also
<a href="./inet_cfg">ERTS User's Guide: Inet Configuration</a>
for more information about how to configure an Erlang runtime system
for IP communication, and how to enable this DNS client by defining
<strong>'dns'</strong> as a lookup method.
The DNS client then acts as a backend for the resolving functions in
<a href="./inet">kernel/inet</a>.This DNS client can resolve DNS records even if it
is not used for normal name resolving in the node.This is not a full-fledged resolver, only a
DNS client that relies on asking trusted recursive name servers.</p><h3>Name Resolving</h3><p>UDP queries are used unless resolver option
<strong>usevc</strong> is <strong>true</strong>, which forces TCP queries.
If the query is too large for UDP, TCP is used instead.
For regular DNS queries, 512 bytes is the size limit.</p><p>When EDNS is enabled (resolver option
<strong>edns</strong> is set to the EDNS version (that is, <strong>0</strong>
instead of <strong>false</strong>), resolver option
<strong>udp_payload_size</strong> sets the limit. If a name server
replies with the TC bit set (truncation), indicating that
the answer is incomplete, the query is retried
to that name server using TCP. Resolver option
<strong>udp_payload_size</strong> also sets the advertised
size for the maximum allowed reply size, if EDNS is
enabled, otherwise the name server uses the limit
512 bytes. If the reply is larger, it gets truncated,
forcing a TCP requery.</p><p>For UDP queries, resolver options <strong>timeout</strong>
and <strong>retry</strong> control retransmission.
Each name server in the <strong>nameservers</strong> list is
tried with a time-out of <strong>timeout</strong>/<strong>retry</strong>.
Then all name servers are tried again, doubling the
time-out, for a total of <strong>retry</strong> times.</p><p>For queries not using the <strong>search</strong> list,
if the query to all <strong>nameservers</strong> results in
<strong>{error,nxdomain}</strong> or an empty answer, the same
query is tried for <strong>alt_nameservers</strong>.</p><h3>Resolver Types</h3><p>The following data types concern the resolver:</p><h2>Data Types</h2><span class="name">res_option</span><span class="name">nameserver</span><span class="name">res_error</span><h3>DNS Types</h3><p><a name="dns_types"></a>
The following data types concern the DNS client:</p><h2>Data Types</h2><span class="name">dns_name</span><p>A string with no adjacent dots.</p><span class="name">rr_type</span><span class="name">dns_class</span><span class="name">dns_msg</span><p>This is the start of a hiearchy of opaque data structures
that can be examined with access functions in <strong>inet_dns</strong>, which
return lists of <strong>{Field,Value}</strong> tuples. The arity 2 functions
only return the value for a specified field.</p><pre>
dns_msg() = DnsMsg
    inet_dns:msg(DnsMsg) -&gt;
        [ {header, dns_header()}
        | {qdlist, dns_query()}
        | {anlist, dns_rr()}
        | {nslist, dns_rr()}
        | {arlist, dns_rr()} ]
    inet_dns:msg(DnsMsg, header) -&gt; dns_header() % for example
    inet_dns:msg(DnsMsg, Field) -&gt; Value

dns_header() = DnsHeader
    inet_dns:header(DnsHeader) -&gt;
        [ {id, integer()}
        | {qr, boolean()}
        | {opcode, query | iquery | status | integer()}
        | {aa, boolean()}
        | {tc, boolean()}
        | {rd, boolean()}
        | {ra, boolean()}
        | {pr, boolean()}
        | {rcode, integer(0..16)} ]
    inet_dns:header(DnsHeader, Field) -&gt; Value

query_type() = axfr | mailb | maila | any | rr_type()

dns_query() = DnsQuery
    inet_dns:dns_query(DnsQuery) -&gt;
        [ {domain, dns_name()}
        | {type, query_type()}
        | {class, dns_class()} ]
    inet_dns:dns_query(DnsQuery, Field) -&gt; Value

dns_rr() = DnsRr
    inet_dns:rr(DnsRr) -&gt; DnsRrFields | DnsRrOptFields
    DnsRrFields = [ {domain, dns_name()}
                  | {type, rr_type()}
                  | {class, dns_class()}
                  | {ttl, integer()}
                  | {data, dns_data()} ]
    DnsRrOptFields = [ {domain, dns_name()}
                     | {type, opt}
                     | {udp_payload_size, integer()}
                     | {ext_rcode, integer()}
                     | {version, integer()}
                     | {z, integer()}
                     | {data, dns_data()} ]
    inet_dns:rr(DnsRr, Field) -&gt; Value</pre><p>There is an information function for the types above:</p><pre>
inet_dns:record_type(dns_msg()) -&gt; msg;
inet_dns:record_type(dns_header()) -&gt; header;
inet_dns:record_type(dns_query()) -&gt; dns_query;
inet_dns:record_type(dns_rr()) -&gt; rr;
inet_dns:record_type(_) -&gt; undefined.</pre><p>So, <strong>inet_dns:(inet_dns:record_type(X))(X)</strong> converts
any of these data structures into a <strong>{Field,Value}</strong> list.</p><span class="name">dns_data</span><p><strong><span class="anno">Regexp</span></strong> is a string with characters encoded
in the UTF-8 coding standard.</p><h2>Functions</h2><h3>getbyname/2</h3><h3>getbyname/3</h3><p>Resolve a DNS record of the specified type for the specified host.</p><p>Resolves a DNS record of the specified type for the specified host,
of class <strong>in</strong>. Returns, on success, a <strong>hostent()</strong> record
with <strong>dns_data()</strong> elements in the address list field.</p><p>This function uses resolver option <strong>search</strong> that
is a list of domain names. If the name to resolve contains
no dots, it is prepended to each domain name in the
search list, and they are tried in order. If the name
contains dots, it is first tried as an absolute name
and if that fails, the search list is used. If the name
has a trailing dot, it is supposed to be
an absolute name and the search list is not used.</p><h3>gethostbyaddr/1</h3><h3>gethostbyaddr/2</h3><p>Return a hostent record for the host with the specified address.</p><p>Backend functions used by
<a href="../kernel/inet#gethostbyaddr/1">kernel/inet#gethostbyaddr/1</a>.
</p><h3>gethostbyname/1</h3><h3>gethostbyname/2</h3><h3>gethostbyname/3</h3><p>Return a hostent record for the host with the specified name. </p><p>Backend functions used by
<a href="../kernel/inet#gethostbyname/1">kernel/inet#gethostbyname/1</a>.
</p><p>This function uses resolver option <strong>search</strong> just like
<a href="#getbyname/2">getbyname/2</a>.
</p><p>If resolver option <strong>inet6</strong> is <strong>true</strong>,
an IPv6 address is looked up.</p><h3>lookup/3</h3><h3>lookup/4</h3><h3>lookup/5</h3><p>Resolve the DNS data for the record of the specified type and class for the specified name.</p><p>Resolves the DNS data for the record of the specified type and class
for the specified name. On success, filters out the answer records
with the correct <strong><span class="anno">Class</span></strong> and
<strong><span class="anno">Type</span></strong>, and returns
a list of their data fields. So, a lookup for type <strong>any</strong>
gives an empty answer, as the answer records have
specific types that are not <strong>any</strong>. An empty answer
or a failed lookup returns an empty list.</p><p>Calls
<a href="#resolve/3">resolve/3</a>
with the same arguments and filters the result, so
<strong><span class="anno">Opts</span></strong> is described for those functions.</p><h3>resolve/3</h3><h3>resolve/4</h3><h3>resolve/5</h3><p>Resolve a DNS record of the specified type and class for the specified name.</p><p>Resolves a DNS record of the specified type and class for the
specified name. The returned <strong>dns_msg()</strong> can be examined using
access functions in <strong>inet_db</strong>, as described in section
in <a href="#dns_types">DNS Types</a>.</p><p>If <strong><span class="anno">Name</span></strong> is an <strong>ip_address()</strong>, the domain
name to query for is generated as the standard reverse
<strong>".IN-ADDR.ARPA."</strong> name for an IPv4 address, or the
<strong>".IP6.ARPA."</strong> name for an IPv6 address.
In this case, you most probably want to use
<strong><span class="anno">Class</span> = in</strong> and <strong><span class="anno">Type</span> = ptr</strong>,
but it is not done automatically.</p><p><strong><span class="anno">Opts</span></strong> overrides the corresponding resolver
options. If option <strong>nameservers</strong> is specified, it is
assumed that it is the complete list of name serves,
so resolver option <strong>alt_nameserves</strong> is ignored.
However, if option <strong>alt_nameserves</strong> is also specified to this
function, it is used.</p><p>Option <strong>verbose</strong> (or rather <strong>{verbose,true}</strong>)
causes diagnostics printout through
<a href="../stdlib/io#format/3">stdlib/io#format/3</a>
of queries, replies retransmissions, and so on, similar
to from utilities, such as <strong>dig</strong> and <strong>nslookup</strong>.</p><p>If <strong><span class="anno">Opt</span></strong> is any atom, it is interpreted
as <strong>{<span class="anno">Opt</span>,true}</strong> unless the atom string starts with
<strong>"no"</strong>, making the
interpretation <strong>{<span class="anno">Opt</span>,false}</strong>.
For example, <strong>usevc</strong> is an alias for <strong>{usevc,true}</strong>
and <strong>nousevc</strong> is an alias for <strong>{usevc,false}</strong>.</p><p>Option <strong>inet6</strong> has no effect on this function. You
probably want to use <strong><span class="anno">Type</span> = a | aaaa</strong> instead.</p><h3>Example</h3><p>This access functions example shows how
<a href="#lookup/3">lookup/3</a>
can be implemented using
<a href="#resolve/3">resolve/3</a>
from outside the module:</p><pre><code class="">
example_lookup(Name, Class, Type) -&gt;
    case inet_res:resolve(Name, Class, Type) of
        {ok,Msg} -&gt;
            [inet_dns:rr(RR, data)
             || RR &lt;- inet_dns:msg(Msg, anlist),
                 inet_dns:rr(RR, type) =:= Type,
                 inet_dns:rr(RR, class) =:= Class];
        {error,_} -&gt;
            []
     end.</code></pre><h3>Legacy Functions</h3><p>These are deprecated because the annoying double
meaning of the name servers/time-out argument, and
because they have no decent place for a resolver options list.</p><h2>Functions</h2><h3>nslookup/3</h3><h3>nslookup/4</h3><h3>nslookup/4</h3><p>Resolve a DNS record of the specified type and class for the specified name.</p><ul><li>Name</li></ul><ul><li>Class</li></ul><ul><li>Type</li></ul><ul><li>Timeout</li></ul><ul><li>Nameservers</li></ul><ul><li>Reason</li></ul><p>Resolves a DNS record of the specified type and class for the
specified name.</p><h3>nnslookup/4</h3><h3>nnslookup/5</h3><p>Resolve a DNS record of the specified type and class for the specified name.</p><p>Resolves a DNS record of the specified type and class for the
specified name.</p><h2>init</h2><p>Coordination of system startup.</p><p>This module is moved to the
<a href="./init">ERTS</a> application.</p><h2>logger</h2><p>API module for Logger, the standard logging facility
    in Erlang/OTP.</p><p>This module implements the main API for logging in
Erlang/OTP. To create a log event, use the
<a href="#logging_API">API functions</a> or the
log
<a href="#macros">macros</a>, for example:<pre><code class="">
?LOG_ERROR("error happened because: ~p", [Reason]).   % With macro
logger:error("error happened because: ~p", [Reason]). % Without macro
    </code></pre>To configure the Logger backend,
use <a href="./kernel_app#logger">Kernel configuration parameters</a>
or <a href="#configuration_API">configuration functions</a> in the Logger API.By default, the Kernel application installs one log handler at
system start. This handler is named <strong>default</strong>. It receives
and processes standard log events produced by the Erlang runtime
system, standard behaviours and different Erlang/OTP
applications. The log events are by default printed to the
terminal.If you want your systems logs to be printed to a file instead,
you must configure the default handler to do so. The simplest
way is to include the following in
your <a href="config">config</a>:<pre><code class="">
[{kernel,
  [{logger,
    [{handler, default, logger_std_h,
      #{config =&gt; #{file =&gt; "path/to/file.log"}}}]}]}].
      </code></pre>
For more information about:
<ul><li>the Logger facility in general, see the <a href="logger_chapter">User's Guide</a>.</li><li>how to configure Logger, see the <a href="./logger_chapter#configuration">Configuration</a> section in the User's Guide.</li><li>the built-in handlers, see <a href="logger_std_h">logger_std_h</a> and <a href="logger_disk_log_h">logger_disk_log_h</a>.</li><li>the built-in formatter, see <a href="logger_formatter">logger_formatter</a>.</li><li>built-in filters, see <a href="logger_filters">logger_filters</a>.</li></ul></p><h2>Data Types</h2><span class="name">filter</span><p>A filter which can be installed as a handler filter, or as
a primary filter in Logger.</p><span class="name">filter_arg</span><p>The second argument to the filter fun.</p><span class="name">filter_id</span><p>A unique identifier for a filter.</p><span class="name">filter_return</span><p>The return value from the filter fun.</p><span class="name">formatter_config</span><p>Configuration data for the
formatter. See <a href="logger_formatter">logger_formatter</a>
for an example of a formatter implementation.</p><span class="name">handler_config</span><p>Handler configuration data for Logger. The following
default values apply:</p><ul><li><strong>level =&gt; all</strong></li><li><strong>filter_default =&gt; log</strong></li><li><strong>filters =&gt; []</strong></li><li><strong>formatter =&gt; {logger_formatter, DefaultFormatterConfig</strong>}</li></ul><p>In addition to these, the following fields are
automatically inserted by Logger, values taken from the
two first parameters
to <a href="#add_handler-3">add_handler-3</a>:</p><ul><li><strong>id =&gt; HandlerId</strong></li><li><strong>module =&gt; Module</strong></li></ul><p>These are read-only and cannot be changed in runtime.</p><p>Handler specific configuration data is inserted by the
handler callback itself, in a sub structure associated with
the field named <strong>config</strong>. See
the <a href="logger_std_h">logger_std_h</a>
and <a href="logger_disk_log_h">logger_disk_log_h</a>
manual pages for information about the specifc configuration
for these handlers.</p><p>See the <a href="./logger_formatter#type-config">logger_formatter#type-config</a> manual page for
information about the default configuration for this
formatter.</p><span class="name">handler_id</span><p>A unique identifier for a handler instance.</p><span class="name">level</span><p>The severity level for the message to be logged.</p><span class="name">log_event</span><span class="name">metadata</span><p>Metadata for the log event.</p><p>Logger adds the following metadata to each log event:</p><ul><li><strong>pid  =&gt; self()</strong></li><li><strong>gl   =&gt; group_leader()</strong></li><li><strong>time =&gt; logger:timestamp()</strong></li></ul><p>When a log macro is used, Logger also inserts location
information:</p><ul><li><strong>mfa  =&gt; {?MODULE, ?FUNCTION_NAME, ?FUNCTION_ARITY}</strong></li><li><strong>file =&gt; ?FILE</strong></li><li><strong>line =&gt; ?LINE</strong></li></ul><p>You can add custom metadata, either by specifying a map as
the last parameter to any of the log macros or the API
functions, or by setting process metadata
with <a href="#set_process_metadata-1">set_process_metadata-1</a>
or <a href="#update_process_metadata-1">update_process_metadata-1</a>.</p><p>Logger merges all the metadata maps before forwarding the
log event to the handlers. If the same keys occur, values
from the log call overwrite process metadata, which in turn
overwrite values set by Logger.</p><p>The following custom metadata keys have special meaning:</p><dl><dt><strong>domain</strong></dt><dd> <p>The value associated with this key is used by filters
for grouping log events originating from, for example,
specific functional
areas. See <a href="./logger_filters#domain-2">logger_filters#domain-2</a>
for a description of how this field can be used.</p> </dd><dt><strong>report_cb</strong></dt><dd> <p>If the log message is specified as
a <a href="#type-report">type-report</a>,
the <strong>report_cb</strong> key can be associated with a fun
(report callback) that converts the report to a format
string and arguments, or directly to a string. See the
type definition
of <a href="#type-report_cb">type-report_cb</a>,
and
section <a href="./logger_chapter#log_message">Log Message</a> in the User's Guide for more
information about report callbacks.</p> </dd></dl><span class="name">msg_fun</span><span class="name">olp_config</span><span class="name">primary_config</span><p>Primary configuration data for Logger. The following
default values apply:</p><ul><li><strong>level =&gt; info</strong></li><li><strong>filter_default =&gt; log</strong></li><li><strong>filters =&gt; []</strong></li></ul><span class="name">report</span><span class="name">report_cb</span><p>A fun which converts a <a href="#type-report">type-report</a> to a format string and arguments, or directly to a string.
See section <a href="./logger_chapter#log_message">Log Message</a> in the User's Guide for more
information.</p><span class="name">report_cb_config</span><span class="name">timestamp</span><p>A timestamp produced
with <a href="#timestamp-0">timestamp-0</a>.</p><h3>Macros</h3><p>The following macros are defined in <strong>logger.hrl</strong>, which
is included in a module with the directive</p><pre><code class="">
    -include_lib("kernel/include/logger.hrl").</code></pre><ul><li><strong>?LOG_EMERGENCY(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_EMERGENCY(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_ALERT(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_ALERT(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_CRITICAL(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_CRITICAL(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_ERROR(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_ERROR(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_WARNING(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_WARNING(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_NOTICE(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_NOTICE(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_INFO(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_INFO(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG_DEBUG(StringOrReport[,Metadata])</strong></li><li><strong>?LOG_DEBUG(FunOrFormat,Args[,Metadata])</strong></li><li><strong>?LOG(Level,StringOrReport[,Metadata])</strong></li><li><strong>?LOG(Level,FunOrFormat,Args[,Metadata])</strong></li></ul><p>All macros expand to a call to Logger, where <strong>Level</strong> is
taken from the macro name, or from the first argument in the
case of the <strong>?LOG</strong> macro. Location data is added to the
metadata as described under
the <a href="#type-metadata">type-metadata</a>
type definition.</p><p>The call is wrapped in a case statement and will be evaluated
only if <strong>Level</strong> is equal to or below the configured log
level.</p><a name="logging_API"></a><h3>Logging API functions</h3><h2>Functions</h2><h3>emergency(StringOrReport[,Metadata])</h3><h3>emergency(Format,Args[,Metadata])</h3><h3>emergency(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>emergency</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>alert(StringOrReport[,Metadata])</h3><h3>alert(Format,Args[,Metadata])</h3><h3>alert(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>alert</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>critical(StringOrReport[,Metadata])</h3><h3>critical(Format,Args[,Metadata])</h3><h3>critical(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>critical</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>error(StringOrReport[,Metadata])</h3><h3>error(Format,Args[,Metadata])</h3><h3>error(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>error</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>warning(StringOrReport[,Metadata])</h3><h3>warning(Format,Args[,Metadata])</h3><h3>warning(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>warning</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>notice(StringOrReport[,Metadata])</h3><h3>notice(Format,Args[,Metadata])</h3><h3>notice(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>notice</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>info(StringOrReport[,Metadata])</h3><h3>info(Format,Args[,Metadata])</h3><h3>info(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>info</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>debug(StringOrReport[,Metadata])</h3><h3>debug(Format,Args[,Metadata])</h3><h3>debug(Fun,FunArgs[,Metadata])</h3><p>Logs the given message as level <strong>debug</strong>.</p><p>Equivalent to
<a href="#log-2">log-2</a>.</p><h3>log/2</h3><h3>log/3</h3><h3>log/3</h3><h3>log/3</h3><h3>log/4</h3><h3>log/4</h3><p>Logs the given message.</p><ul><li>Level</li></ul><ul><li>StringOrReport</li></ul><ul><li>Format</li></ul><ul><li>Args</li></ul><ul><li>Fun</li></ul><ul><li>FunArgs</li></ul><ul><li>Metadata</li></ul><p>Log the given message.</p><a name="configuration_API"></a><h3>Configuration API functions</h3><h2>Functions</h2><h3>add_handler/3</h3><p>Add a handler with the given configuration.</p><p>Add a handler with the given configuration.</p><p><strong><span class="anno">HandlerId</span></strong> is a unique identifier which
must be used in all subsequent calls referring to this
handler.</p><h3>add_handler_filter/3</h3><p>Add a filter to the specified handler.</p><p>Add a filter to the specified handler.</p><p>The filter fun is called with the log event as the first
parameter, and the specified <strong>filter_args()</strong> as the
second parameter.</p><p>The return value of the fun specifies if a log event is to
be discarded or forwarded to the handler callback:</p><dl><dt><strong>log_event()</strong></dt><dd> <p>The filter <em>passed</em>. The next handler filter, if
any, is applied. If no more filters exist for this
handler, the log event is forwarded to the handler
callback.</p> </dd><dt><strong>stop</strong></dt><dd> <p>The filter <em>did not pass</em>, and the log event is
immediately discarded.</p> </dd><dt><strong>ignore</strong></dt><dd> <p>The filter has no knowledge of the log event. The next
handler filter, if any, is applied. If no more filters
exist for this handler, the value of
the <strong>filter_default</strong> configuration parameter for
the handler specifies if the log event shall be
discarded or forwarded to the handler callback.</p> </dd></dl><p>See
section <a href="./logger_chapter#filters">Filters</a>
in the User's Guide for more information about filters.</p><p>Some built-in filters exist. These are defined in
<a href="logger_filters">logger_filters</a>.</p><h3>add_handlers/1</h3><p>Set up log handlers from the application's configuration parameters.</p><p>Reads the application configuration parameter <strong>logger</strong> and
calls <strong>add_handlers/1</strong> with its contents.</p><h3>add_handlers/1</h3><p>Setup logger handlers.</p><ul><li>config_handler</li></ul><p>This function should be used by custom Logger handlers to make
configuration consistent no matter which handler the system uses.
Normal usage is to add a call to <strong>logger:add_handlers/1</strong>
just after the processes that the handler needs are started,
and pass the application's <strong>logger</strong> configuration as the argument.
For example:</p><pre><code class="">
-behaviour(application).
start(_, []) -&gt;
    case supervisor:start_link({local, my_sup}, my_sup, []) of
        {ok, Pid} -&gt;
            ok = logger:add_handlers(my_app),
            {ok, Pid, []};
        Error -&gt; Error
     end.</code></pre><p>This reads the <strong>logger</strong> configuration parameter from
the <strong>my_app</strong> application and starts the configured
handlers. The contents of the configuration use the same
rules as the
<a href="./logger_chapter#handler-configuration">logger handler configuration</a>.
</p><p>If the handler is meant to replace the default handler, the Kernel's
default handler have to be disabled before the new handler is added.
A <strong>sys.config</strong> file that disables the Kernel handler and adds
a custom handler could look like this:</p><pre><code class="">
[{kernel,
  [{logger,
    %% Disable the default Kernel handler
    [{handler, default, undefined}]}]},
 {my_app,
  [{logger,
    %% Enable this handler as the default
    [{handler, default, my_handler, #{}}]}]}].
         </code></pre><h3>add_primary_filter/2</h3><p>Add a primary filter to Logger.</p><p>Add a primary filter to Logger.</p><p>The filter fun is called with the log event as the first
parameter, and the specified <strong>filter_args()</strong> as the
second parameter.</p><p>The return value of the fun specifies if a log event is to
be discarded or forwarded to the handlers:</p><dl><dt><strong>log_event()</strong></dt><dd> <p>The filter <em>passed</em>. The next primary filter, if
any, is applied. If no more primary filters exist, the
log event is forwarded to the handler part of Logger,
where handler filters are applied.</p> </dd><dt><strong>stop</strong></dt><dd> <p>The filter <em>did not pass</em>, and the log event is
immediately discarded.</p> </dd><dt><strong>ignore</strong></dt><dd> <p>The filter has no knowledge of the log event. The next
primary filter, if any, is applied. If no more primary
filters exist, the value of the
primary <strong>filter_default</strong> configuration parameter
specifies if the log event shall be discarded or
forwarded to the handler part.</p> </dd></dl><p>See section <a href="./logger_chapter#filters"> Filters</a> in the User's Guide for more information
about filters.</p><p>Some built-in filters exist. These are defined
in <a href="logger_filters">logger_filters</a>.</p><h3>get_config/0</h3><p>Look up the current Logger configuration</p><p>Look up all current Logger configuration, including primary,
handler, and proxy configuration, and module level settings.</p><h3>get_handler_config/0</h3><p>Look up the current configuration for all handlers.</p><p>Look up the current configuration for all handlers.</p><h3>get_handler_config/1</h3><p>Look up the current configuration for the given handler.</p><p>Look up the current configuration for the given handler.</p><h3>get_handler_ids/0</h3><p>Look up the identities for all installed handlers.</p><p>Look up the identities for all installed handlers.</p><h3>get_primary_config/0</h3><p>Look up the current primary configuration for Logger.</p><p>Look up the current primary configuration for Logger.</p><h3>get_proxy_config/0</h3><p>Look up the current configuration for the Logger proxy.</p><p>Look up the current configuration for the Logger proxy.</p><p>For more information about the proxy, see
section <a href="./logger_chapter#proxy">Logger Proxy</a> in the Kernel User's Guide.</p><h3>get_module_level/0</h3><p>Look up all current module levels.</p><p>Look up all current module levels. Returns a list
containing one <strong>{Module,Level}</strong> element for each module
for which the module level was previously set
with <a href="#set_module_level-2">set_module_level-2</a>.</p><h3>get_module_level/1</h3><p>Look up the current level for the given modules.</p><p>Look up the current level for the given modules. Returns a
list containing one <strong>{Module,Level}</strong> element for each
of the given modules for which the module level was
previously set with <a href="#set_module_level-2">set_module_level-2</a>.</p><h3>get_process_metadata/0</h3><p>Retrieve data set with set_process_metadata/1.</p><p>Retrieve data set
with <a href="#set_process_metadata-1">set_process_metadata-1</a> or
<a href="#update_process_metadata-1">update_process_metadata-1</a>.</p><h3>i/0</h3><h3>i/1</h3><p>Pretty print the Logger configuration.</p><p>Pretty print the Logger configuration.</p><h3>remove_handler/1</h3><p>Remove the handler with the specified identity.</p><p>Remove the handler identified by <strong><span class="anno">HandlerId</span></strong>.</p><h3>remove_handler_filter/2</h3><p>Remove a filter from the specified handler.</p><p>Remove the filter identified
by <strong><span class="anno">FilterId</span></strong> from the handler identified
by <strong><span class="anno">HandlerId</span></strong>.</p><h3>remove_primary_filter/1</h3><p>Remove a primary filter from Logger.</p><p>Remove the primary filter identified
by <strong><span class="anno">FilterId</span></strong> from Logger.</p><h3>set_application_level/2</h3><p>Set the log level for all modules in the specified application.</p><p>Set the log level for all the modules of the specified application.</p><p>This function is a convenience function that calls
<a href="#set_module_level/2">logger:set_module_level/2</a>
for each module associated with an application.</p><h3>set_handler_config/2</h3><p>Set configuration data for the specified handler.</p><p>Set configuration data for the specified handler. This
overwrites the current handler configuration.</p><p>To modify the existing configuration,
use <a href="#update_handler_config-2">update_handler_config-2</a>, or, if a more
complex merge is needed, read the current configuration
with <a href="#get_handler_config-1">get_handler_config-1</a>, then do the merge before writing the new
configuration back with this function.</p><p>If a key is removed compared to the current configuration,
and the key is known by Logger, the default value is used. If
it is a custom key, then it is up to the handler
implementation if the value is removed or a default value is
inserted.</p><h3>set_handler_config/3</h3><h3>set_handler_config/3</h3><h3>set_handler_config/3</h3><h3>set_handler_config/3</h3><h3>set_handler_config/3</h3><p>Add or update configuration data for the specified handler.</p><ul><li>HandlerId</li></ul><ul><li>Level</li></ul><ul><li>FilterDefault</li></ul><ul><li>Filters</li></ul><ul><li>Formatter</li></ul><ul><li>Config</li></ul><ul><li>Return</li></ul><p>Add or update configuration data for the specified
handler. If the given <strong><span class="anno">Key</span></strong> already
exists, its associated value will be changed
to the given value. If it does not exist, it will
be added.</p><p>If the value is incomplete, which for example can be the
case for the <strong>config</strong> key, it is up to the handler
implementation how the unspecified parts are set. For all
handlers in the Kernel application, unspecified data for
the <strong>config</strong> key is set to default values. To update
only specified data, and keep the existing configuration for
the rest, use <a href="#update_handler_config-3">update_handler_config-3</a>.</p><p>See the definition of
the <a href="#type-handler_config">type-handler_config</a> type for more
information about the different parameters.</p><h3>set_primary_config/1</h3><p>Set primary configuration data for Logger.</p><p>Set primary configuration data for Logger. This
overwrites the current configuration.</p><p>To modify the existing configuration,
use <a href="#update_primary_config-1">update_primary_config-1</a>, or, if a more
complex merge is needed, read the current configuration
with <a href="#get_primary_config-0">get_primary_config-0</a>, then do the merge before writing the new
configuration back with this function.</p><p>If a key is removed compared to the current configuration,
the default value is used.</p><h3>set_primary_config/2</h3><h3>set_primary_config/2</h3><h3>set_primary_config/2</h3><p>Add or update primary configuration data for Logger.</p><ul><li>Level</li></ul><ul><li>FilterDefault</li></ul><ul><li>Filters</li></ul><p>Add or update primary configuration data for Logger. If the
given <strong><span class="anno">Key</span></strong> already exists, its associated
value will be changed to the given value. If it does not
exist, it will be added.</p><h3>set_proxy_config/1</h3><p>Set configuration data for the Logger proxy.</p><p>Set configuration data for the Logger proxy. This
overwrites the current proxy configuration. Keys that are not
specified in the <strong><span class="anno">Config</span></strong> map gets default
values.</p><p>To modify the existing configuration,
use <a href="#update_proxy_config-1">update_proxy_config-1</a>, or, if a more
complex merge is needed, read the current configuration
with <a href="#get_proxy_config-0">get_proxy_config-0</a>, then do the merge before writing the new
configuration back with this function.</p><p>For more information about the proxy, see
section <a href="./logger_chapter#proxy">Logger Proxy</a> in the Kernel User's Guide.</p><h3>set_module_level/2</h3><p>Set the log level for the specified modules.</p><p>Set the log level for the specified modules.</p><p>The log level for a module overrides the primary log level
of Logger for log events originating from the module in
question. Notice, however, that it does not override the
level configuration for any handler.</p><p>For example: Assume that the primary log level for Logger
is <strong>info</strong>, and there is one handler, <strong>h1</strong>, with
level <strong>info</strong> and one handler, <strong>h2</strong>, with
level <strong>debug</strong>.</p><p>With this configuration, no debug messages will be logged,
since they are all stopped by the primary log level.</p><p>If the level for <strong>mymodule</strong> is now set
to <strong>debug</strong>, then debug events from this module will be
logged by the handler <strong>h2</strong>, but not by
handler <strong>h1</strong>.</p><p>Debug events from other modules are still not logged.</p><p>To change the primary log level for Logger, use
<a href="#set_primary_config/2">set_primary_config/2</a>.</p><p>To change the log level for a handler, use
<a href="#set_handler_config/3">set_handler_config/3</a>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The originating module for a log event is only detected
if the key <strong>mfa</strong> exists in the metadata, and is
associated with <strong>{Module, Function, Arity}</strong>. When log
macros are used, this association is automatically added
to all log events. If an API function is called directly,
without using a macro, the logging client must explicitly
add this information if module levels shall have any
effect.</p></div><h3>set_process_metadata/1</h3><p>Set metadata to use when logging from current process.</p><p>Set metadata which Logger shall automatically insert in
all log events produced on the current process.</p><p>Location data produced by the log macros, and/or metadata
given as argument to the log call (API function or macro),
are merged with the process metadata. If the same keys
occur, values from the metadata argument to the log call
overwrite values from the process metadata, which in turn
overwrite values from the location data.</p><p>Subsequent calls to this function overwrites previous data
set. To update existing data instead of overwriting it,
see <a href="#update_process_metadata-1">update_process_metadata-1</a>.</p><h3>unset_application_level/1</h3><p>Unset the log level for all modules in the specified application.</p><p>Unset the log level for all the modules of the specified application.</p><p>This function is a convinience function that calls
<a href="#unset_module_level/1">logger:unset_module_level/2</a>
for each module associated with an application.</p><h3>unset_module_level/0</h3><p>Remove module specific log settings for all modules.</p><p>Remove module specific log settings. After this, the
primary log level is used for all modules.</p><h3>unset_module_level/1</h3><p>Remove module specific log settings for the given modules.</p><p>Remove module specific log settings. After this, the
primary log level is used for the specified modules.</p><h3>unset_process_metadata/0</h3><p>Delete data set with set_process_metadata/1.</p><p>Delete data set
with <a href="#set_process_metadata-1">set_process_metadata-1</a> or
<a href="#update_process_metadata-1">update_process_metadata-1</a>.</p><h3>update_formatter_config/2</h3><p>Update the formatter configuration for the specified handler.</p><p>Update the formatter configuration for the specified handler.</p><p>The new configuration is merged with the existing formatter
configuration.</p><p>To overwrite the existing configuration without any merge,
use</p><pre>
.</pre><h3>update_formatter_config/3</h3><p>Update the formatter configuration for the specified handler.</p><p>Update the formatter configuration for the specified handler.</p><p>This is equivalent to</p><pre>
</pre><h3>update_handler_config/2</h3><p>Update configuration data for the specified handler.</p><p>Update configuration data for the specified handler. This function
behaves as if it was implemented as follows:</p><pre><code class="erl">
{ok, {_, Old}} = logger:get_handler_config(HandlerId),
logger:set_handler_config(HandlerId, maps:merge(Old, Config)).
	</code></pre><p>To overwrite the existing configuration without any merge,
use <a href="#set_handler_config-2">set_handler_config-2</a>.</p><h3>update_handler_config/3</h3><h3>update_handler_config/3</h3><h3>update_handler_config/3</h3><h3>update_handler_config/3</h3><h3>update_handler_config/3</h3><p>Add or update configuration data for the specified handler.</p><ul><li>HandlerId</li></ul><ul><li>Level</li></ul><ul><li>FilterDefault</li></ul><ul><li>Filters</li></ul><ul><li>Formatter</li></ul><ul><li>Config</li></ul><ul><li>Return</li></ul><p>Add or update configuration data for the specified
handler. If the given <strong><span class="anno">Key</span></strong> already
exists, its associated value will be changed
to the given value. If it does not exist, it will
be added.</p><p>If the value is incomplete, which for example can be the
case for the <strong>config</strong> key, it is up to the handler
implementation how the unspecified parts are set. For all
handlers in the Kernel application, unspecified data for
the <strong>config</strong> key is not changed. To reset unspecified
data to default values,
use <a href="#set_handler_config-3">set_handler_config-3</a>.</p><p>See the definition of
the <a href="#type-handler_config">type-handler_config</a> type for more
information about the different parameters.</p><h3>update_primary_config/1</h3><p>Update primary configuration data for Logger.</p><p>Update primary configuration data for Logger. This function
behaves as if it was implemented as follows:</p><pre><code class="erl">
Old = logger:get_primary_config(),
logger:set_primary_config(maps:merge(Old, Config)).
	</code></pre><p>To overwrite the existing configuration without any merge,
use <a href="#set_primary_config-1">set_primary_config-1</a>.</p><h3>update_process_metadata/1</h3><p>Set or update metadata to use when logging from current process.</p><p>Set or update metadata to use when logging from current
process</p><p>If process metadata exists for the current process, this
function behaves as if it was implemented as follows:</p><pre><code class="erl">
logger:set_process_metadata(maps:merge(logger:get_process_metadata(), Meta)).
	</code></pre><p>If no process metadata exists, the function behaves as
<a href="#set_process_metadata-1">set_process_metadata-1</a>.</p><h3>update_proxy_config/1</h3><p>Update configuration data for the Logger proxy.</p><p>Update configuration data for the Logger proxy. This function
behaves as if it was implemented as follows:</p><pre><code class="erl">
Old = logger:get_proxy_config(),
logger:set_proxy_config(maps:merge(Old, Config)).
	</code></pre><p>To overwrite the existing configuration without any merge,
use <a href="#set_proxy_config-1">set_proxy_config-1</a>.</p><p>For more information about the proxy, see
section <a href="./logger_chapter#proxy">Logger Proxy</a> in the Kernel User's Guide.</p><a name="misc_API"></a><h3>Miscellaneous API functions</h3><h2>Functions</h2><h3>compare_levels/2</h3><p>Compare the severity of two log levels.</p><p>Compare the severity of two log levels. Returns <strong>gt</strong>
if <strong>Level1</strong> is more severe than
<strong>Level2</strong>, <strong>lt</strong> if <strong>Level1</strong> is less severe,
and <strong>eq</strong> if the levels are equal.</p><h3>format_report/1</h3><p>Convert a log message on report form to {Format, Args}.</p><p>Convert a log message on report form to <strong>{Format, Args}</strong>. This is the default report callback used
by <a href="logger_formatter">logger_formatter</a> when no custom report
callback is found. See
section <a href="./logger_chapter#log_message">Log Message</a> in the Kernel User's Guide for
information about report callbacks and valid forms of log
messages.</p><p>The function produces lines of <strong>Key: Value</strong> from
key-value lists. Strings are printed with <strong>~ts</strong> and
other terms with <strong>~tp</strong>.</p><p>If <strong><span class="anno">Report</span></strong> is a map, it is converted to
a key-value list before formatting as such.</p><h3>timestamp/0</h3><p>Return a timestamp to insert in meta data for a log event.</p><p>Return a timestamp that can be inserted as the <strong>time</strong>
field in the meta data for a log event. It is produced with
<a href="../kernel/os#system_time-1">kernel/os#system_time-1</a>.</p><p>Notice that Logger automatically inserts a timestamp in the
meta data unless it already exists. This function is
exported for the rare case when the timestamp must be taken
at a different point in time than when the log event is
issued.</p><a name="handler_callback_functions"></a><h3>Handler Callback Functions</h3><p>The following functions are to be exported from a handler
callback module.</p><h2>Functions</h2><h3>HModule:adding_handler(Config1) -&gt; {ok, Config2} | {error,
	Reason}</h3><p>An instance of this handler is about to be added.</p><ul><li><span class="v">Config1 = Config2 = </span></li><li><span class="v">Reason = term()</span></li></ul><p>This callback function is optional.</p><p>The function is called on a temporary process when an new
handler is about to be added. The purpose is to verify the
configuration and initiate all resources needed by the
handler.</p><p>The handler identity is associated with the <strong>id</strong> key
in <strong>Config1</strong>.</p><p>If everything succeeds, the callback function can add
possible default values or internal state values to the
configuration, and return the adjusted map
in <strong>{ok,Config2}</strong>.</p><p>If the configuration is faulty, or if the initiation fails,
the callback function must return <strong>{error,Reason}</strong>.</p><h3>HModule:changing_config(SetOrUpdate, OldConfig, NewConfig) -&gt; {ok, Config} | {error, Reason}</h3><p>The configuration for this handler is about to change.</p><ul><li><span class="v">SetOrUpdate = set | update</span></li><li><span class="v">OldConfig = NewConfig = Config = </span></li><li><span class="v">Reason = term()</span></li></ul><p>This callback function is optional.</p><p>The function is called on a temporary process when the
configuration for a handler is about to change. The purpose
is to verify and act on the new configuration.</p><p><strong>OldConfig</strong> is the existing configuration
and <strong>NewConfig</strong> is the new configuration.</p><p>The handler identity is associated with the <strong>id</strong> key
in <strong>OldConfig</strong>.</p><p><strong>SetOrUpdate</strong> has the value <strong>set</strong> if the
configuration change originates from a call to
<a href="#set_handler_config-2">set_handler_config-2</a>, and <strong>update</strong>
if it originates from <a href="#update_handler_config-2">update_handler_config-2</a>. The handler can
use this parameteter to decide how to update the value of
the <strong>config</strong> field, that is, the handler specific
configuration data. Typically, if <strong>SetOrUpdate</strong>
equals <strong>set</strong>, values that are not specified must be
given their default values. If <strong>SetOrUpdate</strong>
equals <strong>update</strong>, the values found in <strong>OldConfig</strong>
must be used instead.</p><p>If everything succeeds, the callback function must return a
possibly adjusted configuration in <strong>{ok,Config}</strong>.</p><p>If the configuration is faulty, the callback function must
return <strong>{error,Reason}</strong>.</p><h3>HModule:filter_config(Config) -&gt; FilteredConfig</h3><p>Remove internal data from configuration.</p><ul><li><span class="v">Config = FilteredConfig = </span></li></ul><p>This callback function is optional.</p><p>The function is called when one of the Logger API functions
for fetching the handler configuration is called, for
example
<a href="#get_handler_config-1">get_handler_config-1</a>.</p><p>It allows the handler to remove internal data fields from
its configuration data before it is returned to the
caller.</p><h3>HModule:log(LogEvent, Config) -&gt; void()</h3><p>Log the given log event.</p><ul><li><span class="v">LogEvent = </span></li><li><span class="v">Config = </span></li></ul><p>This callback function is mandatory.</p><p>The function is called when all primary filters and all
handler filters for the handler in question have passed for
the given log event. It is called on the client process, that
is, the process that issued the log event.</p><p>The handler identity is associated with the <strong>id</strong> key
in <strong>Config</strong>.</p><p>The handler must log the event.</p><p>The return value from this function is ignored by
Logger.</p><h3>HModule:removing_handler(Config) -&gt; ok</h3><p>The given handler is about to be removed.</p><ul><li><span class="v">Config = </span></li></ul><p>This callback function is optional.</p><p>The function is called on a temporary process when a
handler is about to be removed. The purpose is to release
all resources used by the handler.</p><p>The handler identity is associated with the <strong>id</strong> key
in <strong>Config</strong>.</p><p>The return value is ignored by Logger.</p><a name="formatter_callback_functions"></a><h3>Formatter Callback Functions</h3><p>The following functions are to be exported from a formatter
callback module.</p><h2>Functions</h2><h3>FModule:check_config(FConfig) -&gt; ok | {error, Reason}</h3><p>Validate the given formatter configuration.</p><ul><li><span class="v">FConfig = </span></li><li><span class="v">Reason = term()</span></li></ul><p>This callback function is optional.</p><p>The function is called by a Logger when formatter
configuration is set or modified. The formatter must
validate the given configuration and return <strong>ok</strong> if it
is correct, and <strong>{error,Reason}</strong> if it is faulty.</p><p>The following Logger API functions can trigger this callback:</p><ul><li><a href="./logger#add_handler-3">logger#add_handler-3</a></li><li><a href="./logger#set_handler_config-2">logger#set_handler_config-2</a></li><li><a href="./logger#update_handler_config-2">logger#update_handler_config-2</a></li><li><a href="./logger#update_formatter_config-2">logger#update_formatter_config-2</a></li></ul><p>See <a href="logger_formatter">logger_formatter</a>
for an example implementation. <strong>logger_formatter</strong> is the
default formatter used by Logger.</p><h3>FModule:format(LogEvent, FConfig) -&gt; FormattedLogEntry</h3><p>Format the given log event.</p><ul><li><span class="v">LogEvent = </span></li><li><span class="v">FConfig = </span></li><li><span class="v">FormattedLogEntry = </span></li></ul><p>This callback function is mandatory.</p><p>The function can be called by a log handler to convert a
log event term to a printable string. The returned value
can, for example, be printed as a log entry to the console
or a file using <a href="../stdlib/io#put_chars-1">stdlib/io#put_chars-1</a>.</p><p>See <a href="logger_formatter">logger_formatter</a>
for an example implementation. <strong>logger_formatter</strong> is the
default formatter used by Logger.</p><h3>See Also</h3><p>
<a href="config">config</a>,
<a href="./erlang">erts/erlang</a>,
<a href="./io">stdlib/io</a>,
<a href="logger_disk_log_h">logger_disk_log_h</a>,
<a href="logger_filters">logger_filters</a>,
<a href="logger_formatter">logger_formatter</a>,
<a href="logger_std_h">logger_std_h</a>,
<a href="./unicode">stdlib/unicode</a>
</p><h2>logger_filters</h2><p>Filters to use with Logger.</p><p>All functions exported from this module can be used as primary
or handler
filters. See <a href="./logger#add_primary_filter-2">logger#add_primary_filter-2</a>
and <a href="./logger#add_handler_filter-3">logger#add_handler_filter-3</a> for more information
about how filters are added.Filters are removed with <a href="./logger#remove_primary_filter-1">logger#remove_primary_filter-1</a>
and <a href="./logger#remove_handler_filter-2">logger#remove_handler_filter-2</a>.</p><h2>Functions</h2><h3>domain/2</h3><p>Filter log events based on the domain field in metadata.</p><p>This filter provides a way of filtering log events based on a
<strong>domain</strong> field in <strong>Metadata</strong>. This field is
optional, and the purpose of using it is to group log events
from, for example, a specific functional area. This allows
filtering or other specialized treatment in a Logger
handler.</p><p>A domain field must be a list of atoms, creating smaller
and more specialized domains as the list grows longer. The
greatest domain is <strong>[]</strong>, which comprises all possible
domains.</p><p>For example, consider the following domains:</p><pre>
D1 = [otp]
D2 = [otp, sasl]</pre><p><strong>D1</strong> is the greatest of the two, and is said to be a
super-domain of <strong>D2</strong>. <strong>D2</strong> is a
sub-domain <strong>D1</strong>. Both <strong>D1</strong> and <strong>D2</strong> are
sub-domains of <strong>[]</strong>.</p><p>The above domains are used for logs originating from
Erlang/OTP. D1 specifies that the log event comes from
Erlang/OTP in general, and D2 indicates that the log event
is a so
called <a href="./logger_chapter#sasl_reports">SASL report</a>.</p><p>The <strong><span class="anno">Extra</span></strong> parameter to
the <strong>domain/2</strong> function is specified when adding the
filter via <a href="./logger#add_primary_filter-2">logger#add_primary_filter-2</a>
or <a href="./logger#add_handler_filter-3">logger#add_handler_filter-3</a>.</p><p>The filter compares the value of the <strong>domain</strong> field in
the log event's metadata (<strong>Domain</strong>) against
<strong><span class="anno">MatchDomain</span></strong>. The filter matches if the
value of <strong>Compare</strong> is:</p><dl><dt><strong>sub</strong></dt><dd> <p>and <strong>Domain</strong> is equal to or a sub-domain
of <strong>MatchDomain</strong>, that is, if <strong>MatchDomain</strong> is
a prefix of <strong>Domain</strong>.</p> </dd><dt><strong>super</strong></dt><dd> <p>and <strong>Domain</strong> is equal to or a super-domain
of <strong>MatchDomain</strong>, that is, if <strong>Domain</strong> is a
prefix of <strong>MatchDomain</strong>.</p> </dd><dt><strong>equal</strong></dt><dd> <p>and <strong>Domain</strong> is equal to <strong>MatchDomain</strong>.</p> </dd><dt><strong>not_equal</strong></dt><dd> <p>and <strong>Domain</strong> differs from <strong>MatchDomain</strong>, or
if there is no domain field in metadata.</p> </dd><dt><strong>undefined</strong></dt><dd> <p>and there is no domain field in metadata. In this
case <strong><span class="anno">MatchDomain</span></strong> must be set
to <strong>[]</strong>.</p> </dd></dl><p>If the filter matches and <strong><span class="anno">Action</span></strong> is
<strong>log</strong>, the log event is allowed. If the filter matches
and <strong><span class="anno">Action</span></strong> is <strong>stop</strong>, the log event
is stopped.</p><p>If the filter does not match, it returns <strong>ignore</strong>,
meaning that other filters, or the value of the
configuration parameter <strong>filter_default</strong>, decide if the
event is allowed or not.</p><p>Log events that do not contain any domain field, match only
when <strong><span class="anno">Compare</span></strong> is equal
to <strong>undefined</strong> or <strong>not_equal</strong>.</p><p>Example: stop all events with domain <strong>[otp, sasl | _]</strong></p><pre><code class="">
logger:set_handler_config(h1, filter_default, log). % this is the default
Filter = {fun logger_filters:domain/2, {stop, sub, [otp, sasl]}}.
logger:add_handler_filter(h1, no_sasl, Filter).
ok</code></pre><h3>level/2</h3><p>Filter log events based on the log level.</p><p>This filter provides a way of filtering log events based
on the log level. It matches log events by comparing the
log level with a specified <strong>MatchLevel</strong></p><p>The <strong><span class="anno">Extra</span></strong> parameter is specified when
adding the filter
via <a href="./logger#add_primary_filter-2">logger#add_primary_filter-2</a>
or <a href="./logger#add_handler_filter-3">logger#add_handler_filter-3</a>.</p><p>The filter compares the value of the event's log level
(<strong>Level</strong>) to <strong><span class="anno">MatchLevel</span></strong> by
calling <a href="./logger#compare_levels-2">logger#compare_levels-2</a>.
The filter matches if the value
of <strong><span class="anno">Operator</span></strong> is:</p><dl><dt><strong>neq</strong></dt><dd><p>and the compare function returns <strong>lt</strong>
or <strong>gt</strong>.</p></dd><dt><strong>eq</strong></dt><dd><p>and the compare function returns <strong>eq</strong>.</p></dd><dt><strong>lt</strong></dt><dd><p>and the compare function returns <strong>lt</strong>.</p></dd><dt><strong>gt</strong></dt><dd><p>and the compare function returns <strong>gt</strong>.</p></dd><dt><strong>lteq</strong></dt><dd><p>and the compare function returns <strong>lt</strong>
or <strong>eq</strong>.</p></dd><dt><strong>gteq</strong></dt><dd><p>and the compare function returns <strong>gt</strong>
or <strong>eq</strong>.</p></dd></dl><p>If the filter matches and <strong><span class="anno">Action</span></strong> is
<strong>log</strong>, the log event is allowed. If the filter
matches and <strong><span class="anno">Action</span></strong> is <strong>stop</strong>, the
log event is stopped.</p><p>If the filter does not match, it returns <strong>ignore</strong>,
meaning that other filters, or the value of the
configuration parameter <strong>filter_default</strong>, will decide
if the event is allowed or not.</p><p>Example: only allow debug level log events</p><pre><code class="">
logger:set_handler_config(h1, filter_default, stop).
Filter = {fun logger_filters:level/2, {log, eq, debug}}.
logger:add_handler_filter(h1, debug_only, Filter).
ok</code></pre><h3>progress/2</h3><p>Filter progress reports from supervisor and application_controller.</p><p>This filter matches all progress reports
from <strong>supervisor</strong> and <strong>application_controller</strong>.</p><p>If <strong><span class="anno">Extra</span></strong> is <strong>log</strong>, the progress
reports are allowed. If <strong><span class="anno">Extra</span></strong>
is <strong>stop</strong>, the progress reports are stopped.</p><p>The filter returns <strong>ignore</strong> for all other log events.</p><h3>remote_gl/2</h3><p>Filter events with group leader on remote node.</p><p>This filter matches all events originating from a process
that has its group leader on a remote node.</p><p>If <strong><span class="anno">Extra</span></strong> is <strong>log</strong>, the matching
events are allowed. If <strong><span class="anno">Extra</span></strong>
is <strong>stop</strong>, the matching events are stopped.</p><p>The filter returns <strong>ignore</strong> for all other log events.</p><h3>See Also</h3><p>
<a href="logger">logger</a>
</p><h2>logger_formatter</h2><p>Default formatter for Logger.</p><p>Each Logger handler has a configured formatter specified as a
module and a configuration term. The purpose of the formatter is
to translate the log events to a final printable string
(<a href="../stdlib/unicode#type-chardata">stdlib/unicode#type-chardata</a>) which can be written to the output device of the
handler. See
sections <a href="./logger_chapter#handlers">Handlers</a>
and <a href="./logger_chapter#formatters">Formatters</a>
in the Kernel User's Guide for more information.<strong>logger_formatter</strong> is the default formatter used by
Logger.</p><h2>Data Types</h2><span class="name">config</span><p>The configuration term for <strong>logger_formatter</strong> is a
<a href="./maps">map</a>, and the
following keys can be set as configuration parameters:</p><dl><dt><a name="chars_limit"></a> <strong>chars_limit = integer() &gt; 0 | unlimited</strong></dt><dd> <p>A positive integer representing the value of the option
with the same name to be used when calling
<a href="../stdlib/io_lib#format-3">stdlib/io_lib#format-3</a>.
This value limits the total number of characters printed
for each log event. Notice that this is a soft limit. For a
hard truncation limit, see option <strong>max_size</strong>.</p> <p>Defaults to <strong>unlimited</strong>.</p> </dd><dt><a name="depth"></a><strong>depth = integer() &gt; 0 | unlimited</strong></dt><dd> <p>A positive integer representing the maximum depth to
which terms shall be printed by this formatter. Format
strings passed to this formatter are rewritten. The
format controls ~p and ~w are replaced with ~P and ~W,
respectively, and the value is used as the depth
parameter. For details, see
<a href="../stdlib/io#format-2">stdlib/io#format-2</a>
in STDLIB.</p> <p>Defaults to <strong>unlimited</strong>.</p> </dd><dt><strong>legacy_header = boolean()</strong></dt><dd> <p>If set to <strong>true</strong> a header field is added to
logger_formatter's part of <strong>Metadata</strong>. The value of
this field is a string similar to the header created by
the
old <a href="error_logger">error_logger</a>
event handlers. It can be included in the log event by
adding the list <strong>[logger_formatter,header]</strong> to the
template. See the description of
the <a href="#type-template">type-template</a>
type for more information.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><a name="max_size"></a> <strong>max_size = integer() &gt; 0 | unlimited</strong></dt><dd> <p>A positive integer representing the absolute maximum size a
string returned from this formatter can have. If the
formatted string is longer, after possibly being limited
by <strong>chars_limit</strong> or <strong>depth</strong>, it is truncated.</p> <p>Defaults to <strong>unlimited</strong>.</p> </dd><dt><strong>report_cb = </strong><a href="./logger#type-report_cb">logger#type-report_cb</a></dt><dd> <p>A report callback is used by the formatter to transform
log messages on report form to a format string and
arguments. The report callback can be specified in the
metadata for the log event. If no report callback exists
in metadata, <strong>logger_formatter</strong> will
use <a href="./logger#format_report-1">logger#format_report-1</a> as default
callback.</p> <p>If this configuration parameter is set, it replaces
both the default report callback, and any report
callback found in metadata. That is, all reports are
converted by this configured function.</p> </dd><dt><strong>single_line = boolean()</strong></dt><dd> <p>If set to <strong>true</strong>, each log event is printed as a
single line. To achieve this, <strong>logger_formatter</strong>
sets the field width to <strong>0</strong> for all <strong>~p</strong>
and <strong>~P</strong> control sequences in the format a string
(see <a href="../stdlib/io#format-2">stdlib/io#format-2</a>), and replaces all
newlines in the message with <strong>", "</strong>. White spaces
following directly after newlines are removed. Notice
that newlines added by the <strong>template</strong> parameter are
not replaced.</p> <p>Defaults to <strong>true</strong>.</p> </dd><dt><a name="template"></a> <strong>template = </strong><a href="#type-template">type-template</a></dt><dd> <p>The template describes how the formatted string is
composed by combining different data values from the log
event. See the description of
the <a href="#type-template">type-template</a>
type for more information about this.</p> </dd><dt><strong>time_designator = byte()</strong></dt><dd> <p>Timestamps are formatted according to RFC3339, and the
time designator is the character used as date and time
separator.</p> <p>Defaults to <strong>$T</strong>.</p> <p>The value of this parameter is used as
the <strong>time_designator</strong> option
to <a href="../stdlib/calendar#system_time_to_rfc3339-2">stdlib/calendar#system_time_to_rfc3339-2</a>.</p> </dd><dt><strong>time_offset = integer() | [byte()]</strong></dt><dd> <p>The time offset, either a string or an integer, to be
used when formatting the timestamp.</p> <p>An empty string is interpreted as local time. The
values <strong>"Z"</strong>, <strong>"z"</strong> or <strong>0</strong> are
interpreted as Universal Coordinated Time (UTC).</p> <p>Strings, other than <strong>"Z"</strong>, <strong>"z"</strong>,
or <strong>""</strong>, must be on the form <strong>Â±[hh]:[mm]</strong>, for
example <strong>"-02:00"</strong> or <strong>"+00:00"</strong>.</p> <p>Integers must be in microseconds, meaning that the
offset <strong>7200000000</strong> is equivalent
to <strong>"+02:00"</strong>.</p> <p>Defaults to an empty string, meaning that timestamps
are displayed in local time. However, for backwards
compatibility, if the SASL configuration
parameter <a href="../sasl/sasl_app#utc_log">sasl/sasl_app#utc_log</a><strong>=true</strong>, the default is
changed to <strong>"Z"</strong>, meaning that timestamps are displayed
in UTC.</p> <p>The value of this parameter is used as
the <strong>offset</strong> option
to <a href="../stdlib/calendar#system_time_to_rfc3339-2">stdlib/calendar#system_time_to_rfc3339-2</a>.</p> </dd></dl><span class="name">metakey</span><span class="name">template</span><p>The template is a list of atoms, atom lists, tuples and strings. The
atoms <strong>level</strong> or <strong>msg</strong>, are treated as
placeholders for the severity level and the log message,
respectively. Other atoms or atom lists are interpreted as
placeholders for metadata, where atoms are expected to match
top level keys, and atom lists represent paths to sub keys when
the metadata is a nested map. For example the
list <strong>[key1,key2]</strong> is replaced by the value of
the <strong>key2</strong> field in the nested map below. The
atom <strong>key1</strong> on its own is replaced by the complete
value of the <strong>key1</strong> field. The values are converted to
strings.</p><pre><code class="">
#{key1 =&gt; #{key2 =&gt; my_value,
            ...}
  ...}</code></pre><p>Tuples in the template express if-exist tests for metadata
keys. For example, the following tuple says that
if <strong>key1</strong> exists in the metadata map,
print <strong>"key1=Value"</strong>, where <strong>Value</strong> is the value
that <strong>key1</strong> is associated with in the metadata map. If
<strong>key1</strong> does not exist, print nothing.</p><pre><code class="">
{key1, ["key1=",key1], []}</code></pre><p>Strings in the template are printed literally.</p><p>The default value for the <strong>template</strong> configuration
parameter depends on the value of the <strong>single_line</strong>
and <strong>legacy_header</strong> configuration parameters as
follows.</p><p>The log event used in the examples is:</p><pre><code class="">
?LOG_ERROR("name: ~p~nexit_reason: ~p", [my_name, "It crashed"])</code></pre><dl><dt><strong>legacy_header = true, single_line = false</strong></dt><dd> <p>Default
template: <strong>[[logger_formatter,header],"\n",msg,"\n"]</strong></p> <p>Example log entry:</p> <pre><code class="">
=ERROR REPORT==== 17-May-2018::18:30:19.453447 ===
name: my_name
exit_reason: "It crashed"</code></pre> <p>Notice that all eight levels can occur in the heading,
not only <strong>ERROR</strong>, <strong>WARNING</strong> or <strong>INFO</strong> as
<a href="error_logger">error_logger</a>
produces. And microseconds are added at the end of the
timestamp.</p> </dd><dt><strong>legacy_header = true, single_line = true</strong></dt><dd> <p>Default
template: <strong>[[logger_formatter,header],"\n",msg,"\n"]</strong></p> <p>Notice that the template is here the same as
for <strong>single_line=false</strong>, but the resulting log entry
differs in that there is only one line after the
heading:</p> <pre><code class="">
=ERROR REPORT==== 17-May-2018::18:31:06.952665 ===
name: my_name, exit_reason: "It crashed"</code></pre> </dd><dt><strong>legacy_header = false, single_line = true</strong></dt><dd> <p>Default template: <strong>[time," ",level,": ",msg,"\n"]</strong></p> <p>Example log entry:</p> <pre><code class="">
2018-05-17T18:31:31.152864+02:00 error: name: my_name, exit_reason: "It crashed"</code></pre> </dd><dt><strong>legacy_header = false, single_line = false</strong></dt><dd> <p>Default template: <strong>[time," ",level,":\n",msg,"\n"]</strong></p> <p>Example log entry:</p> <pre><code class="">
2018-05-17T18:32:20.105422+02:00 error:
name: my_name
exit_reason: "It crashed"</code></pre> </dd></dl><h2>Functions</h2><h3>check_config/1</h3><p>Validates the given formatter configuration.</p><p>The function is called by Logger when the formatter
configuration for a handler is set or modified. It
returns <strong>ok</strong> if the configuration is valid,
and <strong>{error,term()}</strong> if it is faulty.</p><p>The following Logger API functions can trigger this callback:</p><ul><li><a href="./logger#add_handler-3">logger#add_handler-3</a></li><li><a href="./logger#set_handler_config-2">logger#set_handler_config-2</a></li><li><a href="./logger#update_handler_config-2">logger#update_handler_config-2</a></li><li><a href="./logger#update_formatter_config-2">logger#update_formatter_config-2</a></li></ul><h3>format/2</h3><p>Formats the given message.</p><p>This the formatter callback function to be called from
handlers. The log event is processed as follows:</p><ul><li>If the message is on report form, it is converted to <strong>{Format,Args}</strong> by calling the report callback. See section <a href="./logger_chapter#log_message">Log Message</a> in the Kernel User's Guide for more information about report callbacks and valid forms of log messages.</li><li>The message size is limited according to the values of configuration parameters <a href="#chars_limit">chars_limit</a> and <a href="#depth">depth</a>.</li><li>The full log entry is composed according to the <a href="#template">template</a>.</li><li>If the final string is too long, it is truncated according to the value of configuration parameter <a href="#max_size">max_size</a>.</li></ul><h3>See Also</h3><p>
<a href="./calendar">stdlib/calendar</a>,
<a href="error_logger">error_logger</a>,
<a href="./io">stdlib/io</a>,
<a href="./io_lib">stdlib/io_lib</a>,
<a href="logger">logger</a>,
<a href="./maps">stdlib/maps</a>,
<a href="./sasl_app">sasl/sasl_app</a>,
<a href="./unicode">stdlib/unicode</a>
</p><h2>logger_std_h</h2><p>Standard handler for Logger.</p><p>This is the standard handler for Logger.
Multiple instances of this handler can be added to
Logger, and each instance prints logs to <strong>standard_io</strong>,
<strong>standard_error</strong>, or to file.The handler has an overload protection mechanism that keeps the handler
process and the Kernel application alive during high loads of log 
events. How overload protection works, and how to configure it, is
described in the
<a href="./logger_chapter#overload_protection">logger_chapter#overload_protection</a>.To add a new instance of the standard handler, use
<a href="./logger#add_handler-3">logger#add_handler-3</a>. The handler configuration argument is a map which can contain
general configuration parameters, as documented in the
<a href="./logger_chapter#handler_configuration">logger_chapter#handler_configuration</a>, and handler specific parameters. The specific data
is stored in a sub map with the key <strong>config</strong>, and can contain the
following parameters:<dl><dt><a name="type"></a><strong>type = standard_io | standard_error | file</strong></dt><dd> <p>Specifies the log destination.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to <strong>standard_io</strong>, unless
parameter <a href="#file">file</a> is
given, in which case it defaults to <strong>file</strong>.</p> </dd><dt><a name="file"></a><strong>file = </strong><a href="./file#type-filename">file#type-filename</a></dt><dd> <p>This specifies the name of the log file when the handler is
of type <strong>file</strong>.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to the same name as the handler identity, in the
current directory.</p> </dd><dt><a name="modes"></a><strong>modes = [</strong><a href="./file#type-mode">file#type-mode</a><strong>]</strong></dt><dd> <p>This specifies the file modes to use when opening the log
file,
see <a href="./file#open-2">file#open-2</a>.
If <strong>modes</strong> are not specified, the default list used
is <strong>[raw,append,delayed_write]</strong>. If <strong>modes</strong> are
specified, the list replaces the default modes list with the
following adjustments:</p> <ul><li> If <strong>raw</strong> is not found in the list, it is added. </li><li> If none of <strong>write</strong>, <strong>append</strong> or <strong>exclusive</strong> is found in the list, <strong>append</strong> is added.</li><li>If none of <strong>delayed_write</strong> or <strong>{delayed_write,Size,Delay}</strong> is found in the list, <strong>delayed_write</strong> is added.</li></ul> <p>Log files are always UTF-8 encoded. The encoding cannot be
changed by setting the mode <strong>{encoding,Encoding}</strong>.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to <strong>[raw,append,delayed_write]</strong>.</p> </dd><dt><a name="max_no_bytes"></a><strong>max_no_bytes = pos_integer() | infinity</strong></dt><dd> <p>This parameter specifies if the log file should be rotated
or not. The value <strong>infinity</strong> means the log file will
grow indefinitely, while an integer value specifies at which
file size (bytes) the file is rotated.</p> <p>Defaults to <strong>infinity</strong>.</p> </dd><dt><a name="max_no_files"></a><strong>max_no_files = non_neg_integer()</strong></dt><dd> <p>This parameter specifies the number of rotated log file
archives to keep. This has meaning only
if <a href="#max_no_bytes">max_no_bytes</a>
is set to an integer value.</p> <p>The log archives are
named <strong>FileName.0</strong>, <strong>FileName.1</strong>,
... <strong>FileName.N</strong>, where <strong>FileName</strong> is the name of
the current log file. <strong>FileName.0</strong> is the newest of the
archives. The maximum value for <strong>N</strong> is the value
of <strong>max_no_files</strong> minus 1.</p> <p>Notice that setting this value to <strong>0</strong> does not turn of
rotation. It only specifies that no archives are kept.</p> <p>Defaults to <strong>0</strong>.</p> </dd><dt><a name="compress_on_rotate"></a><strong>compress_on_rotate = boolean()</strong></dt><dd> <p>This parameter specifies if the rotated log file archives
shall be compressed or not. If set to <strong>true</strong>, all
archives are compressed with <strong>gzip</strong>, and renamed
to <strong>FileName.N.gz</strong></p> <p><strong>compress_on_rotate</strong> has no meaning if <a href="#max_no_bytes">max_no_bytes</a> has the
value <strong>infinity</strong>.</p> <p>Defaults to <strong>false</strong>.</p> </dd><dt><a name="file_check"></a><strong>file_check = non_neg_integer()</strong></dt><dd> <p>When <strong>logger_std_h</strong> logs to a file, it reads the file
information of the log file prior to each write
operation. This is to make sure the file still exists and
has the same inode as when it was opened. This implies some
performance loss, but ensures that no log events are lost in
the case when the file has been removed or renamed by an
external actor.</p> <p>In order to allow minimizing the performance loss, the
<strong>file_check</strong> parameter can be set to a positive integer
value, <strong>N</strong>. The handler will then skip reading the file
information prior to writing, as long as no more
than <strong>N</strong> milliseconds have passed since it was last
read.</p> <p>Notice that the risk of loosing log events grows when
the <strong>file_check</strong> value grows.</p> <p>Defaults to 0.</p> </dd><dt><strong>filesync_repeat_interval = pos_integer() | no_repeat</strong></dt><dd> <p>This value, in milliseconds, specifies how often the handler does
a file sync operation to write buffered data to disk. The handler attempts
the operation repeatedly, but only performs a new sync if something has
actually been logged.</p> <p>If <strong>no_repeat</strong> is set as value, the repeated file sync operation
is disabled, and it is the operating system settings that determine
how quickly or slowly data is written to disk. The user can also call
the <a href="./logger_std_h#filesync-1">logger_std_h#filesync-1</a>
function to perform a file sync.</p> <p>Defaults to <strong>5000</strong> milliseconds.</p> </dd></dl>Other configuration parameters exist, to be used for customizing
the overload protection behaviour. The same parameters are used both in the
standard handler and the disk_log handler, and are documented in the
<a href="./logger_chapter#overload_protection">logger_chapter#overload_protection</a>.Notice that if changing the configuration of the handler in
runtime, the <strong>type</strong>, <strong>file</strong>, or <strong>modes</strong> parameters
must not be modified.Example of adding a standard handler:<pre><code class="">
logger:add_handler(my_standard_h, logger_std_h,
                   #{config =&gt; #{file =&gt; "./system_info.log",
                                 filesync_repeat_interval =&gt; 1000}}).
    </code></pre>To set the default handler, that starts initially with
the Kernel application, to log to file instead of <strong>standard_io</strong>,
change the Kernel default logger configuration. Example:<pre><code class="">
erl -kernel logger '[{handler,default,logger_std_h,
                      #{config =&gt; #{file =&gt; "./log.log"}}}]'
    </code></pre>An example of how to replace the standard handler with a disk_log handler
at startup is found in the
<a href="logger_disk_log_h">logger_disk_log_h</a>
manual.</p><h2>Functions</h2><h3>filesync/1</h3><p>Writes buffered data to disk.</p><p>Write buffered data to disk.</p><h3>See Also</h3><p><a href="logger">logger</a>,
<a href="logger_disk_log_h">logger_disk_log_h</a></p><h2>logger_disk_log_h</h2><p>A disk_log based handler for Logger</p><p>This is a handler for Logger that offers circular
(wrapped) logs by using <a href="disk_log">disk_log</a>. 
Multiple instances of this handler can be added to Logger, and each instance
prints to its own disk log file, created with the name and settings specified
in the handler configuration.The default standard handler,
<a href="logger_std_h">logger_std_h</a>, can be
replaced by a disk_log handler at startup of the Kernel application.
See an example of this below.The handler has an overload protection mechanism that keeps the handler
process and the Kernel application alive during  high loads of log 
events. How overload protection works, and how to configure it, is
described in the
<a href="./logger_chapter#overload_protection">logger_chapter#overload_protection</a>.To add a new instance of the disk_log handler, use
<a href="./logger#add_handler-3">logger#add_handler-3</a>. The handler configuration argument is a map which can contain
general configuration parameters, as documented in the
<a href="./logger_chapter#handler_configuration">logger_chapter#handler_configuration</a>, and handler specific parameters. The specific data
is stored in a sub map with the key <strong>config</strong>, and can contain the
following parameters:<dl><dt><strong>file</strong></dt><dd> <p>This is the full name of the disk log file. The option
corresponds to the <strong>name</strong> property in the
<a href="./disk_log#open-1">disk_log#open-1</a>
datatype.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to the same name as the handler identity, in the
current directory.</p> </dd><dt><strong>type</strong></dt><dd> <p>This is the disk log type, <strong>wrap</strong> or <strong>halt</strong>. The option
corresponds to the <strong>type</strong> property in the
<a href="./disk_log#open-1">disk_log#open-1</a>
datatype.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to <strong>wrap</strong>.</p> </dd><dt><strong>max_no_files</strong></dt><dd> <p>This is the maximum number of files that disk_log uses
for its circular logging. The option
corresponds to the <strong>MaxNoFiles</strong> element in the <strong>size</strong> property in the
<a href="./disk_log#open-1">disk_log#open-1</a>
datatype.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to <strong>10</strong>.</p> <p>The setting has no effect on a halt log.</p> </dd><dt><strong>max_no_bytes</strong></dt><dd> <p>This is the maximum number of bytes that is written to
a log file before disk_log proceeds with the next file in order, or
generates an error in case of a full halt log. The option
corresponds to the <strong>MaxNoBytes</strong> element in the <strong>size</strong> property in the
<a href="./disk_log#open-1">disk_log#open-1</a>
datatype.</p> <p>The value is set when the handler is added, and it cannot
be changed in runtime.</p> <p>Defaults to <strong>1048576</strong> bytes for a wrap log, and
<strong>infinity</strong> for a halt log.</p> </dd><dt><strong>filesync_repeat_interval</strong></dt><dd> <p>This value, in milliseconds, specifies how often the handler does
a disk_log sync operation to write buffered data to disk. The handler attempts
the operation repeatedly, but only performs a new sync if something has
actually been logged.</p> <p>Defaults to <strong>5000</strong> milliseconds.</p> <p>If <strong>no_repeat</strong> is set as value, the repeated sync operation
is disabled. The user can also call the
<a href="./logger_disk_log_h#filesync-1">logger_disk_log_h#filesync-1</a> function to perform a disk_log sync.</p> </dd></dl>Other configuration parameters exist, to be used for customizing
the overload protection behaviour. The same parameters are used both in the
standard handler and the disk_log handler, and are documented in the
<a href="./logger_chapter#overload_protection">logger_chapter#overload_protection</a>.Notice that when changing the configuration of the handler in runtime, the
disk_log options (<strong>file</strong>, <strong>type</strong>, <strong>max_no_files</strong>,
<strong>max_no_bytes</strong>) must not be modified.Example of adding a disk_log handler:<pre><code class="">
logger:add_handler(my_disk_log_h, logger_disk_log_h,
                   #{config =&gt; #{file =&gt; "./my_disk_log",
                                 type =&gt; wrap,
                                 max_no_files =&gt; 4,
                                 max_no_bytes =&gt; 10000},
                                 filesync_repeat_interval =&gt; 1000}}).
    </code></pre>To use the disk_log handler instead of the default standard
handler when starting an Erlang node, change the Kernel default logger to
use <strong>logger_disk_log_h</strong>. Example:<pre><code class="">
erl -kernel logger '[{handler,default,logger_disk_log_h,
                      #{config =&gt; #{file =&gt; "./system_disk_log"}}}]'
    </code></pre></p><h2>Functions</h2><h3>filesync/1</h3><p>Writes buffered data to disk.</p><p>Write buffered data to disk.</p><h3>See Also</h3><p><a href="logger">logger</a>,
<a href="logger_std_h">logger_std_h</a>,
<a href="disk_log">disk_log</a></p><h2>net_adm</h2><p>Various Erlang net administration routines.</p><p>This module contains various network utility functions.</p><h2>Functions</h2><h3>dns_hostname/1</h3><p>Official name of a host.</p><p>Returns the official name of <strong><span class="anno">Host</span></strong>, or
<strong>{error, <span class="anno">Host</span>}</strong> if no such name is found. See also
<a href="inet">inet</a>.</p><h3>host_file/0</h3><p>Read file <strong>.hosts.erlang</strong>.</p><p>Reads file <strong>.hosts.erlang</strong>, see section
<a href="#files">Files</a>. Returns the hosts in this
file as a list. Returns <strong>{error, <span class="anno">Reason</span>}</strong> if the
file cannot be read or the Erlang terms on the file cannot be
interpreted.</p><h3>localhost/0</h3><p>Name of the local host.</p><p>Returns the name of the local host. If Erlang was started
with command-line flag <strong>-name</strong>, <strong><span class="anno">Name</span></strong> is
the fully qualified name.</p><h3>names/0</h3><h3>names/1</h3><p>Names of Erlang nodes at a host.</p><p>Similar to <strong>epmd -names</strong>, see
<a href="./epmd">erts/epmd</a>.
<strong><span class="anno">Host</span></strong> defaults to the local host. Returns the
names and associated port numbers of the Erlang nodes that
<strong>epmd</strong> registered at the specified host. Returns
<strong>{error, address}</strong> if <strong>epmd</strong> is not operational.</p><p><em>Example:</em></p><pre>
(arne@dunn)1&gt; <span class="input">net_adm:names().</span>
{ok,[{"arne",40262}]}</pre><h3>ping/1</h3><p>Set up a connection to a node.</p><p>Sets up a connection to <strong><span class="anno">Node</span></strong>. Returns
<strong>pong</strong> if it is successful, otherwise <strong>pang</strong>.</p><h3>world/0</h3><h3>world/1</h3><p>Lookup and connect to all nodes at all hosts in <strong>.hosts.erlang</strong>.</p><ul><li>verbosity</li></ul><p>Calls <strong>names(Host)</strong> for all hosts that
are specified in the Erlang host file <strong>.hosts.erlang</strong>,
collects the replies, and then evaluates <strong>ping(Node)</strong> on
all those nodes. Returns the list of all nodes that are
successfully pinged.</p><p><strong><span class="anno">Arg</span></strong> defaults to <strong>silent</strong>.
If <strong><span class="anno">Arg</span> == verbose</strong>, the function writes
information about which nodes it is pinging to <strong>stdout</strong>.</p><p>This function can be useful when a node is started, and
the names of the other network nodes are not initially known.</p><p>Returns <strong>{error, Reason}</strong> if <strong>host_file()</strong>
returns <strong>{error, Reason}</strong>.</p><h3>world_list/1</h3><h3>world_list/2</h3><p>Lookup and connect to all nodes at specified hosts.</p><ul><li>verbosity</li></ul><p>Same as <a href="#world/1">world/1</a>,
but the hosts are specified as argument
instead of being read from <strong>.hosts.erlang</strong>.</p><h3>Files</h3><a name="files"></a><p>File <strong>.hosts.erlang</strong> consists of a number of host names
written as Erlang terms. It is looked for in the current work
directory, the user's home directory, and <strong>$OTP_ROOT</strong>
(the root directory of Erlang/OTP), in that order.</p><p>The format of file <strong>.hosts.erlang</strong> must be one host
name per line. The host names must be within quotes.</p><p><em>Example:</em></p><pre>
'super.eua.ericsson.se'.
'renat.eua.ericsson.se'.
'grouse.eua.ericsson.se'.
'gauffin1.eua.ericsson.se'.
^ (new line)</pre><h2>net_kernel</h2><p>Erlang networking kernel.</p><p>The net kernel is a system process, registered as
<strong>net_kernel</strong>, which must be operational for distributed Erlang
to work. The purpose of this process is to implement parts of
the BIFs <strong>spawn/4</strong> and <strong>spawn_link/4</strong>, and to provide 
monitoring of the network.An Erlang node is started using command-line flag
<strong>-name</strong> or <strong>-sname</strong>:<pre>
$ <span class="input">erl -sname foobar</span></pre>It is also possible to call <strong>net_kernel:start([foobar])</strong>
directly from the normal Erlang shell prompt:<pre>
1&gt; <span class="input">net_kernel:start([foobar, shortnames]).</span>
{ok,&lt;0.64.0&gt;}
(foobar@gringotts)2&gt;</pre>If the node is started with command-line flag <strong>-sname</strong>,
the node name is <strong>foobar@Host</strong>, where <strong>Host</strong> is
the short name of the host (not the fully qualified domain name).
If started with flag <strong>-name</strong>, the node name is <strong>foobar@Host</strong>,
where <strong>Host</strong> is the fully qualified domain name.
For more information, see
<a href="./erl">erts/erl</a>.Normally, connections are established automatically when
another node is referenced. This functionality can be disabled
by setting Kernel configuration parameter
<strong>dist_auto_connect</strong> to <strong>never</strong>, see
<a href="kernel_app">kernel_app</a>. In this case,
connections must be established explicitly by calling
<a href="#connect_node/1">connect_node/1</a>.Which nodes that are allowed to communicate with each other is handled
by the magic cookie system, see section
<a href="./distributed">Distributed Erlang</a>
in the Erlang Reference Manual.</p><h2>Functions</h2><h3>allow/1</h3><p>Permit access to a specified set of nodes</p><p>Permits access to the specified set of nodes.</p><p>Before the first call to <strong>allow/1</strong>, any node with the correct
cookie can be connected. When <strong>allow/1</strong> is called, a list
of allowed nodes is established. Any access attempts made from (or to)
nodes not in that list will be rejected.</p><p>Subsequent calls to <strong>allow/1</strong> will add the specified nodes
to the list of allowed nodes. It is not possible to remove nodes
from the list.</p><p>Returns <strong>error</strong> if any element in <strong><span class="anno">Nodes</span></strong> is not
an atom.</p><h3>connect_node/1</h3><p>Establish a connection to a node.</p><p>Establishes a connection to <strong><span class="anno">Node</span></strong>. Returns
<strong>true</strong> if a connection was established or was already
established or if <strong><span class="anno">Node</span></strong> is the local node
itself. Returns <strong>false</strong> if the connection attempt failed, and
<strong>ignored</strong> if the local node is not alive.</p><h3>get_net_ticktime/0</h3><p>Get <strong>net_ticktime</strong>.</p><p>Gets <strong>net_ticktime</strong> (see
<a href="kernel_app">kernel_app</a>).</p><p>Defined return values (<strong><span class="anno">Res</span></strong>):</p><dl><dt><strong><span class="anno">NetTicktime</span></strong></dt><dd><p><strong>net_ticktime</strong> is <strong><span class="anno">NetTicktime</span></strong>
seconds.</p></dd><dt><strong>{ongoing_change_to, <span class="anno">NetTicktime</span>}</strong></dt><dd><p><strong>net_kernel</strong> is currently changing
<strong>net_ticktime</strong> to <strong><span class="anno">NetTicktime</span></strong>
seconds.</p></dd><dt><strong>ignored</strong></dt><dd><p>The local node is not alive.</p></dd></dl><h3>getopts/2</h3><p>Get distribution socket options.</p><p>Get one or more options for the distribution socket
connected to <strong><span class="anno">Node</span></strong>.</p><p>If <strong><span class="anno">Node</span></strong> is a connected node
the return value is the same as from
<a href="./inet#getopts/2">inet#getopts/2</a>
where <strong>Sock</strong> is the distribution socket for <strong><span class="anno">Node</span></strong>.</p><p>Returns <strong>ignored</strong> if the local node is not alive or
<strong>{error, noconnection}</strong> if <strong><span class="anno">Node</span></strong> is not connected.</p><h3>monitor_nodes/1</h3><h3>monitor_nodes/2</h3><p>Subscribe to node status change messages.</p><p>The calling process subscribes or unsubscribes to node
status change messages. A <strong>nodeup</strong> message is delivered
to all subscribing processes when a new node is connected, and
a <strong>nodedown</strong> message is delivered when a node is
disconnected.</p><p>If <strong><span class="anno">Flag</span></strong> is <strong>true</strong>, a new subscription is
started. If <strong><span class="anno">Flag</span></strong> is <strong>false</strong>, all previous
subscriptions started with the same <strong><span class="anno">Options</span></strong>
are stopped. Two
option lists are considered the same if they contain the same
set of options.</p><p>As from Kernel version 2.11.4, and ERTS version
5.5.4, the following is guaranteed:</p><ul><li><p><strong>nodeup</strong> messages are delivered before delivery
of any message from the remote node passed through the
newly established connection.</p></li><li><p><strong>nodedown</strong> messages are not delivered until all
messages from the remote node that have been passed
through the connection have been delivered.</p></li></ul><p>Notice that this is <em>not</em> guaranteed for Kernel
versions before 2.11.4.</p><p>As from Kernel version 2.11.4, subscriptions can also be
made before the <strong>net_kernel</strong> server is started, that is,
<strong>net_kernel:monitor_nodes/[1,2]</strong> does not return
<strong>ignored</strong>.</p><p>As from Kernel version 2.13, and ERTS version
5.7, the following is guaranteed:</p><ul><li><p><strong>nodeup</strong> messages are delivered after the
corresponding node appears in results from
<strong>erlang:nodes/X</strong>.</p></li><li><p><strong>nodedown</strong> messages are delivered after the
corresponding node has disappeared in results from
<strong>erlang:nodes/X</strong>.</p></li></ul><p>Notice that this is <em>not</em> guaranteed for Kernel
versions before 2.13.</p><p>The format of the node status change messages depends on
<strong><span class="anno">Options</span></strong>. If <strong><span class="anno">Options</span></strong> is
<strong>[]</strong>, which is the default, the format is as follows:</p><pre><code class="">
{nodeup, Node} | {nodedown, Node}
  Node = node()</code></pre><p>If <strong><span class="anno">Options</span></strong> is not <strong>[]</strong>, the format is
as follows:</p><pre><code class="">
{nodeup, Node, InfoList} | {nodedown, Node, InfoList}
  Node = node()
  InfoList = [{Tag, Val}]</code></pre><p><strong>InfoList</strong> is a list of tuples. Its contents depends on
<strong><span class="anno">Options</span></strong>, see below.</p><p>Also, when <strong>OptionList == []</strong>, only visible nodes, that
is, nodes that appear in the result of
<a href="../erts/erlang#nodes/0">erts/erlang#nodes/0</a>,
are monitored.</p><p><strong><span class="anno">Option</span></strong> can be any of the following:</p><dl><dt><strong>{node_type, NodeType}</strong></dt><dd> <p>Valid values for <strong>NodeType</strong>:</p> <dl><dt><strong>visible</strong></dt><dd><p>Subscribe to node status change messages for visible
nodes only. The tuple <strong>{node_type, visible}</strong> is
included in <strong>InfoList</strong>.</p></dd><dt><strong>hidden</strong></dt><dd><p>Subscribe to node status change messages for hidden
nodes only. The tuple <strong>{node_type, hidden}</strong> is
included in <strong>InfoList</strong>.</p></dd><dt><strong>all</strong></dt><dd><p>Subscribe to node status change messages for both
visible and hidden nodes. The tuple
<strong>{node_type, visible | hidden}</strong> is included in
<strong>InfoList</strong>.</p></dd></dl> </dd><dt><strong>nodedown_reason</strong></dt><dd> <p>The tuple <strong>{nodedown_reason, Reason}</strong> is included in
<strong>InfoList</strong> in <strong>nodedown</strong> messages.</p> <p>
<strong>Reason</strong> can, depending on which
distribution module or process that is used be any term,
but for the standard TCP distribution module it is
any of the following:
</p> <dl><dt><strong>connection_setup_failed</strong></dt><dd><p>The connection setup failed (after <strong>nodeup</strong>
messages were sent).</p></dd><dt><strong>no_network</strong></dt><dd><p>No network is available.</p></dd><dt><strong>net_kernel_terminated</strong></dt><dd><p>The <strong>net_kernel</strong> process terminated.</p></dd><dt><strong>shutdown</strong></dt><dd><p>Unspecified connection shutdown.</p></dd><dt><strong>connection_closed</strong></dt><dd><p>The connection was closed.</p></dd><dt><strong>disconnect</strong></dt><dd><p>The connection was disconnected (forced from the
current node).</p></dd><dt><strong>net_tick_timeout</strong></dt><dd><p>Net tick time-out.</p></dd><dt><strong>send_net_tick_failed</strong></dt><dd><p>Failed to send net tick over the connection.</p></dd><dt><strong>get_status_failed</strong></dt><dd><p>Status information retrieval from the <strong>Port</strong>
holding the connection failed.</p></dd></dl> </dd></dl><h3>set_net_ticktime/1</h3><h3>set_net_ticktime/2</h3><p>Set <strong>net_ticktime</strong>.</p><p>Sets <strong>net_ticktime</strong> (see
<a href="kernel_app">kernel_app</a>) to
<strong><span class="anno">NetTicktime</span></strong> seconds.
<strong><span class="anno">TransitionPeriod</span></strong> defaults to <strong>60</strong>.</p><p>Some definitions:</p><dl><dt>Minimum transition traffic interval (<strong>MTTI</strong>)</dt><dd><p><strong>minimum(<span class="anno">NetTicktime</span>, PreviousNetTicktime)*1000 div 4</strong> milliseconds.</p></dd><dt>Transition period</dt><dd><p>The time of the least number of consecutive <strong>MTTI</strong>s
to cover <strong><span class="anno">TransitionPeriod</span></strong> seconds following
the call to <strong>set_net_ticktime/2</strong> (that is,
((<strong><span class="anno">TransitionPeriod</span>*1000 - 1) div MTTI + 1)*MTTI</strong>
milliseconds).</p></dd></dl><p>If
<strong>NetTicktime &lt; PreviousNetTicktime</strong>,
the <strong>net_ticktime</strong> change is done at the end of
the transition period; otherwise at the beginning. During
the transition period, <strong>net_kernel</strong> ensures that
there is outgoing traffic on all connections at least
every <strong>MTTI</strong> millisecond.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The <strong>net_ticktime</strong> changes must be initiated on all
nodes in the network (with the same <strong><span class="anno">NetTicktime</span></strong>)
before the end of any transition period on any node;
otherwise connections can erroneously be disconnected.</p></div><p>Returns one of the following:</p><dl><dt><strong>unchanged</strong></dt><dd> <p><strong>net_ticktime</strong> already has the value of
<strong><span class="anno">NetTicktime</span></strong> and is left unchanged.</p> </dd><dt><strong>change_initiated</strong></dt><dd> <p><strong>net_kernel</strong> initiated the change of
<strong>net_ticktime</strong> to <strong><span class="anno">NetTicktime</span></strong>
seconds.</p> </dd><dt><strong>{ongoing_change_to, <span class="anno">NewNetTicktime</span>}</strong></dt><dd> <p>The request is <em>ignored</em> because
<strong>net_kernel</strong> is busy changing <strong>net_ticktime</strong> to
<strong><span class="anno">NewNetTicktime</span></strong> seconds.</p> </dd></dl><h3>setopts/2</h3><p>Set distribution socket options.</p><p>Set one or more options for distribution sockets.
Argument <strong><span class="anno">Node</span></strong> can be either one node name
or the atom <strong>new</strong> to affect the distribution sockets of all
future connected nodes.</p><p>The return value is the same as from
<a href="./inet#setopts/2">inet#setopts/2</a>
or <strong>{error, noconnection}</strong> if <strong><span class="anno">Node</span></strong> is not
a connected node or <strong>new</strong>.</p><p>If <strong><span class="anno">Node</span></strong> is <strong>new</strong> the <strong><span class="anno">Options</span></strong>
will then also be added to kernel configration parameters
<a href="../kernel/kernel_app#inet_dist_listen_options">inet_dist_listen_options</a>
and
<a href="../kernel/kernel_app#inet_dist_connect_options">inet_dist_connect_options</a>.</p><p>Returns <strong>ignored</strong> if the local node is not alive.</p><h3>start([Name]) -&gt; {ok, pid()} | {error, Reason}</h3><h3>start([Name, NameType]) -&gt; {ok, pid()} | {error, Reason}</h3><h3>start([Name, NameType, Ticktime]) -&gt; {ok, pid()} | {error, Reason}</h3><p>Turn an Erlang runtime system into a distributed node.</p><ul><li><span class="v">Name = atom()</span></li><li><span class="v">NameType = shortnames | longnames</span></li><li><span class="v">Reason = {already_started, pid()} | term()</span></li></ul><p>Turns a non-distributed node into a distributed node by
starting <strong>net_kernel</strong> and other necessary processes.</p><p>Notice that the argument is a list with exactly one, two, or
three arguments. <strong>NameType</strong> defaults to <strong>longnames</strong>
and <strong>Ticktime</strong> to <strong>15000</strong>.</p><h3>stop/0</h3><p>Turn a node into a non-distributed Erlang runtime system.</p><p>Turns a distributed node into a non-distributed node. For
other nodes in the network, this is the same as the node
going down. Only possible when the net kernel was started using
<a href="#start/1">start/1</a>,
otherwise <strong>{error, not_allowed}</strong> is returned. Returns
<strong>{error, not_found}</strong> if the local node is not alive.</p><h2>os</h2><p>Operating system-specific functions.</p><p>The functions in this module are operating system-specific.
Careless use of these functions results in programs that will
only run on a specific platform. On the other hand, with careful
use, these functions can be of help in enabling a program to run on
most platforms.</p><h2>Data Types</h2><span class="name">env_var_name</span><p>A string containing valid characters on the specific
OS for environment variable names using
<a href="./file#native_name_encoding/0">file#native_name_encoding/0</a>
encoding. Note that specifically null characters (integer
value zero) and <strong>$=</strong> characters are not allowed.
However, note that not all invalid characters necessarily
will cause the primitiv operations to fail, but may instead
produce invalid results.
</p><span class="name">env_var_value</span><p>A string containing valid characters on the specific
OS for environment variable values using
<a href="./file#native_name_encoding/0">file#native_name_encoding/0</a>
encoding. Note that specifically null characters (integer
value zero) are not allowed. However, note that not all
invalid characters necessarily will cause the primitiv
operations to fail, but may instead produce invalid results.
</p><span class="name">env_var_name_value</span><p>
Assuming that environment variables has been correctly
set, a strings containing valid characters on the specific
OS for environment variable names and values using
<a href="./file#native_name_encoding/0">file#native_name_encoding/0</a>
encoding. The first <strong>$=</strong> characters appearing in
the string separates environment variable name (on the
left) from environment variable value (on the right).
</p><span class="name">os_command</span><p>All characters needs to be valid characters on the
specific OS using
<a href="./file#native_name_encoding/0">file#native_name_encoding/0</a>
encoding. Note that specifically null characters (integer
value zero) are not allowed. However, note that not all
invalid characters not necessarily will cause
<a href="#cmd/1">cmd/1</a>
to fail, but may instead produce invalid results.
</p><span class="name">os_command_opts</span><p>Options for <a href="#cmd/2">cmd/2</a></p><dl><dt><strong>max_size</strong></dt><dd> <p>The maximum size of the data returned by the <strong>os:cmd</strong> call.
See the <a href="#cmd/2">cmd/2</a>
documentation for more details.</p> </dd></dl><h2>Functions</h2><h3>cmd/1</h3><h3>cmd/2</h3><p>Execute a command in a shell of the target OS.</p><p>Executes <strong><span class="anno">Command</span></strong> in a command shell of the
target OS, captures the standard output of the command,
and returns this result as a string.</p><div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Previous implementation used to allow all characters
as long as they were integer values greater than or equal to zero.
This sometimes lead to unwanted results since null characters
(integer value zero) often are interpreted as string termination. The
current implementation rejects these.</p></div><p><em>Examples:</em></p><pre><code class="">
LsOut = os:cmd("ls"), % on unix platform
DirOut = os:cmd("dir"), % on Win32 platform</code></pre><p>Notice that in some cases, standard output of a command when
called from another program (for example, <strong>os:cmd/1</strong>)
can differ, compared with the standard output of the command
when called directly from an OS command shell.</p><p><strong>os:cmd/2</strong> was added in kernel-5.5 (OTP-20.2.1). It makes it
possible to pass an options map as the second argument in order to
control the behaviour of <strong>os:cmd</strong>. The possible options are:
</p><dl><dt><strong>max_size</strong></dt><dd> <p>The maximum size of the data returned by the <strong>os:cmd</strong> call.
This option is a safety feature that should be used when the command
executed can return a very large, possibly infinite, result.</p> <pre><code class="">
&gt; os:cmd("cat /dev/zero", #{ max_size =&gt; 20 }).
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]</code></pre> </dd></dl><h3>find_executable/1</h3><h3>find_executable/2</h3><p>Absolute filename of a program.</p><p>These two functions look up an executable program, with the
specified name and a search path, in the same way as the underlying
OS. <strong>find_executable/1</strong> uses the current
execution path (that is, the environment variable <strong>PATH</strong> on
Unix and Windows).</p><p><strong><span class="anno">Path</span></strong>, if specified, is to conform to the syntax
of execution paths on the OS. Returns the absolute filename of the
executable program <strong><span class="anno">Name</span></strong>,
or <strong>false</strong> if the program is not found.</p><h3>getenv/0</h3><p>List all environment variables.</p><p>Returns a list of all environment variables.
Each environment variable is expressed as a single string on
the format <strong>"VarName=Value"</strong>, where <strong>VarName</strong> is
the name of the variable and <strong>Value</strong> its value.</p><p>If Unicode filename encoding is in effect (see the
<a href="../erts/erl#file_name_encoding"> manual page</a>), the strings can contain characters with
codepoints &gt; 255.</p><h3>getenv/1</h3><p>Get the value of an environment variable.</p><p>Returns the <strong><span class="anno">Value</span></strong> of the environment variable
<strong><span class="anno">VarName</span></strong>, or <strong>false</strong> if the environment
variable is undefined.</p><p>If Unicode filename encoding is in effect (see the
<a href="../erts/erl#file_name_encoding"> manual page</a>), the strings <strong><span class="anno">VarName</span></strong> and
<strong><span class="anno">Value</span></strong> can contain characters with
codepoints &gt; 255.</p><h3>getenv/2</h3><p>Get the value of an environment variable.</p><p>Returns the <strong><span class="anno">Value</span></strong> of the environment variable
<strong><span class="anno">VarName</span></strong>, or <strong>DefaultValue</strong> if the
environment variable is undefined.</p><p>If Unicode filename encoding is in effect (see the
<a href="../erts/erl#file_name_encoding"> manual page</a>), the strings <strong><span class="anno">VarName</span></strong> and
<strong><span class="anno">Value</span></strong> can contain characters with
codepoints &gt; 255.</p><h3>getpid/0</h3><p>Return the process identifier of the emulator process.</p><p>Returns the process identifier of the current Erlang emulator
in the format most commonly used by the OS environment.
Returns <strong><span class="anno">Value</span></strong> as a string containing
the (usually) numerical identifier for a process. On Unix,
this is typically the return value of the <strong>getpid()</strong>
system call. On Windows,
the process id as returned by the <strong>GetCurrentProcessId()</strong>
system call is used.</p><h3>putenv/2</h3><p>Set a new value for an environment variable.</p><p>Sets a new <strong><span class="anno">Value</span></strong> for environment variable
<strong><span class="anno">VarName</span></strong>.</p><p>If Unicode filename encoding is in effect (see the
<a href="../erts/erl#file_name_encoding"> manual page</a>), the strings <strong><span class="anno">VarName</span></strong> and
<strong><span class="anno">Value</span></strong> can contain characters with
codepoints &gt; 255.</p><p>On Unix platforms, the environment is set using UTF-8 encoding
if Unicode filename translation is in effect. On Windows, the
environment is set using wide character interfaces.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>
<strong><span class="anno">VarName</span></strong> is not allowed to contain
an <strong>$=</strong> character. Previous implementations used
to just let the <strong>$=</strong> character through which
silently caused erroneous results. Current implementation
will instead throw a <strong>badarg</strong> exception.
</p></div><h3>set_signal/2</h3><p>Enables or disables handling of OS signals.</p><p>Enables or disables OS signals.</p><p>Each signal my be set to one of the following options:</p><dl><dt><strong>ignore</strong></dt><dd> This signal will be ignored. </dd><dt><strong>default</strong></dt><dd> This signal will use the default signal handler for the operating system. </dd><dt><strong>handle</strong></dt><dd> This signal will notify <a href="./kernel_app#erl_signal_server">kernel_app#erl_signal_server</a> when it is received by the Erlang runtime system. </dd></dl><h3>system_time/0</h3><p>Current OS system time.</p><p>Returns the current
<a href="../erts/time_correction#OS_System_Time">OS system time</a>
in <strong>native</strong>
<a href="../erts/erlang#type_time_unit">time unit</a>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>This time is <em>not</em> a monotonically increasing time.</p></div><h3>system_time/1</h3><p>Current OS system time.</p><p>Returns the current
<a href="../erts/time_correction#OS_System_Time">OS system time</a>
converted into the <strong><span class="anno">Unit</span></strong> passed as argument.</p><p>Calling <strong>os:system_time(<span class="anno">Unit</span>)</strong> is equivalent to
<a href="../erts/erlang#convert_time_unit/3">erts/erlang#convert_time_unit/3</a>(<a href="#system_time/0">system_time/0</a><strong>, native, <span class="anno">Unit</span>)</strong>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>This time is <em>not</em> a monotonically increasing time.</p></div><h3>timestamp/0</h3><p>Current OS system time on the <strong>erlang:timestamp/0</strong> format.</p><dl><dt>Timestamp</dt><dd>Timestamp = {MegaSecs, Secs, MicroSecs}</dd></dl><p>Returns the current
<a href="../erts/time_correction#OS_System_Time">OS system time</a>
in the same format as
<a href="../erts/erlang#timestamp/0">erts/erlang#timestamp/0</a>.
The tuple can be used together with function
<a href="../stdlib/calendar#now_to_universal_time/1">stdlib/calendar#now_to_universal_time/1</a>
or <a href="../stdlib/calendar#now_to_local_time/1">stdlib/calendar#now_to_local_time/1</a>
to get calendar time. Using the calendar time, together with the
<strong>MicroSecs</strong> part of the return tuple from this function, allows
you to log time stamps in high resolution and consistent with the
time in the rest of the OS.</p><p>Example of code formatting a string in format
"DD Mon YYYY HH:MM:SS.mmmmmm", where DD is the day of month,
Mon is the textual month name, YYYY is the year, HH:MM:SS is the time,
and mmmmmm is the microseconds in six positions:</p><pre><code class="">
-module(print_time).
-export([format_utc_timestamp/0]).
format_utc_timestamp() -&gt;
    TS = {_,_,Micro} = os:timestamp(),
    {{Year,Month,Day},{Hour,Minute,Second}} =
calendar:now_to_universal_time(TS),
    Mstr = element(Month,{"Jan","Feb","Mar","Apr","May","Jun","Jul",
    "Aug","Sep","Oct","Nov","Dec"}),
    io_lib:format("~2w ~s ~4w ~2w:~2..0w:~2..0w.~6..0w",
    [Day,Mstr,Year,Hour,Minute,Second,Micro]).</code></pre><p>This module can be used as follows:</p><pre>
1&gt; <span class="input">io:format("~s~n",[print_time:format_utc_timestamp()]).</span>
29 Apr 2009  9:55:30.051711</pre><p>OS system time can also be retreived by
<a href="#system_time/0">system_time/0</a> and
<a href="#system_time/1">system_time/1</a>.</p><h3>perf_counter/0</h3><p>Returns a performance counter</p><p>Returns the current performance counter value in <strong>perf_counter</strong>
<a href="../erts/erlang#type_time_unit">time unit</a>.
This is a highly optimized call that might not be traceable.
</p><h3>perf_counter/1</h3><p>Returns a performance counter</p><p>Returns a performance counter that can be used as a very fast and
high resolution timestamp. This counter is read directly from the hardware or operating
system with the same guarantees. This means that two consecutive calls
to the function are not guaranteed to be monotonic, though it most likely will be.
The performance counter will be converted to the resolution passed as an argument.</p><pre>1&gt; <span class="input">T1 = os:perf_counter(1000),receive after 10000 -&gt; ok end,T2 = os:perf_counter(1000).</span>
176525861
2&gt; <span class="input">T2 - T1.</span>
10004</pre><h3>type/0</h3><p>Return the OS family and, in some cases, the OS name of the current OS.</p><p>Returns the <strong><span class="anno">Osfamily</span></strong> and, in some cases, the
<strong><span class="anno">Osname</span></strong> of the current OS.</p><p>On Unix, <strong><span class="anno">Osname</span></strong> has the same value as
<strong>uname -s</strong> returns, but in lower case. For example, on
Solaris 1 and 2, it is <strong>sunos</strong>.</p><p>On Windows, <strong><span class="anno">Osname</span></strong> is <strong>nt</strong>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Think twice before using this function. Use module
<a href="./filename">stdlib/filename</a>
if you want to inspect or build filenames in a portable way.
Avoid matching on atom <strong><span class="anno">Osname</span></strong>.</p></div><h3>unsetenv/1</h3><p>Delete an environment variable.</p><p>Deletes the environment variable <strong><span class="anno">VarName</span></strong>.</p><p>If Unicode filename encoding is in effect (see the
<a href="../erts/erl#file_name_encoding"> manual page</a>), the string <strong><span class="anno">VarName</span></strong> can
contain characters with codepoints &gt; 255.</p><h3>version/0</h3><p>Return the OS versions.</p><p>Returns the OS version.
On most systems, this function returns a tuple, but a string
is returned instead if the system has versions that
cannot be expressed as three numbers.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>Think twice before using this function. If you still need
to use it, always <strong>call os:type()</strong> first.</p></div><h2>pg2</h2><p>Distributed named process groups.</p><p>This module implements process groups. Each message can be sent
to one, some, or all group members.A group of processes can be accessed by a common name. For
example, if there is a group named <strong>foobar</strong>, there can be a
set of processes (which can be located on different nodes) that
are all members of the group <strong>foobar</strong>. There are no special
functions for sending a message to the group. Instead, client
functions are to be written with the functions
<a href="#get_members/1">get_members/1</a> and
<a href="#get_local_members/1">get_local_members/1</a>
to determine which processes are members of the group.
Then the message can be sent to one or more group members.If a member terminates, it is automatically removed from the group.</p><h2>Data Types</h2><span class="name">name</span><p>The name of a process group.</p><h2>Functions</h2><h3>create/1</h3><p>Create a new, empty process group.</p><p>Creates a new, empty process group. The group is globally
visible on all nodes. If the group exists, nothing happens.</p><h3>delete/1</h3><p>Delete a process group.</p><p>Deletes a process group.</p><h3>get_closest_pid/1</h3><p>Common dispatch function.</p><p>A useful dispatch function that can be used from
client functions. It returns a process on the local node, if
such a process exists. Otherwise, it selects one randomly.</p><h3>get_local_members/1</h3><p>Return all local processes in a group.</p><p>Returns all processes running on the local node in the
group <strong>Name</strong>. This function is to be used from
within a client function that accesses the group. It is therefore
optimized for speed.</p><h3>get_members/1</h3><p>Return all processes in a group.</p><p>Returns all processes in the group <strong>Name</strong>. This
function is to be used from within a client function that
accesses the group. It is therefore optimized for speed.</p><h3>join/2</h3><p>Join a process to a group.</p><p>Joins the process <strong>Pid</strong> to the group <strong>Name</strong>.
A process can join a group many times and must then
leave the group the same number of times.</p><h3>leave/2</h3><p>Make a process leave a group.</p><p>Makes the process <strong>Pid</strong> leave the group <strong>Name</strong>.
If the process is not a member of the group, <strong>ok</strong> is
returned.</p><h3>start/0</h3><h3>start_link/0</h3><p>Start the <strong>pg2</strong> server.</p><p>Starts the <strong>pg2</strong> server. Normally, the server does not need
to be started explicitly, as it is started dynamically if it
is needed. This is useful during development, but in a
target system the server is to be started explicitly. Use the
configuration parameters for
<a href="./kernel_app#start_pg2">kernel_app#start_pg2</a>
for this.</p><h3>which_groups/0</h3><p>Return a list of all known groups.</p><p>Returns a list of all known groups.</p><h3>See Also</h3><p><a href="kernel_app">kernel_app</a></p><h2>rpc</h2><p>Remote Procedure Call services.</p><p>This module contains services similar to Remote
Procedure Calls. It also contains broadcast facilities and
parallel evaluators. A remote procedure call is a method to call
a function on a remote node and collect the answer. It is used
for collecting information on a remote node, or for running a
function with some specific side effects on the remote node.</p><h2>Data Types</h2><span class="name">key</span><p>As returned by
<a href="#async_call/4">async_call/4</a>.</p><h2>Functions</h2><h3>abcast/2</h3><p>Broadcast a message asynchronously to a registered process on all nodes.</p><p>Equivalent to <strong>abcast([node()|nodes()], <span class="anno">Name</span>, <span class="anno">Msg</span>)</strong>.</p><h3>abcast/3</h3><p>Broadcast a message asynchronously to a registered process on specific nodes.</p><p>Broadcasts the message <strong><span class="anno">Msg</span></strong> asynchronously to
the registered process <strong><span class="anno">Name</span></strong> on the specified
nodes.</p><h3>async_call/4</h3><p>Evaluate a function call on a node, asynchronous version.</p><p>Implements <em>call streams with promises</em>, a type of
RPC that does not suspend the caller until the result is
finished. Instead, a key is returned, which can be used
later to collect the value. The key can be viewed as a
promise to deliver the answer.</p><p>In this case, the key <strong><span class="anno">Key</span></strong> is returned, which
can be used in a subsequent call to
<a href="#yield/1">yield/1</a> or
<a href="#nb_yield/1">nb_yield/1</a>
to retrieve the value of evaluating <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on node
<strong><span class="anno">Node</span></strong>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p><a href="#yield/1">yield/1</a> and
<a href="#nb_yield/1">nb_yield/1</a>
must be called by the same process from which this function
was made otherwise they will never yield correctly.</p></div><h3>block_call/4</h3><p>Evaluate a function call on a node in the RPC server's context.</p><p>Same as <a href="#call/4">call/4</a>,
but the RPC server at <strong><span class="anno">Node</span></strong> does
not create a separate process to handle the call. Thus,
this function can be used if the intention of the call is to
block the RPC server from any other incoming requests until
the request has been handled. The function can also be used
for efficiency reasons when very small fast functions are
evaluated, for example, BIFs that are guaranteed not to
suspend.</p><h3>block_call/5</h3><p>Evaluate a function call on a node in the RPC server's context.</p><p>Same as
<a href="#block_call/4">block_call/4</a>,
but with a time-out value in the same manner as
<a href="#call/5">call/5</a>.</p><h3>call/4</h3><p>Evaluate a function call on a node.</p><p>Evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on node <strong><span class="anno">Node</span></strong> and returns
the corresponding value <strong><span class="anno">Res</span></strong>, or
<strong>{badrpc, <span class="anno">Reason</span>}</strong> if the call fails.</p><h3>call/5</h3><p>Evaluate a function call on a node.</p><p>Evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on node <strong><span class="anno">Node</span></strong> and returns
the corresponding value <strong><span class="anno">Res</span></strong>, or
<strong>{badrpc, <span class="anno">Reason</span>}</strong> if the call fails.
<strong><span class="anno">Timeout</span></strong> is
a time-out value in milliseconds. If the call times out,
<strong><span class="anno">Reason</span></strong> is <strong>timeout</strong>.</p><p>If the reply arrives after the call times out, no message
contaminates the caller's message queue, as this
function spawns off a middleman process to act as (a void)
destination for such an orphan reply. This feature also makes
this function more expensive than <strong>call/4</strong> at
the caller's end.</p><h3>cast/4</h3><p>Run a function on a node ignoring the result.</p><p>Evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on node
<strong><span class="anno">Node</span></strong>. No response is delivered and the calling
process is not suspended until the evaluation is complete, as
is the case with
<a href="#call/4">call/4</a>.</p><h3>eval_everywhere/3</h3><p>Run a function on all nodes, ignoring the result.</p><p>Equivalent to <strong>eval_everywhere([node()|nodes()], <span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong>.</p><h3>eval_everywhere/4</h3><p>Run a function on specific nodes, ignoring the result.</p><p>Evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on
the specified nodes. No answers are collected.</p><h3>multi_server_call/2</h3><p>Interact with the servers on a number of nodes.</p><p>Equivalent to <strong>multi_server_call([node()|nodes()], <span class="anno">Name</span>, <span class="anno">Msg</span>)</strong>.</p><h3>multi_server_call/3</h3><p>Interact with the servers on a number of nodes.</p><p>Can be used when interacting with servers called
<strong><span class="anno">Name</span></strong> on the specified nodes. It is assumed that
the servers receive messages in the format
<strong>{From, <span class="anno">Msg</span>}</strong> and reply using
<strong>From ! {<span class="anno">Name</span>, Node, <span class="anno">Reply</span>}</strong>, where
<strong>Node</strong> is the name of the node where the server is located.
The function returns <strong>{<span class="anno">Replies</span>, <span class="anno">BadNodes</span>}</strong>, where <strong><span class="anno">Replies</span></strong> is a
list of all <strong><span class="anno">Reply</span></strong> values, and
<strong><span class="anno">BadNodes</span></strong> is one of the following:</p><ul><li>A list of the nodes that do not exist</li><li>A list of the nodes where the server does not exist</li><li>A list of the nodes where the server terminated before sending any reply.</li></ul><h3>multicall/3</h3><p>Evaluate a function call on a number of nodes.</p><p>Equivalent to <strong>multicall([node()|nodes()], <span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>, infinity)</strong>.</p><h3>multicall/4</h3><p>Evaluate a function call on a number of nodes.</p><p>Equivalent to <strong>multicall(<span class="anno">Nodes</span>, <span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>, infinity)</strong>.</p><h3>multicall/4</h3><p>Evaluate a function call on a number of nodes.</p><p>Equivalent to <strong>multicall([node()|nodes()], <span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>, <span class="anno">Timeout</span>)</strong>.</p><h3>multicall/5</h3><p>Evaluate a function call on a number of nodes.</p><p>In contrast to an RPC, a multicall is an RPC that is sent
concurrently from one client to multiple servers. This is
useful for collecting information from a set of nodes,
or for calling a function on a set of nodes to achieve some
side effects. It is semantically the same as iteratively
making a series of RPCs on all the nodes, but the multicall
is faster, as all the requests are sent at the same time
and are collected one by one as they come back.</p><p>The function evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong>
on the specified nodes and collects the answers. It returns
<strong>{<span class="anno">ResL</span>, <span class="anno">BadNodes</span>}</strong>, where
<strong><span class="anno">BadNodes</span></strong> is a list
of the nodes that do not exist,
and <strong><span class="anno">ResL</span></strong> is a list of the return values,
or <strong>{badrpc, <span class="anno">Reason</span>}</strong> for failing calls.
<strong><span class="anno">Timeout</span></strong> is a time (integer) in milliseconds, or
<strong>infinity</strong>.</p><p>The following example is useful when new object code is to
be loaded on all nodes in the network, and indicates
some side effects that RPCs can produce:</p><pre><code class="">
%% Find object code for module Mod
{Mod, Bin, File} = code:get_object_code(Mod),

%% and load it on all nodes including this one
{ResL, _} = rpc:multicall(code, load_binary, [Mod, File, Bin]),

%% and then maybe check the ResL list.</code></pre><h3>nb_yield/1</h3><p>Deliver the result of evaluating a function call on a node (non-blocking).</p><p>Equivalent to <strong>nb_yield(<span class="anno">Key</span>, 0)</strong>.</p><h3>nb_yield/2</h3><p>Deliver the result of evaluating a function call on a node (non-blocking).</p><p>Non-blocking version of
<a href="#yield/1">yield/1</a>. It returns
the tuple <strong>{value, <span class="anno">Val</span>}</strong> when the computation is
finished, or <strong>timeout</strong> when <strong><span class="anno">Timeout</span></strong>
milliseconds has elapsed.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>This function must be called by the same process from which
<a href="#async_call/4">async_call/4</a>
was made otherwise it will only return <strong>timeout</strong>.</p></div><h3>parallel_eval/1</h3><p>Evaluate many function calls on all nodes in parallel.</p><p>Evaluates, for every tuple in <strong><span class="anno">FuncCalls</span></strong>,
<strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, <span class="anno">Args</span>)</strong> on some node in
the network. Returns the list of return values, in the same
order as in <strong><span class="anno">FuncCalls</span></strong>.</p><h3>pinfo/1</h3><p>Information about a process.</p><p>Location transparent version of the BIF
<a href="../erts/erlang#process_info/1">erts/erlang#process_info/1</a> in ERTS.</p><h3>pinfo/2</h3><h3>pinfo/2</h3><p>Information about a process.</p><p>Location transparent version of the BIF
<a href="../erts/erlang#process_info/2">erts/erlang#process_info/2</a> in ERTS.</p><h3>pmap/3</h3><p>Parallel evaluation of mapping a function over a list.</p><p>Evaluates <strong>apply(<span class="anno">Module</span>, <span class="anno">Function</span>, [<span class="anno">Elem</span>|<span class="anno">ExtraArgs</span>])</strong> for every element
<strong><span class="anno">Elem</span></strong> in <strong><span class="anno">List1</span></strong>, in parallel.
Returns the list of return values, in the same order as in
<strong><span class="anno">List1</span></strong>.</p><h3>sbcast/2</h3><p>Broadcast a message synchronously to a registered process on all nodes.</p><p>Equivalent to <strong>sbcast([node()|nodes()], <span class="anno">Name</span>, <span class="anno">Msg</span>)</strong>.</p><h3>sbcast/3</h3><p>Broadcast a message synchronously to a registered process on specific nodes.</p><p>Broadcasts the message <strong><span class="anno">Msg</span></strong> synchronously to
the registered process <strong><span class="anno">Name</span></strong> on the specified
nodes.</p><p>Returns <strong>{<span class="anno">GoodNodes</span>, <span class="anno">BadNodes</span>}</strong>,
where <strong><span class="anno">GoodNodes</span></strong> is the list of nodes that have
<strong><span class="anno">Name</span></strong> as a registered process.</p><p>The function is synchronous in the sense that it is known
that all servers have received the message when the call
returns. It is not possible to know that the servers have
processed the message.</p><p>Any further messages sent to the servers, after this
function has returned, are received by all servers after
this message.</p><h3>server_call/4</h3><p>Interact with a server on a node.</p><p>Can be used when interacting with a server called
<strong><span class="anno">Name</span></strong> on node <strong><span class="anno">Node</span></strong>. It is
assumed that the server receives messages in the format
<strong>{From, <span class="anno">Msg</span>}</strong> and replies using
<strong>From ! {<span class="anno">ReplyWrapper</span>, <span class="anno">Node</span>, <span class="anno">Reply</span>}</strong>. This function makes such
a server call and ensures that the entire call is packed into
an atomic transaction, which either succeeds or fails. It
never hangs, unless the server itself hangs.</p><p>The function returns the answer <strong><span class="anno">Reply</span></strong> as
produced by the server <strong><span class="anno">Name</span></strong>, or
<strong>{error, <span class="anno">Reason</span>}</strong>.</p><h3>yield/1</h3><p>Deliver the result of evaluating a function call on a node (blocking).</p><p>Returns the promised answer from a previous
<a href="#async_call/4">async_call/4</a>.
If the answer is available, it is
returned immediately. Otherwise, the calling process is
suspended until the answer arrives from <strong>Node</strong>.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>This function must be called by the same process from which
<a href="#async_call/4">async_call/4</a>
was made otherwise it will never return.</p></div><h2>seq_trace</h2><p>Sequential tracing of messages.</p><p>Sequential tracing makes it possible to trace all messages
resulting from one initial message. Sequential tracing is
independent of the ordinary tracing in Erlang, which
is controlled by the <strong>erlang:trace/3</strong> BIF. For more information
about what sequential tracing is and how it can be used, see section
<a href="#whatis">Sequential Tracing</a>.<strong>seq_trace</strong> provides functions that control all aspects of
sequential tracing. There are functions for activation,
deactivation, inspection, and for collection of the trace output.</p><h2>Data Types</h2><span class="name">token</span><p>An opaque term (a tuple) representing a trace token.</p><h2>Functions</h2><h3>set_token/1</h3><p>Set the trace token</p><p>Sets the trace token for the calling process to <strong><span class="anno">Token</span></strong>.
If <strong><span class="anno">Token</span> == []</strong> then tracing is disabled, otherwise
<strong><span class="anno">Token</span></strong> should be an Erlang term returned from
<strong>get_token/0</strong> or <strong>set_token/1</strong>. <strong>set_token/1</strong>
can be used to temporarily exclude message passing from
the trace by setting the trace token to empty like this:</p><pre><code class="">
OldToken = seq_trace:set_token([]), % set to empty and save 
                                    % old value
% do something that should not be part of the trace
io:format("Exclude the signalling caused by this~n"),
seq_trace:set_token(OldToken), % activate the trace token again
...  </code></pre><p>Returns the previous value of the trace token.</p><h3>set_token/2</h3><p>Set a component of the trace token</p><ul><li>component</li></ul><ul><li>flag</li></ul><ul><li>value</li></ul><p>Sets the individual <strong><span class="anno">Component</span></strong> of the trace token to
<strong><span class="anno">Val</span></strong>. Returns the previous value of the component.</p><dl><dt><strong>set_token(label, <span class="anno">Label</span>)</strong></dt><dd> <p>The <strong>label</strong> component is a term which
identifies all events belonging to the same sequential
trace. If several sequential traces can be active
simultaneously, <strong>label</strong> is used to identify
the separate traces. Default is 0.</p> <div class="alert alert-warning"><h4 class="alert-heading">Warning</h4><p>Labels were restricted to small signed integers (28 bits)
prior to OTP 21. The trace token will be silenty dropped if it
crosses over to a node that does not support the label.</p></div> </dd><dt><strong>set_token(serial, SerialValue)</strong></dt><dd> <p><strong>SerialValue = {<span class="anno">Previous</span>, <span class="anno">Current</span>}</strong>.
The <strong>serial</strong> component contains counters which
enables the traced messages to be sorted, should never be
set explicitly by the user as these counters are updated
automatically. Default is <strong>{0, 0}</strong>.</p> </dd><dt><strong>set_token(send, <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables tracing on message sending. Default is
<strong>false</strong>.</p> </dd><dt><strong>set_token('receive', <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables tracing on message reception. Default is
<strong>false</strong>.</p> </dd><dt><strong>set_token(print, <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables tracing on explicit calls to
<strong>seq_trace:print/1</strong>. Default is <strong>false</strong>.</p> </dd><dt><strong>set_token(timestamp, <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables a timestamp to be generated for each
traced event. Default is <strong>false</strong>.</p> </dd><dt><strong>set_token(strict_monotonic_timestamp, <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables a strict monotonic timestamp to be generated
for each traced event. Default is <strong>false</strong>. Timestamps will
consist of
<a href="../erts/time_correction#Erlang_Monotonic_Time">Erlang monotonic time</a> and a monotonically increasing
integer. The time-stamp has the same format and value
as produced by <strong>{erlang:monotonic_time(nanosecond), erlang:unique_integer([monotonic])}</strong>.</p> </dd><dt><strong>set_token(monotonic_timestamp, <span class="anno">Bool</span>)</strong></dt><dd> <p>A trace token flag (<strong>true | false</strong>) which
enables/disables a strict monotonic timestamp to be generated
for each traced event. Default is <strong>false</strong>. Timestamps
will use
<a href="../erts/time_correction#Erlang_Monotonic_Time">Erlang monotonic time</a>. The time-stamp has the same
format and value as produced by
<strong>erlang:monotonic_time(nanosecond)</strong>.</p> </dd></dl><p>If multiple timestamp flags are passed, <strong>timestamp</strong> has
precedence over <strong>strict_monotonic_timestamp</strong> which
in turn has precedence over <strong>monotonic_timestamp</strong>. All
timestamp flags are remembered, so if two are passed
and the one with highest precedence later is disabled
the other one will become active.</p><h3>get_token/0</h3><p>Return the value of the trace token</p><p>Returns the value of the trace token for the calling process.
If <strong>[]</strong> is returned, it means that tracing is not active.
Any other value returned is the value of an active trace
token. The value returned can be used as input to
the <strong>set_token/1</strong> function.</p><h3>get_token/1</h3><p>Return the value of a trace token component</p><ul><li>component</li></ul><ul><li>flag</li></ul><ul><li>value</li></ul><p>Returns the value of the trace token component
<strong>Component</strong>. See
<a href="#set_token/2">set_token/2</a> for
possible values of <strong>Component</strong> and <strong>Val</strong>.</p><h3>print/1</h3><p>Put the Erlang term <strong>TraceInfo</strong>into the sequential trace output</p><p>Puts the Erlang term <strong><span class="anno">TraceInfo</span></strong> into the sequential
trace output if the calling process currently is executing
within a sequential trace and the <strong>print</strong> flag of
the trace token is set.</p><h3>print/2</h3><p>Put the Erlang term <strong>TraceInfo</strong>into the sequential trace output</p><p>Same as <strong>print/1</strong> with the additional condition that
<strong><span class="anno">TraceInfo</span></strong> is output only if <strong>Label</strong> is equal to
the label component of the trace token.</p><h3>reset_trace/0</h3><p>Stop all sequential tracing on the local node</p><p>Sets the trace token to empty for all processes on the
local node. The process internal counters used to create
the serial of the trace token is set to 0. The trace token is
set to empty for all messages in message queues. Together
this will effectively stop all ongoing sequential tracing in
the local node.</p><h3>set_system_tracer/1</h3><p>Set the system tracer</p><ul><li>tracer</li></ul><p>Sets the system tracer. The system tracer can be either a
process, port or <a href="./erl_tracer">tracer module</a>
denoted by <strong><span class="anno">Tracer</span></strong>.
Returns the previous value (which can be <strong>false</strong> if no system
tracer is active).</p><p>Failure: <strong>{badarg, Info}}</strong> if <strong><span class="anno">Pid</span></strong> is not an
existing local pid.</p><h3>get_system_tracer/0</h3><p>Return the pid() or port() of the current system tracer.</p><ul><li>tracer</li></ul><p>Returns the pid, port identifier or tracer module of the current system
tracer or <strong>false</strong> if no system tracer is activated.</p><h3>Trace Messages Sent to the System Tracer</h3><p>The format of the messages is one of the following, depending on if
flag <strong>timestamp</strong> of the trace token is set to <strong>true</strong> or
<strong>false</strong>:</p><pre><code class="">
{seq_trace, Label, SeqTraceInfo, TimeStamp}</code></pre><p>or</p><pre><code class="">
{seq_trace, Label, SeqTraceInfo}</code></pre><p>Where:</p><pre><code class="">
Label = int()
TimeStamp = {Seconds, Milliseconds, Microseconds}  
  Seconds = Milliseconds = Microseconds = int()</code></pre><p><strong>SeqTraceInfo</strong> can have the following formats:</p><dl><dt><strong>{send, Serial, From, To, Message}</strong></dt><dd> <p>Used when a process <strong>From</strong> with its trace token flag
<strong>print</strong> set to <strong>true</strong> has sent a message.</p> </dd><dt><strong>{'receive', Serial, From, To, Message}</strong></dt><dd> <p>Used when a process <strong>To</strong> receives a message with a
trace token that has flag <strong>'receive'</strong> set to <strong>true</strong>.</p> </dd><dt><strong>{print, Serial, From, _, Info}</strong></dt><dd> <p>Used when a process <strong>From</strong> has called
<strong>seq_trace:print(Label, TraceInfo)</strong> and has a trace
token with flag <strong>print</strong> set to <strong>true</strong>, and
<strong>label</strong> set to <strong>Label</strong>.</p> </dd></dl><p><strong>Serial</strong> is a tuple <strong>{PreviousSerial, ThisSerial}</strong>,
where:</p><ul><li><p>Integer <strong>PreviousSerial</strong> denotes the serial
counter passed in the last received message that carried a trace
token. If the process is the first in a new sequential trace,
<strong>PreviousSerial</strong> is set to the value of the process internal
"trace clock".</p></li><li><p>Integer <strong>ThisSerial</strong> is the serial
counter that a process sets on outgoing messages. It is based
on the process internal "trace clock", which is incremented by one
before it is attached to the trace token in the message.</p></li></ul><a name="whatis"></a><h3>Sequential Tracing</h3><p>Sequential tracing is a way to trace a sequence of messages sent
between different local or remote processes, where the sequence
is initiated by a single message. In short, it works as follows:</p><p>Each process has a <em>trace token</em>, which can be empty or
not empty. When not empty, the trace token can be seen as
the tuple <strong>{Label, Flags, Serial, From}</strong>. The trace token is
passed invisibly with each message.</p><p>To start a sequential trace, the user must explicitly set
the trace token in the process that will send the first message
in a sequence.</p><p>The trace token of a process is set each time the process
matches a message in a receive statement, according to the trace
token carried by the received message, empty or not.</p><p>On each Erlang node, a process can be set as the <em>system tracer</em>.
This process will receive trace messages each time
a message with a trace token is sent or received (if the trace
token flag <strong>send</strong> or <strong>'receive'</strong> is set). The system
tracer can then print each trace event, write it to a file, or
whatever suitable.</p><div class="alert alert-info"><h4 class="alert-heading">Note</h4><p>The system tracer only receives those trace events that
occur locally within the Erlang node. To get the whole picture
of a sequential trace, involving processes on many Erlang
nodes, the output from the system tracer on each involved node
must be merged (offline).</p></div><p>The following sections describe sequential tracing and its most
fundamental concepts.</p><h3>Trace Token</h3><p>Each process has a current trace token. Initially, the token is
empty. When the process sends a message to another process, a
copy of the current token is sent "invisibly" along with
the message.</p><p>The current token of a process is set in one of the following two
ways:</p><ul><li> <p>Explicitly by the process itself, through a call to
<strong>seq_trace:set_token/1,2</strong></p> </li><li> <p>When a message is received</p> </li></ul><p>In both cases, the current token is set. In particular, if
the token of a received message is empty, the current token of
the process is set to empty.</p><p>A trace token contains a label and a set of flags. Both
the label and the flags are set in both alternatives above.</p><h3>Serial</h3><p>The trace token contains a component called
<strong>serial</strong>. It consists of two integers, <strong>Previous</strong> and
<strong>Current</strong>. The purpose is to uniquely identify each traced
event within a trace sequence, as well as to order the messages
chronologically and in the different branches, if any.</p><p>The algorithm for updating <strong>Serial</strong> can be described as
follows:</p><p>Let each process have two counters, <strong>prev_cnt</strong> and
<strong>curr_cnt</strong>, both are set to <strong>0</strong> when a process is created.
The counters are updated at the following occasions:</p><ul><li> <p><em>When the process is about to send a message and the trace token is not empty.</em></p> <p>Let the serial of the trace token be <strong>tprev</strong> and
<strong>tcurr</strong>.</p> <pre>
curr_cnt := curr_cnt + 1
tprev := prev_cnt
tcurr := curr_cnt</pre> <p>The trace token with <strong>tprev</strong> and <strong>tcurr</strong> is then
passed along with the message.</p> </li><li> <p><em>When the process calls</em> <strong>seq_trace:print(Label, Info)</strong>,
<strong>Label</strong> <em>matches the label part of the trace token and the trace token print flag is true.</em></p> <p>The algorithm is the same as for send above.</p> </li><li> <p><em>When a message is received and contains a non-empty trace token.</em></p> <p>The process trace token is set to the trace token from
the message.</p> <p>Let the serial of the trace token be <strong>tprev</strong> and
<strong>tcurr</strong>.</p> <pre><code class="">
if (curr_cnt &lt; tcurr )
   curr_cnt := tcurr
prev_cnt := tcurr</code></pre> </li></ul><p><strong>curr_cnt</strong> of a process is incremented each time
the process is involved in a sequential trace. The counter can
reach its limit (27 bits) if a process is very long-lived and is
involved in much sequential tracing. If the counter overflows, the
serial for ordering of the trace events cannot be used. To prevent
the counter from overflowing in the middle of
a sequential trace, function <strong>seq_trace:reset_trace/0</strong>
can be called to reset <strong>prev_cnt</strong> and <strong>curr_cnt</strong> of
all processes in the Erlang node. This function also sets all
trace tokens in processes and their message queues to empty, and
thus stops all ongoing sequential tracing.</p><h3>Performance Considerations</h3><p>The performance degradation for a system that is enabled for
sequential tracing is negligible as long as no tracing is
activated. When tracing is activated, there is an
extra cost for each traced message, but all other messages are
unaffected.</p><h3>Ports</h3><p>Sequential tracing is not performed across ports.</p><p>If the user for some reason wants to pass the trace token to a
port, this must be done manually in the code of the port
controlling process. The port controlling processes have to check
the appropriate sequential trace settings (as obtained from
<strong>seq_trace:get_token/1</strong>) and include trace information in
the message data sent to their respective ports.</p><p>Similarly, for messages received from a port, a port controller
has to retrieve trace-specific information, and set appropriate
sequential trace flags through calls to
<strong>seq_trace:set_token/2</strong>.</p><h3>Distribution</h3><p>Sequential tracing between nodes is performed transparently.
This applies to C-nodes built with <strong>Erl_Interface</strong> too. A C-node
built with <strong>Erl_Interface</strong> only maintains one trace token, which
means that the C-node appears as one process from
the sequential tracing point of view.</p><h3>Example of Use</h3><p>This example gives a rough idea of how the new
primitives can be used and what kind of output it produces.</p><p>Assume that you have an initiating process with
<strong>Pid == &lt;0.30.0&gt;</strong> like this:</p><pre><code class="">
-module(seqex).
-compile(export_all).

loop(Port) -&gt;
    receive 
        {Port,Message} -&gt;
            seq_trace:set_token(label,17),
            seq_trace:set_token('receive',true),
            seq_trace:set_token(print,true),
            seq_trace:print(17,"**** Trace Started ****"),
            call_server ! {self(),the_message};
        {ack,Ack} -&gt;
            ok
    end,
    loop(Port).</code></pre><p>And a registered process <strong>call_server</strong> with
<strong>Pid == &lt;0.31.0&gt;</strong> like this:</p><pre><code class="">
loop() -&gt;
    receive
        {PortController,Message} -&gt;
            Ack = {received, Message},
            seq_trace:print(17,"We are here now"),
            PortController ! {ack,Ack}
    end,
    loop().</code></pre><p>A possible output from the system's <strong>sequential_tracer</strong> can be
like this:</p><pre>
17:&lt;0.30.0&gt; Info {0,1} WITH
"**** Trace Started ****"
17:&lt;0.31.0&gt; Received {0,2} FROM &lt;0.30.0&gt; WITH
{&lt;0.30.0&gt;,the_message}
17:&lt;0.31.0&gt; Info {2,3} WITH
"We are here now"
17:&lt;0.30.0&gt; Received {2,4} FROM &lt;0.31.0&gt; WITH
{ack,{received,the_message}}</pre><p>The implementation of a system tracer process that produces
this printout can look like this:</p><pre><code class="">
tracer() -&gt;
    receive
        {seq_trace,Label,TraceInfo} -&gt;
           print_trace(Label,TraceInfo,false);
        {seq_trace,Label,TraceInfo,Ts} -&gt;
           print_trace(Label,TraceInfo,Ts);
        Other -&gt; ignore
    end,
    tracer().        

print_trace(Label,TraceInfo,false) -&gt;
    io:format("~p:",[Label]),
    print_trace(TraceInfo);
print_trace(Label,TraceInfo,Ts) -&gt;
    io:format("~p ~p:",[Label,Ts]),
    print_trace(TraceInfo).

print_trace({print,Serial,From,_,Info}) -&gt;
    io:format("~p Info ~p WITH~n~p~n", [From,Serial,Info]);
print_trace({'receive',Serial,From,To,Message}) -&gt;
    io:format("~p Received ~p FROM ~p WITH~n~p~n", 
              [To,Serial,From,Message]);
print_trace({send,Serial,From,To,Message}) -&gt;
    io:format("~p Sent ~p TO ~p WITH~n~p~n", 
              [From,Serial,To,Message]).</code></pre><p>The code that creates a process that runs this tracer function
and sets that process as the system tracer can look like this:</p><pre><code class="">
start() -&gt;
    Pid = spawn(?MODULE,tracer,[]),
    seq_trace:set_system_tracer(Pid), % set Pid as the system tracer 
    ok.</code></pre><p>With a function like <strong>test/0</strong>, the whole example can be
started:</p><pre><code class="">
test() -&gt;
    P = spawn(?MODULE, loop, [port]),
    register(call_server, spawn(?MODULE, loop, [])),
    start(),
    P ! {port,message}.</code></pre><h2>user</h2><p>Standard I/O server.</p><p><strong>user</strong> is a server that responds to all messages
defined in the I/O interface. The code in <strong>user.erl</strong> can be
used as a model for building alternative I/O servers.</p><h2>wrap_log_reader</h2><p>A service to read internally formatted wrap disk logs.
</p><p>This module makes it possible to read internally formatted
wrap disk logs, see
<a href="disk_log">disk_log</a>.
<strong>wrap_log_reader</strong> does not
interfere with <strong>disk_log</strong> activities; there is however a bug in this
version of the <strong>wrap_log_reader</strong>, see section
<a href="#bugs">Known Limitations</a>.A wrap disk log file consists of many files, called index files. A log
file can be opened and closed. Also, a single index file can be opened
separately. If a non-existent or non-internally formatted file is opened,
an error message is returned. If the file is corrupt, no attempt is made
to repair it, but an error message is returned.If a log is configured to be distributed, it is possible that all items
are not logged on all nodes. <strong>wrap_log_reader</strong> only reads the log on
the called node; it is up to the user to be sure that all items
are read.</p><h2>Data Types</h2><span class="name">continuation</span><p>Continuation returned by <strong>open/1,2</strong> or <strong>chunk/1,2</strong>.</p><h2>Functions</h2><h3>chunk/1</h3><h3>chunk/2</h3><p>Read a chunk of objects written to a wrap log.</p><ul><li>chunk_ret</li></ul><p>Enables to efficiently read the
terms that are appended to a log. Minimises disk
I/O by reading 64 kilobyte chunks from the file.</p><p>The first time <strong>chunk()</strong> is called, an initial
continuation returned from <strong>open/1</strong> or <strong>open/2</strong> must be
provided.</p><p>When <strong>chunk/3</strong> is called, <strong><span class="anno">N</span></strong> controls the
maximum number of terms that are read from the log in each
chunk. Defaults to <strong>infinity</strong>, which means that all the
terms contained in the 8K chunk are read. If less than
<strong><span class="anno">N</span></strong> terms are returned, this does not necessarily
mean that end of file is reached.</p><p>Returns a tuple <strong>{<span class="anno">Continuation2</span>, <span class="anno">Terms</span>}</strong>, where <strong><span class="anno">Terms</span></strong> is a list
of terms found in the log. <strong><span class="anno">Continuation2</span></strong> is yet
another continuation that  must be passed on to any
subsequent calls to <strong>chunk()</strong>. With a series of calls to
<strong>chunk()</strong>, it is then possible to extract all terms from a log.</p><p>Returns a tuple <strong>{<span class="anno">Continuation2</span>, <span class="anno">Terms</span>, <span class="anno">Badbytes</span>}</strong> if the log is opened
in read only mode and the read chunk is corrupt.
<strong><span class="anno">Badbytes</span></strong>
indicates the number of non-Erlang terms found in the chunk.
Notice that the log is not repaired.</p><p>Returns <strong>{<span class="anno">Continuation2</span>, eof}</strong> when
the end of the log is reached, and <strong>{error, <span class="anno">Reason</span>}</strong>
if an error occurs.</p><p>The returned continuation either is or is not valid in the next call
to this function. This is because the log can wrap and delete
the file into which the continuation points. To ensure
this does not occur, the log can be blocked during the search.</p><h3>close/1</h3><p>Close a log.</p><p>Closes a log file properly.</p><h3>open/1</h3><h3>open/2</h3><p>Open a log file.</p><ul><li>open_ret</li></ul><p><strong><span class="anno">Filename</span></strong> specifies the name of the file to be
read.</p><p><strong><span class="anno">N</span></strong> specifies the index of the file to be read.
If <strong><span class="anno">N</span></strong> is omitted, the whole wrap log file is read;
if it is specified, only the specified index file is read.</p><p>Returns <strong>{ok, <span class="anno">Continuation</span>}</strong> if the
log/index file is opened successfully.
<strong><span class="anno">Continuation</span></strong>
is to be used when chunking or closing the file.</p><p>Returns <strong>{error, <span class="anno">Reason</span>}</strong> for all errors.</p><h3>Known Limitations</h3><a name="bugs"></a><p>This version of <strong>wrap_log_reader</strong> does not detect if
<strong>disk_log</strong> wraps to a new index file between a call to
<strong>wrap_log_reader:open()</strong> and the first call to
<strong>wrap_log_reader:chunk()</strong>.
If this occurs, the call to <strong>chunk()</strong> reads the last logged
items in the log file, as the opened index file was truncated by
<strong>disk_log</strong>.</p><h3>See Also</h3><p><a href="disk_log">disk_log</a></p><h2>zlib</h2><p>Zlib compression interface.</p><p>This module is moved to the
<a href="./zlib">ERTS</a> application.</p></body></html>
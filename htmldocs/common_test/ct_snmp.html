<!doctype html>
<html><head><meta charset="utf-8"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css"></head><body style="margin: 4em 10%"><h1>ct_snmp</h1><h1>ct_snmp</h1><p>Common Test user interface module for the SNMP application.</p><p><strong>Common Test</strong> user interface module for the <strong>SNMP</strong>
application.The purpose of this module is to simplify SNMP configuration for the
test case writer. Many test cases can use default values for common
operations and then no SNMP configuration files need to be supplied.
When it is necessary to change particular configuration parameters, a
subset of the relevant SNMP configuration files can be passed to
<strong>ct_snmp</strong> by <strong>Common Test</strong> configuration files. For more
specialized configuration parameters, a simple SNMP configuration file
can be placed in the test suite data directory. To simplify the test
suite, <strong>Common Test</strong> keeps track of some of the SNMP manager
information. This way the test suite does not have to handle as many
input parameters as if it had to interface wthe OTP SNMP manager
directly.<em>Configurable SNMP Manager and Agent Parameters:</em>Manager configuration:<dl><dt><strong>[{start_manager, boolean()}</strong></dt><dd><p>Optional. Default is <strong>true</strong>.</p></dd><dt><strong>{users, [{user_name(), [call_back_module(), user_data()]}]}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{usm_users, [{usm_user_name(), [usm_config()]}]}</strong></dt><dd><p>Optional. SNMPv3 only.</p></dd><dt><strong>{managed_agents,[{agent_name(), [user_name(), agent_ip(), agent_port(), [agent_config()]]}]}</strong></dt><dd><p><strong>managed_agents</strong> is optional.</p></dd><dt><strong>{max_msg_size, integer()}</strong></dt><dd><p>Optional. Default is <strong>484</strong>.</p></dd><dt><strong>{mgr_port, integer()}</strong></dt><dd><p>Optional. Default is <strong>5000</strong>.</p></dd><dt><strong>{engine _id, string()}</strong></dt><dd><p>Optional. Default is <strong>"mgrEngine"</strong>.</p></dd></dl>Agent configuration:<dl><dt><strong>{start_agent, boolean()}</strong></dt><dd><p>Optional. Default is <strong>false</strong>.</p></dd><dt><strong>{agent_sysname, string()}</strong></dt><dd><p>Optional. Default is <strong>"ct_test"</strong>.</p></dd><dt><strong>{agent_manager_ip, manager_ip()}</strong></dt><dd><p>Optional. Default is <strong>localhost</strong>.</p></dd><dt><strong>{agent_vsns, list()}</strong></dt><dd><p>Optional. Default is <strong>[v2]</strong>.</p></dd><dt><strong>{agent_trap_udp, integer()}</strong></dt><dd><p>Optional. Default is <strong>5000</strong>.</p></dd><dt><strong>{agent_udp, integer()}</strong></dt><dd><p>Optional. Default is <strong>4000</strong>.</p></dd><dt><strong>{agent_notify_type, atom()}</strong></dt><dd><p>Optional. Default is <strong>trap</strong>.</p></dd><dt><strong>{agent_sec_type, sec_type()}</strong></dt><dd><p>Optional. Default is <strong>none</strong>.</p></dd><dt><strong>{agent_passwd, string()}</strong></dt><dd><p>Optional. Default is <strong>""</strong>.</p></dd><dt><strong>{agent_engine_id, string()}</strong></dt><dd><p>Optional. Default is <strong>"agentEngine"</strong>.</p></dd><dt><strong>{agent_max_msg_size, string()}</strong></dt><dd><p>Optional. Default is <strong>484</strong>.</p></dd></dl>The following parameters represents the SNMP configuration files
<strong>context.conf</strong>, <strong>standard.conf</strong>, <strong>community.conf</strong>,
<strong>vacm.conf</strong>, <strong>usm.conf</strong>, <strong>notify.conf</strong>,
<strong>target_addr.conf</strong>, and <strong>target_params.conf</strong>. Notice that
all values in <strong>agent.conf</strong> can be modified by the parameters
listed above. All these configuration files have default values set by
the <strong>SNMP</strong> application. These values can be overridden by suppling
a list of valid configuration values or a file located in the test
suites data directory, which can produce a list of valid configuration
values if you apply function <strong>file:consult/1</strong> to the file.<dl><dt><strong>{agent_contexts, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_community, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_sysinfo,  [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_vacm, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_usm, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_notify_def, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_target_address_def, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd><dt><strong>{agent_target_param_def, [term()] | {data_dir_file, rel_path()}}</strong></dt><dd><p>Optional.</p></dd></dl>Parameter <strong>MgrAgentConfName</strong> in the functions is to be a name
you allocate in your test suite using a <strong>require</strong> statement.
Example (where <strong>MgrAgentConfName = snmp_mgr_agent</strong>):<pre>
 suite() -&gt; [{require, snmp_mgr_agent, snmp}].</pre>or<pre>
 ct:require(snmp_mgr_agent, snmp).</pre>Notice that USM users are needed for SNMPv3 configuration and are
not to be confused with users.SNMP traps, inform, and report messages are handled by the user
callback module. For details, see the
<a href="./index">snmp/index</a> application.It is recommended to use the <strong>.hrl</strong> files created by the
Erlang/OTP MIB compiler to define the Object Identifiers (OIDs).
For example, to get the Erlang node name from <strong>erlNodeTable</strong>
in the OTP-MIB:<pre>
 Oid = ?erlNodeEntry ++ [?erlNodeName, 1]</pre>Furthermore, values can be set for <strong>SNMP</strong> application configuration
parameters, <strong>config</strong>, <strong>server</strong>, <strong>net_if</strong>, and so on (for
a list of valid parameters and types, see the  <a href="./users_guide">snmp/users_guide</a>). This is
done by defining a configuration data variable on the following form:<pre>
 {snmp_app, [{manager, [snmp_app_manager_params()]},
             {agent, [snmp_app_agent_params()]}]}.</pre>A name for the data must be allocated in the suite using
<strong>require</strong> (see the example above). Pass this name as argument
<strong>SnmpAppConfName</strong> to
<a href="#start-3">start-3</a>.
<strong>ct_snmp</strong> specifies default values for some <strong>SNMP</strong> application
configuration parameters (such as <strong>{verbosity,trace}</strong> for parameter
<strong>config</strong>). This set of defaults is merged with the parameters
specified by the user. The user values override <strong>ct_snmp</strong>
defaults.</p><h2>Data Types</h2><a name="types"></a><dl><dt><strong>agent_config() = {Item, Value}</strong></dt><dd><a name="type-agent_config"></a> </dd><dt><strong>agent_ip() = ip()</strong></dt><dd><a name="type-agent_ip"></a> </dd><dt><strong>agent_name() = atom()</strong></dt><dd><a name="type-agent_name"></a> </dd><dt><strong>agent_port() = integer()</strong></dt><dd><a name="type-agent_port"></a> </dd><dt><strong>call_back_module() = atom()</strong></dt><dd><a name="type-call_back_module"></a> </dd><dt><strong>error_index() = integer()</strong></dt><dd><a name="type-error_index"></a> </dd><dt><strong>error_status() = noError | atom()</strong></dt><dd><a name="type-error_status"></a> </dd><dt><strong>ip() = string() | {integer(), integer(), integer(), integer()}</strong></dt><dd><a name="type-ip"></a> </dd><dt><strong>manager_ip() = ip()</strong></dt><dd><a name="type-manager_ip"></a> </dd><dt><strong>oid() = [byte()]</strong></dt><dd><a name="type-oid"></a> </dd><dt><strong>oids() = [oid()]</strong></dt><dd><a name="type-oids"></a> </dd><dt><strong>rel_path() = string()</strong></dt><dd><a name="type-rel_path"></a> </dd><dt><strong>sec_type() = none | minimum | semi</strong></dt><dd><a name="type-sec_type"></a> </dd><dt><strong>snmp_app_agent_params() = term()</strong></dt><dd><a name="type-snmp_app_agent_params"></a> </dd><dt><strong>snmp_app_manager_params() = term()</strong></dt><dd><a name="type-snmp_app_manager_params"></a> </dd><dt><strong>snmpreply() = {error_status(), error_index(), varbinds()}</strong></dt><dd><a name="type-snmpreply"></a> </dd><dt><strong>user_data() = term()</strong></dt><dd><a name="type-user_data"></a> </dd><dt><strong>user_name() = atom()</strong></dt><dd><a name="type-user_name"></a> </dd><dt><strong>usm_config() = {Item, Value}</strong></dt><dd><a name="type-usm_config"></a> </dd><dt><strong>usm_user_name() = string()</strong></dt><dd><a name="type-usm_user_name"></a> </dd><dt><strong>value_type() = o('OBJECT IDENTIFIER') | i('INTEGER') | u('Unsigned32') | g('Unsigned32') | s('OCTET STRING')</strong></dt><dd><a name="type-value_type"></a> </dd><dt><strong>var_and_val() = {oid(), value_type(), value()}</strong></dt><dd><a name="type-var_and_val"></a> </dd><dt><strong>varbind() = term()</strong></dt><dd><a name="type-varbind"></a> </dd><dt><strong>varbinds() = [varbind()]</strong></dt><dd><a name="type-varbinds"></a> </dd><dt><strong>varsandvals() = [var_and_val()]</strong></dt><dd><a name="type-varsandvals"></a> </dd></dl><p>These data types are described in the documentation for
the <a href="./index">snmp/index</a> application.</p><h1>Functions</h1><h2>get_next_values(Agent, Oids, MgrAgentConfName) -&gt; SnmpReply</h2><p>Issues a synchronous SNMP get next request.</p><ul><li><span class="v">Agent = agent_name()</span></li><li><span class="v">Oids = oids()</span></li><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">SnmpReply = snmpreply()</span></li></ul><a name="get_next_values-3"></a><p>Issues a synchronous SNMP <strong>get next</strong> request.</p><h2>get_values(Agent, Oids, MgrAgentConfName) -&gt; SnmpReply</h2><p>Issues a synchronous SNMP get request.</p><ul><li><span class="v">Agent = agent_name()</span></li><li><span class="v">Oids = oids()</span></li><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">SnmpReply = snmpreply()</span></li></ul><a name="get_values-3"></a><p>Issues a synchronous SNMP <strong>get</strong> request.</p><h2>load_mibs(Mibs) -&gt; ok | {error, Reason}</h2><p>Loads the MIBs into agent snmp_master_agent.</p><ul><li><span class="v">Mibs = [MibName]</span></li><li><span class="v">MibName = string()</span></li><li><span class="v">Reason = term()</span></li></ul><a name="load_mibs-1"></a><p>Loads the MIBs into agent <strong>snmp_master_agent</strong>.</p><h2>register_agents(MgrAgentConfName, ManagedAgents) -&gt; ok | {error, Reason}</h2><p>Explicitly instructs the manager to handle this agent.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">ManagedAgents = [agent()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="register_agents-2"></a><p>Explicitly instructs the manager to handle this agent. Corresponds
to making an entry in <strong>agents.conf</strong>.</p><p>This function tries to register the specified managed agents, without
checking if any of them exist. To change a registered managed agent,
the agent must first be unregistered.</p><h2>register_users(MgrAgentConfName, Users) -&gt; ok | {error, Reason}</h2><p>Registers the manager entity (=user) responsible for specific agent(s).</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Users = [user()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="register_users-2"></a><p>Registers the manager entity (=user) responsible for specific
agent(s). Corresponds to making an entry in <strong>users.conf</strong>.</p><p>This function tries to register the specified users, without checking
if any of them exist. To change a registered user, the user must
first be unregistered.</p><h2>register_usm_users(MgrAgentConfName, UsmUsers) -&gt; ok | {error, Reason}</h2><p>Explicitly instructs the manager to handle this USM user.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">UsmUsers = [usm_user()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="register_usm_users-2"></a><p>Explicitly instructs the manager to handle this USM user.
Corresponds to making an entry in <strong>usm.conf</strong>.</p><p>This function tries to register the specified users, without checking
if any of them exist. To change a registered user, the user must
first be unregistered.</p><h2>set_info(Config) -&gt; [{Agent, OldVarsAndVals, NewVarsAndVals}]</h2><p>Returns a list of all successful set requests performed in the test case in reverse order.</p><ul><li><span class="v">Config = [{Key, Value}]</span></li><li><span class="v">Agent = agent_name()</span></li><li><span class="v">OldVarsAndVals = varsandvals()</span></li><li><span class="v">NewVarsAndVals = varsandvals()</span></li></ul><a name="set_info-1"></a><p>Returns a list of all successful <strong>set</strong> requests performed in
the test case in reverse order. The list contains the involved user
and agent, the value before <strong>set</strong>, and the new value. This is
intended to simplify the cleanup in function <strong>end_per_testcase</strong>,
that is, the undoing of the <strong>set</strong> requests and their possible
side-effects.</p><h2>set_values(Agent, VarsAndVals, MgrAgentConfName, Config) -&gt; SnmpReply</h2><p>Issues a synchronous SNMP set request.</p><ul><li><span class="v">Agent = agent_name()</span></li><li><span class="v">Oids = oids()</span></li><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Config = [{Key, Value}]</span></li><li><span class="v">SnmpReply = snmpreply()</span></li></ul><a name="set_values-4"></a><p>Issues a synchronous SNMP <strong>set</strong> request.</p><h2>start(Config, MgrAgentConfName) -&gt; ok</h2><p>Equivalent to start(Config, MgrAgentConfName, undefined).</p><a name="start-2"></a><p>Equivalent to
<a href="#start-3">start-3</a>.</p><h2>start(Config, MgrAgentConfName, SnmpAppConfName) -&gt; ok</h2><p>Starts an SNMP manager and/or agent.</p><ul><li><span class="v">Config = [{Key, Value}]</span></li><li><span class="v">Key = atom()</span></li><li><span class="v">Value = term()</span></li><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">SnmpConfName = atom()</span></li></ul><a name="start-3"></a><p>Starts an SNMP manager and/or agent. In the manager case,
registrations of users and agents, as specified by the configuration
<strong>MgrAgentConfName</strong>, are performed. When using SNMPv3, called
USM users are also registered. Users, <strong>usm_users</strong>, and
managed agents can also be registered later using
<a href="#register_users-2">register_users-2</a>,
<a href="#register_agents-2">register_agents-2</a>,
and
<a href="#register_usm_users-2">register_usm_users-2</a>.</p><p>The agent started is called <strong>snmp_master_agent</strong>. Use
<a href="#load_mibs-1">load_mibs-1</a>
to load MIBs into the agent.</p><p>With <strong>SnmpAppConfName</strong> SNMP applications can be configured
with parameters <strong>config</strong>, <strong>mibs</strong>, <strong>net_if</strong>, and so on.
The values are merged with (and possibly override) default values
set by <strong>ct_snmp</strong>.</p><h2>stop(Config) -&gt; ok</h2><p>Stops the SNMP manager and/or agent, and removes all files created.</p><ul><li><span class="v">Config = [{Key, Value}]</span></li><li><span class="v">Key = atom()</span></li><li><span class="v">Value = term()</span></li></ul><a name="stop-1"></a><p>Stops the SNMP manager and/or agent, and removes all files
created.</p><h2>unload_mibs(Mibs) -&gt; ok | {error, Reason}</h2><p>Unloads the MIBs from agent snmp_master_agent.</p><ul><li><span class="v">Mibs = [MibName]</span></li><li><span class="v">MibName = string()</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unload_mibs-1"></a><p>Unloads the MIBs from agent <strong>snmp_master_agent</strong>.</p><h2>unregister_agents(MgrAgentConfName) -&gt; ok</h2><p>Unregisters all managed agents.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_agents-1"></a><p>Unregisters all managed agents.</p><h2>unregister_agents(MgrAgentConfName, ManagedAgents) -&gt; ok</h2><p>Unregisters the specified managed agents.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">ManagedAgents = [agent_name()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_agents-2"></a><p>Unregisters the specified managed agents.</p><h2>unregister_users(MgrAgentConfName) -&gt; ok</h2><p>Unregisters all users.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_users-1"></a><p>Unregisters all users.</p><h2>unregister_users(MgrAgentConfName, Users) -&gt; ok</h2><p>Unregisters the specified users.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Users = [user_name()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_users-2"></a><p>Unregisters the specified users.</p><h2>unregister_usm_users(MgrAgentConfName) -&gt; ok</h2><p>Unregisters all USM users.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_usm_users-1"></a><p>Unregisters all USM users.</p><h2>unregister_usm_users(MgrAgentConfName, UsmUsers) -&gt; ok</h2><p>Unregisters the specified USM users.</p><ul><li><span class="v">MgrAgentConfName = atom()</span></li><li><span class="v">UsmUsers = [usm_user_name()]</span></li><li><span class="v">Reason = term()</span></li></ul><a name="unregister_usm_users-2"></a><p>Unregisters the specified USM users.</p></body></html>